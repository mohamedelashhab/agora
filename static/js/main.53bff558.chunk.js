(this["webpackJsonpAgora-Edu-Web"]=this["webpackJsonpAgora-Edu-Web"]||[]).push([[0],{195:function(e,t,a){},213:function(e,t,a){},214:function(e,t,a){},255:function(e,t,a){e.exports=function(){return new Worker(a.p+"5e0ef16dbf18f4194502.worker.js")}},286:function(e,t,a){e.exports=a(558)},291:function(e,t,a){},296:function(e,t,a){},314:function(e,t,a){},318:function(e,t,a){},334:function(e,t){},336:function(e,t){},354:function(e,t){},370:function(e,t,a){},371:function(e,t,a){},372:function(e,t,a){},373:function(e,t,a){},374:function(e,t,a){},375:function(e,t,a){},377:function(e,t,a){},378:function(e,t,a){},381:function(e,t,a){},382:function(e,t,a){},546:function(e,t,a){},548:function(e,t,a){},549:function(e,t,a){},550:function(e,t,a){},551:function(e,t,a){},552:function(e,t,a){},558:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(24),c=a.n(o),s=(a(291),a(28)),i=a(49),u=r.a.createContext({});var l=function(e){var t=e.children;return r.a.createElement(i.a,null,r.a.createElement(s.a,null,(function(e){return r.a.createElement(u.Provider,{value:e},t)})))},d=a(596),m=a(273),h=Object(m.a)({typography:{fontFamily:'-apple-system, BlinkMacSystemFont, \\"Segoe UI\\", \\"Roboto\\", \\"Oxygen\\", \\"Ubuntu\\", \\"Cantarell\\", \\"Fira Sans\\", \\"Droid Sans\\", \\"Helvetica Neue\\", sans-serif',fontSize:14,fontWeightLight:300,fontWeightRegular:400,fontWeightMedium:500},overrides:{MuiRadio:{root:{padding:"4px"}},MuiSvgIcon:{root:{width:"1rem",height:"1rem"}},MuiFormControl:{root:{margin:"0.3rem 0"}},MuiInput:{underline:{"&:before":{borderBottom:"1px solid #EAEAEA"},"&:hover:not($disabled):not($focused):not($error):before":{borderBottom:"2px solid #EAEAEA"},"&$focused":{"&:after":{borderBottom:"2px solid #44a2fc"}}}}}}),p=function(e){var t=e.children;return r.a.createElement(d.a,{theme:h},t)},f=a(2),v=a(14),_=a(630),b=a(606),g=a(252),O=a(597),E=function(e){return r.a.createElement(O.a,{id:"room_join",variant:"contained",className:e.className?e.className:"custom-button",color:"primary",onClick:e.onClick},e.name)},y=a(626),k=a(600),T=a(618),C=a(179),j=(a(296),a(19)),w=a(23),A=a(272),S=a(15),P=a.n(S),R=new(function(){function e(){Object(j.a)(this,e),this.storage=void 0,this.languageKey="demo_language",this.storage=window.sessionStorage}return Object(w.a)(e,[{key:"read",value:function(e){try{return JSON.parse(this.storage.getItem(e))}catch(t){return this.storage.getItem(e)}}},{key:"save",value:function(e,t){this.storage.setItem(e,JSON.stringify(t))}},{key:"clear",value:function(e){this.storage.removeItem(e)}},{key:"setLanguage",value:function(e){this.save(this.languageKey,e)}},{key:"getLanguage",value:function(){return{language:this.read(this.languageKey)?this.read(this.languageKey):navigator.language}}},{key:"getRtmMessage",value:function(){var e=R.read("channelMessages");if(Object(S.isEmpty)(e))return{count:0,messages:[]};var t=e.filter((function(e){return"group_message"===e.message_type})).reduce((function(e,t){var a=t.payload,n=JSON.parse(a);return n.content?e.concat({account:n.account,content:n.content,ms:t.ms,src:t.src}):e}),[]);return{messages:t,count:t.length}}}]),e}());window.GlobalStorage=R;var N=R,x=[{value:0,text:"home.1v1",path:"one-to-one"},{value:1,text:"home.mini_class",path:"small-class"},{value:2,text:"home.large_class",path:"big-class"}],I=new(function(){function e(){Object(j.a)(this,e),this.subject=void 0,this.state=void 0,this.defaultState=Object(f.a)({loading:!1,toast:{type:"",message:""},dialog:{type:"",message:"",confirmText:"confirm",cancelText:"cancel"},uploadNotice:{type:"",title:""},notice:{reason:"",text:""},nativeWindowInfo:{visible:!1,items:[]},lock:!1,active:"chatroom",language:navigator.language,newMessageCount:0},N.getLanguage()),this.subject=null,this.state=this.defaultState}return Object(w.a)(e,[{key:"initialize",value:function(){this.subject=new A.a,this.state=Object(f.a)({},this.defaultState),this.subject.next(this.state)}},{key:"subscribe",value:function(e){this.initialize(),this.subject&&this.subject.subscribe(e)}},{key:"unsubscribe",value:function(){this.subject&&this.subject.unsubscribe(),this.subject=null}},{key:"commit",value:function(e){this.subject&&this.subject.next(e)}},{key:"updateState",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),e),this.commit(this.state)}},{key:"showNotice",value:function(e){var t=e.reason,a=e.text;this.state=Object(f.a)(Object(f.a)({},this.state),{},{notice:{text:a,reason:t}}),this.commit(this.state)}},{key:"removeNotice",value:function(){this.state=Object(f.a)(Object(f.a)({},this.state),{},{notice:{text:"",reason:""}}),this.commit(this.state)}},{key:"setNativeWindowInfo",value:function(e){var t=e.visible,a=e.items;this.state=Object(f.a)(Object(f.a)({},this.state),{},{nativeWindowInfo:{visible:t,items:a}}),this.commit(this.state)}},{key:"showUploadNotice",value:function(e){var t=e.type,a=e.title;this.state=Object(f.a)(Object(f.a)({},this.state),{},{uploadNotice:{type:t,title:a}}),this.commit(this.state)}},{key:"removeUploadNotice",value:function(){this.state=Object(f.a)(Object(f.a)({},this.state),{},{uploadNotice:{type:"",title:""}}),this.commit(this.state)}},{key:"showToast",value:function(e){var t=e.type,a=e.message;this.state=Object(f.a)(Object(f.a)({},this.state),{},{toast:{type:t,message:a}}),this.commit(this.state)}},{key:"showDialog",value:function(e){var t=e.type,a=e.message;this.state=Object(f.a)(Object(f.a)({},this.state),{},{dialog:{type:t,message:a}}),this.commit(this.state)}},{key:"removeDialog",value:function(){this.state=Object(f.a)(Object(f.a)({},this.state),{},{dialog:{type:"",message:""}}),this.commit(this.state)}},{key:"showLoading",value:function(){this.state=Object(f.a)(Object(f.a)({},this.state),{},{loading:!0}),this.commit(this.state)}},{key:"stopLoading",value:function(){this.state=Object(f.a)(Object(f.a)({},this.state),{},{loading:!1}),this.commit(this.state)}},{key:"getLanguage",value:function(){return N.read("demo_language")}},{key:"setLanguage",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{language:e}),this.commit(this.state),N.save("demo_language",this.state.language),window.location.reload()}},{key:"setActive",value:function(e){this.state="chatroom"!==e?Object(f.a)(Object(f.a)({},this.state),{},{active:e}):Object(f.a)(Object(f.a)({},this.state),{},{active:e,newMessageCount:0}),this.commit(this.state)}},{key:"setMessageCount",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{newMessageCount:e}),this.commit(this.state)}},{key:"lock",value:function(){this.state=Object(f.a)(Object(f.a)({},this.state),{},{lock:!0}),this.commit(this.state)}},{key:"unlock",value:function(){this.state=Object(f.a)(Object(f.a)({},this.state),{},{lock:!1}),this.commit(this.state)}}]),e}());window.globalStore=I;var D=Object({NODE_ENV:"production",PUBLIC_URL:"/agora",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_AGORA_APP_ID:"28ee29aa37f1480b98ea44c6668e56a5",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_EDU_ENDPOINT_PREFIX:"https://api.agora.io/edu",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"OThmNDM5NjQ0NGU1NDE1NDgxZWM2NzgyZjUwYzAzODE6MmRjYjRkZDI5NTAxNGJiZjgxYTZiOWMxYjg1ZGYxMTY=",REACT_APP_AGORA_RTM_ENDPOINT:"your_server_rtm_endpoint_api",REACT_APP_END_POINT:"http://127.0.0.1:8000/",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}).REACT_APP_BUILD_VERSION,U={screen_share_permission:"\u7f3a\u5c11\u5c4f\u5e55\u5171\u4eab\u6743\u9650",electron:{start_screen_share_failed:"native screen sharing failed"},icon:{setting:"\u8bbe\u7f6e","upload-log":"\u4e0a\u4f20\u65e5\u5fd7","exit-room":"\u9000\u51fa\u6559\u5ba4","lang-select":"\u8bed\u8a00\u5207\u6362"},doc_center:"\u6587\u6863\u4e2d\u5fc3",upload_picture:"\u4e0a\u4f20\u56fe\u7247",convert_webpage:"\u8f6c\u6362\u52a8\u6001PPT",convert_to_picture:"PPT\u8f6c\u56fe\u7247",upload_audio_video:"\u4e0a\u4f20\u97f3\u89c6\u9891",return:{home:"\u8fd4\u56de\u4e3b\u9875"},control_items:{first_page:"\u7b2c\u4e00\u9875",prev_page:"\u4e0a\u4e00\u9875",next_page:"\u4e0b\u4e00\u9875",last_page:"\u6700\u540e\u4e00\u9875",stop_recording:"\u505c\u6b62\u4e91\u7aef\u5f55\u5236",recording:"\u5f00\u59cb\u4e91\u7aef\u5f55\u5236",quit_screen_sharing:"\u505c\u6b62\u5c4f\u5e55\u5206\u4eab",screen_sharing:"\u5f00\u59cb\u5c4f\u5e55\u5206\u4eab",delete_current:"\u5220\u9664\u5f53\u524d",delete_all:"\u5220\u9664\u5168\u90e8"},zoom_control:{folder:"\u6587\u6863\u4e2d\u5fc3",lock_board:"\u8bbe\u7f6e\u767d\u677f\u8ddf\u968f",unlock_board:"\u53d6\u6d88\u767d\u677f\u8ddf\u968f"},tool:{selector:"\u9f20\u6807\u9009\u62e9\u5668",pencil:"\u753b\u7b14",rectangle:"\u77e9\u5f62",ellipse:"\u692d\u5706",eraser:"\u6a61\u76ae\u64e6",text:"\u6587\u5b57",color_picker:"\u8c03\u8272\u677f",add:"\u65b0\u589e\u4e00\u9875",upload:"\u4e0a\u4f20",hand_tool:"\u624b\u6293\u5de5\u5177"},error:{not_found:"\u9875\u9762\u627e\u4e0d\u5230",components:{paramsEmpty:"\u53c2\u6570\uff1a{reason}\u4e0d\u80fd\u4e3a\u7a7a"}},whiteboard:{loading:"\u52a0\u8f7d\u4e2d...",global_state_limit:"\u8bf7\u4e0d\u8981\u7ed9\u767d\u677f\u8bbe\u7f6e\u8fc7\u5927\u7684globalState size",locked_board:"\u8001\u5e08\u6b63\u5728\u63a7\u5236\u767d\u677f\uff0c\u8bf7\u52ff\u4e66\u5199",unlocked_board:"\u767d\u677f\u5df2\u89e3\u9664\u9501\u5b9a\u3002"},toast:{upload_log_failure:"\u4e0a\u4f20\u65e5\u5fd7\u5931\u8d25\uff0c\u9519\u8bef\u7c7b\u578b\uff1a{reason}, \u8be6\u60c5\u53c2\u8003\u5f00\u53d1\u8005\u5de5\u5177",show_log_id:"\u8bf7\u63d0\u4f9b\u4f60\u7684\u65e5\u5fd7ID: {no}",api_login_failured:"\u623f\u95f4\u52a0\u5165\u5931\u8d25, \u539f\u56e0: {reason}",confirm:"\u786e\u5b9a",cancel:"\u53d6\u6d88",quit_room:"\u786e\u5b9a\u9000\u51fa\u8bfe\u7a0b\u5417\uff1f",kick:"\u5176\u4ed6\u7aef\u767b\u5f55\uff0c\u88ab\u8e22\u51fa\u623f\u95f4",login_failure:"\u767b\u5f55\u623f\u95f4\u5931\u8d25",whiteboard_lock:"\u8bbe\u7f6e\u767d\u677f\u8ddf\u968f",whiteboard_unlock:"\u53d6\u6d88\u767d\u677f\u8ddf\u968f",canceled_screen_share:"\u5df2\u53d6\u6d88\u5c4f\u5e55\u5171\u4eab",screen_sharing_failed:"\u5c4f\u5e55\u5206\u4eab\u5931\u8d25, \u539f\u56e0\uff1a{reason}",recording_failed:"\u5f00\u542f\u4e91\u5f55\u5236\u5931\u8d25, \u539f\u56e0\uff1a{reason}",start_recording:"\u5f00\u59cb\u4e91\u5f55\u5236",stop_recording:"\u7ed3\u675f\u4e91\u5f55\u5236",recording_too_short:"\u5f55\u5236\u592a\u77ed\uff0c\u81f3\u5c1115\u79d2",rtm_login_failed:"\u623f\u95f4\u767b\u5f55\u5931\u8d25, \u8bf7\u68c0\u67e5\u7f51\u7edc\u8bbe\u7f6e",rtm_login_failed_reason:"\u623f\u95f4\u767b\u5f55\u5931\u8d25, \u539f\u56e0\uff1a {reason}",replay_failed:"\u56de\u653e\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5",teacher_exists:"\u8be5\u623f\u95f4\u8001\u5e08\u5df2\u5b58\u5728\uff0c\u8bf7\u7b49\u5f8530\u79d2\u6216\u91cd\u65b0\u521b\u5efa\u6559\u5ba4",student_over_limit:"\u8d85\u51fa\u5b66\u751f\u6700\u5927\u4eba\u6570\uff0c\u8bf7\u7b49\u5f8530\u79d2\u6216\u91cd\u65b0\u521b\u5efa\u6559\u5ba4",teacher_and_student_over_limit:"\u8d85\u51fa\u5b66\u751f\u548c\u8001\u5e08\u7684\u6700\u5927\u4eba\u6570",teacher_accept_whiteboard:"\u8001\u5e08\u5df2\u6388\u6743\u4e86\u4f60\u767d\u677f\u7684\u6743\u9650",teacher_cancel_whiteboard:"\u8001\u5e08\u5df2\u6536\u56de\u4e86\u4f60\u767d\u677f\u7684\u6743\u9650",teacher_accept_co_video:"\u8001\u5e08\u5df2\u5141\u8bb8\u8fde\u9ea6",teacher_reject_co_video:"\u8001\u5e08\u5df2\u62d2\u7edd\u8fde\u9ea6",teacher_cancel_co_video:"\u8001\u5e08\u5df2\u53d6\u6d88\u8fde\u9ea6",student_cancel_co_video:"\u5b66\u751f\u5df2\u53d6\u6d88\u8fde\u9ea6",student_send_co_video_apply:'"{reason}" \u5b66\u751f\u53d1\u8d77\u4e86\u8fde\u9ea6\u7533\u8bf7',student_peer_leave:'"{reason}" \u79bb\u5f00\u4e86',stop_co_video:'\u6559\u5e08\u505c\u6b62\u4e86"{reason}"\u7684\u8fde\u9ea6',reject_co_video:"\u60a8\u53d6\u6d88\u4e86\u5b66\u751f\u7684\u8fde\u9ea6\u7533\u8bf7",close_co_video:"\u60a8\u5173\u95ed\u4e86\u5b66\u751f\u7684\u8fde\u9ea6",close_youself_co_video:"\u4f60\u5173\u95ed\u4e86\u81ea\u5df1\u7684\u8fde\u9ea6",accept_co_video:"\u60a8\u540c\u610f\u4e86\u8fde\u9ea6"},notice:{student_interactive_apply:'"{reason}"\u60f3\u548c\u4f60\u8fde\u9ea6'},chat:{placeholder:"\u8bf4\u70b9\u4ec0\u4e48",banned:"\u7981\u8a00\u4e2d",send:"\u53d1\u9001"},device:{camera:"\u6444\u50cf\u5934",microphone:"\u9ea6\u514b\u98ce",speaker:"\u626c\u58f0\u5668",finish:"\u5b8c\u6210"},nav:{delay:"\u5ef6\u8fdf: ",network:"\u7f51\u7edc: ",cpu:"CPU: ",class_end:"\u8bfe\u7a0b\u7ed3\u675f",class_start:"\u8bfe\u7a0b\u5f00\u59cb"},home:{"entry-home":"\u8fdb\u5165\u6559\u5ba4",teacher:"\u8001\u5e08",student:"\u5b66\u751f",cover_class:"cover-cn",room_name:"\u623f\u95f4\u540d",nickname:"\u6635\u79f0",room_type:"\u623f\u95f4\u7c7b\u578b",room_join:"\u52a0\u5165\u623f\u95f4",short_title:{title:"\u58f0\u7f51\u4e91\u8bfe\u5802",subtitle:"\u7531\u58f0\u7f51\u63d0\u4f9b"},name_too_long:"\u540d\u5b57\u8fc7\u957f\uff0c\u4e0d\u5f97\u8d85\u8fc720\u4e2a\u5b57\u7b26","1v1":"\u4e00\u5bf9\u4e00",mini_class:"\u5c0f\u73ed\u8bfe",large_class:"\u5927\u73ed\u8bfe",missing_room_name:"\u7f3a\u5c11\u623f\u95f4\u540d",missing_your_name:"\u7f3a\u5c11\u6635\u79f0",missing_password:"\u7f3a\u5c11\u623f\u95f4\u5bc6\u7801",missing_role:"\b\u7f3a\u5c11\u89d2\u8272",account:"\u59d3\u540d",password:"\u5bc6\u7801"},room:{chat_room:"\u6d88\u606f\u5217\u8868",student_list:"\u5b66\u751f\u5217\u8868",uploading:"\u4e0a\u4f20\u4e2d...",converting:"\u8f6c\u6362\u4e2d...",upload_success:"\u4e0a\u4f20\u6210\u529f",upload_failure:"\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc",convert_success:"\u8f6c\u6362\u6210\u529f",convert_failure:"\u8f6c\u6362\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc"},replay:{loading:"\u52a0\u8f7d\u4e2d...",recording:"\u5728\u5f55\u5236\u4e2d",finished:"\u5f55\u5236\u5b8c\u6210",finished_recording_to_be_download:"\u670d\u52a1\u7aef\u51c6\u5907\u4e0b\u8f7d\u4e2d",finished_download_to_be_convert:"\u670d\u52a1\u7aef\u51c6\u5907\u8f6c\u6362\u4e2d",finished_convert_to_be_upload:"\u670d\u52a1\u7aef\u51c6\u5907\u4fdd\u5b58\u4e2d"},course_recording:"\u5f55\u5236\u56de\u653e",build_version:"\u6784\u5efa\u7248\u672c: ".concat(D||"0.0.1")},M=Object({NODE_ENV:"production",PUBLIC_URL:"/agora",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_AGORA_APP_ID:"28ee29aa37f1480b98ea44c6668e56a5",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_EDU_ENDPOINT_PREFIX:"https://api.agora.io/edu",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"OThmNDM5NjQ0NGU1NDE1NDgxZWM2NzgyZjUwYzAzODE6MmRjYjRkZDI5NTAxNGJiZjgxYTZiOWMxYjg1ZGYxMTY=",REACT_APP_AGORA_RTM_ENDPOINT:"your_server_rtm_endpoint_api",REACT_APP_END_POINT:"http://127.0.0.1:8000/",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}).REACT_APP_BUILD_VERSION,L={screen_share_permission:"Need Electron Screen Capture Permission",electron:{start_screen_share_failed:"native screen sharing failed"},icon:{setting:"Setting","upload-log":"Upload Log","exit-room":"Exit Room","lang-select":"Switch Language"},doc_center:"Course Document Center",upload_picture:"Upload Picture",convert_webpage:"Dynamic PPT",convert_to_picture:"Static PPT",upload_audio_video:"Upload Audio/Video",return:{home:"Back To Home"},control_items:{first_page:"First Page",prev_page:"Prev Page",next_page:"Next Page",last_page:"Last Page",stop_recording:"Stop Cloud Recording",recording:"Start Cloud Recording",quit_screen_sharing:"Stop Screen Sharing",screen_sharing:"Start Screen Sharing",delete_current:"Remove Current",delete_all:"Remove All"},zoom_control:{folder:"Document Center",lock_board:"Set Whiteboard Follow",unlock_board:"Reset Whiteboard Follow"},tool:{selector:"mouse selector",pencil:"penceil",rectangle:"rectangle",ellipse:"ellipse",eraser:"eraser",text:"text",color_picker:"color picker",add:"add new page",upload:"upload ",hand_tool:"hand selector"},error:{not_found:"Page Not Found",components:{paramsEmpty:"params\uff1a{reason} can`t be empty"}},whiteboard:{loading:"Loading...",global_state_limit:"globalState size limit size probably overflow",locked_board:"The teacher is moving the whiteboard. Please do not draw on it.",unlocked_board:"The whiteboard already unlocked"},toast:{upload_log_failure:"Upload Log Failure\uff0cErrorName: {reason}\uff0csee more details in devtool",show_log_id:"Report your log ID: {reason}",api_login_failured:"Join Failured, Reason: {reason}",confirm:"Confirm",cancel:"Cancel",quit_room:"Are you sure to exit the classroom?",kick:"kicked",login_failure:"login failure",whiteboard_lock:"Whiteboard follow",whiteboard_unlock:"Whiteboard nofollow",canceled_screen_share:"Canceled screen sharing",screen_sharing_failed:"Screen sharing failed, reason: {reason}",recording_failed:"Start cloud recording failed, reason: {reason}",start_recording:"Start cloud recording success",stop_recording:"Stop cloud recording success",recording_too_short:"Recording too short, at least 15 seconds",rtm_login_failed:"login failure, please check your network",rtm_login_failed_reason:"login failure, reason: {reason}",replay_failed:"Replay Failed please refresh browser",teacher_exists:"Teacher already exists, Please waiting for 30s or reopen new class",student_over_limit:"Student have reached upper limit, , Please waiting for 30s or rejoin new class",teacher_and_student_over_limit:"The number of students and teacher have reached upper limit",teacher_accept_whiteboard:"Teacher already grant your whiteboard",teacher_cancel_whiteboard:"Teacher already cancel your whiteboard",teacher_accept_co_video:"Teacher already accept co-video",teacher_reject_co_video:"Teacher already rejected co-video",teacher_cancel_co_video:"Teacher already canceled co-video",student_cancel_co_video:"Student canceled co-video",student_peer_leave:'"{reason}" Left',student_send_co_video_apply:'"{reason}" send the co-video request',stop_co_video:'Stop "{reason}" co-video',reject_co_video:"Reject co-video",close_co_video:"Close co-video",close_youself_co_video:"Stop co-video",accept_co_video:"Accept co-video"},notice:{student_interactive_apply:'"{reason}" wants to interact with you'},chat:{placeholder:"Input Message",banned:"Banned",send:"send"},device:{camera:"Camera",microphone:"Microphone",speaker:"Speaker",finish:"Finish"},nav:{delay:"Delay: ",network:"Network: ",cpu:"CPU: ",class_end:"Class end",class_start:"Class start"},home:{"entry-home":"Join Classroom",teacher:"teacher",student:"student",cover_class:"cover-en",room_name:"Room Name",nickname:"Your Name",room_type:"Room Type",room_join:"Join",short_title:{title:"Agora Cloud Class",subtitle:"Powered by agora.io, a leading online learning engagement platform"},name_too_long:"name too long, should <= 20 characters","1v1":"One to One Classroom",mini_class:"Small Classroom",large_class:"Lecture Hall",missing_room_name:"missing room name",missing_your_name:"missing your name",missing_password:"missing password",missing_role:"missing role",account:"Name",password:"Password"},room:{chat_room:"Chat Room",student_list:"Student List",uploading:"Uploading...",converting:"Converting...",upload_success:"upload success",upload_failure:"upload failure, check the network",convert_success:"convert success",convert_failure:"convert failure, check the network"},replay:{loading:"loading...",recording:"In Recording",finished:"Finished",finished_recording_to_be_download:"Server prepare downloading",finished_download_to_be_convert:"Server prepare converting",finished_convert_to_be_upload:"Server prepare saving"},course_recording:"course recording",build_version:"build version: ".concat(M||"0.0.1")},B=Object({NODE_ENV:"production",PUBLIC_URL:"/agora",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_AGORA_APP_ID:"28ee29aa37f1480b98ea44c6668e56a5",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_EDU_ENDPOINT_PREFIX:"https://api.agora.io/edu",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"OThmNDM5NjQ0NGU1NDE1NDgxZWM2NzgyZjUwYzAzODE6MmRjYjRkZDI5NTAxNGJiZjgxYTZiOWMxYjg1ZGYxMTY=",REACT_APP_AGORA_RTM_ENDPOINT:"your_server_rtm_endpoint_api",REACT_APP_END_POINT:"http://127.0.0.1:8000/",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}).REACT_APP_BUILD_VERSION,W=function(e,t){var a=I.state.language.match(/zh/)?U:L,n=Object(S.get)(a,e,null);return n?(Object(S.isEmpty)(t)||t.reason&&n.match(/\{.+\}/)&&(n=n.replace(/\{.+\}/,t.reason)),n):(console.error("".concat(a,": ").concat(e," has no match")),"".concat(a,".").concat(e))},Y=Object(g.a)((function(e){return{radioGroup:{display:"block",clear:"both",justifyContent:"space-between"},required:{fontSize:"12px",color:"#ff0000",lineHeight:"17px",position:"absolute",top:"23px"}}})),G=function(e){var t=Y();return r.a.createElement(y.a,{className:t.radioGroup,row:!0,value:e.role,onChange:e.onChange},r.a.createElement(k.a,{className:"custom-radio align-left",value:"teacher",control:r.a.createElement(T.a,{className:"custom-radio",color:"primary"}),label:W("home.teacher"),labelPlacement:"end"}),r.a.createElement(k.a,{className:"custom-radio align-right",value:"student",control:r.a.createElement(T.a,{className:"custom-radio",color:"primary"}),label:W("home.student"),labelPlacement:"end"}),e.requiredText?r.a.createElement(C.a,{className:t.required},e.requiredText):null)},K=function(e){var t=e.data,a=e.icon,n=e.disable,o=e.className,c=e.onClick,s=n?"":a?"icon-btn":"icon";s=e.active?s+" active":s;var i=t||"";return r.a.createElement("div",{className:"".concat(s," ").concat(o),onClick:c,"data-name":i})},F=a(627),V=a(601),z=Object(g.a)((function(e){return{formInput:{"&:after":{borderBottom:"1px solid #44a2fc"}},required:{fontSize:"12px",color:"#ff0000",lineHeight:"17px",position:"absolute",top:"48px"}}})),Z=function(e){var t=z();return r.a.createElement(r.a.Fragment,null,r.a.createElement(F.a,null,e.Label),r.a.createElement(V.a,{className:t.formInput,value:e.value,onChange:function(t){var a=t.target.value;e.onChange(a||"")}}),e.requiredText?r.a.createElement(C.a,{className:t.required},e.requiredText):null)},H=a(617),J=a(629),q=r.a.memo((function(e){var t=e.Label,a=e.value,n=e.onChange,o=e.items;return r.a.createElement(r.a.Fragment,null,r.a.createElement(F.a,null,t),r.a.createElement(H.a,{value:a,onChange:n},o.map((function(e,t){return r.a.createElement(J.a,{key:t,value:t},e.text)}))))})),X=r.a.memo((function(e){var t=e.value,a=e.onChange,n=e.items;return r.a.createElement(H.a,{value:t,onChange:a},n.map((function(e,t){return r.a.createElement(J.a,{key:t,value:t},e.text)})))}));console.log("CURRENT RUNTIME: ".concat("web"));var Q,$,ee,te=r.a.createContext({}),ae=function(){return r.a.useContext(te)},ne=function(e){var t=e.children,a=P.a.get(Object({NODE_ENV:"production",PUBLIC_URL:"/agora",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_AGORA_APP_ID:"28ee29aa37f1480b98ea44c6668e56a5",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_EDU_ENDPOINT_PREFIX:"https://api.agora.io/edu",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"OThmNDM5NjQ0NGU1NDE1NDgxZWM2NzgyZjUwYzAzODE6MmRjYjRkZDI5NTAxNGJiZjgxYTZiOWMxYjg1ZGYxMTY=",REACT_APP_AGORA_RTM_ENDPOINT:"your_server_rtm_endpoint_api",REACT_APP_END_POINT:"http://127.0.0.1:8000/",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}),"REACT_APP_RUNTIME_PLATFORM","web"),o=Object(s.f)(),c=window.ipc;Object(n.useEffect)((function(){c&&(o.pathname.match(/classroom|replay/)?c.send("resize-window",{width:990,height:706}):c.send("resize-window",{width:700,height:500}))}),[o,c]);var i=function(e){if(c)switch(e){case"minimum":return void c.send("minimum");case"maximum":return void c.send("maximum");case"close":return void c.send("close")}},u={platform:a,NavBtn:function(){return"electron"===a?r.a.createElement("div",{className:"menu-group"},r.a.createElement(K,{className:"icon-minimum",icon:!0,onClick:function(){i("minimum")}}),r.a.createElement(K,{className:"icon-maximum",icon:!0,onClick:function(){i("maximum")}}),r.a.createElement(K,{className:"icon-close",icon:!0,onClick:function(){i("close")}})):null},HomeBtn:function(e){var t=e.handleSetting;return"electron"===a?r.a.createElement(r.a.Fragment,null,r.a.createElement(K,{className:"icon-setting",onClick:t}),r.a.createElement("div",{className:"icon-container"},r.a.createElement(K,{className:"icon-minimum",onClick:function(){i("minimum")}}),r.a.createElement(K,{className:"icon-close",onClick:function(){i("close")}}))):null},SettingBtn:function(){return"electron"===a?r.a.createElement(r.a.Fragment,null,r.a.createElement(K,{className:"icon-minimum",onClick:function(){i("minimum")}}),r.a.createElement(K,{className:"icon-close",onClick:function(){i("close")}})):null}};return r.a.createElement(te.Provider,{value:u},t)},re=a(86),oe=a(75),ce=a(1),se=a.n(ce),ie=a(5),ue=a(45),le="28ee29aa37f1480b98ea44c6668e56a5",de=(Object({NODE_ENV:"production",PUBLIC_URL:"/agora",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_AGORA_APP_ID:"28ee29aa37f1480b98ea44c6668e56a5",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_EDU_ENDPOINT_PREFIX:"https://api.agora.io/edu",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"OThmNDM5NjQ0NGU1NDE1NDgxZWM2NzgyZjUwYzAzODE6MmRjYjRkZDI5NTAxNGJiZjgxYTZiOWMxYjg1ZGYxMTY=",REACT_APP_AGORA_RTM_ENDPOINT:"your_server_rtm_endpoint_api",REACT_APP_END_POINT:"http://127.0.0.1:8000/",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}).REACT_APP_AGORA_APP_TOKEN,a(34)),me=a.n(de),he=a(141),pe=a.n(he),fe=pe.a.LOG_FILTER_DEBUG;!function(e){e[e.muteAudio=101]="muteAudio",e[e.unmuteAudio=102]="unmuteAudio",e[e.muteVideo=103]="muteVideo",e[e.unmuteVideo=104]="unmuteVideo",e[e.applyCoVideo=105]="applyCoVideo",e[e.acceptCoVideo=106]="acceptCoVideo",e[e.rejectCoVideo=107]="rejectCoVideo",e[e.cancelCoVideo=108]="cancelCoVideo",e[e.muteChat=109]="muteChat",e[e.unmuteChat=110]="unmuteChat",e[e.muteBoard=200]="muteBoard",e[e.unmuteBoard=201]="unmuteBoard",e[e.lockBoard=301]="lockBoard",e[e.unlockBoard=302]="unlockBoard",e[e.startCourse=401]="startCourse",e[e.endCourse=402]="endCourse",e[e.muteAllChat=501]="muteAllChat",e[e.unmuteAllChat=502]="unmuteAllChat"}(Q||(Q={})),function(e){e[e.chat=1]="chat",e[e.roomMemberChanged=2]="roomMemberChanged",e[e.roomInfoChanged=3]="roomInfoChanged",e[e.coVideoUsersChanged=4]="coVideoUsersChanged",e[e.replay=5]="replay",e[e.screenShare=6]="screenShare",e[e.recordStateChanged=7]="recordStateChanged"}($||($={})),function(e){e[e.studentSendApply=1]="studentSendApply",e[e.teacherSendReject=2]="teacherSendReject",e[e.teacherSendAccept=4]="teacherSendAccept",e[e.teacherSendStop=5]="teacherSendStop",e[e.studentSendStop=6]="studentSendStop"}(ee||(ee={}));var ve=function(){function e(){Object(j.a)(this,e),this._bus=void 0,this._currentChannel=void 0,this._currentChannelName=void 0,this._channels=void 0,this._client=void 0,this._channelAttrsKey=void 0,this._logged=!1,this._joined=!1,this._bus=new me.a,this._channels={},this._currentChannel=null,this._currentChannelName=null,this._channelAttrsKey=null,this._client=null}return Object(w.a)(e,[{key:"removeAllListeners",value:function(){this._bus.removeAllListeners()}},{key:"destroy",value:function(){for(var e=0,t=Object.keys(this._channels);e<t.length;e++){var a=t[e];this._channels[a]&&(this._channels[a].removeAllListeners(),this._channels[a]=null)}this._currentChannel=null,this._currentChannelName=null,this._client.removeAllListeners()}},{key:"on",value:function(e,t){this._bus.on(e,t)}},{key:"off",value:function(e,t){this._bus.off(e,t)}},{key:"login",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a,n){var r,o=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=pe.a.createInstance(t,{enableLogUpload:!0,logFilter:fe}),e.prev=1,e.next=4,r.login({uid:a,token:n});case 4:r.on("ConnectionStateChanged",(function(e,t){o._bus.emit("ConnectionStateChanged",{newState:e,reason:t})})),r.on("MessageFromPeer",(function(e,t,a){o._bus.emit("MessageFromPeer",{message:e,peerId:t,props:a})})),this._client=r,this._logged=!0,e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(1),r.removeAllListeners(),e.t0;case 14:return e.abrupt("return");case 15:case"end":return e.stop()}}),e,this,[[1,10]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logged){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._client.logout();case 4:return this.destroy(),this._logged=!1,e.abrupt("return");case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"join",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this._client.createChannel(t),this._channels[t]=a,this._currentChannel=this._channels[t],this._currentChannelName=t,e.next=6,a.join();case 6:return a.on("ChannelMessage",(function(e,t){n._bus.emit("ChannelMessage",{message:e,memberId:t})})),a.on("MemberJoined",(function(e){n._bus.emit("MemberJoined",e)})),a.on("MemberLeft",(function(e){n._bus.emit("MemberLeft",e)})),a.on("MemberCountUpdated",(function(e){n._bus.emit("MemberCountUpdated",e)})),a.on("AttributesUpdated",(function(e){n._bus.emit("AttributesUpdated",e)})),this._joined=!0,e.abrupt("return");case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"destroyChannel",value:function(e){this._channels[e]&&(this._channels[e].removeAllListeners(),this._channels[e]=null)}},{key:"leave",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._channels[t]&&(this._joined=!1,this.destroyChannel(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"exit",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.deleteChannelAttributesByKey();case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:return e.prev=7,e.next=10,this.leave(this._currentChannelName);case 10:return e.next=12,this.logout();case 12:return e.finish(7);case 13:case"end":return e.stop()}}),e,this,[[0,5,7,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"notifyMessage",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.cmd,n=t.data,r=t.enableHistoricalMessaging,o=void 0!==r&&r,c=JSON.stringify({cmd:a,data:n}),e.abrupt("return",this._currentChannel.sendMessage({text:c},{enableHistoricalMessaging:o}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendPeerMessage",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ee(t,a),console.log("[rtm-client] send peer message ",t,JSON.stringify(a)),e.next=4,this._client.sendMessageToPeer({text:JSON.stringify(a)},t,{enableHistoricalMessaging:!0});case 4:return n=e.sent,e.abrupt("return",n.hasPeerReceived);case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"sendRecordMessage",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={account:t.account,recordId:t.recordId},e.abrupt("return",this.notifyMessage({cmd:$.replay,data:a,enableHistoricalMessaging:!1}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateChannelAttrsByKey",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._channelAttrsKey=t,n={},t&&(n[t]=JSON.stringify(a)),console.log("[rtm-client] updateChannelAttrsByKey ",a," key ",t,n),e.next=6,this._client.addOrUpdateChannelAttributes(this._currentChannelName,n,{enableNotificationToChannelMembers:!0});case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKey",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._channelAttrsKey){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._client.deleteChannelAttributesByKeys(this._currentChannelName,[this._channelAttrsKey],{enableNotificationToChannelMembers:!0});case 4:return this._channelAttrsKey=null,e.abrupt("return");case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChannelAttrs",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._client.getChannelAttributes(this._currentChannelName);case 2:return t=e.sent,e.abrupt("return",JSON.stringify(t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._client.getChannelMemberCount(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryOnlineStatusBy",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={teacherCount:0,totalCount:0,studentTotalCount:0},!(t.length>0)){e.next=7;break}return n=t.map((function(e){return"".concat(e.uid)})),e.next=5,this._client.queryPeersOnlineStatus(n);case 5:(a=e.sent)&&Object.keys(a).length?((r=t.find((function(e){return"teacher"===e.role})))&&a[r.uid]&&(a.teacher=a[r.uid],a.teacherCount=1),a.totalCount=t.filter((function(e){return a[e.uid]})).length,a.studentsTotalCount=a.totalCount-a.teacherCount):console.warn("accounts: ".concat(n,", cannot get peers online status from [queryPeersOnlineStatus]"));case 7:return e.abrupt("return",a);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributeBy",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c,s,i;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._client.getChannelAttributes(t);case 2:a=e.sent,n=[],r=0,o=Object.keys(a);case 5:if(!(r<o.length)){e.next=16;break}if("teacher"!==(c=o[r])){e.next=11;break}return(s=ye(S.get(a,"".concat(c,".value"))))&&Object.keys(s).length&&n.push(Object(f.a)({role:"teacher"},s)),e.abrupt("continue",13);case 11:(i=ye(S.get(a,"".concat(c,".value"))))&&Object.keys(i).length&&(i.uid=c,n.push(i));case 13:r++,e.next=5;break;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),_e=a(135),be=a.n(_e),ge={accessKeyId:Object(S.get)(Object({NODE_ENV:"production",PUBLIC_URL:"/agora",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_AGORA_APP_ID:"28ee29aa37f1480b98ea44c6668e56a5",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_EDU_ENDPOINT_PREFIX:"https://api.agora.io/edu",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"OThmNDM5NjQ0NGU1NDE1NDgxZWM2NzgyZjUwYzAzODE6MmRjYjRkZDI5NTAxNGJiZjgxYTZiOWMxYjg1ZGYxMTY=",REACT_APP_AGORA_RTM_ENDPOINT:"your_server_rtm_endpoint_api",REACT_APP_END_POINT:"http://127.0.0.1:8000/",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}),"REACT_APP_YOUR_OWN_OSS_BUCKET_KEY","empty-placeholder"),accessKeySecret:Object(S.get)(Object({NODE_ENV:"production",PUBLIC_URL:"/agora",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_AGORA_APP_ID:"28ee29aa37f1480b98ea44c6668e56a5",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_EDU_ENDPOINT_PREFIX:"https://api.agora.io/edu",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"OThmNDM5NjQ0NGU1NDE1NDgxZWM2NzgyZjUwYzAzODE6MmRjYjRkZDI5NTAxNGJiZjgxYTZiOWMxYjg1ZGYxMTY=",REACT_APP_AGORA_RTM_ENDPOINT:"your_server_rtm_endpoint_api",REACT_APP_END_POINT:"http://127.0.0.1:8000/",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}),"REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET","empty-placeholder"),bucket:Object(S.get)(Object({NODE_ENV:"production",PUBLIC_URL:"/agora",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_AGORA_APP_ID:"28ee29aa37f1480b98ea44c6668e56a5",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_EDU_ENDPOINT_PREFIX:"https://api.agora.io/edu",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"OThmNDM5NjQ0NGU1NDE1NDgxZWM2NzgyZjUwYzAzODE6MmRjYjRkZDI5NTAxNGJiZjgxYTZiOWMxYjg1ZGYxMTY=",REACT_APP_AGORA_RTM_ENDPOINT:"your_server_rtm_endpoint_api",REACT_APP_END_POINT:"http://127.0.0.1:8000/",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}),"REACT_APP_YOUR_OWN_OSS_BUCKET_NAME","empty-placeholder"),endpoint:Object(S.get)(Object({NODE_ENV:"production",PUBLIC_URL:"/agora",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_AGORA_APP_ID:"28ee29aa37f1480b98ea44c6668e56a5",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_EDU_ENDPOINT_PREFIX:"https://api.agora.io/edu",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"OThmNDM5NjQ0NGU1NDE1NDgxZWM2NzgyZjUwYzAzODE6MmRjYjRkZDI5NTAxNGJiZjgxYTZiOWMxYjg1ZGYxMTY=",REACT_APP_AGORA_RTM_ENDPOINT:"your_server_rtm_endpoint_api",REACT_APP_END_POINT:"http://127.0.0.1:8000/",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}),"REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE","empty-placeholder"),folder:Object(S.get)(Object({NODE_ENV:"production",PUBLIC_URL:"/agora",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_AGORA_APP_ID:"28ee29aa37f1480b98ea44c6668e56a5",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_EDU_ENDPOINT_PREFIX:"https://api.agora.io/edu",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"OThmNDM5NjQ0NGU1NDE1NDgxZWM2NzgyZjUwYzAzODE6MmRjYjRkZDI5NTAxNGJiZjgxYTZiOWMxYjg1ZGYxMTY=",REACT_APP_AGORA_RTM_ENDPOINT:"your_server_rtm_endpoint_api",REACT_APP_END_POINT:"http://127.0.0.1:8000/",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}),"REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER","empty-placeholder")},Oe=new be.a(ge);function Ee(e,t){var a=t.cmd,n=(t.text,"");switch(a){case Q.acceptCoVideo:n="accept co-video";break;case Q.rejectCoVideo:n="reject co-video";break;case Q.cancelCoVideo:n="cancel co-video";break;case Q.applyCoVideo:n="apply co-video";break;case Q.muteVideo:n="mute video";break;case Q.muteAudio:n="mute audio";break;case Q.unmuteAudio:n="unmute audio";break;case Q.unmuteVideo:n="unmute video";break;default:return console.warn("[RoomMessage] unknown type, from peerId: ".concat(e))}console.log("[RoomMessage] [".concat(n,"] from peerId: ").concat(e))}function ye(e){try{return JSON.parse(e)}catch(t){return{}}}var ke=function(e){var t=encodeURI(e.name),a=t.substring(t.length,t.lastIndexOf("."));return{fileName:t,fileType:a}},Te=["unknown","excellent","good","poor","bad","very bad","down"];function Ce(e){var t=Math.max(e.downlinkNetworkQuality,e.uplinkNetworkQuality);return Te[t]?Te[t]:"unknown"}var je,we=window.rtcEngine;we&&(we.initialize(le),we.setChannelProfile(1),we.enableVideo(),we.enableAudio(),we.enableWebSdkInteroperability(!0),we.setVideoProfile(43,!1),window.ipc&&window.ipc.once("initialize",(function(e,t){var a=t[0],n=t[2],r=t[3];window.videoSourceLogPath=n,window.videoSourceAddonLogPath=r,we.setLogFile(a)}))),window.ipc&&window.ipc.on("export-log",(function(e,t){window.doGzip(),console.log("doGzip",window.doGzip)})),function(e){e[e.local=0]="local",e[e.remote=1]="remote",e[e.localVideoSource=2]="localVideoSource",e[e.remoteVideoSource=3]="remoteVideoSource"}(je||(je={}));var Ae=a(63),Se=a(38),Pe=a.n(Se);Pe.a.Logger.enableLogUpload(),Pe.a.Logger.setLogLevel(Pe.a.Logger.DEBUG);var Re=["accessAllowed","accessDenied","stopScreenSharing","videoTrackEnded","audioTrackEnded","player-status-changed"],Ne=["stream-published","stream-added","stream-removed","stream-subscribed","peer-online","peer-leave","error","network-type-changed","network-quality","exception","onTokenPrivilegeWillExpire","onTokenPrivilegeDidExpire"],xe=function(){function e(){Object(j.a)(this,e),this.streamID=void 0,this._init=!1,this._joined=!1,this._published=!1,this._internalTimer=void 0,this._client=Pe.a.createClient({mode:"live",codec:"vp8"}),this._bus=new me.a,this._localStream=null,this._streamEvents=void 0,this._clientEvents=void 0,this._addEventListener=!1,this.streamID=null,this._streamEvents=[],this._clientEvents=[]}return Object(w.a)(e,[{key:"initClient",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._init){e.next=2;break}return e.abrupt("return");case 2:return a=new Promise((function(e,a){!1===n._init&&n._client.init(t,(function(){n._init=!0,e()}),a)})),e.next=5,a;case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createClient",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initClient(t);case 2:this.subscribeClientEvents(),a&&(this._internalTimer=setInterval((function(){n._client.getTransportStats((function(e){var t=e.RTT?e.RTT:0;n._bus.emit("watch-rtt",t)}))}),100));case 4:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"destroyClient",value:function(){this.unsubscribeClientEvents()}},{key:"subscribeClientEvents",value:function(){var e=this;if(!this._addEventListener){this._addEventListener=!0;var t,a=Object(ue.a)(Ne);try{var n=function(){var a=t.value;e._clientEvents.push(a),e._client.on(a,(function(t){e._bus.emit(a,t)}))};for(a.s();!(t=a.n()).done;)n()}catch(r){a.e(r)}finally{a.f()}}}},{key:"unsubscribeClientEvents",value:function(){var e=this;if(this._addEventListener){var t,a=Object(ue.a)(this._clientEvents);try{var n=function(){var a=t.value;e._client.off(a,(function(){})),e._clientEvents=e._clientEvents.filter((function(e){return e===a}))};for(a.s();!(t=a.n()).done;)n()}catch(r){a.e(r)}finally{a.f()}this._addEventListener=!1}}},{key:"subscribeLocalStreamEvents",value:function(){var e,t=this,a=Object(ue.a)(Re);try{var n=function(){var a=e.value;t._streamEvents.push(a),t._localStream.on(a,(function(e){t._bus.emit(a,e)}))};for(a.s();!(e=a.n()).done;)n()}catch(r){a.e(r)}finally{a.f()}}},{key:"unsubscribeLocalStreamEvents",value:function(){var e=this;if(this._localStream){var t,a=Object(ue.a)(this._streamEvents);try{var n=function(){var a=t.value;e._localStream.removeEventListener(a,(function(e){})),e._streamEvents=e._streamEvents.filter((function(e){return e===a}))};for(a.s();!(t=a.n()).done;)n()}catch(r){a.e(r)}finally{a.f()}}}},{key:"renewToken",value:function(e){if(!this._client)return console.warn("renewToken is not permitted, checkout your instance");this._client.renewToken(e)}},{key:"removeAllListeners",value:function(){console.log("[agora-rtc] prepare remove all event listeners"),this.unsubscribeClientEvents(),this._bus.removeAllListeners(),console.log("[agora-rtc] remove all event listeners")}},{key:"on",value:function(e,t){this._bus.on(e,t)}},{key:"off",value:function(e,t){this._bus.off(e,t)}},{key:"publish",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){if(t._published)return e();t._client.publish(t._localStream,(function(e){a(e)})),setTimeout((function(){e(),t._published=!0}),300)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"unpublish",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){if(!t._published||!t._localStream)return e();t._client.unpublish(t._localStream,(function(e){a(e)})),setTimeout((function(){e(),t.destroyLocalStream(),t._published=!1}),300)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setRemoteVideoStreamType",value:function(e,t){this._client.setRemoteVideoStreamType(e,t)}},{key:"enableDualStream",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){t._client.enableDualStream(e,a)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"createLocalStream",value:function(e){var t=this;return this._localStream=Pe.a.createStream(Object(f.a)(Object(f.a)({},e),{},{mirror:!1})),new Promise((function(a,n){t._localStream.init((function(){t.streamID=e.streamID,t.subscribeLocalStreamEvents(),e.audioOutput&&e.audioOutput.deviceId&&t.setAudioOutput(e.audioOutput.deviceId).then((function(){console.log("setAudioOutput success",e.audioOutput)})).catch((function(e){console.warn("setAudioOutput failed",e,JSON.stringify(e))})),a()}),(function(e){n(e)}))}))}},{key:"destroyLocalStream",value:function(){this.unsubscribeLocalStreamEvents(),this._localStream&&(this._localStream.isPlaying()&&this._localStream.stop(),this._localStream.close()),this._localStream=null,this.streamID=0}},{key:"join",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a,n){var r=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){r._client.join(n,a,+t,e,o)})));case 1:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._client){e.next=2;break}return e.abrupt("return",new Promise((function(e,a){t._client.leave(e,a)})));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setAudioOutput",value:function(e){var t=this;return new Promise((function(a,n){t._client?t._client.setAudioOutput(e,a,n):a()}))}},{key:"setAudioVolume",value:function(e){this._client.setAudioVolume(e)}},{key:"subscribe",value:function(e){this._client.subscribe(e,{video:!0,audio:!0},(function(e){console.log("[rtc-client] subscribe failed: ",JSON.stringify(e))}))}},{key:"destroy",value:function(){this._internalTimer&&clearInterval(this._internalTimer),this._internalTimer=null,this.destroyLocalStream(),this.removeAllListeners()}},{key:"exit",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.leave();case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),e.t0;case 8:return e.prev=8,this.destroy(),e.finish(8);case 11:case"end":return e.stop()}}),e,this,[[0,5,8,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"getDevices",value:function(){return new Promise((function(e,t){Pe.a.getDevices((function(t){var a=[];t.forEach((function(e){a.push({deviceId:e.deviceId,kind:e.kind,label:e.label})})),e({cameraCanUse:t.filter((function(e){return"videoinput"===e.kind})).length>0,microphoneCanUse:t.filter((function(e){return"audioinput"===e.kind})).length>0,devices:a})}),(function(e){t(e)}))}))}},{key:"forceGetDevices",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t,a,n,r,o,c,s,i,u;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Pe.a.createStream({audio:!0,video:!1}),a=Pe.a.createStream({audio:!1,video:!0}),n=new Promise((function(e){t.init((function(){return e(null)}),(function(t){return e(t)}))})),r=new Promise((function(e){a.init((function(){return e(null)}),(function(t){return e(t)}))})),e.prev=4,e.next=7,Promise.all([n,r]);case 7:return o=e.sent,c=Object(v.a)(o,2),s=c[0],i=c[1],e.next=13,this.getDevices();case 13:return u=e.sent,null!==s&&(u.microphoneCanUse=!1,console.warn("create audio temp stream failed!",s)),null!==i&&(u.cameraCanUse=!1,console.warn("create video temp stream failed!",i)),e.abrupt("return",u);case 19:throw e.prev=19,e.t0=e.catch(4),e.t0;case 22:return e.prev=22,t.close(),a.close(),e.finish(22);case 26:case"end":return e.stop()}}),e,this,[[4,19,22,26]])})));return function(){return e.apply(this,arguments)}}()}]),e}();var Ie=function(){function e(t){Object(j.a)(this,e),this.rtc=void 0,this.shareClient=void 0,this.localUid=void 0,this.channel=void 0,this.bus=void 0,this.shared=void 0,this.joined=void 0,this.cameraCanUse=void 0,this.microphoneCanUse=void 0,this.forceGetDevice=void 0,this.published=void 0,this.tmpStream=void 0,this.roomStore=void 0,this.localUid=0,this.channel="",this.rtc=new xe,this.bus=new me.a,this.shared=!1,this.shareClient=null,this.tmpStream=null,this.joined=!1,this.published=!1,this.cameraCanUse=!1,this.microphoneCanUse=!1,this.forceGetDevice=!1,this.roomStore=t.roomStore}return Object(w.a)(e,[{key:"getDevices",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t,a,n,r,o,c,s,i;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new xe,a={cameraCanUse:this.cameraCanUse,microphoneCanUse:this.microphoneCanUse,devices:[]},e.prev=2,this.forceGetDevice){e.next=10;break}return e.next=6,t.forceGetDevices();case 6:a=e.sent,this.forceGetDevice=!0,e.next=13;break;case 10:return e.next=12,t.getDevices();case 12:a=e.sent;case 13:return r=(n=a).cameraCanUse,o=n.microphoneCanUse,c=n.devices,this.cameraCanUse=r,this.microphoneCanUse=o,s=c.filter((function(e){return"videoinput"===e.kind})),i=c.filter((function(e){return"audioinput"===e.kind})),s.length||console.warn("cameraList is empty",c),i.length||console.warn("microphoneList is empty",c),e.next=22,t.initClient(le);case 22:return e.abrupt("return",c);case 25:throw e.prev=25,e.t0=e.catch(2),e.t0;case 28:return e.prev=28,e.finish(28);case 30:case"end":return e.stop()}}),e,this,[[2,25,28,30]])})));return function(){return e.apply(this,arguments)}}()},{key:"joinChannel",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.uid,n=t.channel,r=t.dual,o=t.token,c=t.appId,this.localUid=+a,this.channel=n,console.log("channel",n,"dual",r,this.localUid,c),e.next=6,this.rtc.createClient(c,!0);case 6:return e.next=8,this.rtc.join(this.localUid,n,o);case 8:if(e.t0=r,!e.t0){e.next=12;break}return e.next=12,this.rtc.enableDualStream();case 12:this.joined=!0,He.setRTCJoined(!0),console.log("join web agora sdk rtc success");case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"leaveChannel",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.localUid=0,this.channel="",e.prev=2,e.next=5,this.unpublishLocalStream();case 5:return e.next=7,this.rtc.leave();case 7:this.joined=!1,He.setRTCJoined(!1),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(2),e.t0;case 14:return e.prev=14,this.rtc.destroy(),this.rtc.destroyClient(),e.finish(14);case 18:case"end":return e.stop()}}),e,this,[[2,11,14,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"enableDualStream",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rtc.enableDualStream());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"publishLocalStream",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(" publish local stream ",this.published),!this.published){e.next=5;break}return e.next=4,this.unpublishLocalStream();case 4:console.log("[agora-web] unpublished",this.published);case 5:if(t.cameraId&&t.microphoneId){e.next=11;break}return e.next=8,this.getDevices();case 8:a=e.sent,t.cameraId||(t.cameraId=a.filter((function(e){return"videoinput"===e.kind}))[0].deviceId),t.microphoneId||(t.microphoneId=a.filter((function(e){return"audioinput"===e.kind}))[0].deviceId);case 11:return e.next=13,this.rtc.createLocalStream(t);case 13:return e.next=15,this.rtc.publish();case 15:this.published=!0;case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unpublishLocalStream",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[agora-web] invoke unpublishStream"),e.next=3,this.rtc.unpublish();case 3:this.published=!1;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startScreenShare",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.uid,n=t.channel,r=t.token,o=t.appId,console.log("startScreenShare ",a,n,r,o),c=new xe,e.prev=3,e.next=6,c.createLocalStream({video:!1,audio:!1,screen:!0,screenAudio:!0,streamID:a,microphoneId:"",cameraId:""});case 6:return e.next=8,c.createClient(o);case 8:return e.next=10,c.join(a,n,r);case 10:return e.next=12,c.publish();case 12:this.shared=!0,this.shareClient=c,e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(3),e.t0;case 19:case"end":return e.stop()}}),e,this,[[3,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"stopScreenShare",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.shareClient.unpublish();case 2:return e.next=4,this.shareClient.leave();case 4:this.shareClient.destroy(),this.shareClient.destroyClient(),this.shared=!1,this.shareClient=void 0;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"exit",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.next=4,this.leaveChannel();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),t.push({rtcClient:e.t0});case 9:if(!0!==this.shared){e.next=20;break}return e.prev=10,e.next=13,this.shareClient.unpublish();case 13:return e.next=15,this.shareClient.leave();case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(10),t.push({shareClient:e.t1});case 20:if(this.shareClient)try{this.shareClient.destroy(),this.shareClient.destroyClient()}catch(a){t.push({shareClient:a})}if(Object(S.isEmpty)(t)){e.next=23;break}throw t;case 23:case"end":return e.stop()}}),e,this,[[1,6],[10,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"createPreviewStream",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.cameraId,n=t.microphoneId,r=t.speakerId,o=Pe.a.createStream({video:!0,audio:!0,screen:!1,cameraId:a,microphoneId:n,speakerId:r}),this.tmpStream&&(this.tmpStream.isPlaying()&&this.tmpStream.stop(),this.tmpStream.close()),e.abrupt("return",new Promise((function(e,t){o.init((function(){c.tmpStream=o,e(o)}),(function(e){t(e)}))})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"subscribe",value:function(e){this.rtc.subscribe(e)}},{key:"setRemoteVideoStreamType",value:function(e,t){this.rtc.setRemoteVideoStreamType(e,t)}}]),e}();function De(e){var t=function(e){try{var t=I.getLanguage().match(/^zh/)?"zh-cn":"en-us";return(N.read("demo-i18n-error")||{})[t][e]}catch(a){return console.warn(a),null}}(e);return t||e}function Ue(e,t){return Me.apply(this,arguments)}function Me(){return(Me=Object(ie.a)(se.a.mark((function e(t,a){var n=arguments;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.length>2&&void 0!==n[2]?n[2]:0,e.abrupt("return",new Promise((function(e,n){var r=function(t){return t.ok||n(new Error(t.statusText)),t.json().then(e).catch(n)},o=function(e){n(e)},c=function(e){throw console.warn(e),e};fetch(t,a).then(r).catch(o).catch(c);var s=new Error("request timeout");setTimeout(n,1e4,s)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Le(e,t){return Be.apply(this,arguments)}function Be(){return(Be=Object(ie.a)(se.a.mark((function e(t,a){var n,r,o,c,s=arguments;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:0,e.prev=1,e.next=4,Ue(t,a,n);case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),!e.t0||"request timeout"!==e.t0.message){e.next=15;break}return o=De("".concat(r=408)),c="".concat(o)==="".concat(r),I.showToast({type:"eduApiError",message:c?"request timeout":o}),e.abrupt("return",{code:r,msg:null,response:null});case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}var We=new(function(){function e(){Object(j.a)(this,e),this.subject=void 0,this.state=void 0,this.defaultState={state:"ready",history:null},this.subject=null,this.state=this.defaultState}return Object(w.a)(e,[{key:"initialize",value:function(){this.subject=new A.a,this.state=Object(f.a)({},this.defaultState),this.subject.next(this.state)}},{key:"subscribe",value:function(e){this.initialize(),this.subject&&this.subject.subscribe(e)}},{key:"unsubscribe",value:function(){this.subject&&this.subject.unsubscribe(),this.subject=null}},{key:"commit",value:function(e){this.subject&&this.subject.next(e)}},{key:"setHistory",value:function(e){this.state&&(this.state=Object(f.a)(Object(f.a)({},this.state),{},{history:e}),this.commit(this.state))}},{key:"getHistory",value:function(){if(this.state)return this.state.history}}]),e}());window.historyStore=We;var Ye=a(136),Ge=a.n(Ye),Ke="https://api.agora.io/edu",Fe=function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c,s,i,u,l,d,m,h,p;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.url,n=t.method,r=t.data,o=t.token,c=t.full_url,s={method:n,headers:{"Content-Type":"application/json",Authorization:"Basic ".concat("OThmNDM5NjQ0NGU1NDE1NDgxZWM2NzgyZjUwYzAzODE6MmRjYjRkZDI5NTAxNGJiZjgxYTZiOWMxYjg1ZGYxMTY=".replace(/basic\s+|basic/i,""))}},o&&(s.headers.token=o),r&&(s.body=JSON.stringify(r)),i=void 0,!c){e.next=11;break}return e.next=8,Le("".concat(c),s);case 8:i=e.sent,e.next=14;break;case 11:return e.next=13,Le("".concat(Ke).concat(a),s);case 13:i=e.sent;case 14:if(l=(u=i).code,d=u.msg,m=u.data,0===l||408===l){e.next=23;break}if(h=De("".concat(l)),p="".concat(h)==="".concat(l),I.showToast({type:"eduApiError",message:p?"".concat(d):h}),401!==l&&1101012!==l){e.next=22;break}return We.state.history.push("/"),e.abrupt("return");case 22:throw{api_error:h,isErrorCode:p};case 23:return e.abrupt("return",m);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ve=function(){function e(){Object(j.a)(this,e),this.appID="28ee29aa37f1480b98ea44c6668e56a5",this.roomId="",this._userToken="",this.recordId=""}return Object(w.a)(e,[{key:"fetchStsToken",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n,r;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"edu-demo",n=t||0,e.next=4,Fe({url:"/v1/log/params?appCode=".concat("edu-demo","&osType=",3,"&terminalType=",3,"&appVersion=").concat(B,"&roomId=").concat(n,"&fileExt=").concat(a,"&appId=").concat(this.appID),method:"GET"});case 4:return r=e.sent,e.abrupt("return",{bucketName:r.bucketName,callbackBody:r.callbackBody,callbackContentType:r.callbackContentType,accessKeyId:r.accessKeyId,accessKeySecret:r.accessKeySecret,securityToken:r.securityToken,ossKey:r.ossKey});case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"uploadToOss",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a,n){var r,o,c,s,i,u,l,d,m,h;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchStsToken(t,n);case 2:return r=e.sent,o=r.bucketName,c=r.callbackBody,s=r.callbackContentType,i=r.accessKeyId,u=r.accessKeySecret,l=r.securityToken,d=r.ossKey,m={bucketName:o,callbackBody:c,callbackContentType:s,accessKeyId:i,accessKeySecret:u,securityToken:l},h=new be.a({accessKeyId:m.accessKeyId,accessKeySecret:m.accessKeySecret,stsToken:m.securityToken,bucket:m.bucketName,secure:!0,endpoint:"oss-accelerate.aliyuncs.com"}),"".concat(Ke,"/v1/log/sts/callback"),e.prev=13,e.next=16,h.put(d,a,{callback:{url:"".concat(Ke,"/v1/log/sts/callback"),body:c,contentType:s}});case 16:return e.abrupt("return",e.sent);case 19:throw e.prev=19,e.t0=e.catch(13),I.showToast({type:"oss",message:W("toast.upload_log_failure",{reason:e.t0.name})}),e.t0;case 23:case"end":return e.stop()}}),e,this,[[13,19]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"uploadZipLogFile",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uploadToOss(t,a,"zip");case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"uploadLogFile",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uploadToOss(t,a,"log");case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"entry",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/entry"),method:"POST",data:t});case 2:return a=e.sent,this.roomId=a.roomId,this.userToken=a.userToken,e.abrupt("return",{data:a});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshToken",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(this.roomId,"/token/refresh"),method:"POST",token:this.userToken});case 2:return t=e.sent,e.abrupt("return",{rtcToken:t.rtcToken,rtmToken:t.rtmToken,screenToken:t.screenToken});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateCourse",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.room,e.next=3,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(this.roomId),method:"POST",data:a,token:this.userToken});case 3:return n=e.sent,e.abrupt("return",{data:n});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateRoomUser",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.userId,n=Object(oe.a)(t,["userId"]),e.next=3,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(this.roomId,"/user/").concat(a),method:"POST",data:n,token:this.userToken});case 3:return r=e.sent,e.abrupt("return",{data:r});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startRecording",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(this.roomId,"/record/start"),method:"POST",data:t,token:this.userToken});case 2:return a=e.sent,this.recordId=a.recordId,e.abrupt("return",{data:a});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopRecording",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(this.roomId,"/record/").concat(t,"/stop"),method:"POST",token:this.userToken});case 2:return a=e.sent,e.abrupt("return",{data:a});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRecordingList",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(this.roomId,"/records"),method:"GET",token:this.userToken});case 2:return t=e.sent,e.abrupt("return",{data:t});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWhiteboardBy",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({full_url:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board".replace("%app_id%",this.appID).replace("%room_id%",t),method:"GET",token:this.userToken});case 2:return a=e.sent,e.abrupt("return",{boardId:a.boardId,boardToken:a.boardToken});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRoomInfoBy",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(t),method:"GET",token:this.userToken});case 2:return a=e.sent,e.next=5,this.getWhiteboardBy(t);case 5:return n=e.sent,e.abrupt("return",{data:{room:Object(f.a)(Object(f.a)({},a.room),{},{boardId:n.boardId,boardToken:n.boardToken}),users:a.room.coVideoUsers,user:a.user}});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRoomState",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c,s,i,u;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRoomInfoBy(t);case 2:return a=e.sent,n=a.data,r=n.users,o=n.room,c=n.user,s=r.reduce((function(e,t){return e.set("".concat(t.uid),{role:t.role,account:t.userName,uid:t.uid,video:t.enableVideo,audio:t.enableAudio,chat:t.enableChat,grantBoard:t.grantBoard,userId:t.userId,screenId:t.screenId})}),Object(Ae.b)()),i={courseState:o.courseState,muteChat:o.muteAllChat,isRecording:o.isRecording,boardId:o.boardId,boardToken:o.boardToken,lockBoard:o.lockBoard,teacherId:"",memberCount:o.onlineUsers},(u=s.find((function(e){return 1===e.role})))&&(i.teacherId=u.uid),1===c.role&&(i.teacherId=c.uid),e.abrupt("return",{usersMap:s,room:i,me:c});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCourseState",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c,s;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRoomInfoBy(t);case 2:return a=e.sent,n=a.data,r=n.users,o=n.room,c={roomName:o.roomName,roomId:o.roomId,courseState:o.courseState,roomType:o.type,muteChat:o.muteAllChat,recordId:o.recordId,recordingTime:o.recordingTime,isRecording:Boolean(o.isRecording),boardId:o.boardId,boardToken:o.boardToken,lockBoard:o.lockBoard,memberCount:o.onlineUsers},(s=r.find((function(e){return 1===e.role})))&&(c.teacherId=s.uid,c.screenId=s.screenId,c.screenToken=s.screenToken),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Login",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c,s,i,u,l,d,m,h,p,f;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.appID){e.next=2;break}throw"appId is empty: ".concat(this.appID);case 2:return e.next=4,this.entry(t);case 4:return a=e.sent,n=a.data,r=n.roomId,n.userToken,e.next=10,this.getRoomInfoBy(r);case 10:return o=e.sent,c=o.data,s=c.room,i=c.user,u=c.users,d=i,m=(l=void 0===u?[]:u).find((function(e){return 1===+e.role})),h={rid:s.channelName,roomName:s.roomName,channelName:s.channelName,roomId:s.roomId,roomType:s.type,courseState:s.courseState,muteAllChat:s.muteAllChat,isRecording:s.isRecording,recordId:s.recordId,recordingTime:s.recordingTime,boardId:s.boardId,boardToken:s.boardToken,lockBoard:s.lockBoard,teacherId:0},m&&(h.teacherId=+m.uid),1===d.role&&(h.teacherId=d.uid),t.userUuid&&(d.uuid=t.userUuid),p=l.map((function(e){return"".concat(e.uid)})),h.teacherId&&p.length&&(h.coVideoUids=p.filter((function(e){return"".concat(e)!=="".concat(h.teacherId)}))),f={course:h,me:d,users:l,appID:this.appID,onlineUsers:s.onlineUsers},e.abrupt("return",f);case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchRoomBy",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c,s,i,u,l,d,m;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.appID){e.next=2;break}throw"appId is empty: ".concat(this.appID);case 2:return this.roomId=t,e.next=5,this.getRoomInfoBy(t);case 5:return a=e.sent,n=a.data,r=n.room,o=n.user,c=n.users,i=o,u=(s=void 0===c?[]:c).find((function(e){return 1===+e.role})),l={rid:r.channelName,roomName:r.roomName,channelName:r.channelName,roomId:r.roomId,roomType:r.type,courseState:r.courseState,muteAllChat:r.muteAllChat,isRecording:r.isRecording,recordId:r.recordId,recordingTime:r.recordingTime,boardId:r.boardId,boardToken:r.boardToken,lockBoard:r.lockBoard,teacherId:0},u&&(l.teacherId=+u.uid),1===i.role&&(l.teacherId=i.uid),d=s.map((function(e){return"".concat(e.uid)})),l.teacherId&&d.length&&(l.coVideoUids=d.filter((function(e){return"".concat(e)!=="".concat(l.teacherId)}))),m={course:l,me:i,users:s,appID:this.appID,onlineUsers:r.onlineUsers},e.abrupt("return",m);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCourseRecordBy",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a,n){var r,o,c,s,i;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.userToken=n,e.next=3,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(a,"/record/").concat(t),method:"GET",token:this.userToken});case 3:return r=e.sent,e.next=6,this.getWhiteboardBy(a);case 6:return o=e.sent,c=Object(S.get)(r,"recordDetails",[]).find((function(e){return 1===e.role})),s=["recording","finished","finished_recording_to_be_download","finished_download_to_be_convert","finished_convert_to_be_upload"],i={boardId:o.boardId,boardToken:o.boardToken,startTime:r.startTime,endTime:r.endTime,url:null===c||void 0===c?void 0:c.url,status:r.status,statusText:s[r.status]},e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"exitRoom",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(t,"/exit"),method:"POST",token:this.userToken,data:{appId:this.appID,roomId:t}});case 2:return e.sent,e.abrupt("return");case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"studentSendApply",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(t,"/covideo"),method:"POST",token:this.userToken,data:{type:1}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"studentStopCoVideo",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(t,"/covideo"),method:"POST",token:this.userToken,data:{type:6}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"teacherAcceptApply",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(t,"/covideo"),method:"POST",token:this.userToken,data:{type:4,userIds:[a]}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"teacherRejectApply",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(t,"/covideo"),method:"POST",token:this.userToken,data:{type:2,userIds:[a]}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"teacherCancelStudent",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(t,"/covideo"),method:"POST",token:this.userToken,data:{type:5,userIds:[a]}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"sendChannelMessage",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(t.roomId,"/chat"),method:"POST",token:this.userToken,data:{message:t.message,type:t.type}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startScreenShare",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/apps/".concat(this.appID,"/room/").concat(t,"/screen"),method:"POST",token:this.userToken,data:{state:1}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"userToken",get:function(){return window.sessionStorage.getItem("edu-userToken")||""},set:function(e){window.sessionStorage.setItem("edu-userToken",e)}}],[{key:"fetchI18n",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe({url:"/v1/multi/language",method:"GET"});case 2:t=e.sent,(a=t||{})&&N.save("demo-i18n-error",a);case 4:case"end":return e.stop()}var a}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),ze=new Ve,Ze=function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ve.fetchI18n();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),He=new(function(){function e(){Object(j.a)(this,e),this.subject=void 0,this._state=void 0,this.defaultState=Object.freeze(Object(f.a)({rtmLock:!1,rtcToken:"",rtmToken:"",appID:"",recordLock:!1,me:{account:"",uid:"",roomToken:"",role:0,video:1,audio:1,chat:1,grantBoard:0,rtmToken:"",rtcToken:"",appID:"",coVideo:""},users:Object(Ae.b)(),applyUser:{userId:"",account:""},rtm:{joined:!1},rtc:{published:!1,joined:!1,shared:!1,users:Object(Ae.c)(),localStream:null,localSharedStream:null,remoteStreams:Object(Ae.b)()},course:{teacherId:"",boardId:"",boardToken:"",courseState:0,muteChat:0,isRecording:!1,recordId:"",recordingTime:0,rid:"",roomName:"",roomType:0,lockBoard:0,roomId:"",screenId:"",screenToken:""},mediaDevice:{microphoneId:"",speakerId:"",cameraId:"",speakerVolume:100,camera:0,speaker:0,microphone:0},messages:Object(Ae.a)(),language:navigator.language},N.read("agora_room"))),this.windowId=0,this.rtmClient=void 0,this.rtcClient=void 0,this.subject=null,this._state=Object(f.a)({},this.defaultState),this.rtmClient=new ve,this.rtcClient=new Ie({roomStore:this})}return Object(w.a)(e,[{key:"state",get:function(){return this._state},set:function(e){this._state=e}}]),Object(w.a)(e,[{key:"initialize",value:function(){this.subject=new A.a,this.state=Object(f.a)({},this.defaultState),this.subject.next(this.state)}},{key:"subscribe",value:function(e){this.initialize(),this.subject&&this.subject.subscribe(e)}},{key:"unsubscribe",value:function(){this.subject&&this.subject.unsubscribe(),this.subject=null}},{key:"commit",value:function(e){this.subject&&this.subject.next(e)}},{key:"updateState",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),e),this.commit(this.state)}},{key:"isTeacher",value:function(e){return!(!"".concat(e)||!"".concat(this.state.course.teacherId)||"".concat(this.state.course.teacherId)!=="".concat(e))}},{key:"isStudent",value:function(e){return!(!"".concat(e)||"".concat(this.state.course.teacherId)==="".concat(e))}},{key:"updateRecordState",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{course:Object(f.a)(Object(f.a)({},this.state.course),{},{roomId:e.roomId,recordId:e.recordId,recordingTime:e.recordingTime,isRecording:!!e.isRecording})}),console.log(">>>: updateRecordState ",e),this.commit(this.state)}},{key:"fetchCurrentRoom",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t,a,n,r,o,c,s;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ze.fetchRoomBy(He.state.course.roomId);case 3:return t=e.sent,a=t.course,n=t.me,r=t.users,o=t.appID,c=t.onlineUsers,s=r.reduce((function(e,t){return e.set("".concat(t.uid),{role:t.role,account:t.userName,uid:t.uid,video:t.enableVideo,audio:t.enableAudio,chat:t.enableChat,grantBoard:t.grantBoard,userId:t.userId,screenId:t.screenId})}),Object(Ae.b)()),e.next=8,this.rtmClient.login(o,"".concat(n.uid),n.rtmToken);case 8:return e.next=10,this.rtmClient.join(a.rid);case 10:this.state=Object(f.a)(Object(f.a)({},this.state),{},{rtm:Object(f.a)(Object(f.a)({},this.state.rtm),{},{joined:!0}),course:Object(f.a)(Object(f.a)({},this.state.course),{},{rid:a.channelName,roomType:a.roomType,roomId:a.roomId,roomName:a.roomName,courseState:a.courseState,muteChat:a.muteAllChat,recordId:"".concat(a.recordId),isRecording:a.isRecording,recordingTime:a.recordingTime,lockBoard:a.lockBoard,boardId:"".concat(a.boardId),boardToken:"".concat(a.boardToken),teacherId:"".concat(a.teacherId),screenId:"".concat(n.screenId),screenToken:"".concat(n.screenToken),coVideoUids:a.coVideoUids,memberCount:+c}),me:Object(f.a)(Object(f.a)({},this.state.me),{},{uid:n.uid,account:n.userName,rtmToken:n.rtmToken,rtcToken:n.rtcToken,channelName:n.channelName,screenId:n.screenId,screenToken:n.screenToken,appID:n.appID,role:n.role,chat:n.enableChat,video:n.enableVideo,audio:n.enableAudio,userId:n.userId,coVideo:n.coVideo}),users:s,appID:o}),this.commit(this.state),e.next=20;break;case 14:if(e.prev=14,e.t0=e.catch(0),!this.rtmClient._logged){e.next=19;break}return e.next=19,this.rtmClient.logout();case 19:throw e.t0;case 20:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"addLocalStream",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{rtc:Object(f.a)(Object(f.a)({},this.state.rtc),{},{localStream:e})}),this.commit(this.state)}},{key:"removeLocalStream",value:function(){this.state=Object(f.a)(Object(f.a)({},this.state),{},{rtc:Object(f.a)(Object(f.a)({},this.state.rtc),{},{localStream:null,localSharedStream:null})}),this.commit(this.state)}},{key:"addLocalSharedStream",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{rtc:Object(f.a)(Object(f.a)({},this.state.rtc),{},{localSharedStream:e})}),this.commit(this.state)}},{key:"removeLocalSharedStream",value:function(){this.state=Object(f.a)(Object(f.a)({},this.state),{},{rtc:Object(f.a)(Object(f.a)({},this.state.rtc),{},{localSharedStream:null})}),this.commit(this.state)}},{key:"addRTCUser",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{rtc:Object(f.a)(Object(f.a)({},this.state.rtc),{},{users:this.state.rtc.users.add(e)})}),this.commit(this.state)}},{key:"removePeerUser",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{rtc:Object(f.a)(Object(f.a)({},this.state.rtc),{},{users:this.state.rtc.users.delete(e)})}),this.commit(this.state)}},{key:"addRemoteStream",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{rtc:Object(f.a)(Object(f.a)({},this.state.rtc),{},{remoteStreams:this.state.rtc.remoteStreams.set("".concat(e.streamID),e)})}),this.commit(this.state)}},{key:"removeRemoteStream",value:function(e){var t=this.state.rtc.remoteStreams.get("".concat(e));t&&t.stream&&t.stream.isPlaying&&t.stream.isPlaying()&&t.stream.stop(),this.state=Object(f.a)(Object(f.a)({},this.state),{},{rtc:Object(f.a)(Object(f.a)({},this.state.rtc),{},{remoteStreams:this.state.rtc.remoteStreams.delete("".concat(e))})}),this.commit(this.state)}},{key:"updateRtc",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{rtc:Object(f.a)(Object(f.a)({},this.state.rtc),e)}),this.commit(this.state)}},{key:"updateDevice",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{mediaDevice:e}),this.commit(this.state)}},{key:"sendChannelMessage",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze.sendChannelMessage({roomId:this.state.course.roomId,message:t.message,type:1});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handlePeerMessage",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n,r,o,c,s,i;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.cmd,r=t.data,o=r.userName,c=r.userId,s=r.type,1===n){e.next=3;break}return e.abrupt("return");case 3:e.t0=s,e.next=e.t0===ee.teacherSendReject?6:e.t0===ee.studentSendApply?8:e.t0===ee.teacherSendAccept?17:e.t0===ee.teacherSendStop?19:21;break;case 6:return I.showToast({type:"co-video",message:W("toast.teacher_reject_co_video")}),e.abrupt("return");case 8:if("peer_hands_up"!==I.state.notice.reason||!this.state.applyUser.userId){e.next=11;break}return console.warn("ignore: ",a,c,s,o),e.abrupt("return");case 11:if(!(i=c)||!a){e.next=17;break}return this.updateApplyUser({account:"".concat(o),userId:"".concat(i)}),I.showNotice({reason:"peer_hands_up",text:W("notice.student_interactive_apply",{reason:"".concat(o)})}),I.showToast({type:"peer_hands_up",message:W("toast.student_send_co_video_apply",{reason:"".concat(o)})}),e.abrupt("return");case 17:return I.showToast({type:"peer_hands_up",message:W("toast.teacher_accept_co_video",{reason:"".concat(o)})}),e.abrupt("return");case 19:return I.showToast({type:"peer_hands_up",message:W("toast.stop_co_video",{reason:"".concat(o)})}),e.abrupt("return");case 21:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"mute",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state.me,"".concat(n.uid)!=="".concat(t)){e.next=13;break}if("audio"!==a){e.next=5;break}return e.next=5,this.updateLocalMe({audio:0,broad:!0});case 5:if("video"!==a){e.next=8;break}return e.next=8,this.updateLocalMe({video:0,broad:!0});case 8:if("chat"!==a){e.next=11;break}return e.next=11,this.updateLocalMe({chat:0,broad:!0});case 11:e.next=26;break;case 13:if(1!==n.role){e.next=26;break}if("audio"!==a){e.next=17;break}return e.next=17,this.updateUserBy("".concat(t),{audio:0});case 17:if("video"!==a){e.next=20;break}return e.next=20,this.updateUserBy("".concat(t),{video:0});case 20:if("chat"!==a){e.next=23;break}return e.next=23,this.updateUserBy("".concat(t),{chat:0});case 23:if("grantBoard"!==a){e.next=26;break}return e.next=26,this.updateUserBy("".concat(t),{grantBoard:0});case 26:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"unmute",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state.me,"".concat(n.uid)!=="".concat(t)){e.next=13;break}if("audio"!==a){e.next=5;break}return e.next=5,this.updateLocalMe({audio:1,broad:!0});case 5:if("video"!==a){e.next=8;break}return e.next=8,this.updateLocalMe({video:1,broad:!0});case 8:if("chat"!==a){e.next=11;break}return e.next=11,this.updateLocalMe({chat:1,broad:!0});case 11:e.next=26;break;case 13:if(1!==n.role){e.next=26;break}if("audio"!==a){e.next=17;break}return e.next=17,this.updateUserBy("".concat(t),{audio:1});case 17:if("video"!==a){e.next=20;break}return e.next=20,this.updateUserBy("".concat(t),{video:1});case 20:if("chat"!==a){e.next=23;break}return e.next=23,this.updateUserBy("".concat(t),{chat:1});case 23:if("grantBoard"!==a){e.next=26;break}return e.next=26,this.updateUserBy("".concat(t),{grantBoard:1});case 26:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"LoginToRoom",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c,s,i,u,l,d,m,h,p=arguments;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.length>1&&void 0!==p[1]&&p[1],a=t.userName,n=t.roomName,r=t.role,o=t.type,c=t.uuid,e.prev=2,e.next=5,ze.Login({userName:a,roomName:n,role:r,type:o,roomUuid:n,userUuid:c});case 5:return s=e.sent,i=s.course,u=s.me,l=s.users,d=s.appID,m=s.onlineUsers,h=l.reduce((function(e,t){return e.set("".concat(t.uid),{role:t.role,account:t.userName,uid:t.uid,video:t.enableVideo,audio:t.enableAudio,chat:t.enableChat,grantBoard:t.grantBoard,userId:t.userId,screenId:t.screenId})}),Object(Ae.b)()),e.next=10,this.rtmClient.login(d,"".concat(u.uid),u.rtmToken);case 10:return e.next=12,this.rtmClient.join(i.rid);case 12:this.state=Object(f.a)(Object(f.a)({},this.state),{},{rtm:Object(f.a)(Object(f.a)({},this.state.rtm),{},{joined:!0}),course:Object(f.a)(Object(f.a)({},this.state.course),{},{rid:i.channelName,roomType:i.roomType,roomId:i.roomId,roomName:i.roomName,courseState:i.courseState,muteChat:i.muteAllChat,recordId:"".concat(i.recordId),isRecording:i.isRecording,recordingTime:i.recordingTime,lockBoard:i.lockBoard,boardId:"".concat(i.boardId),boardToken:"".concat(i.boardToken),teacherId:"".concat(i.teacherId),screenId:"".concat(u.screenId),screenToken:"".concat(u.screenToken),coVideoUids:i.coVideoUids,memberCount:+m}),me:Object(f.a)(Object(f.a)({},this.state.me),{},{uid:u.uid,account:u.userName,rtmToken:u.rtmToken,rtcToken:u.rtcToken,channelName:u.channelName,screenId:u.screenId,screenToken:u.screenToken,appID:u.appID,role:u.role,chat:u.enableChat,video:u.enableVideo,audio:u.enableAudio,userId:u.userId,coVideo:u.coVideo}),users:h,appID:d}),this.commit(this.state),e.next=22;break;case 16:if(e.prev=16,e.t0=e.catch(2),!this.rtmClient._logged){e.next=21;break}return e.next=21,this.rtmClient.logout();case 21:throw e.t0;case 22:case"end":return e.stop()}}),e,this,[[2,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setRTCJoined",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{rtc:Object(f.a)(Object(f.a)({},this.state.rtc),{},{joined:e})}),this.commit(this.state)}},{key:"updateChannelMessage",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{messages:this.state.messages.push(e)}),this.commit(this.state)}},{key:"compositeMe",value:function(e){console.log("compositeMe: ",e);var t=Object(f.a)({},this.state.me);for(var a in e)t.hasOwnProperty(a)&&e.hasOwnProperty(a)&&Object(S.set)(t,a,Object(S.get)(e,a,""));return t}},{key:"compositeCourse",value:function(e){console.log("compositeCourse: ",e);var t=Object(f.a)({},this.state.course);for(var a in e)t.hasOwnProperty(a)&&e.hasOwnProperty(a)&&Object(S.set)(t,a,Object(S.get)(e,a,""));return t}},{key:"fetchCourse",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze.getCourseState(this.state.course.roomId);case 2:return t=e.sent,e.next=5,this.updateCourse(Object(f.a)(Object(f.a)({},t),{},{broad:!1}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchRoomState",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t,a,n,r;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze.getRoomState(this.state.course.roomId);case 2:return t=e.sent,a=t.usersMap,n=t.room,r=t.me,e.next=8,this.updateRoomState({usersMap:a,room:n,me:r,broad:!1});case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateRoomState",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c,s,i,u,l,d,m;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.usersMap,n=t.room,r=t.me,o=n.teacherId,c=this.state.course.coVideoUids,a.count()){for(s=[],i=a.toJSON(),u=0,l=Object.keys(i);u<l.length;u++)d=l[u],s.push("".concat(d));c=s.filter((function(e){return"".concat(e)!=="".concat(o)}))}m=r,this.state=Object(f.a)(Object(f.a)({},this.state),{},{course:Object(f.a)(Object(f.a)(Object(f.a)({},this.state.course),n),{},{coVideoUids:c}),me:Object(f.a)(Object(f.a)({},this.state.me),m),users:a}),this.commit(this.state);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateLocalMe",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.broad,n=Object(oe.a)(t,["broad"]),r=this.compositeMe(n),o={uid:r.uid,account:r.account,role:r.role,video:r.video,audio:r.audio,chat:r.chat,grantBoard:r.grantBoard,coVideo:r.coVideo,userId:r.userId,screenId:r.screenId},c={userId:o.userId,enableChat:o.chat,enableAudio:o.audio,enableVideo:o.video,grantBoard:o.grantBoard},!a){e.next=7;break}return e.next=7,this.updateRoomUser({user:c});case 7:this.state=Object(f.a)(Object(f.a)({},this.state),{},{me:Object(f.a)(Object(f.a)({},this.state.me),o),users:this.state.users.set("".concat(this.state.me.uid),o)}),this.commit(this.state);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateRoomUser",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.user,e.next=3,ze.updateRoomUser(a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateApplyUser",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{applyUser:e}),this.commit(this.state)}},{key:"updateUserBy",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n,r,o,c,s,i,u,l,d,m;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=a.broad,r=void 0===n||n,o=Object(oe.a)(a,["broad"]),c=this.state.users.get("".concat(t)),s=Object(f.a)({},c),i=Object.keys(o),u=0,l=i;u<l.length;u++)d=l[u],s.hasOwnProperty(d)&&o.hasOwnProperty(d)&&Object(S.set)(s,d,Object(S.get)(o,d));if(m={userId:s.userId,enableChat:s.chat,enableAudio:s.audio,enableVideo:s.video,grantBoard:s.grantBoard},!r){e.next=9;break}return e.next=9,this.updateRoomUser({user:m});case 9:this.state=Object(f.a)(Object(f.a)({},this.state),{},{users:this.state.users.set("".concat(t),s)}),this.commit(this.state);case 11:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"resolveCourseAttrsToOperate",value:function(e){for(var t=0,a=["lockBoard","courseState","muteChat"];t<a.length;t++){var n=a[t];if(e.hasOwnProperty(n)){var r=-1,o=Object(S.get)(e,n,0),c=n;return"lockBoard"===n?r=o?Q.lockBoard:Q.unlockBoard:"courseState"===n?r=o?Q.startCourse:Q.endCourse:"muteChat"===n&&(r=o?Q.muteAllChat:Q.unmuteAllChat,c="muteAllChat"),{key:c,stateValue:o,value:r}}}}},{key:"updateCourse",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c,s;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.broad,n=void 0===a||a,r=Object(oe.a)(t,["broad"]),o=this.resolveCourseAttrsToOperate(r),c=o.key,s=o.stateValue,!n){e.next=8;break}return e.next=5,ze.updateCourse({room:Object(re.a)({},"".concat(c),s)});case 5:return this.state=Object(f.a)(Object(f.a)({},this.state),{},{course:Object(f.a)(Object(f.a)({},this.state.course),r)}),this.commit(this.state),e.abrupt("return");case 8:this.state=Object(f.a)(Object(f.a)({},this.state),{},{course:Object(f.a)(Object(f.a)({},this.state.course),r)}),this.commit(this.state);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateLocal",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.compositeMe(t),n=this.compositeCourse(t),r=this.state.users,this.state=Object(f.a)(Object(f.a)({},this.state),{},{me:Object(f.a)({},a),users:r,course:Object(f.a)({},n)}),this.commit(this.state);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"exitRoom",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze.exitRoom(this.state.course.roomId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"exitAll",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.prev=1,e.next=4,this.rtmClient.exit();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.warn(e.t0);case 9:return e.prev=9,e.next=12,this.rtcClient.exit();case 12:e.next=17;break;case 14:e.prev=14,e.t1=e.catch(9),console.warn(e.t1);case 17:return e.prev=17,N.clear("agora_room"),this.state=Object(f.a)({},this.defaultState),this.commit(this.state),e.finish(17);case 22:case"end":return e.stop()}}),e,this,[[0,,17,22],[1,6],[9,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"startWebScreenShare",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t,a,n,r,o,c,s,i=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.rtcClient,e.prev=1,e.next=4,ze.refreshToken();case 4:return a=e.sent,n=a.screenToken,r=this.state.course,o=r.screenId,c=r.rid,s=this.state.appID,e.next=10,t.startScreenShare({uid:+o,token:n,channel:c,appId:s});case 10:t.shareClient.on("onTokenPrivilegeWillExpire",(function(e){t.shareClient.renewToken("")})),t.shareClient.on("onTokenPrivilegeDidExpire",(function(e){t.shareClient.renewToken("")})),t.shareClient.on("stopScreenSharing",(function(e){console.log("stop screen share",e),i.stopWebScreenShare().then((function(){I.showToast({message:W("toast.canceled_screen_share"),type:"notice"})})).catch(console.warn).finally((function(){console.log("[agora-web] stop share")}))})),e.next=21;break;case 15:throw e.prev=15,e.t0=e.catch(1),t.shareClient&&(t.shareClient.off("onTokenPrivilegeWillExpire",(function(e){})),t.shareClient.off("onTokenPrivilegeDidExpire",(function(e){})),t.shareClient.off("stopScreenSharing",(function(e){}))),"error"===e.t0.type&&"NotAllowedError"===e.t0.msg&&I.showToast({message:W("toast.canceled_screen_share"),type:"notice"}),"error"===e.t0.type&&"PERMISSION_DENIED"===e.t0.msg&&I.showToast({message:W("toast.screen_sharing_failed",{reason:e.t0.msg}),type:"notice"}),e.t0;case 21:case"end":return e.stop()}}),e,this,[[1,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"stopWebScreenShare",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.rtcClient).shared){e.next=5;break}return e.next=4,t.stopScreenShare();case 4:this.removeLocalSharedStream();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startNativeScreenShare",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.rtcClient,I.setNativeWindowInfo({visible:!0,items:t.getScreenShareWindows()});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startScreenShare",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=3;break;case 3:return e.next=6,this.startWebScreenShare();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopNativeScreenShare",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.rtcClient,e.next=3,t.stopScreenShare();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopScreenShare",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.stopWebScreenShare();case 3:e.next=6;break;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"lockRecording",value:function(){this.state&&(this.state=Object(f.a)(Object(f.a)({},this.state),{},{recordLock:!0}),this.commit(this.state))}},{key:"unlockRecording",value:function(){this.state&&(this.state=Object(f.a)(Object(f.a)({},this.state),{},{recordLock:!1}),this.commit(this.state))}},{key:"startRecording",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t,a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lockRecording(),e.prev=1,30,e.next=5,ze.startRecording({recordingConfig:{maxIdleTime:30}});case 5:t=e.sent,a=t.data,this.state=Object(f.a)(Object(f.a)({},this.state),{},{course:Object(f.a)(Object(f.a)({},this.state.course),{},{recordId:a,isRecording:!0})}),this.commit(this.state),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(1),e.t0;case 14:return e.prev=14,this.unlockRecording(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"stopRecording",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t,a,n,r;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lockRecording(),e.prev=1,e.next=4,ze.stopRecording(this.state.course.recordId);case 4:return t=this.state.course.roomId,e.next=7,ze.getRoomInfoBy(t);case 7:a=e.sent,n=a.data,r=n.room.recordId,this.state=Object(f.a)(Object(f.a)({},this.state),{},{course:Object(f.a)(Object(f.a)({},this.state.course),{},{recordId:r,isRecording:!1})}),this.commit(this.state),e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(1),e.t0;case 17:return e.prev=17,this.unlockRecording(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[1,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"updateCoVideoUsers",value:function(e){var t=this,a=[],n=e.reduce((function(e,t){return 2===+t.role&&a.push(+t.uid),e.set("".concat(t.uid),{role:t.role,account:t.userName,uid:t.uid,video:t.enableVideo,audio:t.enableAudio,chat:t.enableChat,grantBoard:t.grantBoard,userId:t.userId,screenId:t.screenId})}),Object(Ae.b)()),r=this.state.me,o=n.find((function(e){return+t.state.me.uid===+e.uid}));r=o?this.compositeMe(Object(f.a)(Object(f.a)({},o),{},{coVideo:1})):Object(f.a)(Object(f.a)({},r),{},{coVideo:0});var c={screenId:this.state.course.screenId,teacherId:this.state.course.teacherId},s=n.find((function(e){return 1===+e.role}));s&&(c.screenId=s.screenId,c.teacherId=s.uid);var i=this.state.applyUser;i&&i.userId&&(n.find((function(e){return e.userId===i.userId}))||(i={userId:"",account:""}));this.state=Object(f.a)(Object(f.a)({},this.state),{},{users:n,me:Object(f.a)(Object(f.a)({},this.state.me),r),course:Object(f.a)(Object(f.a)(Object(f.a)({},this.state.course),c),{},{coVideoUids:a}),applyUser:i}),this.commit(this.state)}},{key:"updateRoomInfo",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{course:Object(f.a)(Object(f.a)({},this.state.course),{},{lockBoard:e.lockBoard,muteChat:e.muteAllChat,courseState:e.courseState})}),this.commit(this.state)}},{key:"updateRoomMember",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{course:Object(f.a)(Object(f.a)({},this.state.course),{},{memberCount:e})}),this.commit(this.state)}},{key:"updateScreenShare",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{course:Object(f.a)(Object(f.a)({},this.state.course),{},{screenId:e.screenId})}),this.commit(this.state)}}]),e}());window.roomStore=He;a(314);var Je=function(e){return r.a.createElement("a",{href:"https://github.com/AgoraIO-Usecase/eEducation",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("span",{className:"agora-github-pin"}))},qe=a(66),Xe=a.n(qe),Qe=a(62),$e="".concat(window.location.protocol,"//").concat(window.location.host,"/dev/v2/project/%s/rtm").replace("%s","28ee29aa37f1480b98ea44c6668e56a5"),et=function(){function e(t,a){Object(j.a)(this,e),this.startTime=void 0,this.endTime=void 0,this.source=void 0,this.destination=void 0,this.customerId=void 0,this.appSecret=void 0,this.totalCount=void 0,this.offset=void 0,this.limit=void 0,this.startTime=0,this.endTime=0,this.source="",this.destination="",this.customerId=t,this.appSecret=a,this.totalCount=0,this.offset=0,this.limit=100}return Object(w.a)(e,[{key:"basicAuthorization",value:function(){var e="".concat(this.customerId,":").concat(this.appSecret);return"Basic ".concat(btoa(e))}},{key:"fetchChannelMessageCount",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c,s;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.channelName,n=t.startTime,r=t.endTime,e.next=3,Le("".concat($e,"/message/history/count?destination=").concat(a,"&start_time=").concat(n,"&end_time=").concat(r),{method:"GET",headers:{"Content-Type":"application/json",Authorization:this.basicAuthorization()}});case 3:return o=e.sent,c=o,s=Object(S.get)(c,"count"),this.totalCount=s,this.offset=0,this.limit=100,e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchChannelMessages",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c,s,i,u,l;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.channelName,n=t.startTime,r=t.endTime,e.next=3,Le("".concat($e,"/message/history/query"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.basicAuthorization()},body:JSON.stringify({filter:{source:"",destination:a,start_time:n,end_time:r},offset:this.offset,limit:this.limit,order:"asc"})});case 3:if(o=e.sent,c=o,s=Object(S.get)(c,"location"),!Object(S.isEmpty)(s)){e.next=8;break}throw"location from agora rtm endpoint must be present";case 8:return e.next=10,Le("".concat($e,"/message/history/query/").concat(s.replace("~/rtm/message/history/query/","")),{method:"GET",headers:{"Content-Type":"application/json",Authorization:this.basicAuthorization()}});case 10:return i=e.sent,u=i,l=Object(S.get)(u,"messages"),e.abrupt("return",l);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAllChannelMessages",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchChannelMessageCount(t);case 2:if(0!==e.sent){e.next=5;break}return e.abrupt("return",void 0);case 5:a=this.totalCount,n=[];case 7:if(!(a>0)){e.next=15;break}return e.next=10,this.fetchChannelMessages(t);case 10:o=e.sent,n=(r=n).concat.apply(r,Object(Qe.a)(o)),a>=o.length&&(a-=o.length,this.offset=n.length,this.limit=100),e.next=7;break;case 15:return e.abrupt("return",n);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();window.RTMRestful=new et("customer_id","customer_certificate");var tt=function(e,t,a){return Object(ie.a)(se.a.mark((function n(){var r,o;return se.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.replayRoom({beginTimestamp:t.beginTimestamp,duration:t.duration,room:t.room,mediaURL:t.mediaURL,roomToken:t.roomToken},a);case 3:return o=n.sent,r=!1,n.abrupt("return",o);case 8:n.prev=8,n.t0=n.catch(0),r=!0;case 11:if(r){n.next=0;break}case 12:case"end":return n.stop()}}),n,null,[[0,8]])})))()};function at(){var e=localStorage.getItem("demo_edu_uuid");return e||(e=Xe()(),localStorage.setItem("demo_edu_uuid",e),e)}var nt=a(137),rt=a(255),ot=a.n(rt),ct=new nt.a("webdemo_agora_edu");ct.version(1).stores({logs:"content"});var st=ct,it=a(138),ut=a.n(it),lt=((new ut.a).getResult(),function(e){return e.reduce((function(e,t){return e.concat(t)}),[])}),dt=function(){function e(){Object(j.a)(this,e)}return Object(w.a)(e,null,[{key:"init",value:function(){this.thread||(this.thread=new ot.a,this.debugLog())}},{key:"debugLog",value:function(){var e=this.thread;Object.keys(console).filter((function(e){return["info","error","warn","log","debug"].indexOf(e)>=0})).forEach((function(t,a){console[t]=function(t,a){return function(){var n=Array.prototype.slice.call(arguments);lt(n).join(""),e.postMessage({type:"log",data:JSON.stringify([lt(n).join("")])}),a.apply(t,n)}}(console,console[t])})),window.console=console}},{key:"uploadElectronLog",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.doGzip();case 2:return a=e.sent,e.next=5,ze.uploadZipLogFile(t,a);case 5:return n=e.sent,e.abrupt("return",Object(S.get)(n,"data.data",-1));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"doUpload",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],e.next=7;break;case 5:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 7:return e.t2=t,e.next=10,this.uploadLog(He.state.course.roomId);case 10:return e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.abrupt("return",t.join("#"));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"uploadLog",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,st.logs.toArray();case 2:return a=e.sent,n=a.reverse().map((function(e){return JSON.parse(e.content)})).map((function(e){return Array.isArray(e)?e[0]:e})).join("\n"),window.logsStr=n,e.next=7,new File([n],"".concat(+Date.now()));case 7:return r=e.sent,window.file=r,e.next=11,ze.uploadLogFile(t,r);case 11:return o=e.sent,e.next=14,st.delete();case 14:return e.next=16,nt.a.exists(st.name);case 16:if(e.sent){e.next=18;break}st.version(1).stores({logs:"content"});case 18:return e.next=20,st.open();case 20:return console.log("res ",o),e.abrupt("return",Object(S.get)(o,"data.data",-1));case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();dt.originConsole=window.console,dt.thread=null;var mt=Object(g.a)((function(e){return{formControl:{minWidth:"240px",maxWidth:"240px"}}})),ht={display:"none"},pt={roomName:"",roomType:0,role:"",yourName:""};var ft=r.a.memo((function(){document.title=W("home.short_title.title");var e=mt(),t=Object(s.e)(),a=function(e){t.push({pathname:"/device_test"})},o=Object(n.useState)(!1),c=Object(v.a)(o,2),i=c[0],u=c[1],l=ae().HomeBtn,d=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){d.current=!0}}),[]);var m=Object(n.useState)(pt),h=Object(v.a)(m,2),p=h[0],g=h[1],O=Object(n.useState)({}),y=Object(v.a)(O,2),k=y[0],T=y[1];return r.a.createElement("div",{style:ht,className:"flex-container ".concat("home-cover-web")},r.a.createElement("div",{className:"web-menu"},r.a.createElement("div",{className:"web-menu-container"},r.a.createElement("div",{className:"short-title"},r.a.createElement("span",{className:"title"},W("home.short_title.title")),r.a.createElement("span",{className:"subtitle"},W("home.short_title.subtitle")),r.a.createElement("span",{className:"build-version"},W("build_version"))),r.a.createElement("div",{className:"setting-container"},r.a.createElement("div",{className:"flex-row"},r.a.createElement(_.a,{title:W("icon.upload-log"),placement:"top"},r.a.createElement("span",null,r.a.createElement(K,{className:i?"icon-loading":"icon-upload",onClick:function(e){u(!0),dt.doUpload().then((function(e){I.showDialog({type:"uploadLog",message:W("toast.show_log_id",{reason:"".concat(e)})})})).finally((function(){u(!1)}))}}))),r.a.createElement(_.a,{title:W("icon.setting"),placement:"top"},r.a.createElement("span",null,r.a.createElement(K,{className:"icon-setting",onClick:a})))),r.a.createElement(_.a,{title:W("icon.lang-select"),placement:"top"},r.a.createElement("span",null,r.a.createElement(X,{value:N.getLanguage().language.match(/^zh/)?0:1,onChange:function(e){0===e.target.value?I.setLanguage("zh-CN"):I.setLanguage("en")},items:[{text:"\u4e2d\u6587",name:"zh-CN"},{text:"En",name:"en"}]})))))),r.a.createElement("div",{className:"custom-card"},r.a.createElement(Je,null),r.a.createElement("div",{className:"flex-item cover"},r.a.createElement("div",{className:"cover-placeholder-web ".concat(W("home.cover_class"))})),r.a.createElement("div",{className:"flex-item card"},r.a.createElement("div",{className:"position-top card-menu"},r.a.createElement(l,{handleSetting:a})),r.a.createElement("div",{className:"position-content flex-direction-column"},r.a.createElement(b.a,{className:e.formControl},r.a.createElement(Z,{Label:W("home.room_name"),value:p.roomName,onChange:function(e){g(Object(f.a)(Object(f.a)({},p),{},{roomName:e}))},requiredText:k.roomName})),r.a.createElement(b.a,{className:e.formControl},r.a.createElement(Z,{Label:W("home.nickname"),value:p.yourName,onChange:function(e){g(Object(f.a)(Object(f.a)({},p),{},{yourName:e}))},requiredText:k.yourName})),r.a.createElement(b.a,{className:e.formControl},r.a.createElement(q,{Label:W("home.room_type"),value:p.roomType,onChange:function(e){g(Object(f.a)(Object(f.a)({},p),{},{roomType:e.target.value}))},items:x.map((function(e){return{value:e.value,text:W("".concat(e.text)),path:e.path}}))})),r.a.createElement(b.a,{className:e.formControl},r.a.createElement(G,{value:p.role,onChange:function(e){g(Object(f.a)(Object(f.a)({},p),{},{role:e.target.value}))},requiredText:k.role})),r.a.createElement(E,{name:W("home.room_join"),onClick:function(){var e=window.location.href,a=new URL(e),n=a.searchParams.get("room"),r={token:a.searchParams.get("token"),roomName:n,roomType:a.searchParams.get("roomtype"),subject:a.searchParams.get("subject"),yourName:""};Ge.a.post("".concat("http://127.0.0.1:8000/","creat_class_room"),r).then((function(e){if(p.roomName=e.data.roomName,p.role=e.data.role,p.roomType=e.data.roomType,p.yourName=e.data.yourName,p.roomName)if(p.yourName)if(p.role){if(x[p.roomType]){var a=x[p.roomType].path;I.showLoading(),He.LoginToRoom({userName:p.yourName,roomName:p.roomName,role:"teacher"===p.role?1:2,type:p.roomType,uuid:at()}).then((function(){t.push("/classroom/".concat(a))})).catch((function(e){e.hasOwnProperty("api_error")||(e.reason?I.showToast({type:"rtmClient",message:W("toast.rtm_login_failed_reason",{reason:e.reason})}):I.showToast({type:"rtmClient",message:W("toast.rtm_login_failed")}),console.warn(e))})).finally((function(){I.stopLoading()}))}}else T(Object(f.a)(Object(f.a)({},k),{},{role:W("home.missing_role")}));else T(Object(f.a)(Object(f.a)({},k),{},{yourName:W("home.missing_your_name")}));else T(Object(f.a)(Object(f.a)({},k),{},{roomName:W("home.missing_room_name")}))})).catch((function(e){console.log(e),I.showToast({type:"rtmClient",message:W("toast.rtm_login_failed_reason",{reason:e.response.data.message})})}))}})))))})),vt=a(622),_t=(a(195),Object(g.a)({root:{display:"flex",marginTop:"8px"},sliderClass:{color:"#44A2FC",minWidth:"210px",marginLeft:"6px"}}));function bt(e){var t=_t(e),a=r.a.useState(e.volume),o=Object(v.a)(a,2),c=o[0],s=o[1];return Object(n.useEffect)((function(){e.onChange(c)}),[c]),r.a.createElement("div",{className:"volume-container"},r.a.createElement("div",{className:t.root},r.a.createElement(K,{className:"icon-speaker",disable:!0}),r.a.createElement(vt.a,{className:t.sliderClass,value:c,onChange:function(e,t){s(t)},"aria-labelledby":"continuous-slider"})))}var gt=Object(g.a)({root:{display:"flex",marginTop:"8px"},sliderClass:{color:"#44A2FC",minWidth:"210px",marginLeft:"6px"},sliderRailClass:{height:"12px",color:"#44A2FC"},sliderMarkClass:{height:"12px",color:"#CCCCCC"}});function Ot(e){return r.a.createElement("div",{className:"voice-sliders"},Object(Qe.a)(Array(52)).map((function(t,a){return r.a.createElement("span",{className:e.volume>a?"active":"",key:a})})))}function Et(e){var t=gt(e),a=e.volume;return r.a.createElement("div",{className:t.root},r.a.createElement(K,{className:"icon-voice",disable:!0}),r.a.createElement(Ot,{volume:52*a,className:t.sliderClass}))}var yt=function(e){return r.a.createElement("div",{className:"volume-container"},r.a.createElement(Et,{volume:e.volume}))},kt=(a(318),a(607)),Tt=new(function(){function e(){Object(j.a)(this,e),this.defaultState={reason:null,errors:[]},this.subject=new kt.a(this.defaultState)}return Object(w.a)(e,[{key:"subscribe",value:function(e){this.subject.subscribe(e)}},{key:"unsubscribe",value:function(){this.subject.unsubscribe(),this.state=this.defaultState}},{key:"state",set:function(e){this.subject.next(Object(f.a)(Object(f.a)({},this.subject.getValue()),e))},get:function(){return this.subject.getValue()}}]),e}()),Ct=a(73),jt=a(72),wt=a(257),At=a(266),St=a(22),Pt=Object(St.createPlugins)({video:wt.videoPlugin,audio:At.audioPlugin});Pt.setPluginContext("video",{identity:"guest"}),Pt.setPluginContext("audio",{identity:"guest"});var Rt=new(function(e){Object(Ct.a)(a,e);var t=Object(jt.a)(a);function a(){var e;return Object(j.a)(this,a),(e=t.call(this)).state=void 0,e.subject=void 0,e.defaultState=Object(f.a)(Object(f.a)({joined:!1,scenes:[],currentScenePath:"",currentHeight:0,currentWidth:0,dirs:[],zoomRadio:0,scale:0,recording:!1,startTime:0,endTime:0,room:null,loading:!0},N.read("mediaDirs")),{},{totalPage:0,currentPage:0,type:"static"}),e.disconnected=!0,e.client=new St.WhiteWebSdk({deviceType:St.DeviceType.Surface,plugins:Pt,loggerOptions:{disableReportLog:!1,reportLevelMask:"debug",printLevelMask:"debug"}}),e.operator=null,e.subject=null,e.state=e.defaultState,e}return Object(w.a)(a,[{key:"initialize",value:function(){this.subject=new A.a,this.state=Object(f.a)({},this.defaultState),this.subject.next(this.state)}},{key:"subscribe",value:function(e){this.initialize(),this.subject&&this.subject.subscribe(e)}},{key:"unsubscribe",value:function(){this.subject&&this.subject.unsubscribe(),this.subject=null}},{key:"commit",value:function(e){this.subject&&this.subject.next(e)}},{key:"updateState",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),e),this.commit(this.state)}},{key:"getNameByScenePath",value:function(e){var t=Object(S.get)(this.state.room,"state.globalState.sceneMap",{});return console.log("sceneMap",t),Object(S.get)(t,e,"default name")}},{key:"updateRoomState",value:function(){if(this.state.room){console.log("current room state",this.state.room.state);var e=this.state.room.state,t=e.sceneState.scenePath,a=e.sceneState.scenes[0].ppt,n=Object(S.isEmpty)(a)?"static":"dynamic",r=e.sceneState.index,o=e.sceneState.scenes.length;this.state="dynamic"!==n?Object(f.a)(Object(f.a)({},this.state),{},{currentHeight:0,currentWidth:0}):Object(f.a)(Object(f.a)({},this.state),{},{currentHeight:Object(S.get)(a,"height",0),currentWidth:Object(S.get)(a,"width",0)});for(var c=this.state.room?this.state.room.entireScenes():{},s=[],i=0,u=Object.keys(c);i<u.length;i++){var l=u[i],d={path:l,file:{name:this.getNameByScenePath(l),type:"whiteboard"},type:"static",rootPath:""};c[l]&&(d.rootPath=-1!==["/","/init"].indexOf(l)?"/init":"".concat(l,"/").concat(c[l][0].name),d.type=c[l][0].ppt?"dynamic":"static","dynamic"===d.type&&(d.file.type="ppt")),s.push(d)}var m=function(e){return/\/([^\/]*)\//g.exec(e),"aria"===RegExp.$1?"":RegExp.$1}(t),h=""===m?"/":"/".concat(m),p=[];s.forEach((function(e){p.push({path:e.path,rootPath:e.rootPath,file:e.file})})),this.state=Object(f.a)(Object(f.a)({},this.state),{},{scenes:s,currentScenePath:h,dirs:p,totalPage:o,currentPage:r,type:n}),this.commit(this.state)}}},{key:"setCurrentScene",value:function(e){this.state.dirs.findIndex((function(t){return t.path===e}));this.state=Object(f.a)(Object(f.a)({},this.state),{},{currentScenePath:e}),this.commit(this.state)}},{key:"updateSceneState",value:function(e){e.scenePath;var t=e.scenes[0].ppt,a=Object(S.isEmpty)(t)?"static":"dynamic",n=e.index,r=e.scenes.length;this.state=Object(f.a)(Object(f.a)({},this.state),{},{currentPage:n,totalPage:r,type:a}),this.commit(this.state)}},{key:"updateScale",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{scale:e}),this.commit(this.state)}},{key:"updateLoading",value:function(e){this.state=Object(f.a)(Object(f.a)({},this.state),{},{loading:e}),this.commit(this.state)}},{key:"join",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a,n,r,o,c,s,i,u,l,d,m=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.rid,a=t.uuid,n=t.roomToken,r=t.location,o=t.userPayload,e.next=3,this.leave();case 3:return c="host"===o.identity?"host":"guest",Pt.setPluginContext("video",{identity:c}),Pt.setPluginContext("audio",{identity:c}),s=!(!r.match(/big-class/)||"host"===c),i=!(!r.match(/big-class/)||"host"===c),u=!r.match(/big-class/)||"host"===c,console.log("[White] isWritable, ".concat(u,", disableDeviceInputs, ").concat(s,", disableOperations, ").concat(i,", location: ").concat(r)),l={uuid:a,roomToken:n,disableBezier:!0,disableDeviceInputs:s,disableOperations:i,isWritable:u},e.next=13,this.client.joinRoom(l,{onPhaseChanged:function(e){e===St.RoomPhase.Connected?(m.disconnected=!1,m.updateLoading(!1)):(m.disconnected=!0,m.updateLoading(!0)),console.log("[White] onPhaseChanged phase : ",e)},onRoomStateChanged:function(e){console.log("onRoomStateChanged",e),e.zoomScale&&Rt.updateScale(e.zoomScale),(e.sceneState||e.globalState)&&Rt.updateRoomState()},onDisconnectWithError:function(e){},onKickedWithReason:function(e){},onKeyDown:function(e){},onKeyUp:function(e){},onHandToolActive:function(e){},onPPTLoadProgress:function(e,t){}});case 13:d=e.sent,this.state=Object(f.a)(Object(f.a)({},this.state),{},{room:d}),this.commit(this.state);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"cleanRoom",value:function(){this.state=Object(f.a)(Object(f.a)({},this.state),{},{room:null}),this.commit(this.state)}},{key:"leave",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.room){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.state.room.disconnect();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.warn("disconnect whiteboard failed",e.t0);case 10:return e.prev=10,this.disconnected=!0,this.cleanRoom(),console.log("cleanRoom"),e.finish(10);case 15:this.updateLoading(!0);case 16:case"end":return e.stop()}}),e,this,[[2,7,10,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=Object(ie.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.leave();case 2:this.state=Object(f.a)({},this.defaultState),this.commit(this.state),this.removeAllListeners();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"lock",value:function(){var e=Object(ie.a)(se.a.mark((function e(){var t,a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Boolean(He.state.course.lockBoard),a=t?0:1,e.next=4,He.updateCourse({lockBoard:a});case 4:a?I.showToast({type:"notice-board",message:W("toast.whiteboard_lock")}):I.showToast({type:"notice-board",message:W("toast.whiteboard_unlock")});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),a}(de.EventEmitter));function Nt(e){var t=r.a.useState(e.defaultState),a=Object(v.a)(t,2),n=a[0],o=a[1];return r.a.useEffect((function(){return e.subscribe((function(e){o(e)})),function(){e.unsubscribe()}}),[]),n}window.netlessStore=Rt;var xt=r.a.createContext({}),It=function(){var e=r.a.useContext(xt);if(void 0===e)throw new Error("useStore must be used within a RootProvider");return e},Dt=function(){return It().globalState},Ut=function(){return It().roomState},Mt=function(e){var t=e.children,a=Nt(I),o=Nt(He),c=Nt(Rt),i=Nt(Tt),u=Nt(We),l=Object(s.e)(),d=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){d.current=!0}}),[]);var m={globalState:a,roomState:o,whiteboardState:c,errorState:i,historyState:u};Object(n.useEffect)((function(){dt.init(),Ze(),We.setHistory(l)}),[]),Object(n.useEffect)((function(){if(He.state.rtm.joined){var e=He.rtmClient;return e.on("ConnectionStateChanged",(function(e){var t=e.newState,a=e.reason;return console.log("newState: ".concat(t," reason: ").concat(a)),"LOGIN_FAILURE"===a?(I.showToast({type:"rtmClient",message:W("toast.login_failure")}),void l.push("/")):"REMOTE_LOGIN"===a||"ABORTED"===t?(I.showToast({type:"rtmClient",message:W("toast.kick")}),void l.push("/")):void 0})),e.on("MessageFromPeer",(function(e){var t=e.message.text,a=e.peerId,n=(e.props,function(e){return ye(e)}(t));console.log("message",t,n),He.handlePeerMessage(n,a).then((function(){})).catch(console.warn)})),e.on("ChannelMessage",(function(e){var t=e.memberId,a=e.message,n=ye(a.text),r=n.cmd,o=n.data;if(console.log("ChannelMessage cmd:  ",a,r,JSON.stringify(o)),r===$.chat){if(o.userId===He.state.me.userId)return;"chatroom"===I.state.active?I.setMessageCount(0):I.setMessageCount(I.state.newMessageCount+1);var c={account:o.userName,text:o.message,ts:+Date.now(),id:t};He.updateChannelMessage(c),console.log("[rtmClient] chatMessage ",c," raw Data: ",o)}if(r===$.roomMemberChanged){var s=o.total;He.updateRoomMember(s)}if(r===$.roomInfoChanged&&He.updateRoomInfo({muteAllChat:o.muteAllChat,lockBoard:o.lockBoard,courseState:o.courseState}),r===$.coVideoUsersChanged){var i=o;He.updateCoVideoUsers(i)}if(r===$.replay){"chatroom"===I.state.active?I.setMessageCount(0):I.setMessageCount(I.state.newMessageCount+1);var u={account:o.userName,text:"recording",link:o.recordId,ts:+Date.now(),id:o.uid};He.updateChannelMessage(u),console.log("[rtmClient] replayMessage",u," raw Data: ",o)}r===$.screenShare&&He.updateScreenShare({state:o.state,screenId:o.screenId,userId:o.userId}),r===$.recordStateChanged&&(console.log("Received, ChatCmdType.recordStateChanged: ",r),He.updateRecordState({roomId:o.roomId,recordId:o.recordId,isRecording:o.isRecording,recordingTime:o.recordingTime}))})),function(){e.removeAllListeners()}}}),[He.state.rtm.joined]);var h=Object(s.f)();return Object(n.useEffect)((function(){if("/"!==h.pathname){var e=m.roomState;N.save("agora_room",{me:e.me,course:e.course,mediaDevice:e.mediaDevice,applyUser:e.applyUser}),N.setLanguage(m.globalState.language),window.errorState=i,window.room=o,window.globalState=a,window.whiteboard=c}}),[m,h]),r.a.createElement(xt.Provider,{value:m},t)},Lt=r.a.memo((function(e){var t=e.preview,a=e.role,o=e.account,c=e.stream,s=e.className,i=e.domId,u=e.streamID,l=e.audio,d=e.id,m=e.video,h=e.handleClick,p=e.local,f=e.handleClose,_=e.close,b=e.autoplay,g=Object(n.useRef)(!1),O=Object(n.useRef)(!1),E=Object(n.useRef)(!1),y=Object(n.useState)(!1),k=Object(v.a)(y,2),T=k[0],C=k[1],j=Object(n.useMemo)((function(){return!0===T&&!1===b&&!1===p}),[T,b,p]);Object(n.useEffect)((function(){if(i&&c&&we);}),[i,c,we]),Object(n.useEffect)((function(){if(c&&i&&(!E.current||!c.isPlaying()))return E.current=!0,c.play("".concat(i),{fit:"cover"},(function(e){E.current=!1,console.warn("[video-player] ",JSON.stringify(e),d,c.isPaused(),c.isPlaying()," isLocal: ",p),!b&&e&&e.audio&&"aborted"!==e.audio.status&&!p&&(c.isPaused()&&C(!0),console.warn("[video-player] play failed ",JSON.stringify(e),d,c.isPaused(),c.isPlaying()))})),function(){c.isPlaying()&&c.stop()}}),[i,c]),Object(n.useEffect)((function(){if(c){if(!O.current)return l||(c.muteAudio(),console.log("stream mute audio")),void(O.current=!0);l?(console.log("stream unmute audio"),c.unmuteAudio()):(console.log("stream mute audio"),c.muteAudio())}}),[c,l,we]),Object(n.useEffect)((function(){if(c){if(!g.current)return m||(console.log("stream mute video"),c.muteVideo()),void(g.current=!0);m?(console.log("stream unmute video"),c.unmuteVideo()):(console.log("stream mute video"),c.muteVideo())}}),[c,m,we]);var w=Ut().me;return r.a.createElement("div",{className:"".concat(s||(t?"preview-video rotateY180deg":"agora-video-view ".concat(!1===Boolean(m)&&c?"show-placeholder":"")))},_?r.a.createElement("div",{className:"icon-close",onClick:function(e){f&&d&&f("close",u)}}):null,"screen-sharing"!==s?r.a.createElement("div",{className:"teacher"===a?"teacher-placeholder":"student-placeholder"}):null,t?null:o?r.a.createElement("div",{className:"video-profile"},r.a.createElement("span",{className:"account"},o),"".concat(w.uid)==="".concat(d)||1===w.role?r.a.createElement("span",{className:"media-btn"},r.a.createElement(K,{onClick:function(e){h&&d&&h("audio",u,d)},className:l?"icon-speaker-on":"icon-speaker-off",data:"audio"}),r.a.createElement(K,{onClick:function(e){h&&d&&h("video",u,d)},className:m?"icons-camera-unmute-s":"icons-camera-mute-s",data:"video"})):null):null,r.a.createElement("div",{id:"".concat(i),className:"agora-rtc-video ".concat(p?"rotateY180deg":"")}),j?r.a.createElement("div",{className:"clickable",onClick:function(){c.resume().then((function(){C(!1),console.log("clickable")})).catch(console.warn)}}):null)}));var Bt=Object(g.a)({formControl:{minWidth:"240px",maxWidth:"240px"}}),Wt=function(e){var t=Bt(),a=ae().SettingBtn,o=function(){var e=Object(n.useState)([]),t=Object(v.a)(e,2),a=t[0],o=t[1],c=ae().platform,s=Object(n.useMemo)((function(){return a.filter((function(e){return"videoinput"===e.kind}))}),[a]),i=Object(n.useMemo)((function(){return a.filter((function(e){return"audioinput"===e.kind}))}),[a]),u=Object(n.useMemo)((function(){return a.filter((function(e){return"audiooutput"===e.kind}))}),[a]),l=Ut(),d=Object(n.useMemo)((function(){return l.mediaDevice}),[l.mediaDevice]),m=Object(n.useState)(d.camera),h=Object(v.a)(m,2),p=h[0],f=h[1],_=Object(n.useState)(d.microphone),b=Object(v.a)(_,2),g=b[0],O=b[1],E=Object(n.useState)(d.speaker),y=Object(v.a)(E,2),k=y[0],T=y[1],C=Object(n.useState)(d.speakerVolume),j=Object(v.a)(C,2),w=j[0],A=j[1],S=Object(n.useState)(0),P=Object(v.a)(S,2),R=P[0],N=P[1],x=!1;Object(n.useEffect)((function(){var e=He.rtcClient;if(c&&e){if("web"===c&&!x){var t=e,a=function(){var e=Object(ie.a)(se.a.mark((function e(){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getDevices();case 2:a=e.sent,o(a.map((function(e){return{value:e.deviceId,text:e.label,kind:e.kind}})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return window.addEventListener("devicechange",a),a().then((function(){})).catch(console.warn),x=!0,function(){window.removeEventListener("devicechange",a)}}if("electron"===c&&!x){var n=e,r=function(){var e=Object(ie.a)(se.a.mark((function e(){var t,a,r,c,s,i;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.rtcEngine.getAudioRecordingDevices();case 2:return t=e.sent,e.next=5,n.rtcEngine.getAudioPlaybackDevices();case 5:return a=e.sent,e.next=8,n.rtcEngine.getVideoDevices();case 8:r=e.sent,c=t.map((function(e){return{kind:"audioinput",text:e.devicename,value:e.deviceid}})),s=a.map((function(e){return{kind:"audiooutput",text:e.devicename,value:e.deviceid}})),i=r.map((function(e){return{kind:"videoinput",text:e.devicename,value:e.deviceid}})),o([].concat(c).concat(s).concat(i));case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r().then((function(){return console.log("electron devices changed")})).catch(console.warn),n.on("videodevicestatechanged",r),n.on("audiodevicestatechanged",r),x=!0,function(){n.off("videodevicestatechanged",r),n.off("audiodevicestatechanged",r)}}}}),[c]);var I=Object(n.useMemo)((function(){return s[p]?s[p].value:""}),[s,p]),D=Object(n.useMemo)((function(){return i[g]?i[g].value:""}),[i,g]),U=Object(n.useMemo)((function(){return u[k]?u[k].value:""}),[u,k]),M=Object(n.useState)(null),L=Object(v.a)(M,2),B=L[0],W=L[1],Y=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){Y.current=!0}}),[]);var G=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){G.current=!0}}),[]),Object(n.useEffect)((function(){if(!G.current&&U&&I&&D){var e=He.rtcClient;if(G.current=!0,"web"===c){var t=e;!Y.current&&t.createPreviewStream({cameraId:I,microphoneId:D,speakerId:U}).then((function(e){!Y.current&&W(e)})).finally((function(){G.current=!1}))}if("electron"===c){var a=e.createStream({streamID:0,cameraId:I,microphoneId:D,speakerId:U});W(a),G.current=!1}}}),[c,U,I,D]);var K=Object(n.useRef)(null);Object(n.useEffect)((function(){if(B&&B.getAudioLevel)return K.current=setInterval((function(){!Y.current&&N(B.getAudioLevel())}),300),function(){K.current&&clearInterval(K.current),K.current=null}}),[B]),Object(n.useEffect)((function(){if(B&&"electron"===c){console.log("[electron-client] add volume event listener");var e=function(e,t,a){N(Number((a/255).toFixed(3)))},t=He.rtcClient;t.rtcEngine.setClientRole(1);var a=t.rtcEngine.enableAudioVolumeIndication(1e3,3,!0);return console.log("enableAudioVolumeIndication(1000, 3, true), ",a),t.rtcEngine.on("groupAudioVolumeIndication",e),console.log("startplayback on result",t.rtcEngine.startAudioRecordingDeviceTest(300)),function(){t.rtcEngine.off("groupAudioVolumeIndication",e),console.log("startplayback off result",t.rtcEngine.stopAudioPlaybackDeviceTest())}}}),[B]);var F=Object(n.useCallback)((function(){return B?r.a.createElement(Lt,{domId:"local",preview:!0,stream:B,streamID:0,video:!0,audio:!0,local:!0}):null}),[B]),V=Object(n.useCallback)((function(){return r.a.createElement(yt,{volume:R})}),[R]);return{volume:R,cameraList:s,microphoneList:i,speakerList:u,camera:p,microphone:g,speaker:k,setCamera:f,setMicrophone:O,setSpeaker:T,speakerVolume:w,setSpeakerVolume:A,PreviewPlayer:F,MicrophoneVolume:V,save:function(e){var t=e.camera,a=e.microphone,n=e.speaker,r=e.speakerVolume,o={cameraId:s[t]?s[t].value:"",microphoneId:i[a]?i[a].value:"",speakerId:u[n]?u[n].value:"",camera:t,microphone:a,speaker:n,speakerVolume:r};Y.current=!0,He.updateDevice(o),B&&B.close&&B.close()}}}(),c=o.cameraList,s=o.microphoneList,i=o.speakerList,u=o.camera,l=o.microphone,d=o.speaker,m=o.setCamera,h=o.setMicrophone,p=o.setSpeaker,f=o.speakerVolume,_=o.setSpeakerVolume,g=o.save,O=o.PreviewPlayer,y=o.MicrophoneVolume;return r.a.createElement("div",{className:e.className?e.className:"flex-container"},r.a.createElement("div",{className:"custom-card"},r.a.createElement("div",{className:"flex-item cover"},r.a.createElement(O,null)),r.a.createElement("div",{className:"flex-item card"},r.a.createElement("div",{className:"position-top card-menu"},r.a.createElement("div",null),r.a.createElement("div",{className:"icon-container"},r.a.createElement(a,null))),r.a.createElement("div",{className:"position-content flex-direction-column"},r.a.createElement(b.a,{className:t.formControl},r.a.createElement(q,{Label:W("device.camera"),value:u,onChange:function(e){console.log("changeCamera ",e.target.value),m(e.target.value)},items:c})),r.a.createElement(b.a,{className:t.formControl},r.a.createElement(q,{Label:W("device.microphone"),value:l,onChange:function(e){console.log("changeMicrophone ",e.target.value),h(e.target.value)},items:s}),r.a.createElement(y,null)),r.a.createElement(b.a,{className:t.formControl},r.a.createElement(q,{Label:W("device.speaker"),value:d,onChange:function(e){console.log("changeSpeaker ",e.target.value),p(e.target.value)},items:i}),r.a.createElement(bt,{volume:f,onChange:function(e){console.log("changeSpeaker ",e),_(e)}})),r.a.createElement(E,{name:W("device.finish"),onClick:function(t){g({speakerVolume:f,camera:u,microphone:l,speaker:d}),e.handleFinish(t)}})))))};var Yt,Gt=r.a.memo((function(){var e=Object(s.e)();return Object(n.useEffect)((function(){var e=He.rtcClient;return function(){e.tmpStream&&(e.tmpStream.isPlaying()&&e.tmpStream.stop(),e.tmpStream.close())}}),[]),r.a.createElement("div",{className:"flex-container ".concat("home-cover-web")},r.a.createElement(Wt,{handleFinish:function(t){e.push("/")}}))})),Kt=(a(213),a(46)),Ft=a.n(Kt);!function(e){e[e.CLOSED=0]="CLOSED",e[e.STARTED=1]="STARTED"}(Yt||(Yt={}));var Vt=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;Object(j.a)(this,e),this.stream=t,this.streamID=a,this.local=n},zt={excellent:"network-good",good:"network-good",poor:"network-normal",bad:"network-normal","very bad":"network-bad",down:"network-bad",unknown:"network-bad"};function Zt(e){var t=e.delay,a=e.network,n=(e.cpu,e.role),o=e.roomName,c=e.time,s=e.handleClick,i=e.showSetting,u=e.classState,l=e.onCardConfirm,d=ae().NavBtn;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"nav-container ".concat("")},r.a.createElement("div",{className:"class-title"},r.a.createElement("span",{className:"room-name"},o),1===+n?r.a.createElement(E,{className:"nav-button ".concat(u?"stop":"start"),name:W(u?"nav.class_end":"nav.class_start"),onClick:function(e){s("classState")}}):null),r.a.createElement("div",{className:"network-state"},r.a.createElement("span",{className:"net-field"},W("nav.delay"),r.a.createElement("span",{className:"net-field-value"},t)),r.a.createElement("span",{className:"net-field net-field-container"},W("nav.network"),r.a.createElement("span",{className:"net-field-value ".concat(zt[a]),style:{marginLeft:".2rem"}})),null),r.a.createElement("div",{className:"menu"},r.a.createElement("div",{className:"timer"},r.a.createElement(K,{className:"icon-time",disable:!0}),r.a.createElement("span",{className:"time"},Kt.utc(c).format("HH:mm:ss"))),r.a.createElement("span",{className:"menu-split"}),r.a.createElement("div",{className:"btn-group"},r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{title:W("icon.setting"),placement:"bottom"},r.a.createElement("span",null,r.a.createElement(K,{className:"icon-setting",onClick:function(e){s("setting")}})))),r.a.createElement(_.a,{title:W("icon.upload-log"),placement:"bottom"},r.a.createElement("span",null,r.a.createElement(K,{className:I.state.lock?"icon-loading":"icon-upload",onClick:function(e){s("uploadLog")}}))),r.a.createElement(_.a,{title:W("icon.exit-room"),placement:"bottom"},r.a.createElement("span",null,r.a.createElement(K,{className:"icon-exit",onClick:function(e){s("exit")}})))),r.a.createElement(d,null))),i?r.a.createElement(Wt,{className:"internal-card",handleFinish:function(e){l("setting")}}):null)}function Ht(){var e=ae().platform,t=Object(n.useRef)(!1),a=Object(n.useState)(0),o=Object(v.a)(a,2),c=o[0],s=o[1],i=Object(n.useState)(null),u=Object(v.a)(i,2),l=u[0],d=u[1],m=Object(n.useState)(!1),h=Object(v.a)(m,2),p=h[0],f=h[1],_=Object(n.useState)(0),b=Object(v.a)(_,2),g=b[0],O=b[1],E=Object(n.useState)("unknown"),y=Object(v.a)(E,2),k=y[0],T=y[1],C=Object(n.useState)(0),j=Object(v.a)(C,2),w=j[0],A=j[1];Object(n.useEffect)((function(){return function(){t.current=!0,l&&(clearInterval(l),d(null))}}),[]);var S=Ut(),P=S.me;Object(n.useEffect)((function(){var a=He.rtcClient;if("web"===e){var n=a;return n.rtc.on("watch-rtt",(function(e){!t.current&&O(e)})),n.rtc.on("network-quality",(function(e){var a=Ce(e);!t.current&&T(a)})),function(){n.rtc.off("watch-rtt",(function(){})),n.rtc.off("network-quality",(function(){}))}}if("electron"===e){var r=a;return r.on("rtcStats",(function(e){var a=e.cpuTotalUsage;!t.current&&A(a)})),r.on("networkquality",(function(e,a,n){if(0===e){var r=Ce({downlinkNetworkQuality:n,uplinkNetworkQuality:a});!t.current&&T(r)}})),function(){r.off("rtcStats",(function(){})),r.off("networkquality",(function(){})),r.off("audioquality",(function(){}))}}}),[]);var R=S.course.courseState,N=S.course;Object(n.useEffect)((function(){if(R===Yt.STARTED&&null===l){var e=+Date.now();d(function(e){return setInterval((function(){!t.current&&s(+Date.now()-e)}),150,e)}(e))}l&&R===Yt.CLOSED&&(clearInterval(l),d(null))}),[R]);var x=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){x.current=!0}}),[]);return r.a.createElement(Zt,{role:P.role,roomName:N.roomName,classState:Boolean(N.courseState),delay:"".concat(g,"ms"),time:c,network:"".concat(k),cpu:"".concat(w,"%"),showSetting:p,onCardConfirm:function(e){switch(e){case"setting":return void f(!1);case"exitRoom":return void I.removeDialog()}},handleClick:function(e){"setting"===e?f(!0):"exit"===e?I.showDialog({type:"exitRoom",message:W("toast.quit_room")}):"classState"===e?x.current||(x.current=!0,He.updateCourse({courseState:+!Boolean(He.state.course.courseState)}).then((function(){})).catch(console.warn).finally((function(){x.current=!1}))):"uploadLog"===e&&(I.lock(),dt.doUpload().then((function(e){I.showDialog({type:"uploadLog",message:W("toast.show_log_id",{reason:"".concat(e)})})})).finally((function(){I.unlock()})))}})}var Jt=a(621),qt=a(608),Xt=a(609);a(370);function Qt(e){var t=e.onConfirm,a=e.onClose,n=e.desc,o=e.type,c=function(){a(o)};return r.a.createElement("div",null,r.a.createElement(Jt.a,{disableBackdropClick:!0,open:!0,onClose:c,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(qt.a,{className:"modal-container"},r.a.createElement(Xt.a,{className:"dialog-title"},n),r.a.createElement("div",{className:"button-group"},r.a.createElement(E,{name:W("toast.confirm"),className:"confirm",onClick:function(){t(o)},color:"primary"}),r.a.createElement(E,{name:W("toast.cancel"),className:"cancel",onClick:c,color:"primary"})))))}var $t=r.a.memo((function(){var e=Object(s.e)(),t=Dt().dialog;return Object(n.useMemo)((function(){return!!t.type}),[t])?r.a.createElement(Qt,{type:t.type,desc:t.message,onClose:function(e){"exitRoom"===e?I.removeDialog():"apply"===e?ze.teacherRejectApply(He.state.course.roomId,He.state.applyUser.userId).then((function(){I.showToast({type:"peer_hands_up",message:W("toast.reject_co_video")}),I.removeNotice(),I.removeDialog()})).catch((function(e){console.warn(e)})):"uploadLog"===e&&I.removeDialog()},onConfirm:function(t){"exitRoom"===t?(I.showLoading(),He.exitRoom().finally((function(){I.removeDialog(),I.stopLoading(),e.goBack()}))):"apply"===t?ze.teacherAcceptApply(He.state.course.roomId,He.state.applyUser.userId).then((function(){I.showToast({type:"peer_hands_up",message:W("toast.accept_co_video")}),I.removeNotice(),I.removeDialog()})).catch((function(e){console.warn(e)})):"uploadLog"===t&&I.removeDialog()}}):null})),ea=(a(214),a(371),function(e){e.ownerName;var t=e.name,a=e.className,n=(e.windowId,e.image);return r.a.createElement("div",{className:a||""},r.a.createElement("div",{className:"screen-image"},r.a.createElement("div",{className:"content",style:{backgroundImage:"url(data:image/png;base64,".concat(n,")")}})),r.a.createElement("div",{className:"screen-meta"},t))}),ta=function(e){var t=e.title,a=e.items,n=e.windowId,o=e.selectWindow,c=e.confirm,s=e.cancel;return r.a.createElement("div",{className:"window-picker-mask"},r.a.createElement("div",{className:"window-picker"},r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"title"},t),r.a.createElement("div",{className:"cancelBtn",onClick:s})),r.a.createElement("div",{className:"screen-container"},a.map((function(e,t){return r.a.createElement("div",{className:"screen-item",key:t,onClick:function(){o(e.windowId)},onDoubleClick:c},r.a.createElement(ea,{ownerName:e.ownerName,name:e.name,className:"window-item ".concat(e.windowId===n?"active":""),windowId:e.windowId,image:e.image}))}))),r.a.createElement("div",{className:"footer"},r.a.createElement(E,{className:"share-confirm-btn",name:"start",onClick:c}))))};function aa(){var e=ae().platform,t=Dt().nativeWindowInfo,a=r.a.useState(""),n=Object(v.a)(a,2),o=n[0],c=n[1];return t.visible?r.a.createElement(ta,{windowId:o,title:"Please select and click window for share",items:t.items,cancel:function(){I.setNativeWindowInfo({visible:!1,items:[]})},selectWindow:function(e){c(e)},confirm:function(){var t=Object(ie.a)(se.a.mark((function t(a){var n,r,c,s,i,u;return se.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o){t.next=3;break}return console.warn("windowId is empty"),t.abrupt("return");case 3:if(t.prev=3,"electron"!==e){t.next=16;break}return I.showLoading(),n=He.rtcClient,r=n,t.next=10,ze.refreshToken();case 10:return c=t.sent,s=c.screenToken,t.next=14,r.startScreenShare(o,+He.state.course.screenId,He.state.course.rid,s,He.state.appID);case 14:i=t.sent,He.addLocalSharedStream(new Vt(i,i.uid,!0));case 16:t.next=26;break;case 18:throw t.prev=18,t.t0=t.catch(3),u=He.rtcClient,u.releaseScreenShare(),I.showToast({type:"nativeScreenShare",message:W("electron.start_screen_share_failed")}),console.warn(JSON.stringify(t.t0)),t.t0;case 26:return t.prev=26,I.stopLoading(),I.setNativeWindowInfo({visible:!1,items:[]}),t.finish(26);case 30:case"end":return t.stop()}}),t,null,[[3,18,26,30]])})));return function(e){return t.apply(this,arguments)}}()}):null}var na=[{value:0,path:"one-to-one"},{value:1,path:"small-class"},{value:2,path:"big-class"}];function ra(e){var t=e.children,a=Object(s.e)(),o=Object(n.useRef)(!1);Object(n.useEffect)((function(){var e=He.state.me,t=He.state.course;e.account&&t.roomName||a.push("/"),o.current=!0,He.state.rtm.joined||(I.showLoading(),He.fetchCurrentRoom().then((function(){})).catch((function(e){e.reason?I.showToast({type:"rtmClient",message:W("toast.rtm_login_failed_reason",{reason:e.reason})}):I.showToast({type:"rtmClient",message:W("toast.rtm_login_failed")}),console.warn(e)})).finally((function(){I.stopLoading()})))}),[]);var c=na[He.state.course.roomType],i=Object(s.f)(),u=Ut(),l=He.state.me,d=Boolean(i.pathname.match(/classroom/)),m=Boolean(i.pathname.match(/small-class/));Object(n.useEffect)((function(){return function(){I.removeUploadNotice(),He.exitAll().then((function(){})).catch(console.warn).finally((function(){}))}}),[i]);var h=Object(n.useRef)(!1),p=Object(n.useMemo)((function(){return l.coVideo}),[l.coVideo]);Object(n.useEffect)((function(){return function(){h.current=!0}}),[]);var f=Object(n.useRef)(!1),v=Object(n.useMemo)((function(){return{rtcJoined:u.rtc.joined,uid:u.me.uid,role:u.me.role,mediaDevice:u.mediaDevice}}),[u]),_=v.rtcJoined,b=v.uid,g=v.role,O=v.mediaDevice;return Object(n.useEffect)((function(){if(i.pathname.match(/big-class/)&&1!==l.role){var e=He.rtcClient,t=e;if(t.published)Promise.all([t.unpublishLocalStream()]).then((function(){console.log("[agora-web] unpublish local stream")})).catch(console.warn)}}),[l.role,i.pathname,p]),Object(n.useEffect)((function(){if(_&&!h.current){var e=He.rtcClient,t={streamID:+He.state.me.uid,video:!0,audio:!0,mirror:!1,screen:!1,microphoneId:O.microphoneId,cameraId:O.cameraId,audioOutput:{volume:O.speakerVolume,deviceId:O.speakerId}};console.log("canPb>>> ",p,He.state.me.uid),p&&!f.current&&(f.current=!0,Promise.all([e.publishLocalStream(t)]).then((function(e){console.log("[agora-web] any: ",e[0],e[1]),console.log("[agora-web] publish local stream")})).catch(console.warn).finally((function(){f.current=!1})))}}),[_,b,g,O,p]),Object(n.useEffect)((function(){if(u.me.uid&&u.course.rid&&u.appID&&d){var e=He.rtcClient;if(e.joined||h.current)return;return console.log("[agora-rtc] add event listener"),e.rtc.on("onTokenPrivilegeWillExpire",(function(t){ze.refreshToken().then((function(a){var n=a.rtcToken;e.rtc.renewToken(n),console.log("[agora-web] onTokenPrivilegeWillExpire",t)}))})),e.rtc.on("onTokenPrivilegeDidExpire",(function(t){ze.refreshToken().then((function(a){var n=a.rtcToken;e.rtc.renewToken(n),console.log("[agora-web] onTokenPrivilegeDidExpire",t)}))})),e.rtc.on("error",(function(e){console.log("[agora-web] error evt",e)})),e.rtc.on("stream-published",(function(e){var t=e.stream,a=new Vt(t,t.getId(),!0);He.addLocalStream(a),He.addRTCUser(t.getId())})),e.rtc.on("stream-subscribed",(function(t){var a=t.stream,n=a.getId();i.pathname.match(/small-class/)&&(He.state.course.teacherId&&He.state.course.teacherId==="".concat(n)?(e.setRemoteVideoStreamType(a,0),console.log("[agora-web] dual stream set high for teacher")):(e.setRemoteVideoStreamType(a,1),console.log("[agora-web] dual stream set low for student")));var r=new Vt(a,a.getId(),!1);console.log("[agora-web] subscribe remote stream, id: ",a.getId()),He.addRemoteStream(r)})),e.rtc.on("stream-added",(function(t){var a=t.stream;console.log("[agora-web] added remote stream, id: ",a.getId()),e.subscribe(a)})),e.rtc.on("stream-removed",(function(e){var t=e.stream;console.log("[agora-web] removed remote stream, id: ",t.getId()),He.removeRemoteStream(t.getId())})),e.rtc.on("peer-online",(function(e){var t=e.uid;console.log("[agora-web] peer-online, id: ",t),He.addRTCUser(t)})),e.rtc.on("peer-leave",(function(e){var t=e.uid;console.log("[agora-web] peer-leave, id: ",t),He.removePeerUser(t),He.removeRemoteStream(t),1===He.state.me.role&&2===He.state.course.roomType&&He.state.applyUser.account&&I.showToast({type:"rtmClient",message:W("toast.student_peer_leave",{reason:He.state.applyUser.account})})})),e.rtc.on("stream-fallback",(function(e){var t=e.uid,a=0===e.attr?"resume to a&v mode":"fallback to audio mode";console.info("[agora-web] stream: ".concat(t," fallback: ").concat(a))})),h.current=!0,e.joinChannel({uid:+u.me.uid,channel:u.course.rid,token:u.me.rtcToken,dual:m,appId:u.appID}).then((function(){})).catch(console.warn).finally((function(){h.current=!1})),function(){for(var t=0,a=["onTokenPrivilegeWillExpire","onTokenPrivilegeDidExpire","error","stream-published","stream-subscribed","stream-added","stream-removed","peer-online","peer-leave","stream-fallback"];t<a.length;t++){var n=a[t];e.rtc.off(n,(function(){}))}console.log("[agora-web] remove event listener"),!h.current&&e.exit().then((function(){console.log("[agora-web] do remove event listener")})).catch(console.warn).finally((function(){h.current=!0,He.removeLocalStream()}))}}}),[JSON.stringify([u.me.uid,u.course.rid,u.appID])]),r.a.createElement("div",{className:"classroom ".concat(c.path)},r.a.createElement(aa,null),r.a.createElement(Ht,null),t,r.a.createElement($t,null))}var oa=a(610),ca=Object(g.a)((function(e){return{progress:{margin:e.spacing(2),color:"#44A2FC"},container:{position:"absolute",top:"0px",left:"0px",height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",background:"#ffffff",opacity:.8,zIndex:99999}}})),sa=function(){var e=ca();return r.a.createElement("div",{className:e.container},r.a.createElement(oa.a,{className:e.progress}))};function ia(){return Dt().loading?r.a.createElement(sa,null):null}a(372);function ua(e){var t=e.duration,a=void 0===t?2500:t,o=Dt(),c=r.a.useRef([]),s=Object(n.useState)([]),i=Object(v.a)(s,2),u=i[0],l=i[1],d=Object(n.useRef)(null);return Object(n.useEffect)((function(){u.length>0&&null===d.current&&(d.current=setTimeout((function(){c.current.shift(),l(Object(Qe.a)(c.current)),d.current=null}),a))}),[u]),Object(n.useEffect)((function(){c.current&&o.toast.message&&(c.current.push({message:o.toast.message,key:+Date.now()}),l(Object(Qe.a)(c.current)))}),[o.toast]),r.a.createElement("div",{className:"notice-message-container"},u.map((function(e,t){return r.a.createElement("div",{key:"".concat(t).concat(e.key),className:"custom-toast"},r.a.createElement("div",{className:"toast-container"},r.a.createElement("span",{className:"text"},e.message)))})))}a(373),a(374),a(375);var la=function(e){var t=e.title;return r.a.createElement("div",{className:"progress-cover"},r.a.createElement("div",{className:"progress"},r.a.createElement("div",{className:"content"},r.a.createElement(oa.a,{className:"circular"}),r.a.createElement("span",{className:"title"},t,"..."))))},da=r.a.memo(la);function ma(e){var t=r.a.useState(e.defaultState),a=Object(v.a)(t,2),n=a[0],o=a[1];return r.a.useEffect((function(){return e.subscribe((function(e){o(e)})),function(){e.unsubscribe()}}),[]),n}var ha,pa={beginTimestamp:0,duration:0,roomToken:"",mediaURL:"",isPlaying:!1,progress:0,currentTime:0,phase:"waiting",boardPlayPhase:St.PlayerPhase.Pause,isFirstScreenReady:!1,isPlayerSeeking:!1,isChatOpen:!1,isVisible:!1,replayFail:!1,courseRecordData:{startTime:-1,endTime:-1,url:"",boardId:"",status:0,statusText:""},player:null,videoPlayer:null,timelineScheduler:null},fa=new(function(){function e(){Object(j.a)(this,e),this.subject=void 0,this.state=void 0,this.defaultState=pa,this.subject=null,this.state=null}return Object(w.a)(e,[{key:"initialize",value:function(){this.subject=new A.a,this.state=pa,this.subject.next(this.state)}},{key:"subscribe",value:function(e){this.initialize(),this.subject&&this.subject.subscribe(e)}},{key:"unsubscribe",value:function(){this.subject&&this.subject.unsubscribe(),this.state=null,this.subject=null}},{key:"commit",value:function(e){this.subject&&this.subject.next(e)}},{key:"setPlayer",value:function(e){this.state&&(this.state=Object(f.a)(Object(f.a)({},this.state),{},{player:e}),this.commit(this.state))}},{key:"setCurrentTime",value:function(e){this.state&&(this.state=Object(f.a)(Object(f.a)({},this.state),{},{currentTime:e}),this.commit(this.state))}},{key:"getCourseRecordBy",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a,n){var r,o,c,s,i,u,l;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state){e.next=2;break}return e.abrupt("return");case 2:if(2!==this.state.courseRecordData.status||!this.state.courseRecordData.url){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,ze.getCourseRecordBy(t,a,n);case 6:r=e.sent,o=r.boardId,c=r.startTime,s=r.endTime,i=r.url,u=r.status,l=r.statusText,this.state=Object(f.a)(Object(f.a)({},this.state),{},{courseRecordData:{startTime:c,endTime:s,url:i,boardId:o,status:u,statusText:l}}),this.commit(this.state);case 15:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"updatePlayerStatus",value:function(e){this.state&&(this.state=Object(f.a)(Object(f.a)({},this.state),{},{isPlaying:e}),!this.state.isPlaying&&this.state.player&&this.state.player.seekToScheduleTime(0),this.commit(this.state))}},{key:"updateProgress",value:function(e){this.state&&(this.state=Object(f.a)(Object(f.a)({},this.state),{},{progress:e}),this.commit(this.state))}},{key:"setReplayFail",value:function(e){this.state&&(this.state=Object(f.a)(Object(f.a)({},this.state),{},{replayFail:e}),this.commit(this.state))}},{key:"updateWhiteboardPhase",value:function(e){if(this.state){var t=this.state.isPlaying;e===St.PlayerPhase.Playing&&(t=!0),e!==St.PlayerPhase.Ended&&e!==St.PlayerPhase.Pause||(t=!1),this.state=Object(f.a)(Object(f.a)({},this.state),{},{boardPlayPhase:e,isPlaying:t}),this.commit(this.state)}}},{key:"updatePlayState",value:function(e){this.state&&(this.state=Object(f.a)(Object(f.a)({},this.state),{},{phase:e}),this.commit(this.state))}},{key:"loadFirstFrame",value:function(){console.log("invoke loadFirstFrame"),this.state&&(this.state=Object(f.a)(Object(f.a)({},this.state),{},{isFirstScreenReady:!0}),this.state.player&&this.state.player.seekToScheduleTime(0),console.log("invoke loadFirstFrame success",this.state.isFirstScreenReady),this.commit(this.state))}},{key:"addWhiteboardPlayer",value:function(e){this.state&&(this.state=Object(f.a)(Object(f.a)({},this.state),{},{player:e}),this.commit(this.state))}},{key:"addVideoPlayer",value:function(e){this.state&&(this.state=Object(f.a)(Object(f.a)({},this.state),{},{videoPlayer:e}),this.commit(this.state))}},{key:"addTimeline",value:function(e){this.state&&(this.state=Object(f.a)(Object(f.a)({},this.state),{},{timelineScheduler:e}),this.commit(this.state))}},{key:"joinRoom",value:function(){var e=Object(ie.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze.getWhiteboardBy(t);case 2:return a=e.sent,e.abrupt("return",{roomToken:a.boardToken,uuid:a.boardId});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}()),va=(a(376),a(620)),_a=(a(377),function(e){var t=e.nickname,a=e.content,n=e.link,o=e.sender,c=e.children,s=e.ref,u=e.className,l=Ut(),d=r.a.useMemo((function(){return n&&l.course.rid?r.a.createElement(i.b,{to:"/replay/record/".concat(n,"?roomId=").concat(l.course.roomId,"&token=").concat(ze.userToken,"&senderId=").concat(He.state.me.uid,"&channelName=").concat(He.state.course.rid),target:"_blank"},W("course_recording")):n||a}),[a,n,l.course.roomId]);return r.a.createElement("div",{ref:s,className:"message ".concat(o?"sent":"receive"," ").concat(u||"")},r.a.createElement("div",{className:"nickname"},t),r.a.createElement("div",{className:"content"},d),c||null)});!function(e){e.pending="pending",e.loading="loading",e.load="load"}(ha||(ha={}));var ba,ga=r.a.memo((function(e){var t=e.currentSeekTime,a=e.senderId,o=Object(oe.a)(e,["currentSeekTime","senderId"]),c=Object(n.useRef)(null),s=Object(n.useState)(ha.pending),i=Object(v.a)(s,2),u=i[0],l=i[1];Object(n.useEffect)((function(){o.onPhaseChanged&&o.onPhaseChanged(u)}),[u]);var d=Object(va.a)(Object(ie.a)(se.a.mark((function e(){var t,a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.channelName&&o.startTime&&o.endTime){e.next=2;break}throw new Error("startTime & endTime & channelName shouldn't be empty");case 2:if(!(o.startTime>o.endTime)){e.next=4;break}throw new Error("startTime > endTime, please check your startTime and endTime");case 4:return t=new et("customer_id","customer_certificate"),a={channelName:o.channelName,startTime:Ft()(+o.startTime).utc().format("YYYY-MM-DDTHH:mm:ss"),endTime:Ft()(+o.endTime).utc().format("YYYY-MM-DDTHH:mm:ss")},e.next=8,t.getAllChannelMessages(a);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)}))),[JSON.stringify(o)]),m=d.value,h=d.loading;Object(n.useEffect)((function(){h||l(ha.load)}),[h]);var p=function(e){var t=JSON.parse(e.payload);return{account:t.account,content:t.content,link:t.link,ms:e.ms,uid:e.src}},f=Object(n.useMemo)((function(){return m?m.filter((function(e){return e.payload})).map(p):[]}),[m]),_=Object(n.useMemo)((function(){if(o.startTime&&u===ha.load&&f&&f.length){var e=+o.startTime+t;return f.filter((function(t){return e>=t.ms}))}return[]}),[JSON.stringify([f.length,t,u,o.startTime])]);Object(n.useEffect)((function(){var e;(e=c.current).scrollTop=e.scrollHeight}),[_.length]);var b=Object(n.useCallback)((function(){return _?r.a.createElement(n.Fragment,null,_.map((function(e,t){return r.a.createElement(_a,{key:t,nickname:e.account,content:e.content,link:e.link,sender:e.uid===a})}))):null}),[_.length,a]);return r.a.createElement("div",{className:"chat-messages",ref:c},u!==ha.load?null:r.a.createElement(b,null))})),Oa=a(611),Ea=r.a.createContext({}),ya=function(){var e=ma(fa),t=Object(s.g)().recordId,a=Object(s.f)(),n=new URLSearchParams(a.search),o=n.get("roomId"),c=n.get("token"),i=n.get("senderId"),u=n.get("channelName");Object(Oa.a)((function(){fa.getCourseRecordBy(t,o,c)}),5e3);var l=e,d=l.courseRecordData;return r.a.createElement(Ea.Provider,{value:l},2!==(null===d||void 0===d?void 0:d.status)?r.a.createElement(la,{title:W("replay.".concat((null===d||void 0===d?void 0:d.statusText)?null===d||void 0===d?void 0:d.statusText:"loading"))}):r.a.createElement(ka,{roomId:o,senderId:i,channelName:u,whiteboardUUID:null===d||void 0===d?void 0:d.boardId,startTime:null===d||void 0===d?void 0:d.startTime,endTime:null===d||void 0===d?void 0:d.endTime,mediaUrl:null===d||void 0===d?void 0:d.url}))},ka=function(e){e.whiteboardUUID;var t=e.startTime,a=e.endTime,o=e.mediaUrl,c=e.senderId,s=e.channelName,i=e.roomId,u=r.a.useContext(Ea),l=Object(n.useMemo)((function(){return fa.state&&fa.state.player?fa.state.player:null}),[fa.state]),d=function(){if(fa.state&&l)if(l.phase!==St.PlayerPhase.Playing){if(l.phase!==St.PlayerPhase.WaitingFirstFrame&&l.phase!==St.PlayerPhase.Pause)return l.phase===St.PlayerPhase.Ended?(l.seekToScheduleTime(0),void l.play()):void 0;l.play()}else l.pause()},m=function(){u.player&&u.player.refreshViewSize()},h=function(e){"Space"===e.code&&u.player&&p(u.player)},p=function(e){switch(e.phase){case St.PlayerPhase.WaitingFirstFrame:case St.PlayerPhase.Pause:e.play();break;case St.PlayerPhase.Playing:e.pause();break;case St.PlayerPhase.Ended:e.seekToScheduleTime(0)}},f=Object(n.useMemo)((function(){return t&&a?Math.abs(+t-+a):0}),[t,a]),v=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){v.current=!0}}),[]),Object(n.useEffect)((function(){return window.addEventListener("resize",m),window.addEventListener("keydown",h),i&&t&&a&&fa.joinRoom(i).then((function(e){var a=e.roomToken,n=e.uuid;tt(Rt.client,{beginTimestamp:+t,duration:f,room:n,mediaURL:o,roomToken:a},{onCatchErrorWhenRender:function(e){e&&console.warn(e),I.showToast({message:W("toast.replay_failed"),type:"notice"})},onCatchErrorWhenAppendFrame:function(e){e&&console.warn(e),I.showToast({message:W("toast.replay_failed"),type:"notice"})},onPhaseChanged:function(e){fa.updateWhiteboardPhase(e)},onLoadFirstFrame:function(){fa.loadFirstFrame()},onSliceChanged:function(){},onPlayerStateChanged:function(e){},onStoppedWithError:function(e){e&&console.warn(e),I.showToast({message:W("toast.replay_failed"),type:"notice"}),fa.setReplayFail(!0)},onScheduleTimeChanged:function(e){v.current||fa.setCurrentTime(e)}}).then((function(e){e&&(fa.setPlayer(e),e.seekToScheduleTime(0),e.bindHtmlElement(document.getElementById("whiteboard")))}))})),function(){window.removeEventListener("resize",m),window.removeEventListener("keydown",m)}}),[]);var _=Object(n.useMemo)((function(){return Ft()(f).format("mm:ss")}),[f]),b=Object(n.useMemo)((function(){return Ft()(u.currentTime).format("mm:ss")}),[u.currentTime]),g=Object(n.useCallback)((function(){return l?u.isFirstScreenReady?l.phase===St.PlayerPhase.Playing?null:r.a.createElement("div",{className:"player-cover"},l.phase===St.PlayerPhase.Buffering?r.a.createElement(la,{title:W("replay.loading")}):null,l.phase===St.PlayerPhase.Pause||l.phase===St.PlayerPhase.Ended||l.phase===St.PlayerPhase.WaitingFirstFrame?r.a.createElement("div",{className:"play-btn",onClick:d}):null):null:r.a.createElement(la,{title:W("replay.loading")})}),[l,u]);return r.a.createElement("div",{className:"replay"},r.a.createElement("div",{className:"player-container"},r.a.createElement(g,null),r.a.createElement("div",{className:"player"},r.a.createElement("div",{className:"agora-logo"}),r.a.createElement("div",{id:"whiteboard",className:"whiteboard"}),r.a.createElement("div",{className:"video-menu"},r.a.createElement("div",{className:"control-btn"},r.a.createElement("div",{className:"btn ".concat(l&&l.phase===St.PlayerPhase.Playing?"paused":"play"),onClick:d})),r.a.createElement("div",{className:"progress"},r.a.createElement(vt.a,{className:"custom-video-progress",value:u.currentTime,onMouseDown:function(){fa.state&&fa.state.player&&(fa.state.player.pause(),v.current=!0)},onMouseUp:function(){if(fa.state&&fa.state.player){var e=fa.state.player;e.seekToScheduleTime(u.currentTime),e.play(),v.current=!1}},onTouchStart:function(){(console.log("onTouchEnd"),fa.state&&fa.state.player)&&(fa.state.player.pause(),v.current=!0)},onTouchEnd:function(){if(console.log("onTouchStart"),fa.state&&fa.state.player){var e=fa.state.player;e.seekToScheduleTime(u.currentTime),e.play(),v.current=!1}},onChange:function(e,t){fa.setCurrentTime(t),fa.updateProgress(t)},min:0,max:f,"aria-labelledby":"continuous-slider"}),r.a.createElement("div",{className:"time"},r.a.createElement("div",{className:"current_duration"},b),"/",r.a.createElement("div",{className:"video_duration"},_)))))),r.a.createElement("div",{className:"video-container"},r.a.createElement("div",{className:"video-player"},r.a.createElement("video",{playsInline:!0,id:"white-sdk-video-js",className:"video-js video-layout",style:{width:"100%",height:"100%",objectFit:"cover"}})),r.a.createElement("div",{className:"chat-holder chat-board chat-messages-container"},r.a.createElement(ga,{senderId:c,channelName:s,startTime:t,endTime:a,currentSeekTime:u.currentTime,onPhaseChanged:function(e){e!==ha.load&&(null===l||void 0===l||l.stop())}}))))};!function(e){e.DEBUG="debug",e.NONE="none"}(ba||(ba={}));var Ta,Ca=console,ja=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ba.DEBUG;Object(j.a)(this,e),this.level=t}return Object(w.a)(e,[{key:"prefix",value:function(e){return"[".concat(this.level,"] ").concat(e)}},{key:"info",value:function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];Ca.info.apply(Ca,[this.prefix(e)].concat(a))}},{key:"warn",value:function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];Ca.info.apply(Ca,[this.prefix(e)].concat(a))}},{key:"error",value:function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];Ca.error.apply(Ca,[this.prefix(e)].concat(a))}}]),e}(),wa=a(7),Aa=(a(378),a(379),a(143)),Sa=a.n(Aa),Pa=function(e){Object(Ct.a)(a,e);var t=Object(jt.a)(a);function a(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15,r=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,c=arguments.length>3?arguments[3]:void 0;if(Object(j.a)(this,a),(e=t.call(this)).fps=n,e.callback=r,e.startTime=o,e.endTime=c,e._state="paused",e.delay=void 0,e.duration=void 0,e.rafId=void 0,e.log=void 0,e._lastTimeoutId=void 0,e._stopTimer=void 0,e._visibilityHandler=void 0,e.currentTime=void 0,e.currentDuration=void 0,e.log=new ja,e.endTime<=e.startTime)throw"endTime must greater than startTime";return e.delay=1e3/e.fps,e.rafId=-1,e.duration=e.endTime-e.startTime,e.currentTime=e.startTime,e.currentDuration=0,e._visibilityHandler=function(){},e._lastTimeoutId=-1,e._stopTimer=!0,e}return Object(w.a)(a,[{key:"start",value:function(){var e=this;this._visibilityHandler=function(t){document.hidden?(e.log.warn("passive paused by browser",Date.now()),e.stop()):e.log.warn("switch setTimeout back to raf",Date.now())},document.addEventListener("visibilitychange",this._visibilityHandler,!1),this.state="started";var t=-1,a=-1,n=this.currentDuration;this.rafId=Sa()((function r(o,c){if("ended"===e.state||e.currentTime>=e.endTime)e.stop();else{-1===t&&(t=o);var s=Math.ceil(o-t),i=n+s,u=Math.min(Math.ceil(i/e.duration*100)/100,1),l=Math.min(i,e.duration),d=Math.min(e.startTime+l,e.endTime);e.currentDuration=l;var m=Math.floor(s/e.delay);if(m>a){var h={progress:u,duration:l,time:d,startTime:e.startTime,endTime:e.endTime,isTimer:!0===c};e.callback(h),e.currentTime=d,a=m}"started"===e.state&&(e.rafId=Sa()(r))}}))}},{key:"stop",value:function(){var e;this.state="paused",Sa.a.cancel(this.rafId),e=this._lastTimeoutId,clearInterval(e),this._stopTimer=!0,document.removeEventListener("visibilitychange",(function(){}),!1),this.log.info("this.rafId canceled",this.rafId),this.currentTime===this.endTime&&(this.state="ended")}},{key:"seekTo",value:function(e){if("number"!==typeof e)return this.log.warn("time should pass number");this.currentDuration=e,"ended"===this.state&&(this.currentTime=this.startTime),this.emit("seek-changed",this.currentDuration)}},{key:"state",set:function(e){this._state=e,this.emit("state-changed",this._state)},get:function(){return this._state}}]),a}(de.EventEmitter);!function(e){e.init="init",e.buffering="buffering",e.waiting="waiting",e.playing="playing",e.paused="paused",e.ended="ended",e.loading="loading"}(Ta||(Ta={}));var Ra=function(e){Object(Ct.a)(a,e);var t=Object(jt.a)(a);function a(e,n){var r;Object(j.a)(this,a),(r=t.call(this)).url=e,r.callback=n,r.player=void 0,r.type=void 0,r.cover="",r.log=void 0,r.phaseState=void 0,r.$el=void 0,r.mediaType=void 0,r.log=new ja,r.$el=document.createElement("video"),r.$el.id="video-player",r.$el.className="video-js video-layout",r.player=Object(wa.default)(r.$el,{preload:"auto",controls:!1,autoplay:!1,loop:!1,html5:{hls:{overrideNative:!0}}}),r.type=r.url.split(".").pop()||"mp4";return r.mediaType={m3u8:"application/x-mpegURL",mp4:"video/mp4"}[r.type]||"video/mp4",r.url||console.error("URL: invalid ".concat(r.url)),r.phaseState="init",r.on("phaseChanged",(function(e){n.onPhaseChanged(e)})),r}return Object(w.a)(a,[{key:"initVideo",value:function(e){var t=this;if(!e)throw"DOMException: domId shouldn't empty";var a=document.getElementById(e);if(!a)throw"DOMException: couldn't find ".concat(e," element");a.appendChild(this.$el),this.player.src({src:this.url,type:this.mediaType}),this.player.on("loadeddata",(function(e){t.emit("phaseChanged",t.phaseState="ready")})),this.player.on("loadstart",(function(e){t.emit("phaseChanged",t.phaseState="loading")})),this.player.on("waiting",(function(e){t.emit("phaseChanged",t.phaseState="waiting")})),this.player.on("ended",(function(e){t.emit("phaseChanged",t.phaseState="ended")})),this.player.on("error",(function(e){console.error("error",t.phaseState)})),this.player.load()}},{key:"play",value:function(){!this.isPlaying&&this.player.paused()&&this.player.play()}},{key:"pause",value:function(){this.isPlaying&&!this.player.paused()&&this.player.pause()}},{key:"seekTo",value:function(e){var t=this.player.duration();this.player.ended()&&0!==e||this.player.currentTime(Math.min(e,t))}},{key:"destroy",value:function(){this.player.dispose()}},{key:"isPlaying",get:function(){return this.player.duration()>0&&!this.player.paused()&&!this.player.ended()&&this.player.readyState()>2}}]),a}(de.EventEmitter),Na=r.a.createContext({});window.replayStore=fa;var xa=function(){var e=ma(fa),t=Object(s.f)(),a=Object(s.g)().recordId,n=new URLSearchParams(t.search),o=n.get("roomId"),c=n.get("token"),i=e,u=i.courseRecordData;return Object(Oa.a)((function(){fa.getCourseRecordBy(a,o,c)}),5e3),r.a.createElement(Na.Provider,{value:i},2!==(null===u||void 0===u?void 0:u.status)?r.a.createElement(la,{title:W("replay.".concat((null===u||void 0===u?void 0:u.statusText)?null===u||void 0===u?void 0:u.statusText:"loading"))}):r.a.createElement(Ia,{whiteboardUUID:null===u||void 0===u?void 0:u.boardId,startTime:null===u||void 0===u?void 0:u.startTime,endTime:null===u||void 0===u?void 0:u.endTime,mediaUrl:null===u||void 0===u?void 0:u.url}))},Ia=function(e){var t=e.startTime,a=e.endTime,o=e.mediaUrl,c=e.channelName,s=e.senderId,i=e.whiteboardUUID,u=r.a.useContext(Na);Object(n.useEffect)((function(){var e=+t,n=+a,r=Math.abs(n-e);(function(){var t=Object(ie.a)(se.a.mark((function t(){var a,c,s,u,l;return se.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=new Ra(o,{onPhaseChanged:function(e){console.log("[agore-replay phase] video phase ",e),"ready"===e&&fa.updatePlayState("ready"),"playing"!==e&&console.log("[agore-replay phase] timeline stop in video phase ")}}),window.videoPlayer=a,fa.addVideoPlayer(a),(c=new Pa(30,(function(e){fa.state&&fa.state.phase&&"playing"===fa.state.phase&&(fa.setCurrentTime(e.duration),fa.updateProgress(e.progress))}),e,n)).on("seek-changed",(function(e){fa.state&&fa.state.videoPlayer&&fa.state.player&&e/1e3<fa.state.videoPlayer.player.duration()&&(fa.state.videoPlayer.seekTo(e/1e3),fa.state.player.seekToScheduleTime(e))})),c.on("state-changed",function(){var e=Object(ie.a)(se.a.mark((function e(t){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("state-changed","state",t,fa.state),fa.state&&fa.state.videoPlayer&&fa.state.player&&("started"===t?(fa.state.videoPlayer.play(),fa.state.player.play(),fa.updatePlayState("playing")):"ended"===t?(fa.state.videoPlayer.pause(),fa.state.player.pause(),fa.updatePlayState("ended")):(fa.state.videoPlayer.pause(),fa.state.player.pause(),console.log("[agore-replay phase] timeline ",t,"replayStore.is not empty?: ",null!==fa.state),fa.updatePlayState("paused")));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),fa.addTimeline(c),!i){t.next=17;break}return t.next=10,fa.joinRoom(i);case 10:return s=t.sent,u=s.roomToken,t.next=14,tt(Rt.client,{beginTimestamp:e,duration:r,room:i,roomToken:u},{onCatchErrorWhenRender:function(e){e&&console.warn(e),I.showToast({message:W("toast.replay_failed"),type:"notice"})},onCatchErrorWhenAppendFrame:function(e){e&&console.warn(e),I.showToast({message:W("toast.replay_failed"),type:"notice"})},onPhaseChanged:function(e){console.log("[agore-replay phase] whiteboard ",e);var t="ready";if(e===St.PlayerPhase.Playing)t="playing";else if(e===St.PlayerPhase.Pause||e===St.PlayerPhase.Ended||e===St.PlayerPhase.WaitingFirstFrame){var a;t="paused",null===(a=fa.state)||void 0===a||a.timelineScheduler.stop()}else t="waiting",console.log("[agore-replay phase] whiteboard phase transmit",e,t);console.log("[agore-replay phase] whiteboard phase transmit 2",e,t),fa.updatePlayState(t)},onStoppedWithError:function(e){e&&console.warn(e),I.showToast({message:W("toast.replay_failed"),type:"notice"})}});case 14:l=t.sent,fa.addWhiteboardPlayer(l),console.log("[agore-replay phase] join whiteboard");case 17:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[]);var l=Object(n.useRef)(null),d=Object(n.useRef)(null),m=function(){u.player&&u.player.refreshViewSize()};Object(n.useEffect)((function(){if(l.current&&u.videoPlayer)return u.videoPlayer.initVideo(l.current.id),function(){u.videoPlayer.destroy()}}),[u.videoPlayer,l]),Object(n.useEffect)((function(){if(d.current&&u.player)return console.log("bind",u.player),u.player.bindHtmlElement(d.current),window.addEventListener("resize",m),function(){window.removeEventListener("resize",m)}}),[u.player,d]);var h=function(){if(fa.state&&u.videoPlayer&&u.timelineScheduler)if("paused"!==fa.state.phase&&"ready"!==fa.state.phase){if("started"!==fa.state.phase&&"playing"!==fa.state.phase)return"ended"===fa.state.phase?(u.timelineScheduler.seekTo(0),void u.timelineScheduler.start()):void 0;u.timelineScheduler.stop()}else u.timelineScheduler.start()},p=Object(n.useMemo)((function(){return t&&a?Math.abs(+t-+a):0}),[t,a]),f=Object(n.useMemo)((function(){return Ft()(p).format("mm:ss")}),[p]),v=Object(n.useMemo)((function(){return Ft()(u.currentTime).format("mm:ss")}),[u.currentTime]),_=u.phase,b=Object(n.useCallback)((function(){return document.title=_,u.videoPlayer&&u.player&&"waiting"!==_&&"loading"!==_?"playing"===_?null:r.a.createElement("div",{className:"player-cover"},"playing"!==_?r.a.createElement("div",{className:"play-btn",onClick:h}):null):r.a.createElement(la,{title:W("replay.loading")})}),[u.videoPlayer,u.player,u.phase]),g=function(){u.timelineScheduler&&(console.log("seek to replay. down"),u.timelineScheduler.stop(),fa.updatePlayState("paused"))},O=function(){u.timelineScheduler&&(console.log("seek to replay. up"),u.timelineScheduler.seekTo(u.currentTime),u.timelineScheduler.start())};return r.a.createElement("div",{className:"replay"},r.a.createElement("div",{className:"player-container"},r.a.createElement(b,null),r.a.createElement("div",{className:"player"},r.a.createElement("div",{className:"agora-logo"}),r.a.createElement("div",{ref:d,id:"whiteboard",className:"whiteboard"}),r.a.createElement("div",{className:"video-menu"},r.a.createElement("div",{className:"control-btn"},r.a.createElement("div",{className:"btn ".concat("playing"===_?"paused":"play"),onClick:h})),r.a.createElement("div",{className:"progress"},r.a.createElement(vt.a,{className:"custom-video-progress",value:u.currentTime,onMouseDown:g,onMouseUp:O,onTouchStart:g,onTouchEnd:O,onChange:function(e,t){fa.setCurrentTime(t),fa.updateProgress(t)},min:0,max:p,"aria-labelledby":"continuous-slider"}),r.a.createElement("div",{className:"time"},r.a.createElement("div",{className:"current_duration"},v),"/",r.a.createElement("div",{className:"video_duration"},f)))))),r.a.createElement("div",{className:"video-container"},r.a.createElement("div",{className:"video-player"},r.a.createElement("div",{ref:l,id:"player",style:{width:"100%",height:"100%",objectFit:"cover"}})),r.a.createElement("div",{className:"chat-holder chat-board chat-messages-container"},r.a.createElement(ga,{senderId:s,channelName:c,startTime:t,endTime:a,currentSeekTime:u.currentTime,onPhaseChanged:function(e){var t;e!==ha.load&&(null===(t=u.timelineScheduler)||void 0===t||t.stop())}}))))};a(381);function Da(){var e=Ut(),t=e.me,a=e.course,r=Object(n.useMemo)((function(){if(a.teacherId&&t.uid){var n=He.state.users.get("".concat(a.teacherId));if(n){if(+t.uid===+a.teacherId)return Object(f.a)(Object(f.a)({},e.rtc.localStream),{},{account:n.account,video:n.video,audio:n.audio,local:!0});var r=e.rtc.users.get(+a.teacherId);if(!r)return null;var o=e.rtc.remoteStreams.get("".concat(r));return o?Object(f.a)(Object(f.a)({},o),{},{account:n.account,video:n.video,audio:n.audio}):{streamID:r,account:n.account,video:n.video,audio:n.audio}}}}),[JSON.stringify([a.teacherId,t.uid]),e.users,e.rtc.users,e.rtc.remoteStreams,e.rtc.localStream]),o=Object(n.useMemo)((function(){var t=e.users.get("".concat(a.teacherId)),n="";return t&&(n=t.screenId),n}),[a.teacherId,e.users]);return{teacher:r,students:Object(n.useMemo)((function(){var n=He.state.users;if(!t.uid||0===n.count())return[];var r=a.teacherId,c=e.rtc.users.filter((function(e){return e!==+r&&e!==+t.uid&&e!==+o})),s=[],i=n.get("".concat(t.uid));if(2===+t.role&&i&&e.rtc.localStream){var u=Object(f.a)(Object(f.a)({},e.rtc.localStream),{},{account:i.account,video:i.video,audio:i.audio,local:!0});s.push(u)}var l,d=Object(ue.a)(c);try{for(d.s();!(l=d.n()).done;){var m=l.value,h=n.get("".concat(m)),p=e.rtc.remoteStreams.get("".concat(m));if(h){var v={streamID:m,account:h.account,video:h.video,audio:h.audio};p&&(v=Object(f.a)(Object(f.a)({},p),{},{streamID:m,account:h.account,video:h.video,audio:h.audio})),s.push(v)}}}catch(_){d.e(_)}finally{d.f()}return s}),[JSON.stringify([a.teacherId,o,t.uid]),e.users,e.rtc.users,e.rtc.remoteStreams,e.rtc.localStream]),sharedStream:Object(n.useMemo)((function(){if(e.rtc.localSharedStream)return Object(f.a)(Object(f.a)({},e.rtc.localSharedStream),{},{video:1,audio:1,local:!0});var t=e.rtc.remoteStreams.get("".concat(o));return t?Object(f.a)(Object(f.a)({},t),{},{video:1,audio:1}):null}),[o,e.rtc.remoteStreams,e.rtc.localSharedStream]),currentHost:Object(n.useMemo)((function(){if(!a.coVideoUids||Object(S.isEmpty)(a.coVideoUids))return null;var n=""+a.coVideoUids[0],r=e.users.get("".concat(n));if(!r)return null;if("".concat(t.uid)===n){if(e.rtc.localStream)return Object(f.a)(Object(f.a)({},e.rtc.localStream),{},{account:r.account,video:r.video,audio:r.audio,local:!0,streamID:+t.uid})}else{var o=n,c=e.users.get("".concat(o));if(o&&c){var s={account:c.account,video:c.video,audio:c.audio,streamID:+o},i=e.rtc.remoteStreams.get("".concat(o));return i&&(s=Object(f.a)(Object(f.a)({},s),i)),s}}return null}),[a.coVideoUids,t.uid,t.role,e.users,e.rtc.remoteStreams,e.rtc.localStream]),onPlayerClick:function(){var e=Object(ie.a)(se.a.mark((function e(t,a,n){var r,o,c,s,i,u;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("streamID ",a,n),r=He.state.me,He.state.rtm.joined&&r.uid){e.next=4;break}return e.abrupt("return",console.warn("please confirm joined rtm"));case 4:if(o=He.state.users.get("".concat(n))){e.next=7;break}return e.abrupt("return");case 7:if(c=o.uid,s=Boolean(o.video),i=Boolean(o.audio),u=Boolean(o.chat),"video"!==t){e.next=20;break}if(!s){e.next=17;break}return e.next=15,He.mute(c,"video");case 15:e.next=19;break;case 17:return e.next=19,He.unmute(c,"video");case 19:return e.abrupt("return");case 20:if("audio"!==t){e.next=29;break}if(!i){e.next=26;break}return e.next=24,He.mute(c,"audio");case 24:e.next=28;break;case 26:return e.next=28,He.unmute(c,"audio");case 28:return e.abrupt("return");case 29:if("chat"!==t){e.next=38;break}if(!u){e.next=35;break}return e.next=33,He.mute(c,"chat");case 33:e.next=37;break;case 35:return e.next=37,He.unmute(c,"chat");case 37:return e.abrupt("return");case 38:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()}}var Ua=function(){var e=document.querySelector(".video-marquee .agora-video-view");if(e){var t=e.clientWidth,a=document.querySelectorAll(".video-marquee .agora-video-view").length,n=document.querySelector(".video-marquee-mask");if(t&&n)if(n.clientWidth<=t*a)return!0}return!1};var Ma=r.a.memo((function(){var e=Da(),t=e.teacher,a=e.students,o=e.onPlayerClick,c=Object(n.useRef)(null),s=function(e,t){e.scrollLeft+=t*e.childNodes[1].offsetWidth},i=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){i.current=!0}}),[]);var u=Object(n.useState)(!1),l=Object(v.a)(u,2),d=l[0],m=l[1];return Object(n.useLayoutEffect)((function(){a.length&&!i.current&&m(Ua())}),[a]),Object(n.useEffect)((function(){return window.addEventListener("resize",(function(e){!i.current&&m(Ua())})),function(){window.removeEventListener("resize",(function(){}))}}),[]),r.a.createElement("div",{className:"video-marquee-container"},r.a.createElement("div",{className:"main"},t?r.a.createElement(Lt,{role:"teacher",domId:"dom-".concat(t.streamID),id:"".concat(t.streamID),streamID:t.streamID,stream:t.stream,account:t.account,audio:Boolean(t.audio),video:Boolean(t.video),local:Boolean(t.local),handleClick:o,autoplay:!0}):r.a.createElement(Lt,{role:"teacher",account:"teacher",video:!0,audio:!0,streamID:0})),r.a.createElement("div",{className:"video-marquee-mask"},r.a.createElement("div",{className:"video-marquee",ref:c},d?r.a.createElement("div",{className:"scroll-btn-group"},r.a.createElement("div",{className:"icon icon-left",onClick:function(e){s(c.current,1)}}),r.a.createElement("div",{className:"icon icon-right",onClick:function(e){s(c.current,-1)}})):null,a.map((function(e,t){return r.a.createElement(Lt,{role:"student",domId:"dom-".concat(e.streamID),key:"".concat(t).concat(e.streamID),id:"".concat(e.streamID),account:e.account,streamID:e.streamID,stream:e.stream,video:e.video,audio:e.audio,local:e.local,handleClick:o,autoplay:!0})})))))})),La=(a(382),a(271));function Ba(e){var t=e.room,a=e.className,o=e.loading,c=Object(n.useRef)(null),s=Object(n.useRef)(null);return Object(n.useEffect)((function(){if(t&&Rt.state.room&&c.current)return t.bindHtmlElement(c.current),s.current=new La.a((function(e,t){!Rt.disconnected&&null!==Rt.state.room&&Rt.state.room.isWritable&&(Rt.state.room.moveCamera({centerX:0,centerY:0}),Rt.state.room.refreshViewSize())})),s.current&&s.current.observe(c.current),Rt.updateRoomState(),function(){Rt.state.room&&Rt.state.room.bindHtmlElement(null)}}),[t,c]),r.a.createElement("div",{className:"whiteboard"},o||!t?r.a.createElement(la,{title:W("whiteboard.loading")}):null,r.a.createElement("div",{ref:c,id:"whiteboard",className:"whiteboard-canvas ".concat(a)}))}var Wa=function(e){var t=function(t){e.onClick(t,e.name)};return e.text?r.a.createElement("div",{className:"control-btn control-".concat(e.name," ").concat(e.loading?"icon-loading":""),onClick:t},r.a.createElement("div",{className:"btn-icon ".concat(e.name," ").concat(e.active?"active":""),"data-name":e.name}),r.a.createElement("div",{className:"control-text"},e.text)):r.a.createElement(K,{loading:e.loading,data:e.name,onClick:t,className:"items ".concat(e.name," ").concat(e.active?"active":"")})};function Ya(e){var t=e.sharing,a=e.isHost,o=e.current,c=e.currentPage,s=e.totalPage,i=e.onClick,u=e.role,l=e.notice,d=Ut(),m=Object(n.useRef)(!1),h=function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n,r;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=He.state,r=n.me,!m.current&&r.uid){e.next=5;break}return e.abrupt("return");case 5:if(!n.course.isRecording){e.next=13;break}if(!(+Ft()(Rt.state.startTime).add(15,"seconds")>=+Date.now())||(I.showToast({type:"netlessClient",message:W("toast.recording_too_short")}),0)){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,He.stopRecording();case 10:I.showToast({type:"recording",message:W("toast.stop_recording")}),e.next=16;break;case 13:return e.next=15,He.startRecording();case 15:I.showToast({type:"recording",message:W("toast.start_recording")});case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),e.t0.recordingErr&&I.showToast({type:"recordingErr",message:W("toast.recording_failed",{reason:e.t0.recordingErr.message})});case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,a){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"controls-container"},r.a.createElement("div",{className:"interactive"},l&&d.users.count()<=1?r.a.createElement(Wa,{name:l.reason,onClick:i,active:l.reason===o}):null),r.a.createElement("div",{className:"controls"},t||1!==u?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{title:W("control_items.first_page"),placement:"top"},r.a.createElement("span",null,r.a.createElement(Wa,{name:"first_page",active:"first_page"===o,onClick:i}))),r.a.createElement(_.a,{title:W("control_items.prev_page"),placement:"top"},r.a.createElement("span",null,r.a.createElement(Wa,{name:"prev_page",active:"prev_page"===o,onClick:i}))),r.a.createElement("div",{className:"current_page"},r.a.createElement("span",null,c,"/",s)),r.a.createElement(_.a,{title:W("control_items.next_page"),placement:"top"},r.a.createElement("span",null,r.a.createElement(Wa,{name:"next_page",active:"next_page"===o,onClick:i}))),r.a.createElement(_.a,{title:W("control_items.last_page"),placement:"top"},r.a.createElement("span",null,r.a.createElement(Wa,{name:"last_page",active:"last_page"===o,onClick:i}))),r.a.createElement("div",{className:"menu-split",style:{marginLeft:"7px",marginRight:"7px"}})),1===+u?r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{title:W(He.state.course.isRecording?"control_items.stop_recording":"control_items.recording"),placement:"top"},r.a.createElement("span",null,r.a.createElement(Wa,{loading:Boolean(He.state.recordLock),name:Boolean(He.state.recordLock)?"icon-loading ":He.state.course.isRecording?"stop_recording":"recording",onClick:function(e,t){h(e,t).then((function(){})).catch(console.warn)},active:!1}))),r.a.createElement(_.a,{title:W(t?"control_items.quit_screen_sharing":"control_items.screen_sharing"),placement:"top"},r.a.createElement("span",null,r.a.createElement(Wa,{name:t?"quit_screen_sharing":"screen_sharing",onClick:function(e){t?He.stopScreenShare().then((function(){console.log("stop screen share")})).catch(console.warn):He.startScreenShare().then((function(){console.log("start screen share")})).catch(console.warn)},active:!1,text:t?"stop sharing":""})))):null,2===+u?r.a.createElement(r.a.Fragment,null,r.a.createElement(Wa,{name:a?"hands_up_end":"hands_up",onClick:i,active:!1,text:""})):null))}var Ga=function(e){return r.a.createElement(_.a,{title:W("tool.".concat(e.name)),placement:"right"},r.a.createElement("span",null,r.a.createElement(K,{data:e.name,onClick:function(t){e.onClick(t,e.name)},className:"items ".concat(e.name," ").concat(e.active?"active":"")})))};function Ka(e){return r.a.createElement("div",{className:"menu"},e.items.map((function(t,a){return r.a.createElement(Ga,{key:a,name:t.name,onClick:e.handleToolClick,active:e.currentTool===t.name})})))}var Fa,Va,za=a(267),Za=a(178),Ha=a.n(Za);!function(e){e.dynamic="dynamic",e.static="static",e.init="init"}(Fa||(Fa={})),function(e){e[e.Uploading=0]="Uploading",e[e.Converting=1]="Converting"}(Va||(Va={}));var Ja=function(){function e(t,a,n){var r=this;Object(j.a)(this,e),this.ossClient=void 0,this.room=void 0,this.ossUploadCallback=void 0,this.getFile=function(e){return r.ossClient.generateObjectUrl(e)},this.addFile=function(){var e=Object(ie.a)(se.a.mark((function e(t,a,n){var o;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.ossClient.multipartUpload(t,a,{progress:function(e){n&&n(Va.Uploading,e)}});case 2:if(o=e.sent,r.ossUploadCallback&&r.ossUploadCallback(o),200!==o.res.status){e.next=8;break}return e.abrupt("return",r.getFile(t));case 8:throw new Error("upload to ali oss error, status is ".concat(o.res.status));case 9:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),this.ossClient=t,this.room=a,this.ossUploadCallback=n}return Object(w.a)(e,[{key:"convertFile",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a,n,r,o,c){var s,i,u,l,d,m,h,p,f;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=ke(t),i=s.fileType,u="/".concat(r,"/").concat(o).concat(i),e.next=4,this.addFile(u,t,c);case 4:if(l=e.sent,n!==St.PptKind.Static){e.next=15;break}return e.next=8,a.convert({url:l,kind:n,onProgressUpdated:function(e){c&&c(Va.Converting,e)}});case 8:d=e.sent,m={active:!0,id:"".concat(Xe()()),pptType:Fa.static,data:d.scenes},h=Ha()("/".concat(o,"/").concat(m.id)),this.room.putScenes("/".concat(h),d.scenes),this.room.setScenePath("/".concat(h,"/").concat(d.scenes[0].name)),e.next=23;break;case 15:return console.log("convert no static ppt"),e.next=18,a.convert({url:l,kind:n,onProgressUpdated:function(e){c&&c(Va.Converting,e)}});case 18:d=e.sent,p={active:!0,id:"".concat(Xe()()),pptType:Fa.dynamic,data:d.scenes},f=Ha()("/".concat(o,"/").concat(p.id)),this.room.putScenes("/".concat(f),d.scenes),this.room.setScenePath("/".concat(f,"/").concat(d.scenes[0].name));case 23:c&&c(Va.Converting,1);case 24:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r,o,c){return e.apply(this,arguments)}}()},{key:"getImageSize",value:function(e){var t={width:window.innerWidth,height:window.innerHeight},a=e.width/e.height;return e.width>960&&t.width>960||e.height>960&&t.height>960?a>1?{width:960,height:960/a}:{width:960*a,height:960}:e.width>t.width||e.height>t.height?a>1?{width:t.width,height:t.width/a}:{width:t.height*a,height:t.height}:{width:e.width,height:e.height}}},{key:"uploadImageFiles",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a,n,r){var o,c,s=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.map((function(e){return s.fetchWhiteImageFileWith(e,a,n)})),e.next=3,Promise.all(o);case 3:return c=e.sent,e.next=6,this.uploadImageFilesArray(c,r);case 6:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"fetchWhiteImageFileWith",value:function(e,t,a){var n=this;return new Promise((function(r){var o=new Image,c=new FileReader;c.readAsDataURL(e),c.onload=function(){o.src=c.result,o.onload=Object(ie.a)(se.a.mark((function c(){var s,i;return se.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:s=n.getImageSize(o),i={width:s.width,height:s.height,file:e,coordinateX:t,coordinateY:a},r(i);case 3:case"end":return c.stop()}}),c)})))}}))}},{key:"uploadImageFilesArray",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n,r,o,c,s,i,u,l,d,m=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length>0)){e.next=7;break}n=t.map((function(e){return{uuid:Xe()(),imageFile:e}})),r=Object(ue.a)(n);try{for(r.s();!(o=r.n()).done;)c=o.value,s=c.uuid,i=c.imageFile,u=this.room.convertToPointInWorld({x:i.coordinateX,y:i.coordinateY}),l=u.x,d=u.y,this.room.insertImage({uuid:s,centerX:l,centerY:d,width:i.width,height:i.height})}catch(h){r.e(h)}finally{r.f()}return e.next=6,Promise.all(n.map((function(e){return m.handleUploadTask(e,a)})));case 6:this.room.isWritable&&this.room.setMemberState({currentApplianceName:"selector"});case 7:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"handleUploadTask",value:function(){var e=Object(ie.a)(se.a.mark((function e(t,a){var n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.addFile("".concat(t.uuid).concat(t.imageFile.file.name),t.imageFile.file,a);case 2:n=e.sent,this.room.isWritable&&this.room.completeImageUpload(t.uuid,n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()}]),e}(),qa=function(e){var t=e.room,a=e.uuid,o=e.roomToken,c=e.onProgress,s=e.onFailure,i=e.onSuccess,u=e.didUpload,l=Object(n.useRef)(null),d=Object(n.useRef)(null),m=Object(n.useRef)(null),h=Object(n.useRef)(null),p=function(){var e=Object(ie.a)(se.a.mark((function e(n){var r,l,m;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u(),!(r=n.currentTarget.files[0])){e.next=9;break}return l=new Ja(Oe,t),m=Rt.client.pptConverter(o),e.next=8,l.convertFile(r,m,St.PptKind.Dynamic,ge.folder,a,c);case 8:i&&i();case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),s&&s(e.t0),console.warn(e.t0);case 15:return e.prev=15,d.current&&(d.current.value=""),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,11,15,18]])})));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=Object(ie.a)(se.a.mark((function e(n){var r,l,d;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u(),!(r=n.currentTarget.files[0])){e.next=9;break}return l=new Ja(Oe,t),d=Rt.client.pptConverter(o),e.next=8,l.convertFile(r,d,St.PptKind.Static,ge.folder,a,c);case 8:i&&i();case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),s&&s(e.t0),console.warn(e.t0);case 15:return e.prev=15,m.current&&(m.current.value=""),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,11,15,18]])})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(ie.a)(se.a.mark((function e(a){var n,r,o,d,m,h,p,f;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u(),!(n=a.currentTarget.files[0])){e.next=19;break}if((r=[]).push(n),o=new Ja(Oe,t),!(d=document.getElementById("whiteboard"))){e.next=14;break}return m=d.clientWidth,h=d.clientHeight,e.next=12,o.uploadImageFiles(r,m/2,h/2,c);case 12:e.next=18;break;case 14:return p=window.innerWidth,f=window.innerHeight,e.next=18,o.uploadImageFiles(r,p/2,f/2,c);case 18:i&&i();case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(0),s&&s(e.t0),console.warn(e.t0);case 25:return e.prev=25,l.current&&(l.current.value=""),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[0,21,25,28]])})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=Object(ie.a)(se.a.mark((function e(a){var n,r,o,l,d,m,p,f,v,_,b,g,O;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u(),n=new Ja(Oe,t),!(r=a.currentTarget.files[0])){e.next=23;break}return e.prev=4,o=ke(r),l=o.fileName,d=o.fileType,m="/".concat(ge.folder),p=Xe()(),e.next=10,n.addFile("".concat(m,"/video-").concat(l).concat(p),r,c);case 10:f=e.sent,v=-1!==f.indexOf("https"),_=v?f:f.replace("http","https"),b=d.split(".")[1],_&&Rt.state.room&&("mp4"===b.toLowerCase()&&(g=Rt.state.room.insertPlugin("video",{originX:0,originY:0,width:480,height:270,attributes:{pluginVideoUrl:_}}),console.log("[upload-btn] video resource after insert plugin, res: ",g)),"mp3"===b.toLowerCase()&&(O=Rt.state.room.insertPlugin("audio",{originX:0,originY:0,width:480,height:86,attributes:{pluginAudioUrl:_}}),console.log("[upload-btn] audio resource after insert plugin, res: ",O)),i&&i()),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),s&&s(e.t0);case 20:return e.prev=20,h.current&&(h.current.value=""),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[4,17,20,23]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"upload-btn"},r.a.createElement("div",{className:"upload-items"},r.a.createElement("label",{htmlFor:"upload-image"},r.a.createElement("div",{className:"upload-image-resource"}),r.a.createElement("div",{className:"text-container"},r.a.createElement("div",{className:"title"},W("upload_picture")),r.a.createElement("div",{className:"description"},"bmp, jpg, png, gif"))),r.a.createElement("input",{ref:l,id:"upload-image",accept:"image/*,.bmp,.jpg,.png,.gif",onChange:v,type:"file"})),r.a.createElement("div",{className:"slice-dash"}),r.a.createElement("div",{className:"upload-items"},r.a.createElement("label",{htmlFor:"upload-dynamic"},r.a.createElement("div",{className:"upload-dynamic-resource"}),r.a.createElement("div",{className:"text-container"},r.a.createElement("div",{className:"title"},W("convert_webpage")),r.a.createElement("div",{className:"description"},"pptx"))),r.a.createElement("input",{ref:d,id:"upload-dynamic",accept:".pptx",onChange:p,type:"file"})),r.a.createElement("div",{className:"slice-dash"}),r.a.createElement("div",{className:"upload-items"},r.a.createElement("label",{htmlFor:"upload-static"},r.a.createElement("div",{className:"upload-static-resource"}),r.a.createElement("div",{className:"text-container"},r.a.createElement("div",{className:"title"},W("convert_to_picture")),r.a.createElement("div",{className:"description"},"pptx, word, pdf support"))),r.a.createElement("input",{ref:m,id:"upload-static",accept:".doc,.docx,.ppt,.pptx,.pdf",onChange:f,type:"file"})),r.a.createElement("div",{className:"slice-dash"}),r.a.createElement("div",{className:"upload-items"},r.a.createElement("label",{htmlFor:"upload-video"},r.a.createElement("div",{className:"upload-static-resource"}),r.a.createElement("div",{className:"text-container"},r.a.createElement("div",{className:"title"},W("upload_audio_video")),r.a.createElement("div",{className:"description"},"mp4,mp3"))),r.a.createElement("input",{ref:h,id:"upload-video",accept:".mp4,.mp3",onChange:_,type:"file"})))},Xa=a(623),Qa=function(e){var t=Object(n.useState)(e.name),a=Object(v.a)(t,2),o=a[0],c=a[1],s=Object(n.useRef)(!1),i=Object(Xa.a)((function(){if(s.current&&o&&Rt.state.room){var t=Rt.state.room.state.globalState,a=t.sceneMap;if(a){var n,r=new Blob([JSON.stringify(t)]),c=Object.keys(t).length,i=Object.keys(a).length;if(c<=30&&i<=30&&r.size<=5e4)null===(n=Rt.state.room)||void 0===n||n.setGlobalState({sceneMap:Object(f.a)(Object(f.a)({},a),{},Object(re.a)({},"".concat(e.item.path),"".concat(o)))});else I.showToast({type:"whiteboard",message:W("whiteboard.global_state_limit")})}else{var u;null===(u=Rt.state.room)||void 0===u||u.setGlobalState({sceneMap:Object(re.a)({},"".concat(e.item.path),"".concat(o))})}}}),800,[o]),u=Object(v.a)(i,2)[1];Object(n.useEffect)((function(){return s.current=!0,function(){s.current=!1,u()}}),[u]);var l=-1!==["/","/init"].indexOf(e.item.path);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"item ".concat(e.activeClass," relative")},r.a.createElement(_.a,{title:W(l?"control_items.delete_all":"control_items.delete_current"),placement:"bottom"},r.a.createElement("span",null,r.a.createElement(K,{className:"icon-delete",onClick:function(){var t=Rt.state.room;if(t){t.removeScenes(e.item.path);var a=t.state.globalState.sceneMap,n=Object(S.omit)(a,["".concat(e.item.path)]);l?t.setGlobalState({sceneMap:""}):t.setGlobalState({sceneMap:n})}}}))),r.a.createElement("div",{className:"cover-item ".concat(e.coverType),onClick:function(){e.handleClick(e.item.rootPath)}}),r.a.createElement("span",null,r.a.createElement(V.a,{className:"title",onChange:function(e){c(e.target.value)},defaultValue:e.name}))))},$a=function(e){var t=e.onClose,a=e.items,n=e.activeScenePath,o=e.onClick;return r.a.createElement("div",{className:"resource-menu-container"},r.a.createElement("div",{className:"menu-header"},r.a.createElement("div",{className:"menu-title"},W("doc_center")),r.a.createElement("div",{className:"menu-close",onClick:t})),r.a.createElement("div",{className:"menu-body"},r.a.createElement("div",{className:"menu-items"},a.map((function(e,t){return r.a.createElement(Qa,{activeClass:n===e.path?"active":"",coverType:e.file.type.match(/ppt/)?"ppt-cover":"doc-cover",item:e,name:e.file.name,key:t+e.path+e.file.name,handleClick:o})})))))},en=function(e){Object(Ct.a)(a,e);var t=Object(jt.a)(a);function a(e){var n;return Object(j.a)(this,a),(n=t.call(this,e)).tempRuleIndex=void 0,n.syncRuleIndexTimer=null,n}return Object(w.a)(a,[{key:"delaySyncRuleIndex",value:function(){var e=this;null!==this.syncRuleIndexTimer&&(clearTimeout(this.syncRuleIndexTimer),this.syncRuleIndexTimer=null),this.syncRuleIndexTimer=setTimeout((function(){e.syncRuleIndexTimer=null,e.tempRuleIndex=void 0}),a.syncDuration)}},{key:"moveTo100",value:function(){this.tempRuleIndex=a.readRuleIndexByScale(1),this.delaySyncRuleIndex(),this.props.zoomChange(1)}},{key:"moveRuleIndex",value:function(e){void 0===this.tempRuleIndex&&(this.tempRuleIndex=a.readRuleIndexByScale(this.props.zoomScale)),this.tempRuleIndex+=e,this.tempRuleIndex>a.dividingRule.length-1?this.tempRuleIndex=a.dividingRule.length-1:this.tempRuleIndex<0&&(this.tempRuleIndex=0);var t=a.dividingRule[this.tempRuleIndex];this.delaySyncRuleIndex(),this.props.zoomChange(t)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"zoom-controls"},r.a.createElement(_.a,{title:W("zoom_control.folder"),placement:"top"},r.a.createElement("div",{className:"zoom-icon",onClick:function(){return e.props.onClick()}})),r.a.createElement("div",{className:"zoom-hold"}),r.a.createElement("div",{className:"zoom-size"},Math.ceil(100*this.props.zoomScale)," %"),r.a.createElement("div",{className:"zoom-items"},r.a.createElement("div",{className:"item zoom-in",onClick:function(){return e.moveRuleIndex(-1)}},"-"),r.a.createElement("div",{className:"item zoom-out",onClick:function(){return e.moveRuleIndex(1)}},"+")),r.a.createElement(_.a,{title:He.state.course.lockBoard?W("zoom_control.unlock_board"):W("zoom_control.lock_board"),placement:"top"},r.a.createElement("div",{className:"lock-board",onClick:function(){return e.props.onClickBoardLock()}})))}}],[{key:"readRuleIndexByScale",value:function(e){var t=a.dividingRule;if(e<t[0])return 0;for(var n=0;n<t.length;++n){var r=t[n-1],o=t[n],c=t[n+1],s=void 0===r?Number.MIN_SAFE_INTEGER:(r+o)/2,i=void 0===c?Number.MAX_SAFE_INTEGER:(c+o)/2;if(e>=s&&e<=i)return n}return t.length-1}}]),a}(r.a.Component);en.syncDuration=200,en.dividingRule=Object.freeze([.10737418240000011,.13421772800000012,.16777216000000014,.20971520000000016,.26214400000000015,.3276800000000002,.4096000000000002,.5120000000000001,.6400000000000001,.8,1,1.26,1.5876000000000001,2.000376,2.5204737600000002,3.1757969376000004,4.001504141376,5.041895218133761,6.352787974848539,8.00451284830916,10]);a(546);var tn=function(e){var t=e.type,a=e.title;return r.a.createElement("div",{className:"notice-container ".concat(t)},r.a.createElement("span",{className:"icon-".concat(t)}),r.a.createElement("span",{className:"title"},a))},an=(r.a.createContext({}),r.a.memo((function(){var e=Dt().uploadNotice,t=r.a.useRef([]),a=Object(n.useState)([]),o=Object(v.a)(a,2),c=o[0],s=o[1],i=Object(n.useRef)(null);return Object(n.useEffect)((function(){c.length>0&&null===i.current&&(i.current=setTimeout((function(){t.current.shift(),s(Object(Qe.a)(t.current)),i.current=null}),2500))}),[c]),Object(n.useEffect)((function(){e.title&&e.type&&t.current&&(t.current.push(Object(f.a)(Object(f.a)({},e),{},{key:+Date.now()})),s(Object(Qe.a)(t.current)))}),[e]),r.a.createElement("div",{className:"upload-notice"},c.map((function(e,t){return r.a.createElement(tn,{key:"".concat(t).concat(e.key),type:e.type,title:e.title})})))}))),nn=(a(547),r.a.memo((function(e){var t=e.handleClick,a=e.children,o=Object(s.f)(),c=Ut(),i=It().whiteboardState,u=c.me.role,l=i.room,d=c.me,m=c.course,h=c.rtm,p=Object(n.useRef)(!1),f=Object(n.useState)(""),_=Object(v.a)(f,2),b=_[0],g=_[1],O=Da().sharedStream,E=Object(n.useMemo)((function(){return!(!o.pathname.match(/big-class/)||2!==d.role||!d.coVideo)}),[d.role,d.coVideo,o]),y=Object(n.useMemo)((function(){return{totalPage:i.totalPage,currentPage:i.currentPage,type:i.type}}),[i.currentPage,i.totalPage,i.type]),k=Object(n.useMemo)((function(){return y?y.totalPage:0}),[y]),T=Object(n.useMemo)((function(){return y?y.currentPage+1:0}),[y]),C=function(e){if(y&&l){var t=l.state.sceneState.index+1,a=l.state.sceneState.scenePath,n="/".concat((/\/([^/]*)\//g.exec(a),"aria"===RegExp.$1?"":RegExp.$1));l.isWritable&&(l.putScenes(n,[{}],t),l.setSceneIndex(t)),Rt.updateRoomState()}},j=function(e,t){if(!p.current&&y&&l&&l.isWritable){var a=e-1;if(!(a<0||a>=y.totalPage)){if(t)return l.setSceneIndex(a),void Rt.updateRoomState();"dynamic"===y.type?a>y.currentPage?(l.pptNextStep(),console.log("room.pptNextStep")):(l.pptPreviousStep(),console.log("room.pptPreviousStep")):(l.setSceneIndex(a),console.log("room.setSceneIndex",a)),Rt.updateRoomState()}}},w=Object(n.useMemo)((function(){return 1===+d.role||!(!o.pathname.match(/big-class/)||2!==+d.role)}),[]),A=[{name:"selector"},{name:"pencil"},{name:"rectangle"},{name:"ellipse"},{name:"text"},{name:"eraser"},{name:"color_picker"},{name:"add"},{name:"upload"},{name:"hand_tool"}],S=Object(n.useMemo)((function(){return A.filter((function(e){return 1===+u?e:-1===["add","folder","upload"].indexOf(e.name)?"hand_tool"===e.name?!m.lockBoard:e:void 0}))}),[m.lockBoard]),P=Object(n.useMemo)((function(){if(o.pathname.match("small-class|big-class")){if(1===+d.role)return"drawable";if(2===+d.role)return Boolean(d.grantBoard)?"drawable":"panel"}return"drawable"}),[d.role,d.grantBoard,o]),R=Object(n.useState)("drawable"===P?"pencil":""),N=Object(v.a)(R,2),x=N[0],D=N[1],U=Object(n.useState)(""),M=Object(v.a)(U,2),L=M[0],B=M[1],Y=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){Y.current=!0,Rt.destroy().then((function(){console.log("destroy whiteboard")})).catch(console.warn)}}),[]),Object(n.useEffect)((function(){h.joined&&(Y.current||Rt.state.room||(Y.current=!0,Rt.join({rid:He.state.course.rid,uuid:m.boardId,roomToken:m.boardToken,location:o.pathname,userPayload:{userId:He.state.me.uid,identity:1===+He.state.me.role?"host":"guest"}}).then((function(){console.log("join whiteboard success")})).catch((function(e){console.warn(e)})).finally((function(){Y.current=!1}))))}),[JSON.stringify([h.joined,m.boardId,m.boardToken])]);var G=Object(n.useState)(""),K=Object(v.a)(G,2),F=K[0],V=K[1],z=Object(n.useState)(""),Z=Object(v.a)(z,2),H=Z[0],J=Z[1];Object(n.useEffect)((function(){console.log("uploading [mediaboard] uploadPhase: ",F," convertPhase: ",H)}),[F,H]);var q=Object(n.useCallback)((function(){return"upload"===x&&l?r.a.createElement(qa,{room:l,uuid:l.uuid,roomToken:l.roomToken,didUpload:function(){D("")},onProgress:function(e,t){console.log("uploading [onProgress] phase: ",e," percent: ",t,"uploadPhase: ",F,"convertPhase: ",H),e!==Va.Uploading?e!==Va.Converting||(t<1?"converting"!==H&&J("converting"):J("convert_success")):t<1?"uploading"!==F&&V("uploading"):V("upload_success")},onSuccess:function(){F&&V(""),J&&J(""),console.log("uploading [onSuccess]",F,H)},onFailure:function(e){"uploading"!==F?"converting"!==H||J("convert_failure"):V("upload_failure")}}):null}),[x,l]);Object(n.useEffect)((function(){"upload_success"===F&&I.showUploadNotice({title:W("room.upload_success"),type:"ok"}),"convert_failure"===F&&I.showUploadNotice({title:W("room.upload_failure"),type:"error"})}),[F]),Object(n.useEffect)((function(){"convert_success"===H&&I.showUploadNotice({title:W("room.convert_success"),type:"ok"}),"convert_failure"===H&&I.showUploadNotice({title:W("room.convert_failure"),type:"error"})}),[H]),Object(n.useMemo)((function(){2===+c.me.role&&1===+c.course.lockBoard&&I.showToast({type:"whiteboard",message:W("whiteboard.locked_board")})}),[c.course.lockBoard,c.me.role]),Object(n.useEffect)((function(){d.role&&l&&(1===+d.role&&(He.state.course.lockBoard?l.setViewMode(St.ViewMode.Broadcaster):l.setViewMode(St.ViewMode.Freedom)),2===+d.role&&(He.state.course.lockBoard?(l.handToolActive=!1,l.disableCameraTransform=!0,l.disableDeviceInputs=!0):(l.disableCameraTransform=!1,l.disableDeviceInputs=!1)))}),[l,He.state.course.lockBoard,He.state.me.role]);var X=Dt(),Q=i.scale?i.scale:1,$=Object(n.useCallback)((function(){return"uploading"===F?r.a.createElement(da,{title:W("room.uploading")}):"converting"===H?r.a.createElement(da,{title:W("room.converting")}):null}),[F,H]),ee=void 0;if(i.room&&i.room.state.memberState.strokeColor){var te=i.room.state.memberState.strokeColor;ee={r:te[0],g:te[1],b:te[2]}}var ae="drawable"===P;return r.a.createElement("div",{className:"media-board ".concat(P)},O?r.a.createElement(Lt,{id:"".concat(O.streamID),domId:"shared-".concat(O.streamID),className:"screen-sharing",streamID:O.streamID,stream:O.stream,video:!0,audio:!0,local:O.local}):r.a.createElement(Ba,{loading:i.loading,className:L,room:l}),r.a.createElement("div",{className:"layer"},O?null:r.a.createElement(r.a.Fragment,null,ae?r.a.createElement(Ka,{items:S,currentTool:x,handleToolClick:function(e,t){if(l&&l.isWritable){if(-1!==["upload","color_picker","hand_tool"].indexOf(t)&&t===x)return D(""),void("hand_tool"===t&&(l.handToolActive=!1,B("")));"hand_tool"!==t&&(l.handToolActive=!1,B("")),D(t),"upload"!==t&&"folder"!==t&&"color_picker"!==t&&"add"!==t&&"hand_tool"!==t?l.setMemberState({currentApplianceName:t}):"hand_tool"===t?(l.handToolActive=!0,B("hand"),l.setMemberState({currentApplianceName:"selector"})):"add"===t&&C&&C()}}}):null,"color_picker"===x&&ee?r.a.createElement(za.SketchPicker,{color:ee,onChangeComplete:function(e){if(l&&l.isWritable){var t=e.rgb,a=t.r,n=t.g,r=t.b;l.setMemberState({strokeColor:[a,n,r]})}}}):null),r.a.createElement(q,null),a||null),1===d.role&&l?r.a.createElement(en,{zoomScale:Q,onClick:function(){D("folder")},onClickBoardLock:function(){Rt.lock().then(console.log).catch(console.warn)},zoomChange:function(e){l.moveCamera({scale:e}),Rt.updateScale(e)}}):null,w?r.a.createElement(Ya,{notice:X.notice,role:u,sharing:Boolean(O),current:b,currentPage:T,totalPage:k,isHost:E,onClick:function(e,a){g(a),console.log("[page-tool] click ",a),"first_page"===a&&j(1,!0),"last_page"===a&&j(k,!0),"prev_page"===a&&j(T-1),"next_page"===a&&j(T+1),"peer_hands_up"===a&&(I.showDialog({type:"apply",message:"".concat(I.state.notice.text)}),g("")),t&&t(a)}}):null,"folder"===x&&i.room?r.a.createElement($a,{activeScenePath:i.currentScenePath,items:i.dirs,onClick:function(e){l&&(l.setScenePath(e),l.setSceneIndex(0),Rt.updateRoomState())},onClose:function(e){D("")}}):null,r.a.createElement(an,null),r.a.createElement($,null))})));a(548);var rn=/^\s+/,on=function(e){return e.replace(rn,"")};function cn(e){var t=e.messages,a=e.value,o=e.sendMessage,c=e.handleChange,s=function(){var e=Object(n.useRef)(!1);Object(n.useEffect)((function(){return e.current=!1,function(){e.current=!0}}),[]);var t=He.state.me,a=He.state.course,r=1===t.role,o=Boolean(a.muteChat),c=Boolean(t.chat),s=Object(n.useMemo)((function(){return!(2!==+t.role||!o&&c)}),[o,c,t.role]);return{chat:c,disableChat:s,muteControl:r,muteChat:o,handleMute:function(t){e.current||(e.current=!0,He.updateCourse({muteChat:"mute"===t?1:0}).then((function(){console.log("update success")})).catch(console.warn).finally((function(){e.current=!1})))}}}(),i=s.handleMute,u=s.disableChat,l=s.muteControl,d=s.muteChat,m=Object(n.useRef)(null);Object(n.useEffect)((function(){var e;(e=m.current).scrollTop=e.scrollHeight}),[t]);var h=Ut();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"chat-messages-container"},r.a.createElement("div",{className:"chat-messages",ref:m},t.map((function(e,t){return r.a.createElement(_a,{key:t,nickname:e.account,content:e.text,link:e.link,sender:e.id===h.me.uid})})))),r.a.createElement("div",{className:"message-panel"},l?r.a.createElement("div",{className:"icon ".concat(d?"icon-chat-off":"icon-chat-on"),onClick:function(){i(d?"unmute":"mute")}}):null,r.a.createElement(V.a,{disabled:u,value:a,placeholder:W(u?"chat.banned":"chat.placeholder"),disableUnderline:!0,className:"message-input",onKeyPress:function(){var e=Object(ie.a)(se.a.mark((function e(t){var n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=6;break}if(n=on(a),e.t0=n.length>0,!e.t0){e.next=6;break}return e.next=6,o(n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onChange:c}),r.a.createElement(E,{className:"chat-panel-btn",name:W("chat.send"),onClick:function(){var e=Object(ie.a)(se.a.mark((function e(t){var n;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=on(a),e.t0=n.length>0,!e.t0){e.next=5;break}return e.next=5,o(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})))}a(549);function sn(e){var t=e.value,a=e.icon,n=e.id,o=e.type,c=e.onClick;return r.a.createElement("div",{className:"items"},r.a.createElement(K,{className:"icon-".concat(a,"-").concat(t?"on":"off"),onClick:function(e){c(e,n,o)}}))}function un(e){var t=e.list,a=(e.role,Ut().me),o=Object(n.useRef)(!1),c=function(e,t,n){if(He.state&&a){var r=He.state.users.get("".concat(t));if(r&&!o.current){var c=Boolean(Object(S.get)(r,n));o.current=!0,c?He.mute(r.uid,n).then((function(){})).catch(console.warn).finally((function(){o.current=!1})):He.unmute(r.uid,n).then((function(){})).catch(console.warn).finally((function(){o.current=!1}))}}};return r.a.createElement("div",{className:"student-list"},t.map((function(e,t){return r.a.createElement("div",{key:t,className:"item"},r.a.createElement("div",{className:"nickname"},e.account),r.a.createElement("div",{className:"attrs-group"},r.a.createElement(sn,{type:"grantBoard",id:e.uid,value:Boolean(e.grantBoard),icon:"connect",onClick:c}),r.a.createElement(sn,{type:"chat",id:e.uid,value:Boolean(e.chat),icon:"chat",onClick:c}),r.a.createElement(sn,{type:"audio",id:e.uid,value:Boolean(e.audio),icon:"audio",onClick:c}),r.a.createElement(sn,{type:"video",id:e.uid,value:Boolean(e.video),icon:"video",onClick:c})))})))}function ln(){var e=Object(n.useState)(""),t=Object(v.a)(e,2),a=t[0],r=t[1],o=Ut(),c=o.course.roomName,s=o.me,i=s.role,u=Object(n.useMemo)((function(){return o.messages}),[o.messages]),l=He.rtmClient,d=function(){var e=Object(ie.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l||!s.uid){e.next=10;break}if(1===s.role||s.chat&&!Boolean(o.course.muteChat)){e.next=3;break}return e.abrupt("return",console.warn("chat already muted"));case 3:if(1!==s.role||s.chat){e.next=5;break}return e.abrupt("return",console.warn("chat already muted"));case 5:return e.next=7,He.sendChannelMessage({message:t});case 7:a={account:s.account,id:s.uid,text:t,ts:+Date.now()},He.updateChannelMessage(a),r("");case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{list:Object(n.useMemo)((function(){if(!o.me.uid||!o.rtc.users.count()&&!o.rtc.localStream)return[];var e=o.users.get(o.me.uid),t=[];e&&t.push(e);var a,n=Object(ue.a)(o.rtc.users);try{for(n.s();!(a=n.n()).done;){var r=a.value,c=o.users.get(""+r);c&&t.push(c)}}catch(s){n.e(s)}finally{n.f()}return t.filter((function(e){return 2===+e.role}))}),[o.me.uid,o.rtc.users,o.users,o.rtc.localStream]),role:i,messages:u,sendMessage:d,value:a,handleChange:function(e){r(e.target.value.slice(0,100))},roomName:c}}function dn(e){var t=ln(),a=t.role,o=t.list,c=t.value,s=t.messages,i=t.sendMessage,u=t.handleChange,l=Dt().active,d=Object(n.useState)(!0),m=Object(v.a)(d,2),h=m[0],p=m[1],f="chatroom"!==l?I.state.newMessageCount:0;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"".concat(h?"icon-collapse-off":"icon-collapse-on"," fixed"),onClick:function(e){p(!h)}}),h?r.a.createElement("div",{className:"small-class chat-board"},r.a.createElement("div",{className:"menu"},r.a.createElement("div",{onClick:function(){I.setActive("chatroom")},className:"item ".concat("chatroom"===l?"active":"")},W("room.chat_room"),"chatroom"!==l&&f>0?r.a.createElement("span",{className:"message-count ".concat(I.state.language)},f):null),r.a.createElement("div",{onClick:function(){I.setActive("studentList")},className:"item ".concat("studentList"===l?"active":"")},W("room.student_list"))),r.a.createElement("div",{className:"chat-container ".concat("chatroom"===l?"":"hide")},r.a.createElement(cn,{messages:s,value:c,sendMessage:i,handleChange:u})),r.a.createElement("div",{className:"student-container ".concat("chatroom"!==l?"":"hide")},r.a.createElement(un,{role:a,list:o}))):null)}a(550);function mn(){return r.a.createElement("div",{className:"room-container"},r.a.createElement(Ma,null),r.a.createElement("div",{className:"container"},r.a.createElement(nn,null),r.a.createElement(dn,{currentActive:"media"})))}function hn(e){return r.a.createElement("div",{className:"chat-board"},e.name?r.a.createElement("div",{className:"chat-roomname"},e.name,e.roomCount?"(".concat(e.roomCount,")"):null):null,r.a.createElement(cn,{messages:e.messages,value:e.value,sendMessage:e.sendMessage,handleChange:e.handleChange}))}function pn(){var e=ln(),t=e.value,a=e.messages,n=e.sendMessage,o=e.handleChange,c=Da(),s=c.teacher,i=c.students,u=c.onPlayerClick;return r.a.createElement("div",{className:"room-container"},r.a.createElement(nn,null),r.a.createElement("div",{className:"live-board"},r.a.createElement("div",{className:"video-board"},s?r.a.createElement(Lt,{role:"teacher",streamID:s.streamID,stream:s.stream,domId:"".concat(s.streamID),id:"".concat(s.streamID),account:s.account,handleClick:u,video:s.video,audio:s.audio,local:s.local,autoplay:!0}):r.a.createElement(Lt,{role:"teacher",account:"teacher",domId:"teacher",streamID:0,video:!0,audio:!0}),i[0]?r.a.createElement(Lt,{role:"student",streamID:i[0].streamID,stream:i[0].stream,domId:"".concat(i[0].streamID),id:"".concat(i[0].streamID),handleClick:u,account:i[0].account,video:i[0].video,audio:i[0].audio,local:i[0].local,autoplay:!0}):r.a.createElement(Lt,{role:"student",account:"student",domId:"student",streamID:0,video:!1,audio:!1})),r.a.createElement(hn,{messages:a,value:t,sendMessage:n,handleChange:o})))}a(551);function fn(){var e=ln(),t=e.value,a=e.messages,o=e.sendMessage,c=e.handleChange,s=e.role,i=e.roomName,u=Ut(),l=u.me,d=u.course.memberCount,m=Da(),h=m.teacher,p=m.currentHost,f=m.onPlayerClick,v=Object(n.useRef)(!1),_=Object(n.useRef)(!1);Object(n.useEffect)((function(){return v.current=!1,function(){v.current=!0,_.current=!0}}),[]);var b=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){b.current=!0}}),[]);return r.a.createElement("div",{className:"room-container"},r.a.createElement("div",{className:"live-container"},r.a.createElement(nn,{handleClick:function(e){v.current||("hands_up"===e&&He.state.course.teacherId&&ze.studentSendApply(He.state.course.roomId).then((function(e){console.log("hands_up fulfilled",e)})).catch((function(e){console.warn(e)})),"hands_up_end"===e&&(v.current=!0,ze.studentStopCoVideo(He.state.course.roomId).then((function(e){console.log("hands_up_end success",e)})).catch((function(e){console.warn(e)})).finally((function(){v.current=!1}))))}},r.a.createElement("div",{className:"video-container"},p?r.a.createElement(Lt,{role:"teacher",streamID:p.streamID,stream:p.stream,domId:"".concat(p.streamID),id:"".concat(p.streamID),account:p.account,handleClick:f,close:1===l.role||+l.uid===p.streamID,handleClose:function(e,t){if("close"===e){if(!p||b.current)return;var a=He.rtmClient,n=He.rtcClient,r=He.state.course.teacherId;if(console.log("close rtmClient: ",a,", rtcClient: ",n,", teacherUid: ",r,", lock :",b.current),p.streamID===+l.uid&&r){var o=new Promise((function(e,t){e(n.unpublishLocalStream())}));b.current=!0,v.current=!0,Promise.all([ze.studentStopCoVideo(He.state.course.roomId),o]).then((function(){I.showToast({type:"close_youself_co_video",message:W("toast.close_youself_co_video")}),v.current=!1})).catch((function(e){throw v.current=!1,console.warn(e),e})).finally((function(){b.current=!1}))}"".concat(r)&&"".concat(r)==="".concat(l.uid)&&(v.current=!0,b.current=!0,Promise.all([ze.teacherCancelStudent(He.state.course.roomId,He.state.applyUser.userId)]).then((function(){I.showToast({type:"peer_hands_up",message:W("toast.close_co_video")}),He.updateApplyUser({account:"",userId:""}),v.current=!1})).catch((function(e){v.current=!1,console.warn(e)})).finally((function(){b.current=!1})))}},video:p.video,audio:p.audio,local:p.local,autoplay:Boolean(l.coVideo)}):null))),r.a.createElement("div",{className:"live-board"},r.a.createElement("div",{className:"video-board"},h?r.a.createElement(Lt,{role:"teacher",streamID:h.streamID,stream:h.stream,domId:"dom-".concat(h.streamID),id:"".concat(h.streamID),account:h.account,handleClick:f,audio:Boolean(h.audio),video:Boolean(h.video),local:Boolean(h.local),autoplay:Boolean(l.coVideo)}):r.a.createElement(Lt,{role:"teacher",account:"teacher",streamID:0,video:!0,audio:!0})),r.a.createElement(hn,{name:i,teacher:1===s,messages:a,mute:Boolean(u.course.muteChat),value:t,roomCount:d,sendMessage:o,handleChange:c})))}a(552);var vn=function(e){var t=e.children;return r.a.createElement("div",{className:"main-layout-container"},t)},_n=function(){var e=Object(s.e)();return r.a.createElement(vn,null,r.a.createElement("div",{className:"layout-content"},r.a.createElement("h1",null,"404"),r.a.createElement("h2",null,W("error.not_found")),r.a.createElement("a",{style:{cursor:"pointer"},onClick:function(){e.push("/")}},W("return.home"))))};function bn(e){var t=e.children;return r.a.createElement(r.a.Fragment,null,t)}var gn=a(624),On=a(614),En=a(625),yn=a(612),kn=a(615),Tn=a(616),Cn=a(268),jn=a.n(Cn),wn=a(613);function An(){return r.a.createElement(C.a,{variant:"body2",color:"textSecondary",align:"center"},"Copyright \xa9 ",r.a.createElement(yn.a,{color:"inherit",href:"https://material-ui.com/"},"Your Website")," ",(new Date).getFullYear(),".")}var Sn=Object(g.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}}));function Pn(){var e=Sn();return r.a.createElement(wn.a,{component:"main",maxWidth:"xs"},r.a.createElement(On.a,null),r.a.createElement("div",{className:e.paper},r.a.createElement(gn.a,{className:e.avatar},r.a.createElement(jn.a,null)),r.a.createElement(C.a,{component:"h1",variant:"h5"},"Sign in"),r.a.createElement("form",{className:e.form,noValidate:!0},r.a.createElement(En.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"appID",label:"Agora AppID",name:"appID",autoFocus:!0}),r.a.createElement(En.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"Netless SDKToken",label:"Netless SDKToken",id:"sdkToken"}),r.a.createElement(O.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:e.submit},"Send"),r.a.createElement(kn.a,{container:!0},r.a.createElement(kn.a,{item:!0,xs:!0},r.a.createElement(yn.a,{href:"https://github.com/agoraio-usecase/eEducation/issues/new",target:"_blank",variant:"body2"},"Feedback Github issues")),r.a.createElement(kn.a,{item:!0},r.a.createElement(yn.a,{href:"#",variant:"body2"}))))),r.a.createElement(Tn.a,{mt:8},r.a.createElement(An,null)))}var Rn=function(){return r.a.createElement(p,null,r.a.createElement(l,null,r.a.createElement(ne,null,r.a.createElement(Mt,null,r.a.createElement(ia,null),r.a.createElement(ua,null),r.a.createElement($t,null),r.a.createElement(s.a,{exact:!0,path:"/device_test"},r.a.createElement(Gt,null)),r.a.createElement(s.a,{exact:!0,path:"/classroom/one-to-one"},r.a.createElement(ra,null,r.a.createElement(pn,null))),r.a.createElement(s.a,{exact:!0,path:"/classroom/small-class"},r.a.createElement(ra,null,r.a.createElement(mn,null))),r.a.createElement(s.a,{exact:!0,path:"/classroom/big-class"},r.a.createElement(ra,null,r.a.createElement(fn,null))),r.a.createElement(s.a,{path:"/replay/record/:recordId"},r.a.createElement(bn,null,r.a.createElement(ya,null))),r.a.createElement(s.a,{path:"/replay/agora_record/:recordId"},r.a.createElement(bn,null,r.a.createElement(xa,null))),r.a.createElement(s.a,{path:"/config"},r.a.createElement(Pn,null)),r.a.createElement(s.a,{exact:!0,path:"/"},r.a.createElement(ft,null)),r.a.createElement(s.a,{exact:!0,path:"/404"},r.a.createElement(_n,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Nn,xn=a(269),In=a.n(xn),Dn=a(270),Un=a.n(Dn),Mn=(new ut.a).getResult();if(Object({NODE_ENV:"production",PUBLIC_URL:"/agora",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_AGORA_APP_ID:"28ee29aa37f1480b98ea44c6668e56a5",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_EDU_ENDPOINT_PREFIX:"https://api.agora.io/edu",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"OThmNDM5NjQ0NGU1NDE1NDgxZWM2NzgyZjUwYzAzODE6MmRjYjRkZDI5NTAxNGJiZjgxYTZiOWMxYjg1ZGYxMTY=",REACT_APP_AGORA_RTM_ENDPOINT:"your_server_rtm_endpoint_api",REACT_APP_END_POINT:"http://127.0.0.1:8000/",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}).REACT_APP_AGORA_GTM_ID&&In.a.initialize({gtmId:Object({NODE_ENV:"production",PUBLIC_URL:"/agora",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_AGORA_APP_ID:"28ee29aa37f1480b98ea44c6668e56a5",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_EDU_ENDPOINT_PREFIX:"https://api.agora.io/edu",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"OThmNDM5NjQ0NGU1NDE1NDgxZWM2NzgyZjUwYzAzODE6MmRjYjRkZDI5NTAxNGJiZjgxYTZiOWMxYjg1ZGYxMTY=",REACT_APP_AGORA_RTM_ENDPOINT:"your_server_rtm_endpoint_api",REACT_APP_END_POINT:"http://127.0.0.1:8000/",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}).REACT_APP_AGORA_GTM_ID}),c.a.render(r.a.createElement(Rn,null),document.getElementById("root")),null===(Nn=document.getElementById("room_join"))||void 0===Nn||Nn.click(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})),"mobile"===Mn.device.type){var Ln=document.createElement("div");document.body.appendChild(Ln),Un.a.init({container:Ln,tool:["console","elements"]})}}},[[286,1,2]]]);
//# sourceMappingURL=main.53bff558.chunk.js.map