{"version":3,"sources":["utils/LogUploader/log.worker.ts","containers/custom-browser-router.tsx","containers/theme-container.tsx","components/custom-button.tsx","utils/custom-storage.ts","stores/global.ts","i18n/zh.ts","i18n/en.ts","i18n.ts","components/role-radio.tsx","components/icon.tsx","components/form-input.tsx","components/form-select.tsx","components/lang-select.tsx","utils/platform.ts","utils/agora-rtm-client.ts","containers/platform-container.tsx","utils/config.ts","utils/helper.ts","utils/agora-electron-client.ts","utils/agora-rtc-client.ts","utils/agora-web-client.ts","services/intl-error-helper.ts","utils/fetch.ts","stores/history.ts","services/edu-api.ts","stores/room.ts","components/github-icon/index.tsx","utils/api/rtm-restful.ts","utils/api/whiteboard-api.ts","utils/api/index.ts","utils/LogUploader/db.ts","utils/LogUploader/index.ts","pages/home.tsx","components/volume/speaker.tsx","components/volume/voice.tsx","pages/error-page/state.tsx","stores/whiteboard.ts","containers/root-container.tsx","components/video-player.tsx","components/setting-card.tsx","hooks/use-setting-control.tsx","pages/device-test.tsx","utils/types.ts","components/nav.tsx","components/dialog/index.tsx","components/native-shared-window.tsx","pages/classroom/index.tsx","components/loading.tsx","components/toast.tsx","components/progress/progress.tsx","pages/replay/model.ts","components/whiteboard/agora/rtm-player.tsx","components/chat/message.tsx","utils/agora-web-player/logger.ts","pages/replay/replay.tsx","utils/agora-web-player/agora-player.ts","utils/agora-web-player/timeline-scheduler.ts","pages/replay/agora-replay.tsx","hooks/use-streams.ts","components/video-marquee.tsx","components/whiteboard.tsx","components/whiteboard/control.tsx","components/whiteboard/tools.tsx","utils/upload-manager.ts","components/whiteboard/upload/upload-btn.tsx","components/whiteboard/resources-menu/index.tsx","components/whiteboard/scale-controller.tsx","components/whiteboard/upload/upload-notice.tsx","components/mediaboard.tsx","components/chat/panel.tsx","hooks/use-chat-control.ts","components/student-list.tsx","hooks/use-chat-text.ts","components/roomboard.tsx","pages/classroom/small-class.tsx","components/chat/board.tsx","pages/classroom/one-to-one.tsx","pages/classroom/big-class.tsx","pages/404.tsx","pages/replay/index.tsx","pages/config/index.tsx","pages/index.tsx","serviceWorker.js","index.tsx"],"names":["module","exports","Worker","RouterContext","React","createContext","CustomBrowserRouter","children","routeProps","Provider","value","THEME","createMuiTheme","typography","overrides","MuiRadio","root","padding","MuiSvgIcon","width","height","MuiFormControl","margin","MuiInput","underline","borderBottom","ThemeProvider","theme","props","Button","id","variant","className","color","onClick","name","GlobalStorage","storage","languageKey","this","window","sessionStorage","key","JSON","parse","getItem","_","val","setItem","stringify","removeItem","lang","save","language","read","navigator","channelMessages","isEmpty","count","messages","chatMessages","filter","it","message_type","reduce","collect","payload","json","content","concat","account","ms","src","length","roomTypes","text","path","globalStore","subject","state","defaultState","loading","toast","type","message","dialog","confirmText","cancelText","uploadNotice","title","notice","reason","nativeWindowInfo","visible","items","lock","active","newMessageCount","getLanguage","Subject","next","updateState","initialize","subscribe","unsubscribe","rootState","commit","location","reload","len","BUILD_VERSION","process","REACT_APP_BUILD_VERSION","zhCN","en","t","options","match","get","replace","console","error","useStyles","makeStyles","radioGroup","display","clear","justifyContent","required","fontSize","lineHeight","position","top","classes","RadioGroup","row","role","onChange","FormControlLabel","control","Radio","label","labelPlacement","requiredText","Typography","data","icon","disable","iconClass","dataName","data-name","formInput","InputLabel","Label","Input","evt","target","memo","Select","map","item","MenuItem","log","RoomMessage","ChatCmdType","CoVideoType","PlatformContext","usePlatform","useContext","PlatformContainer","platform","useLocation","ipc","useEffect","pathname","send","handleClick","NavBtn","HomeBtn","handleSetting","SettingBtn","APP_ID","REACT_APP_AGORA_APP_TOKEN","logFilter","AgoraRTM","LOG_FILTER_DEBUG","AgoraRTMClient","_bus","_currentChannel","_currentChannelName","_channels","_client","_channelAttrsKey","_logged","_joined","EventEmitter","removeAllListeners","Object","keys","channel","evtName","cb","on","off","appID","uid","token","rtmClient","createInstance","enableLogUpload","login","newState","emit","peerId","logout","destroy","_channel","createChannel","join","memberId","attributes","destroyChannel","deleteChannelAttributesByKey","leave","params","cmd","enableHistoricalMessaging","body","sendMessage","resolveMessage","sendMessageToPeer","result","hasPeerReceived","msgData","recordId","notifyMessage","replay","attrs","channelAttributes","addOrUpdateChannelAttributes","enableNotificationToChannelMembers","deleteChannelAttributesByKeys","getChannelAttributes","ids","getChannelMemberCount","accounts","results","teacherCount","totalCount","studentTotalCount","queryPeersOnlineStatus","teacher","find","studentsTotalCount","warn","channelName","teacherObj","jsonParse","push","student","ossConfig","ossClient","OSS","acceptCoVideo","rejectCoVideo","cancelCoVideo","applyCoVideo","muteVideo","muteAudio","unmuteAudio","unmuteVideo","err","resolveFileInfo","file","fileName","encodeURI","fileType","substring","lastIndexOf","level","NetworkQualityEvaluation","Math","max","downlinkNetworkQuality","uplinkNetworkQuality","StreamType","AgoraRtcEngine","rtcEngine","setChannelProfile","enableVideo","enableAudio","enableWebSdkInteroperability","setVideoProfile","once","events","args","logPath","videoSourceLogPath","videoSourceAddonLogPath","setLogFile","doGzip","AgoraRTC","Logger","setLogLevel","DEBUG","streamEvents","clientEvents","AgoraRTCClient","streamID","_init","_published","_internalTimer","createClient","mode","codec","_localStream","_streamEvents","_clientEvents","_addEventListener","appId","prepareInit","Promise","resolve","reject","init","enableRtt","initClient","subscribeClientEvents","setInterval","getTransportStats","stats","RTT","unsubscribeClientEvents","removeEventListener","newToken","renewToken","publish","setTimeout","unpublish","destroyLocalStream","stream","streamType","setRemoteVideoStreamType","enableDualStream","createStream","mirror","subscribeLocalStreamEvents","audioOutput","deviceId","setAudioOutput","then","catch","unsubscribeLocalStreamEvents","isPlaying","stop","close","speakerId","volume","setAudioVolume","video","audio","clearInterval","getDevices","devices","_devices","forEach","kind","cameraCanUse","microphoneCanUse","tempAudioStream","tempVideoStream","audioPermissionOK","videoPermissionOK","all","microphone","camera","AgoraWebClient","deps","rtc","shareClient","localUid","bus","shared","joined","forceGetDevice","published","tmpStream","roomStore","client","deviceResult","forceGetDevices","cameraList","microphoneList","dual","setRTCJoined","unpublishLocalStream","destroyClient","cameraId","microphoneId","createLocalStream","screen","screenAudio","undefined","errors","leaveChannel","getIntlError","errorCode","res","locale","_getIntlError","Fetch","input","a","onResponse","response","ok","Error","statusText","onError","rescueError","fetch","AgoraFetch","retryCount","code","isErrorCode","showToast","msg","historyStore","history","PREFIX","AgoraFetchJson","url","method","full_url","opts","headers","resp","responseData","api_error","AgoraEduApi","roomId","_userToken","fileExt","_roomId","bucketName","callbackBody","callbackContentType","accessKeyId","accessKeySecret","securityToken","ossKey","ext","fetchStsToken","ossParams","stsToken","bucket","secure","endpoint","put","callback","contentType","uploadToOss","userToken","rtcToken","rtmToken","screenToken","room","user","userId","userAttrs","config","boardData","boardId","boardToken","getWhiteboardBy","users","coVideoUsers","getRoomInfoBy","rawUsers","rawCourse","me","usersMap","acc","set","userName","chat","enableChat","grantBoard","screenId","Map","courseState","muteChat","muteAllChat","isRecording","lockBoard","teacherId","memberCount","onlineUsers","roomName","roomType","recordingTime","Boolean","entry","teacherState","userList","course","rid","userUuid","uuid","coVideoUids","teacherRecord","recordStatus","startTime","endTime","status","userIds","eduApi","fetchI18n","_state","freeze","rtmLock","recordLock","roomToken","coVideo","applyUser","rtm","Set","localStream","localSharedStream","remoteStreams","mediaDevice","speakerVolume","speaker","List","windowId","rtcClient","fetchRoomBy","add","delete","remoteStream","sendChannelMessage","teacherSendReject","studentSendApply","teacherSendAccept","teacherSendStop","applyUserId","updateApplyUser","showNotice","updateLocalMe","broad","updateUserBy","Login","roomUuid","newMe","prop","hasOwnProperty","newCourse","getCourseState","updateCourse","getRoomState","updateRoomState","usersJson","toJSON","meParams","compositeMe","newMeAttrs","userAttrsParams","updateRoomUser","userParams","prevUser","newUserAttrs","userKeys","stateValue","stateKey","unlockBoard","startCourse","endCourse","unmuteAllChat","courseParams","resolveCourseAttrsToOperate","compositeCourse","exitRoom","exit","webClient","refreshToken","startScreenShare","stopWebScreenShare","finally","stopScreenShare","removeLocalSharedStream","setNativeWindowInfo","getScreenShareWindows","startWebScreenShare","nativeClient","lockRecording","startRecording","recordingConfig","maxIdleTime","unlockRecording","stopRecording","roomInfo","meState","GithubIcon","href","rel","protocol","host","RTMRestful","customerId","appSecret","source","destination","offset","limit","plainCredentials","btoa","Authorization","basicAuthorization","start_time","end_time","order","responseA","jsonA","respB","jsonB","fetchChannelMessageCount","fetchChannelMessages","WhiteboardAPI","replayRoom","beginTimestamp","duration","mediaURL","retrying","genUUID","localStorage","uuidv4","db","Dexie","version","stores","logs","flat","UAParser","getResult","arr","elem","Log","thread","LogWorker","debugLog","e","indexOf","context","arguments","postMessage","apply","proxy","uploadZipLogFile","uploadLog","toArray","logsStr","reverse","Array","isArray","File","Date","now","uploadLogFile","exists","open","originConsole","formControl","minWidth","maxWidth","hiddenStyle","yourName","document","useHistory","useState","setLock","ref","useRef","current","session","setSessionInfo","setRequired","style","Tooltip","placement","doUpload","resultCode","showDialog","setLanguage","FormControl","queryString","URL","room_id","searchParams","axios","post","showLoading","LoginToRoom","stopLoading","marginTop","sliderClass","marginLeft","ContinuousSlider","setValue","Slider","event","newValue","aria-labelledby","sliderRailClass","sliderMarkClass","CustomSlider","VoiceSlider","errorStore","BehaviorSubject","getValue","plugins","createPlugins","videoPlugin","audioPlugin","setPluginContext","identity","whiteboard","scenes","currentScenePath","currentHeight","currentWidth","dirs","zoomRadio","scale","recording","totalPage","currentPage","disconnected","WhiteWebSdk","deviceType","DeviceType","Surface","loggerOptions","disableReportLog","reportLevelMask","printLevelMask","operator","scenePath","sceneMap","roomState","sceneState","ppt","index","entireScenes","dirPath","sceneInfo","getNameByScenePath","rootPath","_dirPath","exec","RegExp","$1","pathName","_dirs","findIndex","userPayload","disableDeviceInputs","disableOperations","isWritable","roomParams","disableBezier","joinRoom","onPhaseChanged","phase","RoomPhase","Connected","updateLoading","onRoomStateChanged","zoomScale","updateScale","globalState","onDisconnectWithError","onKickedWithReason","onKeyDown","onKeyUp","onHandToolActive","onPPTLoadProgress","progress","disconnect","cleanRoom","lockBoardStatus","useObserver","store","setState","netlessStore","RootContext","useStore","useGlobalState","useRoomState","RootProvider","whiteboardState","errorState","historyState","setHistory","resolvePeerMessage","handlePeerMessage","setMessageCount","chatMessage","ts","updateChannelMessage","roomMemberChanged","total","updateRoomMember","roomInfoChanged","updateRoomInfo","coVideoUsersChanged","updateCoVideoUsers","replayMessage","link","screenShare","updateScreenShare","recordStateChanged","updateRecordState","preview","domId","local","handleClose","autoplay","loadVideo","loadAudio","lockPlay","resume","setResume","needResume","useMemo","play","fit","isPaused","setDevices","speakerList","setCamera","setMicrophone","setSpeaker","setSpeakerVolume","setVolume","mounted","addEventListener","getAudioRecordingDevices","microphoneIds","getAudioPlaybackDevices","speakerIds","getVideoDevices","cameraIds","microphones","devicename","deviceid","speakers","cameras","setStream","createPreviewStream","interval","getAudioLevel","onVolumeChange","speakerNumber","totalVolume","Number","toFixed","setClientRole","enableAudioVolumeIndication","startAudioRecordingDeviceTest","stopAudioPlaybackDeviceTest","PreviewPlayer","useCallback","MicrophoneVolume","mediaInfo","updateDevice","useSettingControl","handleFinish","ClassState","AgoraStream","networkQualityIcon","Nav","delay","network","cpu","time","showSetting","classState","onCardConfirm","moment","format","NavContainer","updateTime","timer","setTimer","card","setCard","rtt","updateRtt","quality","updateQuality","cpuUsage","updateCpuUsage","cpuTotalUsage","txquality","rxquality","STARTED","calcDuration","CLOSED","removeDialog","unlock","RoomDialog","onConfirm","onClose","desc","Dialog","disableBackdropClick","aria-describedby","DialogContent","DialogContentText","teacherRejectApply","removeNotice","goBack","teacherAcceptApply","WindowItem","ownerName","image","backgroundImage","WindowList","selectWindow","confirm","cancel","onDoubleClick","NativeSharedWindowContainer","setWindowId","electronStream","addLocalSharedStream","releaseScreenShare","RoomPage","fetchCurrentRoom","classroom","isSmallClass","removeUploadNotice","exitAll","canPublish","publishLock","rtcJoined","streamSpec","publishLocalStream","_stream","getId","addLocalStream","addRTCUser","addRemoteStream","removeRemoteStream","removePeerUser","attr","info","joinChannel","eventName","removeLocalStream","spacing","container","left","alignItems","background","opacity","zIndex","Loading","CircularProgress","LoadContainer","ConsecutiveSnackbars","queueRef","setMessages","timerRef","shift","idx","Progress","RtmPlayerState","currentTime","boardPlayPhase","PlayerPhase","Pause","isFirstScreenReady","isPlayerSeeking","isChatOpen","isVisible","replayFail","courseRecordData","player","videoPlayer","timelineScheduler","replayStore","scheduleTime","getCourseRecordBy","seekToScheduleTime","Playing","Ended","scheduler","Message","nickname","sender","to","LogLevel","RTMReplayer","currentSeekTime","senderId","pending","useAsync","rtmRecord","utc","getAllChannelMessages","load","serializeMessage","rtmMessages","replayMessages","scrollTop","scrollHeight","MessageList","ReplayContext","ReplayContainer","replayState","useParams","URLSearchParams","search","useInterval","whiteboardUUID","mediaUrl","NetlessAgoraReplay","handlePlayerClick","WaitingFirstFrame","pause","onWindowResize","refreshViewSize","handleSpaceKey","handleOperationClick","abs","onCatchErrorWhenRender","onCatchErrorWhenAppendFrame","updateWhiteboardPhase","onLoadFirstFrame","loadFirstFrame","onSliceChanged","onPlayerStateChanged","onStoppedWithError","setReplayFail","onScheduleTimeChanged","setCurrentTime","setPlayer","bindHtmlElement","getElementById","totalTime","PlayerCover","Buffering","onMouseDown","onMouseUp","onTouchStart","onTouchEnd","updateProgress","min","playsInline","objectFit","PhaseState","rawLog","PlayerLogger","prefix","TimelineScheduler","fps","rafId","_lastTimeoutId","_stopTimer","_visibilityHandler","currentDuration","hidden","_time","frame","durationBase","raf","nextTick","timestamp","v","elapsedTime","ceil","currentFrame","floor","isTimer","AgoraPlayer","cover","phaseState","$el","mediaType","createElement","Videojs","preload","controls","loop","html5","hls","overrideNative","split","pop","$dom","appendChild","paused","seconds","ended","dispose","readyState","TimelineReplay","startTimestamp","endTimestamp","updatePlayState","addVideoPlayer","timeline","seekTo","addTimeline","whiteboardPlayStatus","addWhiteboardPlayer","initPlayer","playerElementRef","whiteboardElementRef","initVideo","start","playState","useStream","teacherInfo","teacherUid","remoteTeacherStream","students","studentIds","studentStreams","myAttr","_tmpStream","studentId","studentAttr","sharedStream","currentHost","coVideoUid","userAttr","peerUid","peerUserAttr","onPlayerClick","targetUser","targetUid","mute","unmute","showScrollbar","$marquee","querySelector","clientWidth","marqueeLength","querySelectorAll","videoMarqueeMark","marqueeEl","scrollLeft","childNodes","offsetWidth","scrollBar","setScrollBar","useLayoutEffect","Whiteboard","domRef","domObserver","ResizeObserver","entries","observer","moveCamera","centerX","centerY","observe","ControlItem","Control","sharing","isHost","handleRecording","recordingErr","marginRight","ToolItem","Tools","handleToolClick","currentTool","PPTType","PPTProgressPhase","UploadManager","ossUploadCallback","getFile","generateObjectUrl","addFile","rawFile","onProgress","multipartUpload","p","Uploading","pptConverter","folder","pptURL","PptKind","Static","convert","onProgressUpdated","Converting","documentFile","pptType","static","MD5","putScenes","setScenePath","dynamic","imageInnerSize","windowSize","innerWidth","innerHeight","widthHeightProportion","imageFiles","x","y","newAcceptedFilePromises","fetchWhiteImageFileWith","newAcceptedFiles","uploadImageFilesArray","Image","reader","FileReader","readAsDataURL","onload","getImageSize","imageFile","coordinateX","coordinateY","tasks","convertToPointInWorld","insertImage","task","handleUploadTask","setMemberState","currentApplianceName","fileUrl","completeImageUpload","UploadBtn","onFailure","onSuccess","didUpload","ImageInput","DynamicInput","StaticInput","AudioVideoInput","uploadDynamic","currentTarget","files","uploadManager","convertFile","Dynamic","uploadStatic","uploadImage","uploadFileArray","$whiteboard","clientHeight","uploadImageFiles","uploadAudioVideo","isHttps","toLowerCase","insertPlugin","originX","originY","pluginVideoUrl","pluginAudioUrl","htmlFor","accept","ResourceItem","setName","useDebounce","blob","Blob","globalStateLength","sceneMapLength","size","setGlobalState","isMainScene","activeClass","removeScenes","newSceneMap","omit","coverType","defaultValue","ResourcesMenu","activeScenePath","ScaleController","tempRuleIndex","syncRuleIndexTimer","clearTimeout","syncDuration","readRuleIndexByScale","delaySyncRuleIndex","zoomChange","deltaIndex","dividingRule","targetScale","moveRuleIndex","onClickBoardLock","i","prePoint","point","nextPoint","begin","MIN_SAFE_INTEGER","end","MAX_SAFE_INTEGER","Component","UploadNotice","UploadNoticeView","rtmState","pageTool","setPageTool","studentIsHost","addNewPage","newIndex","currentPath","setSceneIndex","changePage","force","_idx","pptNextStep","pptPreviousStep","showControl","toolItems","drawable","tool","setTool","selector","updateSelector","uploadPhase","updateUploadPhase","convertPhase","updateConvertPhase","UploadPanel","percent","showUploadNotice","setViewMode","ViewMode","Broadcaster","Freedom","handToolActive","disableCameraTransform","UploadProgressView","strokeColor","memberState","r","g","b","showTools","onChangeComplete","rgb","regexPattern","truncateBlank","ChatPanel","handleChange","muteControl","disableChat","handleMute","useChatControl","disabled","placeholder","disableUnderline","onKeyPress","CustomIcon","StudentList","list","useChatText","my","slice","Roomboard","setVisible","setActive","SmallClass","currentActive","ChatBoard","roomCount","OneToOne","BigClass","closeLock","studentStopCoVideo","quitClient","teacherCancelStudent","BasicLayout","PageNotFound","ReplayPageWrapper","Copyright","align","Link","getFullYear","paper","flexDirection","avatar","backgroundColor","palette","secondary","main","form","submit","ConfigPage","Container","component","CssBaseline","Avatar","noValidate","TextField","fullWidth","autoFocus","Grid","xs","Box","mt","exact","hostname","userAgentInfo","REACT_APP_AGORA_GTM_ID","TagManager","gtmId","ReactDOM","render","click","serviceWorker","ready","registration","unregister","device","el","Eruda"],"mappings":"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","file":"static/js/main.9ae69753.chunk.js","sourcesContent":["module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"909594471f27c6305d99.worker.js\");\n};","import React from 'react';\nimport {HashRouter, Route, Router} from 'react-router-dom';\n\nexport const RouterContext = React.createContext({} as Router);\n\nfunction CustomBrowserRouter ({children}: any) {\n  return (\n    <HashRouter>\n      <Route>\n        {(routeProps: any) => (\n          <RouterContext.Provider value={routeProps}>\n            {children}\n          </RouterContext.Provider>\n        )}\n      </Route>\n    </HashRouter>\n  )\n}\n\nexport default CustomBrowserRouter;","import React from 'react';\nimport { ThemeProvider } from '@material-ui/styles';\nimport { createMuiTheme } from '@material-ui/core/styles';\n\nconst THEME = createMuiTheme({\n  typography: {\n   \"fontFamily\": '-apple-system, BlinkMacSystemFont, \\\\\"Segoe UI\\\\\", \\\\\"Roboto\\\\\", \\\\\"Oxygen\\\\\", \\\\\"Ubuntu\\\\\", \\\\\"Cantarell\\\\\", \\\\\"Fira Sans\\\\\", \\\\\"Droid Sans\\\\\", \\\\\"Helvetica Neue\\\\\", sans-serif',\n   \"fontSize\": 14,\n   \"fontWeightLight\": 300,\n   \"fontWeightRegular\": 400,\n   \"fontWeightMedium\": 500,\n  },\n\n  overrides: {\n    MuiRadio: {\n      root: {\n        padding: '4px'\n      }\n    },\n    MuiSvgIcon: {\n      root: {\n        width: '1rem',\n        height: '1rem',\n      }\n    },\n    MuiFormControl: {\n      root: {\n        margin: '0.3rem 0',\n      }\n    },\n    MuiInput: {\n      underline: {\n        '&:before': {\n          borderBottom: '1px solid #EAEAEA',\n        },\n        '&:hover:not($disabled):not($focused):not($error):before': {\n          borderBottom: `2px solid #EAEAEA`,\n        },\n        '&$focused': {\n          '&:after': {\n            borderBottom: '2px solid #44a2fc',\n          }\n        },\n      }\n    }\n  }\n});\n\nexport default function ({children}: any) {\n  return (\n    <ThemeProvider theme={THEME}>\n      {children}\n    </ThemeProvider>\n  )\n}","import React from 'react';\nimport { Button } from '@material-ui/core';\nexport default function (props: any) {\n  return (\n    <Button id=\"room_join\" variant=\"contained\" className={props.className ? props.className : 'custom-button'} color=\"primary\" onClick={props.onClick}>\n      {props.name}\n    </Button>\n  )\n}","import { isEmpty } from \"lodash\";\n\nexport class CustomStorage {\n\n  private storage: Storage;\n\n  languageKey: string = 'demo_language'\n\n  constructor() {\n    this.storage = window.sessionStorage;\n  }\n\n  read(key: string): any {\n    try {\n      let json = JSON.parse(this.storage.getItem(key) as string);\n      return json\n    } catch(_) {\n      return this.storage.getItem(key);\n    }\n  }\n\n  save(key: string, val: any) {\n    this.storage.setItem(key, JSON.stringify(val));\n  }\n\n  clear(key: string) {\n    this.storage.removeItem(key);\n  }\n\n  setLanguage(lang: string) {\n    this.save(this.languageKey, lang)\n  }\n\n  getLanguage() {\n    const language = this.read(this.languageKey) ? this.read(this.languageKey) : navigator.language;\n    return {language};\n  }\n\n  getRtmMessage (): {count: any, messages: any[]} {\n    const channelMessages = GlobalStorage.read('channelMessages');\n    if (isEmpty(channelMessages)) return {\n      count: 0,\n      messages: []\n    }\n    const messages = channelMessages.filter((it: any) => it.message_type === \"group_message\");\n    const chatMessages = messages.reduce((collect: any[], value: any) => {\n      const payload = value.payload;\n      const json = JSON.parse(payload);\n      if (json.content) {\n        return collect.concat({\n          account: json.account,\n          content: json.content,\n          ms: value.ms,\n          src: value.src\n        });\n      }\n      return collect;\n    }, []);\n    return {\n      messages: chatMessages,\n      count: chatMessages.length\n    }\n  }\n}\n\nconst GlobalStorage = new CustomStorage();\n// @ts-ignore\nwindow.GlobalStorage = GlobalStorage;\nexport default GlobalStorage;","import {Subject} from 'rxjs';\nimport GlobalStorage from '../utils/custom-storage';\n\nexport const roomTypes = [\n  {value: 0, text: 'home.1v1', path: 'one-to-one'},\n  {value: 1, text: 'home.mini_class', path: 'small-class'},\n  {value: 2, text: 'home.large_class', path: 'big-class'},\n]\n\nexport type GlobalState = {\n  loading: boolean\n  lock: boolean\n  toast: {\n    type: string\n    message: string\n  }\n  dialog: {\n    type: string\n    message: string\n    confirmText?: string\n    cancelText?: string\n  }\n  uploadNotice: {\n    type: string\n    title: string\n  },\n  notice: {\n    text: string\n    reason: string\n  },\n  nativeWindowInfo: {\n    visible: boolean\n    items: any[]\n  },\n  active: string,\n  language: string,\n  newMessageCount: number,\n}\n\nexport class Root {\n  private subject: Subject<GlobalState> | null;\n  public state: GlobalState;\n  public readonly defaultState: GlobalState = {\n    loading: false,\n    toast: {\n      type: '',\n      message: '',\n    },\n    dialog: {\n      type: '',\n      message: '',\n      confirmText: 'confirm',\n      cancelText: 'cancel'\n    },\n    uploadNotice: {\n      type: '',\n      title: '',\n    },\n    notice: {\n      reason: '',\n      text: '',\n    },\n    nativeWindowInfo: {\n      visible: false,\n      items: []\n    },\n    lock: false,\n    active: 'chatroom',\n    language: navigator.language,\n    newMessageCount: 0,\n    ...GlobalStorage.getLanguage(),\n  }\n\n  constructor() {\n    this.subject = null;\n    this.state = this.defaultState;\n  }\n\n  initialize() {\n    this.subject = new Subject<GlobalState>();\n    this.state = {\n      ...this.defaultState,\n    }\n    this.subject.next(this.state);\n  }\n\n  subscribe(updateState: any) {\n    this.initialize();\n    this.subject && this.subject.subscribe(updateState);\n  }\n\n  unsubscribe() {\n    this.subject && this.subject.unsubscribe();\n    this.subject = null;\n  }\n\n  commit (state: GlobalState) {\n    this.subject && this.subject.next(state);\n  }\n\n  updateState(rootState: GlobalState) {\n    this.state = {\n      ...this.state,\n      ...rootState,\n    }\n    this.commit(this.state);\n  }\n\n  showNotice({\n    reason,\n    text,\n  }:{\n    reason: string,\n    text: string\n  }) {\n    this.state = {\n      ...this.state,\n      notice: {\n        text,\n        reason\n      }\n    }\n    this.commit(this.state);\n  }\n\n  removeNotice() {\n    this.state = {\n      ...this.state,\n      notice: {\n        text: '',\n        reason: ''\n      }\n    }\n    this.commit(this.state);\n  }\n\n  setNativeWindowInfo({visible, items}: {visible: boolean, items: any[]}) {\n    this.state = {\n      ...this.state,\n      nativeWindowInfo: {\n        visible,\n        items\n      }\n    }\n    this.commit(this.state);\n  }\n\n  showUploadNotice({type, title}: {type: string, title: string}) {\n    this.state = {\n      ...this.state,\n      uploadNotice: {\n        type,\n        title\n      }\n    }\n    this.commit(this.state);\n  }\n\n  removeUploadNotice() {\n    this.state = {\n      ...this.state,\n      uploadNotice: {\n        type: '',\n        title: ''\n      }\n    }\n    this.commit(this.state);\n  }\n\n  showToast({type, message}: {type: string, message: string}) {\n    this.state = {\n      ...this.state,\n      toast: {\n        type, message\n      },\n    }\n    this.commit(this.state);\n  }\n\n  showDialog({type, message}: {type: string, message: string}) {\n    this.state = {\n      ...this.state,\n      dialog: {\n        type,\n        message\n      },\n    }\n    this.commit(this.state);\n  }\n\n  removeDialog() {\n    this.state = {\n      ...this.state,\n      dialog: {\n        type: '',\n        message: ''\n      },\n    }\n    this.commit(this.state);\n  }\n\n  showLoading () {\n    this.state = {\n      ...this.state,\n      loading: true\n    }\n    this.commit(this.state);\n  }\n\n  stopLoading () {\n    this.state = {\n      ...this.state,\n      loading: false\n    }\n    this.commit(this.state);\n  }\n\n  getLanguage(): string {\n    return GlobalStorage.read('demo_language')\n  }\n\n  setLanguage(language: string) {\n    this.state = {\n      ...this.state,\n      language,\n    }\n    this.commit(this.state);\n    GlobalStorage.save('demo_language', this.state.language);\n    window.location.reload();\n  }\n\n  setActive(active: string) {\n    if (active !== 'chatroom') {\n      this.state = {\n        ...this.state,\n        active,\n      }\n    } else {\n      this.state = {\n        ...this.state,\n        active,\n        newMessageCount: 0,\n      }\n    }\n    this.commit(this.state);\n  }\n\n  setMessageCount(len: number) {\n    this.state = {\n      ...this.state,\n      newMessageCount: len\n    }\n    this.commit(this.state);\n  }\n\n  lock() {\n    this.state = {\n      ...this.state,\n      lock: true\n    }\n    this.commit(this.state)\n  }\n\n  unlock() {\n    this.state = {\n      ...this.state,\n      lock: false\n    }\n    this.commit(this.state)\n  }\n}\n\nexport const globalStore = new Root();\n\n// @ts-ignore\nwindow.globalStore = globalStore;","const BUILD_VERSION = process.env.REACT_APP_BUILD_VERSION as string;\nconst build_version = BUILD_VERSION ? BUILD_VERSION : '0.0.1';\n\nconst zhCN: any = {\n  \"screen_share_permission\": \"缺少屏幕共享权限\",\n  \"electron\": {\n    \"start_screen_share_failed\": \"native screen sharing failed\"\n  },\n  \"icon\": {\n    \"setting\": \"设置\",\n    \"upload-log\": \"上传日志\",\n    \"exit-room\": \"退出教室\",\n    \"lang-select\": \"语言切换\",\n  },\n  'doc_center': '文档中心',\n  'upload_picture': '上传图片',\n  'convert_webpage': '转换动态PPT',\n  'convert_to_picture': 'PPT转图片',\n  'upload_audio_video': '上传音视频',\n  'return': {\n    'home': '返回主页',\n  },\n  'control_items': {\n    \"first_page\": \"第一页\",\n    \"prev_page\": \"上一页\",\n    \"next_page\": \"下一页\",\n    \"last_page\": \"最后一页\",\n    \"stop_recording\": \"停止云端录制\",\n    \"recording\": \"开始云端录制\",\n    \"quit_screen_sharing\": \"停止屏幕分享\",\n    \"screen_sharing\": \"开始屏幕分享\",\n    \"delete_current\": \"删除当前\",\n    \"delete_all\": \"删除全部\",\n  },\n  'zoom_control': {\n    'folder': '文档中心',\n    'lock_board': '设置白板跟随',\n    'unlock_board': '取消白板跟随'\n  },\n  'tool': {\n    'selector': '鼠标选择器',\n    'pencil': '画笔',\n    'rectangle': '矩形',\n    'ellipse': '椭圆',\n    'eraser': '橡皮擦',\n    'text': '文字',\n    'color_picker': '调色板',\n    'add': '新增一页',\n    'upload': '上传',\n    'hand_tool': '手抓工具'\n  },\n  'error': {\n    'not_found': '页面找不到',\n    'components': {\n      'paramsEmpty': '参数：{reason}不能为空',\n    }\n  },\n  'whiteboard': {\n    'loading': '加载中...',\n    'global_state_limit': '请不要给白板设置过大的globalState size',\n    'locked_board': '老师正在控制白板，请勿书写',\n    'unlocked_board': '白板已解除锁定。',\n  },\n  'toast': {\n    'upload_log_failure': '上传日志失败，错误类型：{reason}, 详情参考开发者工具',\n    'show_log_id': `请提供你的日志ID: {no}`,\n    'api_login_failured': '房间加入失败, 原因: {reason}',\n    'confirm': '确定',\n    'cancel': '取消',\n    'quit_room': '确定退出课程吗？',\n    'kick': '其他端登录，被踢出房间',\n    'login_failure': '登录房间失败',\n    'whiteboard_lock': '设置白板跟随',\n    'whiteboard_unlock': '取消白板跟随',\n    'canceled_screen_share': '已取消屏幕共享',\n    'screen_sharing_failed': '屏幕分享失败, 原因：{reason}',\n    'recording_failed': '开启云录制失败, 原因：{reason}',\n    'start_recording': '开始云录制',\n    'stop_recording': '结束云录制',\n    'recording_too_short': '录制太短，至少15秒',\n    'rtm_login_failed': '房间登录失败, 请检查网络设置',\n    'rtm_login_failed_reason': '房间登录失败, 原因： {reason}',\n    'replay_failed': '回放失败，请刷新页面重试',\n    'teacher_exists': '该房间老师已存在，请等待30秒或重新创建教室',\n    'student_over_limit': '超出学生最大人数，请等待30秒或重新创建教室',\n    'teacher_and_student_over_limit': '超出学生和老师的最大人数',\n    'teacher_accept_whiteboard': '老师已授权了你白板的权限',\n    'teacher_cancel_whiteboard': '老师已收回了你白板的权限',\n    'teacher_accept_co_video': '老师已允许连麦',\n    'teacher_reject_co_video': '老师已拒绝连麦',\n    'teacher_cancel_co_video': '老师已取消连麦',\n    'student_cancel_co_video': '学生已取消连麦',\n    'student_send_co_video_apply': '\"{reason}\" 学生发起了连麦申请',\n    'student_peer_leave': '\"{reason}\" 离开了',\n    'stop_co_video': '教师停止了\"{reason}\"的连麦',\n    'reject_co_video': '您取消了学生的连麦申请',\n    'close_co_video': '您关闭了学生的连麦',\n    'close_youself_co_video': '你关闭了自己的连麦',\n    'accept_co_video': '您同意了连麦',\n  },\n  'notice': {\n    'student_interactive_apply': `\"{reason}\"想和你连麦`\n  },\n  'chat': {\n    'placeholder': '说点什么',\n    'banned': '禁言中',\n    'send': '发送'\n  },\n  'device': {\n    'camera': '摄像头',\n    'microphone': '麦克风',\n    'speaker': '扬声器',\n    'finish': '完成',\n  },\n  'nav': {\n    'delay': '延迟: ',\n    'network': '网络: ',\n    'cpu': 'CPU: ',\n    'class_end': '课程结束',\n    'class_start': '课程开始'\n  },\n  'home': {\n    'entry-home': '进入教室',\n    'teacher': '老师',\n    'student': '学生',\n    'cover_class': 'cover-cn',\n    'room_name': '房间名',\n    'nickname': '昵称',\n    'room_type': '房间类型',\n    'room_join': '加入房间',\n    'short_title': {\n      'title': '声网云课堂',\n      'subtitle': '由声网提供',\n    },\n    'name_too_long': '名字过长，不得超过20个字符',\n    '1v1': '一对一',\n    'mini_class': '小班课',\n    'large_class': '大班课',\n    'missing_room_name': '缺少房间名',\n    'missing_your_name': '缺少昵称',\n    'missing_password': '缺少房间密码',\n    'missing_role': '\b缺少角色',\n    'account': '姓名',\n    'password': '密码',\n  },\n  'room': {\n    'chat_room': '消息列表',\n    'student_list': '学生列表',\n    'uploading': '上传中...',\n    'converting': '转换中...',\n    'upload_success': '上传成功',\n    'upload_failure': '上传失败，请检查网络',\n    'convert_success': '转换成功',\n    'convert_failure': '转换失败，请检查网络',\n  },\n  'replay': {\n    'loading': '加载中...',\n    'recording': '在录制中',\n    'finished': '录制完成',\n    'finished_recording_to_be_download': '服务端准备下载中',\n    'finished_download_to_be_convert': '服务端准备转换中',\n    'finished_convert_to_be_upload': '服务端准备保存中',\n  },\n  'course_recording': '录制回放',\n  'build_version': `构建版本: ${build_version}`,\n}\n\nexport default zhCN;","const BUILD_VERSION = process.env.REACT_APP_BUILD_VERSION as string;\nconst build_version = BUILD_VERSION ? BUILD_VERSION : '0.0.1';\n\nconst en = {\n  \"screen_share_permission\": \"Need Electron Screen Capture Permission\",\n  \"electron\": {\n    \"start_screen_share_failed\": \"native screen sharing failed\"\n  },\n  \"icon\": {\n    \"setting\": \"Setting\",\n    \"upload-log\": \"Upload Log\",\n    \"exit-room\": \"Exit Room\",\n    \"lang-select\": \"Switch Language\",\n  },\n  'doc_center': 'Course Document Center',\n  'upload_picture': 'Upload Picture',\n  'convert_webpage': 'Dynamic PPT',\n  'convert_to_picture': 'Static PPT',\n  'upload_audio_video': 'Upload Audio/Video',\n  'return': {\n    'home': 'Back To Home',\n  },\n  'control_items': {\n    \"first_page\": \"First Page\",\n    \"prev_page\": \"Prev Page\",\n    \"next_page\": \"Next Page\",\n    \"last_page\": \"Last Page\",\n    \"stop_recording\": \"Stop Cloud Recording\",\n    \"recording\": \"Start Cloud Recording\",\n    \"quit_screen_sharing\": \"Stop Screen Sharing\",\n    \"screen_sharing\": \"Start Screen Sharing\",\n    \"delete_current\": \"Remove Current\",\n    \"delete_all\": \"Remove All\",\n  },\n  'zoom_control': {\n    'folder': 'Document Center',\n    'lock_board': 'Set Whiteboard Follow',\n    'unlock_board': 'Reset Whiteboard Follow'\n  },\n  'tool': {\n    'selector': 'mouse selector',\n    'pencil': 'penceil',\n    'rectangle': 'rectangle',\n    'ellipse': 'ellipse',\n    'eraser': 'eraser',\n    'text': 'text',\n    'color_picker': 'color picker',\n    'add': 'add new page',\n    'upload': 'upload ',\n    'hand_tool': 'hand selector'\n  },\n  'error': {\n    'not_found': 'Page Not Found',\n    'components': {\n      'paramsEmpty': 'params：{reason} can`t be empty',\n    }\n  },\n  'whiteboard': {\n    'loading': 'Loading...',\n    'global_state_limit': 'globalState size limit size probably overflow',\n    'locked_board': 'The teacher is moving the whiteboard. Please do not draw on it.',\n    'unlocked_board': 'The whiteboard already unlocked',\n  },\n  'toast': {\n    'upload_log_failure': 'Upload Log Failure，ErrorName: {reason}，see more details in devtool',\n    'show_log_id': `Report your log ID: {reason}`,\n    'api_login_failured': 'Join Failured, Reason: {reason}',\n    'confirm': 'Confirm',\n    'cancel': 'Cancel',\n    'quit_room': 'Are you sure to exit the classroom?',\n    'kick': 'kicked',\n    'login_failure': 'login failure',\n    'whiteboard_lock': 'Whiteboard follow',\n    'whiteboard_unlock': 'Whiteboard nofollow',\n    'canceled_screen_share': 'Canceled screen sharing',\n    'screen_sharing_failed': 'Screen sharing failed, reason: {reason}',\n    'recording_failed': 'Start cloud recording failed, reason: {reason}',\n    'start_recording': 'Start cloud recording success',\n    'stop_recording': 'Stop cloud recording success',\n    'recording_too_short': 'Recording too short, at least 15 seconds',\n    'rtm_login_failed': 'login failure, please check your network',\n    'rtm_login_failed_reason': 'login failure, reason: {reason}',\n    'replay_failed': 'Replay Failed please refresh browser',\n    'teacher_exists': 'Teacher already exists, Please waiting for 30s or reopen new class',\n    'student_over_limit': 'Student have reached upper limit, , Please waiting for 30s or rejoin new class',\n    'teacher_and_student_over_limit': 'The number of students and teacher have reached upper limit',\n    'teacher_accept_whiteboard': 'Teacher already grant your whiteboard',\n    'teacher_cancel_whiteboard': 'Teacher already cancel your whiteboard',\n    'teacher_accept_co_video': 'Teacher already accept co-video',\n    'teacher_reject_co_video': 'Teacher already rejected co-video',\n    'teacher_cancel_co_video': 'Teacher already canceled co-video',\n    'student_cancel_co_video': 'Student canceled co-video',\n    'student_peer_leave': '\"{reason}\" Left',\n    'student_send_co_video_apply': '\"{reason}\" send the co-video request',\n    'stop_co_video': 'Stop \"{reason}\" co-video',\n    'reject_co_video': 'Reject co-video',\n    'close_co_video': 'Close co-video',\n    'close_youself_co_video': 'Stop co-video',\n    'accept_co_video': 'Accept co-video',\n  },\n  'notice': {\n    'student_interactive_apply': `\"{reason}\" wants to interact with you`\n  },\n  'chat': {\n    'placeholder': 'Input Message',\n    'banned': 'Banned',\n    'send': 'send'\n  },\n  'device': {\n    'camera': 'Camera',\n    'microphone': 'Microphone',\n    'speaker': 'Speaker',\n    'finish': 'Finish',\n  },\n  'nav': {\n    'delay': 'Delay: ',\n    'network': 'Network: ',\n    'cpu': 'CPU: ',\n    'class_end': 'Class end',\n    'class_start': 'Class start'\n  },\n  'home': {\n    'entry-home': 'Join Classroom',\n    'teacher': 'teacher',\n    'student': 'student',\n    'cover_class': 'cover-en',\n    'room_name': 'Room Name',\n    'nickname': 'Your Name',\n    'room_type': 'Room Type',\n    'room_join': 'Join',\n    'short_title': {\n      'title': 'Agora Cloud Class',\n      'subtitle': 'Powered by agora.io, a leading online learning engagement platform',\n    },\n    'name_too_long': 'name too long, should <= 20 characters',\n    '1v1': 'One to One Classroom',\n    'mini_class': 'Small Classroom',\n    'large_class': 'Lecture Hall',\n    'missing_room_name': 'missing room name',\n    'missing_your_name': 'missing your name',\n    'missing_password': 'missing password',\n    'missing_role': 'missing role',\n    'account': 'Name',\n    'password': 'Password',\n  },\n  'room': {\n    'chat_room': 'Chat Room',\n    'student_list': 'Student List',\n    'uploading': 'Uploading...',\n    'converting': 'Converting...',\n    'upload_success': 'upload success',\n    'upload_failure': 'upload failure, check the network',\n    'convert_success': 'convert success',\n    'convert_failure': 'convert failure, check the network',\n  },\n  'replay': {\n    'loading': 'loading...',\n    'recording': 'In Recording',\n    'finished': 'Finished',\n    'finished_recording_to_be_download': 'Server prepare downloading',\n    'finished_download_to_be_convert': 'Server prepare converting',\n    'finished_convert_to_be_upload': 'Server prepare saving',\n  },\n  'course_recording': 'course recording',\n  'build_version': `build version: ${build_version}`,\n}\n\nexport default en;","import { globalStore } from './stores/global';\nimport {get, isEmpty} from 'lodash';\nimport zhCN from './i18n/zh';\nimport en from './i18n/en';\n\nexport const BUILD_VERSION = process.env.REACT_APP_BUILD_VERSION as string;\n\nexport const t = (name: string, options?: any): string => {\n  const lang = globalStore.state.language.match(/zh/) ? zhCN : en;\n  let content = get(lang, name, null);\n  if (!content) {\n    console.error(`${lang}: ${name} has no match`);\n    return `${lang}.${name}`;\n  }\n\n  if (!isEmpty(options)) {\n    if (options.reason && content.match(/\\{.+\\}/)) {\n      content = content.replace(/\\{.+\\}/, options.reason);\n    }\n  }\n\n  return content;\n}","import React from 'react';\nimport { Theme, RadioGroup, Radio, FormControlLabel, Typography } from '@material-ui/core';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport './role-radio.scss';\nimport { t } from '../i18n';\n\nconst useStyles = makeStyles ((theme: Theme) => ({\n  radioGroup: {\n    display: 'block',\n    clear: 'both',\n    justifyContent: 'space-between'\n  },\n  required: {\n    fontSize: '12px',\n    color: '#ff0000',\n    lineHeight: '17px',\n    position: 'absolute',\n    top: '23px',\n  }\n}));\n\nexport default function (props: any) {\n  const classes = useStyles();\n  return (\n    <RadioGroup className={classes.radioGroup} row value={props.role} onChange={props.onChange}>\n      <FormControlLabel\n        className={\"custom-radio align-left\"}\n        value=\"teacher\"\n        control={<Radio className={\"custom-radio\"} color=\"primary\" />}\n        label={t(\"home.teacher\")}\n        labelPlacement=\"end\"\n      />\n      <FormControlLabel\n        className={\"custom-radio align-right\"}\n        value=\"student\"\n        control={<Radio className={\"custom-radio\"} color=\"primary\" />}\n        label={t(\"home.student\")}\n        labelPlacement=\"end\"\n      />\n      {props.requiredText ? <Typography className={classes.required}>{props.requiredText}</Typography> : null}\n    </RadioGroup>\n  )\n}","import React from 'react';\nexport default function ({data, icon, disable, className, onClick, active}: any) {\n  let iconClass = disable ? '' : (icon ? 'icon-btn' : 'icon');\n  iconClass = active ? iconClass + \" active\" : iconClass;\n\n  const dataName = data ? data : ''\n  return (\n    <div className={`${iconClass} ${className}`} onClick={onClick} data-name={dataName}></div>\n  )\n}","import React from 'react';\nimport {makeStyles} from '@material-ui/core/styles';\nimport { Theme, Typography, InputLabel, Input } from '@material-ui/core';\n\nconst useStyles = makeStyles ((theme: Theme) => ({\n  formInput: {\n    '&:after': {\n      borderBottom: '1px solid #44a2fc'\n    }\n  },\n  required: {\n    fontSize: '12px',\n    color: '#ff0000',\n    lineHeight: '17px',\n    position: 'absolute',\n    top: '48px'\n  }\n}));\n\n// const ALPHABETICAL = /^[a-zA-Z0-9]*/\n\nexport default function (props: any) {\n  const classes = useStyles();\n\n  const onChange = (evt: any) => {\n    const val = evt.target.value\n    // const val = evt.target.value.match(ALPHABETICAL)[0];\n    props.onChange(val ? val : '');\n  }\n  return (\n    <>\n      <InputLabel>{props.Label}</InputLabel>\n      <Input className={classes.formInput} value={props.value}\n        onChange={onChange}>\n      </Input>\n      {props.requiredText ? <Typography className={classes.required}>{props.requiredText}</Typography> : null}\n    </>\n  );\n}","import React from 'react';\nimport { Select, InputLabel, MenuItem } from '@material-ui/core';\n// import { t } from '../i18n';\n\nexport interface FormSelectItems {\n  text: string\n}\n\nexport interface FormSelect {\n  items: FormSelectItems[]\n  Label: string\n  value: any\n  onChange: (evt: any) => any\n}\n\nconst FormSelect: React.FC<FormSelect> = ({\n  Label,\n  value,\n  onChange,\n  items\n}) => {\n  return (\n    <>\n      <InputLabel>{Label}</InputLabel>\n      <Select\n        value={value}\n        onChange={onChange}\n      >\n        {items.map((item: any, key: number) => \n          <MenuItem key={key} value={key}>{item.text}</MenuItem>\n        )}\n      </Select>\n    </>\n  );\n}\n\nexport default React.memo(FormSelect);","import React from 'react';\nimport { Select, MenuItem } from '@material-ui/core';\n\nconst LangSelect: React.FC<any> = ({\n  value,\n  onChange,\n  items,\n}) => {\n  return (\n    <Select\n      value={value}\n      onChange={onChange}\n    >\n      {items.map((item: any, key: number) => \n        <MenuItem key={key} value={key}>{item.text}</MenuItem>\n      )}\n    </Select>\n  );\n}\n\nexport default React.memo(LangSelect);","console.log(`CURRENT RUNTIME: ${process.env.REACT_APP_RUNTIME_PLATFORM}`);\n\nexport const isElectron = process.env.REACT_APP_RUNTIME_PLATFORM === 'electron'\n\nexport const platform = process.env.REACT_APP_RUNTIME_PLATFORM as string;","import AgoraRTM from 'agora-rtm-sdk';\nimport EventEmitter from 'events';\nimport * as _ from 'lodash';\nimport { resolveMessage, jsonParse } from './helper';\n\nexport const APP_ID = process.env.REACT_APP_AGORA_APP_ID as string;\nconst ENABLE_LOG = process.env.REACT_APP_AGORA_LOG === 'true';\nconst logFilter = ENABLE_LOG ? AgoraRTM.LOG_FILTER_DEBUG : AgoraRTM.LOG_FILTER_OFF;\n\nexport enum RoomMessage {\n  muteAudio = 101,\n  unmuteAudio = 102,\n  muteVideo = 103,\n  unmuteVideo = 104,\n  applyCoVideo = 105,\n  acceptCoVideo = 106,\n  rejectCoVideo = 107,\n  cancelCoVideo = 108,\n  muteChat = 109,\n  unmuteChat = 110,\n  muteBoard = 200,\n  unmuteBoard = 201,\n  lockBoard = 301,\n  unlockBoard = 302,\n  startCourse = 401,\n  endCourse = 402,\n  muteAllChat = 501,\n  unmuteAllChat = 502\n}\n\nexport enum ChatCmdType {\n  chat = 1,\n  roomMemberChanged = 2,\n  roomInfoChanged = 3,\n  coVideoUsersChanged = 4,\n  replay = 5,\n  screenShare = 6,\n  recordStateChanged = 7,\n}\n\nexport enum CoVideoType {\n  studentSendApply = 1,\n  teacherSendReject = 2,\n  // studentCancelApply = 3,\n  teacherSendAccept = 4,\n  teacherSendStop = 5,\n  studentSendStop = 6,\n}\n\nexport interface ChannelBodyParams {\n  account: string\n  content: string\n  recordId: string\n}\n\nexport interface NotifyMessageParams {\n  cmd: ChatCmdType\n  data: ChatMessage | UserMessage | CourseMessage | ReplayMessage\n  enableHistoricalMessaging?: boolean\n}\n\nexport interface CourseMessage {\n  operate: \n    RoomMessage.startCourse | \n    RoomMessage.endCourse | \n    RoomMessage.muteAllChat |\n    RoomMessage.unmuteAllChat |\n    RoomMessage.lockBoard |\n    RoomMessage.unlockBoard |\n    RoomMessage.acceptCoVideo |\n    RoomMessage.cancelCoVideo |\n    RoomMessage.applyCoVideo\n}\n\nexport type ChatMessage = {\n  account: string\n  content: string\n  userId?: string\n}\n\nexport interface ReplayMessage {\n  account: string\n  recordId: string\n}\n\nexport interface UserMessage {\n  uid: string\n  account: string\n  resource: string\n  value: number\n}\n\n\nexport interface ChatBody {\n  account: string\n  content: string\n}\n\nexport interface PeerMessage {\n  uid: string\n  userId: string\n  account: string\n  operate: number\n}\n\nexport interface MessageBody {\n  cmd: RoomMessage\n  text?: string\n  data?: ChatMessage |\n    UserMessage |\n    CourseMessage |\n    PeerMessage |\n    ReplayMessage\n}\n\nexport type SessionProps = {\n  roomType: number,\n  role: string,\n  id: string,\n  room: string,\n  token: string\n}\n\nexport default class AgoraRTMClient {\n\n  private _bus: EventEmitter;\n  public _currentChannel: any;\n  public _currentChannelName: string | any;\n  private _channels: any;\n  private _client: any;\n  private _channelAttrsKey: string | any;\n  public _logged: boolean = false;\n  private _joined: boolean = false;\n\n  constructor () {\n    this._bus = new EventEmitter();\n    this._channels = {};\n    this._currentChannel = null;\n    this._currentChannelName = null;\n    this._channelAttrsKey = null;\n    this._client = null;\n  }\n\n  public removeAllListeners(): any {\n    this._bus.removeAllListeners();\n  }\n\n  destroy (): void {\n    for (let channel of Object.keys(this._channels)) {\n      if (this._channels[channel]) {\n        this._channels[channel].removeAllListeners();\n        this._channels[channel] = null;\n      }\n    }\n    this._currentChannel = null;\n    this._currentChannelName = null;\n    this._client.removeAllListeners();\n  }\n\n  on(evtName: string, cb: (args: any) => void) {\n    this._bus.on(evtName, cb);\n  }\n\n  off(evtName: string, cb: (args: any) => void) {\n    this._bus.off(evtName, cb);\n  }\n\n  async login (appID: string, uid: string, token?: string) {\n    const rtmClient = AgoraRTM.createInstance(appID, { enableLogUpload: ENABLE_LOG, logFilter });\n    try {\n      await rtmClient.login({uid, token});\n      rtmClient.on(\"ConnectionStateChanged\", (newState: string, reason: string) => {\n        this._bus.emit(\"ConnectionStateChanged\", {newState, reason});\n      });\n      rtmClient.on(\"MessageFromPeer\", (message: any, peerId: string, props: any) => {\n        this._bus.emit(\"MessageFromPeer\", {message, peerId, props});\n      });\n      this._client = rtmClient\n      this._logged = true;\n    } catch(err) {\n      rtmClient.removeAllListeners()\n      throw err\n    }\n    return\n  }\n\n  async logout () {\n    if (!this._logged) return;\n    await this._client.logout();\n    this.destroy();\n    this._logged = false;\n    return;\n  }\n\n  async join (channel: string) {\n    const _channel = this._client.createChannel(channel);\n    this._channels[channel] = _channel;\n    this._currentChannel = this._channels[channel];\n    this._currentChannelName = channel;\n    await _channel.join();\n    _channel.on('ChannelMessage', (message: string, memberId: string) => {\n      this._bus.emit('ChannelMessage', {message, memberId});\n    });\n\n    _channel.on('MemberJoined', (memberId: string) => {\n      this._bus.emit('MemberJoined', memberId);\n    });\n\n    _channel.on('MemberLeft', (memberId: string) => {\n      this._bus.emit('MemberLeft', memberId);\n    });\n\n    _channel.on('MemberCountUpdated', (count: number) => {\n      this._bus.emit('MemberCountUpdated', count);\n    })\n\n    _channel.on('AttributesUpdated', (attributes: any) => {\n      this._bus.emit('AttributesUpdated', attributes);\n    });\n    this._joined = true;\n    return;\n  }\n\n  destroyChannel(channel: string) {\n    if (this._channels[channel]) {\n      this._channels[channel].removeAllListeners();\n      this._channels[channel] = null;\n    }\n  }\n\n  async leave (channel: string) {\n    if (this._channels[channel]) {\n      // await this._channels[channel].leave();\n      this._joined = false;\n      this.destroyChannel(channel);\n    }\n  }\n\n  async exit() {\n    try {\n      await this.deleteChannelAttributesByKey();\n    } catch (err) {\n\n    } finally {\n      await this.leave(this._currentChannelName);\n      await this.logout();\n    }\n  }\n\n  async notifyMessage(params: NotifyMessageParams) {\n    const {cmd, data, enableHistoricalMessaging = false} = params\n\n    const body = JSON.stringify({\n      cmd,\n      data,\n    })\n\n    return this._currentChannel.sendMessage({text: body}, {enableHistoricalMessaging})\n  }\n\n  async sendPeerMessage(peerId: string, body: MessageBody) {\n    resolveMessage(peerId, body);\n    console.log(\"[rtm-client] send peer message \", peerId, JSON.stringify(body));\n    let result = await this._client.sendMessageToPeer({text: JSON.stringify(body)}, peerId, {enableHistoricalMessaging: true});\n    return result.hasPeerReceived;\n  }\n\n  async sendRecordMessage(data: Partial<ChannelBodyParams>) {\n    const msgData: ReplayMessage = {\n      account: data.account as string,\n      recordId: data.recordId as string,\n    }\n\n    return this.notifyMessage({\n      cmd: ChatCmdType.replay,\n      data: msgData,\n      enableHistoricalMessaging: false\n    })\n  }\n\n  // async sendChannelMessage(data: Partial<ChannelBodyParams>) {\n  //   const msgData: ChatMessage = {\n  //     account: data.account as string,\n  //     content: data.content as string,\n  //   }\n\n  //   return this.notifyMessage({\n  //     cmd: ChatCmdType.chat,\n  //     data: msgData,\n  //     enableHistoricalMessaging: true\n  //   })\n  // }\n\n  async updateChannelAttrsByKey (key: string, attrs: any) {\n    this._channelAttrsKey = key;\n    const channelAttributes: {[key: string]: string} = {}\n    if (key) {\n      channelAttributes[key] = JSON.stringify(attrs);\n    }\n\n    console.log(\"[rtm-client] updateChannelAttrsByKey \", attrs, \" key \", key, channelAttributes);\n    await this._client.addOrUpdateChannelAttributes(\n      this._currentChannelName,\n      channelAttributes,\n      {enableNotificationToChannelMembers: true});\n  }\n\n  async deleteChannelAttributesByKey() {\n    if (!this._channelAttrsKey) return;\n    await this._client.deleteChannelAttributesByKeys(\n      this._currentChannelName,\n      [this._channelAttrsKey],\n      {enableNotificationToChannelMembers: true}\n    );\n    this._channelAttrsKey = null;\n    return;\n  }\n  \n  async getChannelAttrs (): Promise<string> {\n    let json = await this._client.getChannelAttributes(this._currentChannelName);\n    return JSON.stringify(json);\n  }\n\n  async getChannelMemberCount(ids: string[]) {\n    return this._client.getChannelMemberCount(ids);\n  }\n\n  async queryOnlineStatusBy(accounts: any[]) {\n    let results: any = {\n      teacherCount: 0,\n      totalCount: 0,\n      studentTotalCount: 0\n    };\n    if (accounts.length > 0) {\n      const ids = accounts.map((it: any) => `${it.uid}`);\n      results = await this._client.queryPeersOnlineStatus(ids);\n      if (results && Object.keys(results).length) {\n        const teacher = accounts.find((it: any) => it.role === 'teacher');\n        if (teacher && results[teacher.uid]) {\n          results.teacher = results[teacher.uid];\n          results.teacherCount = 1;\n        }\n        results.totalCount = accounts.filter((it: any) => results[it.uid]).length;\n        results.studentsTotalCount = results.totalCount - results.teacherCount;\n      } else {\n        console.warn(`accounts: ${ids}, cannot get peers online status from [queryPeersOnlineStatus]`);\n      }\n    }\n    return results;\n  }\n\n  async getChannelAttributeBy(channelName: string) {\n    let json = await this._client.getChannelAttributes(channelName);\n    const accounts = [];\n    for (let key of Object.keys(json)) {\n      if (key === 'teacher') {\n        const teacherObj = jsonParse(_.get(json, `${key}.value`));\n        // when teacher is not empty object\n        if(teacherObj && Object.keys(teacherObj).length) {\n          accounts.push({role: 'teacher', ...teacherObj});\n        }\n        continue;\n      }\n      const student = jsonParse(_.get(json, `${key}.value`));\n      // when student is not empty object\n      if (student && Object.keys(student).length) {\n        student.uid = key;\n        accounts.push(student);\n      }\n    }\n    return accounts;\n  }\n}","import React, { useEffect } from 'react';\nimport Icon from '../components/icon';\nimport _ from 'lodash';\nimport { useLocation } from 'react-router';\n\nexport interface IPlatformContext {\n  platform: string\n  NavBtn: React.FC<any>\n  HomeBtn: React.FC<any>\n  SettingBtn: React.FC<any>\n}\n\nexport interface IWindow {\n  ownerName: string\n  name: string\n  windowId: any\n  image: string\n}\n\nconst PlatformContext: React.Context<IPlatformContext> = React.createContext({} as IPlatformContext);\n\nexport const usePlatform = () => React.useContext(PlatformContext);\n\nexport const PlatformContainer: React.FC<React.ComponentProps<any>> = ({ children }: React.ComponentProps<any>) => {\n\n  const platform = _.get(process.env, 'REACT_APP_RUNTIME_PLATFORM', 'web')\n\n\n  const location = useLocation();\n\n  // @ts-ignore\n  const ipc = window.ipc;\n\n  useEffect(() => {\n    if (!ipc) return;\n    if (location.pathname.match(/classroom|replay/)) {\n      ipc.send('resize-window', {width: 990, height: 706});\n    } else {\n      ipc.send('resize-window', {width: 700, height: 500});\n    }\n  }, [location, ipc]);\n\n  const handleClick = (type: string) => {\n\n    if (!ipc) return;\n    \n    switch (type) {\n      case 'minimum': {\n        ipc.send('minimum');\n        return;\n      }\n      case 'maximum': {\n        ipc.send('maximum');\n        return;\n      }\n      case 'close': {\n        ipc.send('close');\n        return;\n      }\n    }\n  }\n\n  const NavBtn: React.FC<any> = () => {\n    if (platform === 'electron') {\n      return (\n        <div className=\"menu-group\">\n          <Icon className=\"icon-minimum\" icon onClick={() => {\n            handleClick(\"minimum\")\n          }} />\n          <Icon className=\"icon-maximum\" icon onClick={() => {\n            handleClick(\"maximum\")\n          }} />\n          <Icon className=\"icon-close\" icon onClick={() => {\n            handleClick(\"close\")\n          }} />\n        </div>\n      )\n    }\n    return null\n  }\n\n  const HomeBtn: React.FC<any> = ({handleSetting}: any) => {\n    if (platform === 'electron') {\n      return (<>\n        <Icon className=\"icon-setting\" onClick={handleSetting} />\n        <div className=\"icon-container\">\n          <Icon className=\"icon-minimum\" onClick={() => {\n            handleClick(\"minimum\")\n          }}/>\n          <Icon className=\"icon-close\" onClick={() => {\n            handleClick('close')\n          }}/>\n        </div>\n      </>)\n    }\n    return null\n  }\n\n  const SettingBtn: React.FC<any> = () => {\n    if (platform === 'electron') {\n      return (\n        <>\n          <Icon className=\"icon-minimum\" onClick={() => {\n            handleClick(\"minimum\")\n          }}/>\n          <Icon className=\"icon-close\" onClick={() => {\n            handleClick('close')\n          }}/>\n        </>\n      )\n    }\n    return null;\n  }\n\n  const value = {\n    platform,\n    NavBtn,\n    HomeBtn,\n    SettingBtn\n  }\n\n  return (\n    <PlatformContext.Provider value={value}>\n      {children}\n    </PlatformContext.Provider>\n  )\n}","export const APP_ID = process.env.REACT_APP_AGORA_APP_ID as string;\nexport const APP_TOKEN = process.env.REACT_APP_AGORA_APP_TOKEN as string;\nexport const ENABLE_LOG = process.env.REACT_APP_AGORA_LOG as string;\n\nexport const RoomKeyIdentifier = 'agora_meeting_room'\nexport const GlobalKeyIdentifier = 'global_identifier'\nexport const UUIDKeyIdentifier = 'agora_meeting_uuid'\nexport const SessionKeyIdentifier = 'agora_demo_session_profile'","import { RoomMessage } from './agora-rtm-client';\nimport OSS from 'ali-oss';\nimport {get} from 'lodash';\n\nexport interface OSSConfig {\n  accessKeyId: string,\n  accessKeySecret: string,\n  // region: string,\n  endpoint: string,\n  bucket: string,\n  folder: string,\n}\n\nexport const ossConfig: OSSConfig = {\n  \"accessKeyId\": get(process.env, 'REACT_APP_YOUR_OWN_OSS_BUCKET_KEY', 'empty-placeholder'),\n  \"accessKeySecret\": get(process.env, 'REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET', 'empty-placeholder'),\n  \"bucket\": get(process.env, 'REACT_APP_YOUR_OWN_OSS_BUCKET_NAME', 'empty-placeholder'),\n  // \"region\": process.env.REACT_APP_YOUR_OWN_OSS_BUCKET_REGION as string,\n  \"endpoint\": get(process.env, 'REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE', 'empty-placeholder'),\n  \"folder\": get(process.env, 'REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER', 'empty-placeholder'),\n}\n\n// console.log(\"your oss config \", ossConfig)\n\nexport const ossClient = new OSS(ossConfig);\n\nexport function resolveMessage(peerId: string, { cmd, text }: { cmd: number, text?: string }) {\n  let type = '';\n  switch (cmd) {\n    case RoomMessage.acceptCoVideo:\n      type = 'accept co-video'\n      break;\n    case RoomMessage.rejectCoVideo:\n      type = 'reject co-video'\n      break;\n    case RoomMessage.cancelCoVideo:\n      type = 'cancel co-video'\n      break;\n    case RoomMessage.applyCoVideo:\n      type = 'apply co-video'\n      break;\n    case RoomMessage.muteVideo:\n      type = 'mute video'\n      break;\n    case RoomMessage.muteAudio:\n      type = 'mute audio'\n      break;\n    case RoomMessage.unmuteAudio:\n      type = 'unmute audio'\n      break;\n    case RoomMessage.unmuteVideo:\n      type = 'unmute video'\n      break;\n    default:\n      return console.warn(`[RoomMessage] unknown type, from peerId: ${peerId}`);\n  }\n  console.log(`[RoomMessage] [${type}] from peerId: ${peerId}`)\n}\n\nexport interface UserAttrs {\n  uid: string\n  account: string\n  role: string\n  audio: number\n  video: number\n  chat: number\n  whiteboard_uid?: string\n  link_uid?: number\n  shared_uid?: number\n  mute_chat?: number\n  class_state?: number\n}\n\nexport function resolveMediaState(body: any) {\n  const cmd: number = body.cmd;\n  const mediaState = {\n    key: 'unknown',\n    val: -1,\n  }\n  switch (cmd) {\n    case RoomMessage.muteVideo:\n      mediaState.key = 'video'\n      mediaState.val = 0\n      break\n    case RoomMessage.unmuteVideo:\n      mediaState.key = 'video'\n      mediaState.val = 1\n      break\n    case RoomMessage.muteAudio:\n      mediaState.key = 'audio'\n      mediaState.val = 0\n      break\n    case RoomMessage.unmuteAudio:\n      mediaState.key = 'audio'\n      mediaState.val = 1\n      break\n    case RoomMessage.muteChat:\n      mediaState.key = 'chat'\n      mediaState.val = 0\n      break\n    case RoomMessage.unmuteChat:\n      mediaState.key = 'chat'\n      mediaState.val = 1\n      break\n    default:\n      console.warn(\"[rtm-message] unknown message protocol\");\n  }\n  return mediaState;\n}\n\nexport function genUid(): string {\n  const id = +Date.now() % 1000000;\n  return id.toString();\n}\n\nexport function jsonParse(json: string) {\n  try {\n    return JSON.parse(json);\n  } catch (err) {\n    return {};\n  }\n}\n\nexport function resolvePeerMessage(text: string) {\n  const body = jsonParse(text);\n  return body;\n}\n\nexport const resolveFileInfo = (file: any) => {\n  const fileName = encodeURI(file.name);\n  const fileType = fileName.substring(fileName.length, fileName.lastIndexOf('.'));\n  return {\n    fileName,\n    fileType\n  }\n}\n\nconst level = [\n  'unknown',\n  'excellent',\n  'good',\n  'poor',\n  'bad',\n  'very bad',\n  'down'\n];\n\nexport function NetworkQualityEvaluation(evt: { downlinkNetworkQuality: number, uplinkNetworkQuality: number }) {\n  let defaultQuality = 'unknown';\n  const val = Math.max(evt.downlinkNetworkQuality, evt.uplinkNetworkQuality);\n  return level[val] ? level[val] : defaultQuality;\n}\n\nexport function CustomBtoa(input: any) {\n  let keyStr =\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n  let output = \"\";\n  let chr1, chr2, chr3, enc1, enc2, enc3, enc4;\n  let i = 0;\n\n  while (i < input.length) {\n    chr1 = input[i++];\n    chr2 = i < input.length ? input[i++] : Number.NaN; // Not sure if the index\n    chr3 = i < input.length ? input[i++] : Number.NaN; // checks are needed here\n\n    enc1 = chr1 >> 2;\n    enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n    enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n    enc4 = chr3 & 63;\n\n    if (isNaN(chr2)) {\n      enc3 = enc4 = 64;\n    } else if (isNaN(chr3)) {\n      enc4 = 64;\n    }\n    output +=\n      keyStr.charAt(enc1) +\n      keyStr.charAt(enc2) +\n      keyStr.charAt(enc3) +\n      keyStr.charAt(enc4);\n  }\n  return output;\n}","import { APP_ID } from './config';\nimport EventEmitter from 'events';\nimport { RoomStore } from '../stores/room';\nimport { globalStore } from '../stores/global';\nimport { CustomBtoa } from './helper';\n// @ts-ignore\nexport const AgoraRtcEngine = window.rtcEngine;\n\nif (AgoraRtcEngine) {\n  AgoraRtcEngine.initialize(APP_ID);\n  AgoraRtcEngine.setChannelProfile(1);\n  AgoraRtcEngine.enableVideo();\n  AgoraRtcEngine.enableAudio();\n  AgoraRtcEngine.enableWebSdkInteroperability(true);\n  AgoraRtcEngine.setVideoProfile(43, false);\n  //@ts-ignore\n  window.ipc && window.ipc.once(\"initialize\", (events: any, args: any) => {\n    const logPath = args[0]\n    const videoSourceLogPath = args[2];\n    const videoSourceAddonLogPath = args[3];\n    //@ts-ignore\n    window.videoSourceLogPath = videoSourceLogPath;\n    //@ts-ignore\n    window.videoSourceAddonLogPath = videoSourceAddonLogPath;\n    AgoraRtcEngine.setLogFile(logPath)\n  })\n}\n\n//@ts-ignore\nwindow.ipc && window.ipc.on(\"export-log\", (events: any, args: any) => {\n  //@ts-ignore\n  window.doGzip();\n  //@ts-ignore\n  console.log('doGzip', window.doGzip);\n})\n\nexport interface Stream {\n  uid: number\n}\n\nexport enum StreamType {\n  local,\n  remote,\n  localVideoSource,\n  remoteVideoSource,\n}\n\nexport class AgoraElectronStream {\n  public stream: Stream;\n  public playing: boolean = false;\n  private domID: string;\n  constructor(\n    public uid: number = uid,\n    public type: StreamType = StreamType.remote,\n  ) {\n    this.domID = '';\n    this.stream = {\n      uid: this.uid,\n    }\n  }\n}\n\nexport interface ElectronStreamSpec {\n  streamID: number\n  microphoneId?: string\n  cameraId?: string\n  speakerId?: string\n  speakerVolume?: number\n}\n\nexport class AgoraElectronClient {\n\n  public joined: boolean;\n  private readonly bus: EventEmitter;\n  public localUid: number;\n  public rid: string;\n  public readonly rtcEngine: any\n  public published: boolean;\n  public shared: boolean;\n  private roomStore: RoomStore;\n  subscribeVideoSource: boolean = false;\n\n  constructor(deps: {roomStore: RoomStore}) {\n    this.rtcEngine = AgoraRtcEngine;\n    this.published = false;\n    this.localUid = 0;\n    this.joined = false;\n    this.shared = false;\n    this.rid = '';\n    this.bus = new EventEmitter();\n    this.roomStore = deps.roomStore;\n  }\n\n  private isLocal(uid: number) {\n    return this.localUid === uid;\n  }\n\n  createStream ({streamID, microphoneId, cameraId, speakerId, speakerVolume}: ElectronStreamSpec) {\n    if (microphoneId) {\n      const res = this.rtcEngine.setAudioRecordingDevice(microphoneId);\n      res !== 0 && console.warn(`[createStream] set microphone: ${microphoneId} failed`);\n    }\n\n    if (cameraId) {\n      const res = this.rtcEngine.setVideoDevice(cameraId);\n      res !== 0 && console.warn(`[createStream] set cameraId: ${cameraId} failed`);\n    }\n\n    if (speakerId) {\n      const res = this.rtcEngine.setAudioPlaybackDevice(speakerId);\n      res !== 0 && console.warn(`[creaetStream] set speakerId: ${speakerId}`);\n    }\n\n    if (speakerVolume) {\n      const res = this.rtcEngine.setAudioPlaybackVolume(speakerVolume);\n      res !== 0 && console.warn(`[creaetStream] set setAudioPlaybackVolume: ${speakerVolume}`);\n    }\n\n    return new AgoraElectronStream(streamID, +streamID !== +this.roomStore.state.course.screenId ? StreamType.local : StreamType.localVideoSource);\n  }\n\n  private readonly events: string[] = [\n    'joinedchannel',\n    'userjoined',\n    'removestream',\n    'leavechannel',\n    'audiodevicestatechanged',\n    'videodevicestatechanged',\n    'error',\n    'executefailed',\n    'rtcStats',\n    'networkquality',\n    'audioquality',\n  ]\n\n  private _subscribedEvents: any[] = [];\n  private destroyed: boolean = false;\n\n  joinChannel({\n    uid,\n    channel,\n    dual,\n    token\n  }: {\n    uid: number,\n    channel: string,\n    dual: boolean,\n    token: string\n  }): number {\n    this.localUid = uid;\n    this.rid = channel;\n    const rtcEngine = this.rtcEngine;\n    const events = [\n      // 'joinedchannel',\n      // 'userjoined',\n      // 'removestream',\n      'leavechannel',\n      'error',\n      'executefailed',\n      'rtcStats',\n      'networkquality',\n      'audioquality',\n    ]\n    for (let event of events) {\n      this._subscribedEvents.push(event);\n      rtcEngine.on(event, (...args: any[]) => {\n        this.bus.emit(event, ...args);\n      })\n    }\n    rtcEngine.on('joinedchannel', (channel: string, uid: number) => {\n      const stream = new AgoraElectronStream(uid, +uid !== +this.roomStore.state.course.screenId ? StreamType.local : StreamType.localVideoSource);\n      this.bus.emit('joinedchannel', {stream});\n    })\n    rtcEngine.on('userjoined', (uid: number) => {\n      const stream = new AgoraElectronStream(uid, StreamType.remote);\n      console.log(\"userjoined\", uid)\n      this.bus.emit('userjoined', {stream});\n    })\n    rtcEngine.on('removestream', (uid: number) => {\n      this.bus.emit('removestream', {uid});\n    })\n    if (dual) {\n      rtcEngine.enableDualStreamMode(true);\n    }\n    // default role is audience\n    this.rtcEngine.setClientRole(2);\n    // WARN: TOKEN\n    let res = this.rtcEngine.joinChannel(token, channel, '', this.localUid);\n    if(res === 0) {\n      this.joined = true;\n      this.destroyed = false;\n    }\n    return res;\n  }\n\n  leave() {\n    if (!this.joined) return;\n    const result = this.rtcEngine.leaveChannel();\n    this.joined = false;\n    this.localUid = 0;\n    this.rid = '';\n    return result;\n  }\n\n  on(name: string, cb: (...args: any[]) => void) {\n    this.bus.on(name, cb);\n  }\n\n  off(name: string, cb: (...args: any[]) => void) {\n    this.bus.off(name, cb);\n  }\n\n  destroyClient() {\n    if (this.destroyed) return;\n    for (let event of this._subscribedEvents) {\n      this.rtcEngine.off(event, () => {});\n    }\n    this.bus.removeAllListeners();\n    this.destroyed = true;\n  }\n\n  getScreenShareWindows() {\n    const items = this.rtcEngine.getScreenWindowsInfo()\n    return items\n      .map((item: any) => ({\n        ownerName: item.ownerName,\n        name: item.name,\n        windowId: item.windowId,\n        image: CustomBtoa(item.image),\n      }));\n  }\n\n  async startScreenShare(\n    windowId: number,\n    uid: number,\n    channel: string,\n    token: string,\n    appId: string,\n    rect = {x: 0, y: 0, width: 0, height: 0},\n    param = {width: 0, height: 0, bitrate: 500, frameRate: 15}\n  ): Promise<AgoraElectronStream> {\n    console.log(\"[native] start screen share\", token, uid, appId);\n    const shareClient = this.rtcEngine;\n    return new Promise((resolve, reject) => {\n      shareClient.videoSourceInitialize(APP_ID);\n      shareClient.videoSourceSetChannelProfile(1);\n      shareClient.videoSourceEnableWebSdkInteroperability(true);\n      // shareClient.setVideoRenderDimension(3, SHARE_ID, 1280, 960);\n      shareClient.videoSourceSetVideoProfile(50, false);\n      //@ts-ignore\n      if (window.videoSourceLogPath) {\n        //@ts-ignore\n        shareClient.videoSourceSetLogFile(window.videoSourceLogPath)\n        //@ts-ignore\n        console.log(`[native] videoSourceSetLogFile, videoSourceLogPath: `, window.videoSourceLogPath)\n      }\n      //@ts-ignore\n      // if (window.videoSourceAddonLogPath) {\n      //   //@ts-ignore\n      //   shareClient.videoSourceSetAddonLogFile(window.videoSourceAddonLogPath)\n      //   //@ts-ignore\n      //   console.log(`[native] videoSourceSetAddonLogFile, videoSourceAddonLogPath: `, window.videoSourceAddonLogPath)\n      // }\n      // to adjust render dimension to optimize performance\n      console.log(\"[electron-debug] SHARE_ID\", uid, \" TOKEN: \", token, \" CHANNEL\", channel);\n      shareClient.videoSourceJoin(token, channel, '', uid);\n      if (!shareClient.subscribeVideoSource) {\n        shareClient.once('videoSourceJoinedSuccess', (uid: number) => {\n          shareClient.subscribeVideoSource = false;\n          console.log(\"[electron-debug] videoSource Joined\", uid);\n          // shareClient.startScreenCapture2(windowId, 15, rect, 0);\n          shareClient.videoSourceStartScreenCaptureByWindow(windowId, {x: 0, y: 0, width: 0, height: 0}, {width: 0, height: 0, bitrate: 500, frameRate: 15});\n          shareClient.startScreenCapturePreview();\n          // shareClient.videoSourceSetVideoProfile(43, false);\n          // shareClient.startScreenCapture2(windowId, 15, rect, 0);\n          // shareClient.startScreenCapturePreview();\n          this.shared = true;\n\n          const electronStream = new AgoraElectronStream(uid, StreamType.localVideoSource);\n          resolve(electronStream);\n          shareClient.off('videoSourceJoinedSuccess', () => {});\n        });\n\n        shareClient.subscribeVideoSource = true;\n\n        setTimeout(() => {\n          reject();\n        }, 5000);\n      }\n    })\n  }\n\n  async stopScreenShare() {\n    globalStore.showLoading();\n    let stopPromise = new Promise((resolve, reject) => {\n      const onSuccess = () => {\n        this.roomStore.removeLocalSharedStream();\n        this.rtcEngine.off('videoSourceLeaveChannel', (evt: any) => {});\n        globalStore.stopLoading();\n      }\n\n      const onFailure = () => {\n        this.roomStore.removeLocalSharedStream();\n        this.rtcEngine.off('videoSourceLeaveChannel', (evt: any) => {});\n        globalStore.stopLoading();\n      }\n\n      // this.rtcEngine.once('videoSourceLeaveChannel', (evt: any) => {\n      //   onSuccess();\n      // });\n      // this.rtcEngine.videoSourceLeave();\n      this.rtcEngine.videoSourceRelease();\n      this.shared = false;\n      resolve(onSuccess());\n      // setTimeout(() => {\n      //   reject(onFailure())\n      // }, 5000)\n    })\n\n    return await stopPromise;\n  }\n\n  releaseScreenShare() {\n    this.roomStore.removeLocalSharedStream();\n    this.rtcEngine.videoSourceLeave()\n    this.rtcEngine.videoSourceRelease();\n    this.rtcEngine.removeAllListeners();\n    this.shared = false;\n    this.rtcEngine.subscribeVideoSource = false;\n  }\n\n  exit () {\n    try {\n      this.leave();\n    } catch(err) {\n      throw err;\n    } finally {\n      this.destroyClient();\n    }\n  }\n\n  publish() {\n    this.published = true;\n    const res = this.rtcEngine.setClientRole(1);\n    return res;\n  }\n\n  unpublish() {\n    this.published = false;\n    const res = this.rtcEngine.setClientRole(2);\n    return res;\n  }\n}\n\n// export const nativeRTCClient = roomStore.rtcClient as AgoraElectronClient;","import EventEmitter from 'events';\nimport AgoraRTC from 'agora-rtc-sdk';\n\nexport type DeviceInfo = {\n  cameraCanUse: boolean\n  microphoneCanUse: boolean\n  devices: Device[]\n}\n\nAgoraRTC.Logger.enableLogUpload();\nAgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.DEBUG);\nexport interface AgoraStreamSpec {\n  streamID: number\n  video: boolean\n  audio: boolean\n  mirror?: boolean\n  screen?: boolean\n  microphoneId?: string\n  cameraId?: string\n  screenAudio?: boolean\n  audioOutput?: {\n    volume: number\n    deviceId: string\n  }\n}\n\nconst streamEvents: string[] = [\n  'accessAllowed', \n  'accessDenied',\n  'stopScreenSharing',\n  'videoTrackEnded',\n  'audioTrackEnded',\n  'player-status-changed'\n];\n\nconst clientEvents: string[] = [\n  'stream-published',\n  'stream-added',\n  'stream-removed',\n  'stream-subscribed',\n  'peer-online',\n  'peer-leave',\n  'error',\n  'network-type-changed',\n  'network-quality',\n  'exception',\n  'onTokenPrivilegeWillExpire',\n  'onTokenPrivilegeDidExpire',\n]\n\nexport class AgoraRTCClient {\n\n  private streamID: any;\n  public _init: boolean = false;\n  public _joined: boolean = false;\n  public _published: boolean = false;\n  private _internalTimer: NodeJS.Timeout | any;\n  public _client: any = AgoraRTC.createClient({mode: 'live', codec: 'vp8'});\n  public _bus: EventEmitter = new EventEmitter();\n  public _localStream: any = null;\n  public _streamEvents: string[];\n  public _clientEvents: string[];\n  public _addEventListener: boolean = false;\n\n  constructor () {\n    this.streamID = null;\n    this._streamEvents = [];\n    this._clientEvents = [];\n  }\n\n  // init rtc client when _init flag is false;\n  async initClient(appId: string) {\n    if (this._init) return;\n    let prepareInit = new Promise((resolve, reject) => {\n      this._init === false && this._client.init(appId, () => {\n        this._init = true;\n        resolve()\n      }, reject);\n    })\n    await prepareInit;\n  }\n\n  // create rtc client;\n  async createClient(appId: string, enableRtt?: boolean) {\n    await this.initClient(appId);\n    this.subscribeClientEvents();\n    if (enableRtt) {\n      this._internalTimer = setInterval(() => {\n        this._client.getTransportStats((stats: any) => {\n          const RTT = stats.RTT ? stats.RTT : 0;\n          this._bus.emit('watch-rtt', RTT);\n        });\n      }, 100);\n    }\n  }\n\n  destroyClient(): void {\n    this.unsubscribeClientEvents();\n  }\n\n  subscribeClientEvents() {\n    if (this._addEventListener) return\n    this._addEventListener = true\n    for (let evtName of clientEvents) {\n      this._clientEvents.push(evtName);\n      this._client.on(evtName, (args: any) => {\n        this._bus.emit(evtName, args);\n      });\n    }\n  }\n\n  unsubscribeClientEvents() {\n    if (this._addEventListener) {\n      for (let evtName of this._clientEvents) {\n        this._client.off(evtName, () => {});\n        this._clientEvents = this._clientEvents.filter((it: any) => it === evtName);\n      }\n      this._addEventListener = false\n    }\n  }\n\n  subscribeLocalStreamEvents() {\n    for (let evtName of streamEvents) {\n      this._streamEvents.push(evtName);\n      this._localStream.on(evtName, (args: any) => {\n        this._bus.emit(evtName, args);\n      });\n    }\n  }\n\n  unsubscribeLocalStreamEvents() {\n    if (this._localStream) {\n      for (let evtName of this._streamEvents) {\n        this._localStream.removeEventListener(evtName, (args: any[]) => {});\n        this._streamEvents = this._streamEvents.filter((it: any) => it === evtName);\n      }\n    }\n  }\n\n  renewToken(newToken: string) {\n    if (!this._client) return console.warn('renewToken is not permitted, checkout your instance');\n    this._client.renewToken(newToken);\n  }\n\n  removeAllListeners() {\n    console.log('[agora-rtc] prepare remove all event listeners')\n    this.unsubscribeClientEvents();\n    this._bus.removeAllListeners();\n    console.log('[agora-rtc] remove all event listeners');\n  }\n\n  // subscribe\n  on(evtName: string, cb: (args: any) => void) {\n    this._bus.on(evtName, cb);\n  }\n\n  // unsubscribe\n  off(evtName: string, cb: (args: any) => void) {\n    this._bus.off(evtName, cb);\n  }\n\n  async publish() {\n    return new Promise((resolve, reject) => {\n      if (this._published) {\n        return resolve();\n      }\n      this._client.publish(this._localStream, (err: any) => {\n        reject(err);\n      })\n      setTimeout(() => {\n        resolve();\n        this._published = true;\n      }, 300);\n    })\n  }\n\n  async unpublish() {\n    return new Promise((resolve, reject) => {\n      if (!this._published || !this._localStream) {\n        return resolve();\n      }\n      this._client.unpublish(this._localStream, (err: any) => {\n        reject(err);\n      })\n      setTimeout(() => {\n        resolve();\n        this.destroyLocalStream();\n        this._published = false;\n      }, 300);\n    })\n  }\n\n  setRemoteVideoStreamType(stream: any, streamType: number) {\n    this._client.setRemoteVideoStreamType(stream, streamType);\n  }\n\n  async enableDualStream() {\n    return new Promise((resolve, reject) => {\n      this._client.enableDualStream(resolve, reject);\n    });\n  }\n\n  createLocalStream(data: AgoraStreamSpec): Promise<any> {\n    this._localStream = AgoraRTC.createStream({...data, mirror: false});\n    return new Promise((resolve, reject) => {\n      this._localStream.init(() => {\n        this.streamID = data.streamID;\n        this.subscribeLocalStreamEvents();\n        if (data.audioOutput && data.audioOutput.deviceId) {\n          this.setAudioOutput(data.audioOutput.deviceId).then(() => {\n            console.log('setAudioOutput success', data.audioOutput)\n          }).catch((err: any) => {\n            console.warn('setAudioOutput failed', err, JSON.stringify(err))\n          })\n        }\n        resolve();\n      }, (err: any) => {\n        reject(err);\n      })\n    });\n  }\n\n  destroyLocalStream () {\n    this.unsubscribeLocalStreamEvents();\n    if(this._localStream) {\n      if (this._localStream.isPlaying()) {\n        this._localStream.stop();\n      }\n      this._localStream.close();\n    }\n    this._localStream = null;\n    this.streamID = 0;\n  }\n\n  async join (uid: number, channel: string, token?: string) {\n    return new Promise((resolve, reject) => {\n      this._client.join(token, channel, +uid, resolve, reject);\n    })\n  }\n\n  async leave () {\n    if (this._client) {\n      return new Promise((resolve, reject) => {\n        this._client.leave(resolve, reject);\n      })\n    }\n  }\n\n  setAudioOutput(speakerId: string) {\n    return new Promise((resolve, reject) => {\n      if (this._client) {\n        this._client.setAudioOutput(speakerId, resolve, reject);\n        return\n      }\n      resolve()\n    })\n  }\n\n  setAudioVolume(volume: number) {\n    this._client.setAudioVolume(volume);\n  }\n\n  subscribe(stream: any) {\n    this._client.subscribe(stream, {video: true, audio: true}, (err: any) => {\n      console.log('[rtc-client] subscribe failed: ', JSON.stringify(err));\n    });\n  }\n\n  destroy (): void {\n    this._internalTimer && clearInterval(this._internalTimer);\n    this._internalTimer = null;\n    this.destroyLocalStream();\n    this.removeAllListeners();\n  }\n\n  async exit () {\n    try {\n      await this.leave();       \n    } catch (err) {\n      throw err;\n    } finally {\n      this.destroy();\n    }\n  }\n\n  getDevices (): Promise<DeviceInfo> {\n    return new Promise((resolve, reject) => {\n      AgoraRTC.getDevices((devices: any) => {\n        const _devices: any[] = [];\n        devices.forEach((item: any) => {\n          _devices.push({deviceId: item.deviceId, kind: item.kind, label: item.label});\n        })\n        resolve({\n          cameraCanUse: devices.filter((it: any) => it.kind === 'videoinput').length > 0 ? true : false,\n          microphoneCanUse: devices.filter((it: any) => it.kind === 'audioinput').length > 0 ? true : false,\n          devices: _devices,\n        });\n      }, (err: any) => {\n        reject(err);\n      });\n    })\n  }\n\n  async forceGetDevices (): Promise<DeviceInfo> {\n    const tempAudioStream = AgoraRTC.createStream({ audio: true, video: false })\n    const tempVideoStream = AgoraRTC.createStream({ audio: false, video: true })\n\n    const audioPermissionOK = new Promise(resolve => {\n      tempAudioStream.init(() => resolve(null), (err: any) => resolve(err))\n    })\n    const videoPermissionOK = new Promise(resolve => {\n      tempVideoStream.init(() => resolve(null), (err: any) => resolve(err))\n    })\n\n    try {\n      let [microphone, camera] = await Promise.all([audioPermissionOK, videoPermissionOK])\n      let result = await this.getDevices()\n\n      if (microphone !== null) {\n        result.microphoneCanUse = false\n        console.warn(\"create audio temp stream failed!\", microphone)\n      }\n      if (camera !== null) {\n        result.cameraCanUse = false\n        console.warn(\"create video temp stream failed!\", camera)\n      }\n      \n      return result\n    } catch (err) {\n      throw err\n    } finally {\n      tempAudioStream.close()\n      tempVideoStream.close()\n    }\n  }\n}","import { AgoraRTCClient, AgoraStreamSpec, DeviceInfo } from './agora-rtc-client';\nimport { roomStore, RoomStore } from '../stores/room';\nimport { isEmpty } from 'lodash';\nimport EventEmitter from 'events';\nimport AgoraRTC from 'agora-rtc-sdk';\nimport { APP_ID } from './config';\n\nexport const createAudioStream = (microphoneId: string) => {\n  const streamInitPromise = new Promise((resolve, reject) => {\n    const stream = AgoraRTC.createStream({\n      video: false,\n      audio: true,\n      microphoneId\n    })\n    stream.init(\n      () => resolve(stream),\n      (err: any) => reject(err)\n    )\n  })\n  return streamInitPromise\n}\n\nexport const createVideoStream = (cameraId: string) => {\n  const streamInitPromise = new Promise((resolve, reject) => {\n    const stream = AgoraRTC.createStream({\n      video: true,\n      audio: false,\n      cameraId\n    })\n    stream.init(\n      () => resolve(stream),\n      (err: any) => reject(err)\n    )\n  })\n  return streamInitPromise\n}\n\nasync function getConnectedDevices(type: string) {\n  const devices = await navigator.mediaDevices.enumerateDevices();\n  return devices.filter(device => device.kind === type)\n}\n\nexport const getCameraDevices = async () => {\n  const agoraVideoStream = AgoraRTC.createStream({video: true, audio: false})\n  try {\n    const requestVideoPermissionPromise = new Promise((resolve, reject) => {\n      agoraVideoStream.init(() => resolve(null), (err: any) => reject(err))\n    })\n    await requestVideoPermissionPromise\n    let videoDevices = await getConnectedDevices('videoinput');\n    return videoDevices.map((device: any, idx: number) => ({\n      deviceId: device.deviceId,\n      text: device.label ? device.label : `camera-${idx}`\n    }))\n  } catch (err) {\n    console.warn('create video stream failed!', err)\n    throw err\n  } finally {\n    agoraVideoStream.close()\n  }\n}\n\nexport const getMicrophoneDevices = async () => {\n  const agoraAudioStream = AgoraRTC.createStream({video: false, audio: true})\n  try {\n    const requestVideoPermissionPromise = new Promise((resolve, reject) => {\n      agoraAudioStream.init(() => resolve(null), (err: any) => reject(err))\n    })\n    await requestVideoPermissionPromise\n    let videoDevices = await getConnectedDevices('audioinput');\n    return videoDevices.map((device: any, idx: number) => ({\n      deviceId: device.deviceId,\n      text: device.label ? device.label : `microphone-${idx}`\n    }))\n  } catch (err) {\n    console.warn('create audio stream failed!', err)\n    throw err\n  } finally {\n    agoraAudioStream.close()\n  }\n}\n\nexport class AgoraWebClient {\n\n  public readonly rtc: AgoraRTCClient;\n  public shareClient: AgoraRTCClient | any;\n  public localUid: number;\n  public channel: string;\n  public readonly bus: EventEmitter;\n  public shared: boolean;\n  public joined: boolean;\n  public cameraCanUse: boolean;\n  public microphoneCanUse: boolean;\n  public forceGetDevice: boolean;\n  public published: boolean;\n  public tmpStream: any;\n\n  private roomStore: RoomStore;\n\n  constructor(deps: {roomStore: RoomStore}) {\n    this.localUid = 0;\n    this.channel = '';\n    this.rtc = new AgoraRTCClient();\n    this.bus = new EventEmitter();\n    this.shared = false;\n    this.shareClient = null;\n    this.tmpStream = null;\n    this.joined = false;\n    this.published = false;\n\n    this.cameraCanUse = false;\n    this.microphoneCanUse = false;\n    this.forceGetDevice = false;\n    \n    this.roomStore = deps.roomStore;\n  }\n\n  async getDevices () {\n    const client = new AgoraRTCClient()\n    let deviceResult: DeviceInfo = {\n      cameraCanUse: this.cameraCanUse,\n      microphoneCanUse: this.microphoneCanUse,\n      devices: []\n    }\n    try {\n      if (!this.forceGetDevice) {\n        deviceResult = await client.forceGetDevices()\n        this.forceGetDevice = true\n      } else {\n        deviceResult = await client.getDevices()\n      }\n      const {cameraCanUse, microphoneCanUse, devices} = deviceResult\n\n      this.cameraCanUse = cameraCanUse\n      this.microphoneCanUse = microphoneCanUse\n\n      const cameraList = devices.filter((it: any) => it.kind === 'videoinput')\n      const microphoneList = devices.filter((it: any) => it.kind === 'audioinput')\n\n      if (!cameraList.length) {\n        console.warn('cameraList is empty', devices)\n      }\n\n      if (!microphoneList.length) {\n        console.warn('microphoneList is empty', devices)\n      }\n\n      // const cameraId = cameraList[0].deviceId\n      // const microphoneId = microphoneList[0].deviceId\n      await client.initClient(APP_ID)\n      // const params = {\n      //   streamID: 0,\n      //   audio: true,\n      //   video: true,\n      //   screen: false,\n      //   microphoneId,\n      //   cameraId,\n      // }\n      // await client.createLocalStream(params)\n      return devices\n    } catch(err) {\n      throw err\n    } finally {\n      // client.destroyLocalStream()\n    }\n  }\n\n\n  async joinChannel({\n    uid, channel, dual, token, appId\n  }: {\n    uid: number,\n    channel: string,\n    dual: boolean,\n    token: string,\n    appId: string\n  }) {\n    this.localUid = +uid;\n    this.channel = channel;\n    console.log('channel', channel, 'dual', dual, this.localUid, appId)\n    await this.rtc.createClient(appId, true);\n    await this.rtc.join(this.localUid, channel, token);\n    dual && await this.rtc.enableDualStream();\n    this.joined = true;\n    roomStore.setRTCJoined(true);\n    console.log('join web agora sdk rtc success')\n  }\n\n  async leaveChannel() {\n    this.localUid = 0;\n    this.channel = '';\n    try {\n      await this.unpublishLocalStream();\n      await this.rtc.leave();\n      this.joined = false;\n      roomStore.setRTCJoined(false);\n    } catch (err) {\n      throw err;\n    } finally {\n      this.rtc.destroy();\n      this.rtc.destroyClient();\n    }\n  }\n\n  async enableDualStream() {\n    return this.rtc.enableDualStream();\n  }\n\n  async publishLocalStream(data: AgoraStreamSpec) {\n    console.log(' publish local stream ', this.published);\n    if (this.published) {\n      await this.unpublishLocalStream();\n      console.log('[agora-web] unpublished', this.published);\n    }\n\n    if (!data.cameraId || !data.microphoneId) {\n      let devices = await this.getDevices()\n      if (!data.cameraId) {\n        data.cameraId = devices.filter((it: any) => it.kind === 'videoinput')[0].deviceId\n      }\n      if (!data.microphoneId) {\n        data.microphoneId = devices.filter((it: any) => it.kind === 'audioinput')[0].deviceId\n      }\n    }\n\n    await this.rtc.createLocalStream(data);\n    await this.rtc.publish();\n    this.published = true;\n  }\n\n  async unpublishLocalStream() {\n    console.log('[agora-web] invoke unpublishStream');\n    await this.rtc.unpublish();\n    this.published = false;\n  }\n\n  async startScreenShare ({\n    uid, channel, token, appId\n  }: {\n    uid: number,\n    channel: string,\n    token: string,\n    appId: string,\n  }) {\n    console.log('startScreenShare ', uid, channel, token, appId)\n    const shareClient = new AgoraRTCClient();\n    try {\n      await shareClient.createLocalStream({\n        video: false,\n        audio: false,\n        screen: true,\n        screenAudio: true,\n        streamID: uid,\n        microphoneId: '',\n        cameraId: ''\n      })\n      await shareClient.createClient(appId);\n      await shareClient.join(uid, channel, token);\n      await shareClient.publish();\n      this.shared = true;\n      this.shareClient = shareClient\n    } catch(err) {\n      throw err\n    }\n  }\n\n  async stopScreenShare () {\n    await this.shareClient.unpublish();\n    await this.shareClient.leave();\n    this.shareClient.destroy();\n    this.shareClient.destroyClient();\n    this.shared = false;\n    this.shareClient = undefined\n  }\n\n  async exit () {\n    const errors: any[] = [];\n    try {\n      await this.leaveChannel();\n    } catch(err) {\n      errors.push({'rtcClient': err});\n    }\n    if (this.shared === true) {\n      try {\n        await this.shareClient.unpublish();\n        await this.shareClient.leave();\n      } catch (err) {\n        errors.push({'shareClient': err});\n      }\n    }\n    if (this.shareClient) {\n      try {\n        this.shareClient.destroy();\n        this.shareClient.destroyClient();\n      } catch(err) {\n        errors.push({'shareClient': err});\n      }\n    }\n    if (!isEmpty(errors)) {\n      throw errors;\n    }\n  }\n\n  async createPreviewStream({cameraId, microphoneId, speakerId}: any) {\n    const tmpStream = AgoraRTC.createStream({\n      video: true,\n      audio: true,\n      screen: false,\n      cameraId,\n      microphoneId,\n      speakerId\n    });\n\n    if (this.tmpStream) {\n      this.tmpStream.isPlaying() && this.tmpStream.stop();\n      this.tmpStream.close();\n    }\n\n    return new Promise((resolve, reject) => {\n      tmpStream.init(() => {\n        this.tmpStream = tmpStream;\n        resolve(tmpStream);\n      }, (err: any) => {\n        reject(err);\n      })\n    });\n  }\n\n  subscribe(stream: any) {\n    this.rtc.subscribe(stream);\n  }\n\n  setRemoteVideoStreamType(stream: any, type: number) {\n    this.rtc.setRemoteVideoStreamType(stream, type);\n  }\n}","import {globalStore} from '../stores/global'\nimport GlobalStorage from '../utils/custom-storage';\n\nconst key = 'demo-i18n-error'\n\nexport function setIntlError (payload: any) {\n  if (payload) {\n    GlobalStorage.save(key, payload)\n  }\n}\n\nfunction _getIntlError (error: string) {\n  try {\n    const locale = globalStore.getLanguage().match(/^zh/) ? 'zh-cn' : 'en-us';\n    const rawData: any = GlobalStorage.read(key)\n    const json = rawData || {}\n    return json[locale][error]\n  } catch(err) {\n    console.warn(err)\n    return null\n  }\n}\n\nexport function getIntlError (errorCode: string) {\n  const res = _getIntlError(errorCode)\n  // TODO: return errorCode when error message not reached \n  // TODO: 处理错误码\n  if (!res) {\n    return errorCode\n  }\n  return res;\n}","import { globalStore } from \"../stores/global\";\nimport { getIntlError } from '../services/intl-error-helper';\n\nconst FETCH_TIMEOUT = 10000\n\n// const delay = 100;\n\nexport async function Fetch (input: RequestInfo, init?: RequestInit, retryCount: number = 0): Promise<any> {\n  return new Promise((resolve, reject) => {\n    const onResponse = (response: Response) => {\n      if (!response.ok) {\n        reject(new Error(response.statusText))\n      }\n      return response.json().then(resolve).catch(reject)\n    }\n\n    const onError = (error: any) => {\n      // retryCount--;\n      // if (retryCount) {\n      //   setTimeout(fetchRequest, delay);\n      // } else {\n        reject(error);\n      // }\n    }\n\n    const rescueError = (error: any) => {\n      console.warn(error)\n      throw error;\n    }\n\n    function fetchRequest() {\n      return fetch(input, init)\n        .then(onResponse)\n        .catch(onError)\n        .catch(rescueError)\n    }\n\n    fetchRequest();\n\n    if (FETCH_TIMEOUT) {\n      const err = new Error(\"request timeout\")\n      setTimeout(reject, FETCH_TIMEOUT, err)\n    }\n  })\n}\n\nexport async function AgoraFetch(input: RequestInfo, init?: RequestInit, retryCount: number = 0) {\n  try {\n    return await Fetch(input, init, retryCount);\n  } catch(err) {\n    if (err && err.message === 'request timeout') {\n      const code = 408\n      const error = getIntlError(`${code}`)\n      const isErrorCode = `${error}` === `${code}`\n      globalStore.showToast({\n        type: 'eduApiError',\n        message: isErrorCode ? `request timeout` : error\n      })\n      return {code, msg: null, response: null}\n    }\n    throw err\n  }\n}","import { Subject } from 'rxjs';\nexport class RouterHistoryEntity {\n  private subject: Subject<any> | null;\n  public state: any;\n\n  public readonly defaultState: any = {\n    state: 'ready',\n    history: null,\n  }\n\n  constructor() {\n    this.subject = null;\n    this.state = this.defaultState;\n  }\n\n  initialize() {\n    this.subject = new Subject<any>();\n    this.state = {\n      ...this.defaultState,\n    }\n    this.subject.next(this.state);\n  }\n\n  subscribe(updateState: any) {\n    this.initialize();\n    this.subject && this.subject.subscribe(updateState);\n  }\n\n  unsubscribe() {\n    this.subject && this.subject.unsubscribe();\n    this.subject = null;\n  }\n\n  commit (state: any) {\n    this.subject && this.subject.next(state);\n  }\n\n  setHistory(history: any) {\n    if (!this.state) return\n    this.state = {\n      ...this.state,\n      history,\n    }\n    this.commit(this.state)\n  }\n\n  getHistory() {\n    if (!this.state) return\n    return this.state.history\n  }\n}\n\nexport const historyStore = new RouterHistoryEntity();\n\n// TODO: Please remove it before release in production\n// 备注：请在正式发布时删除操作的window属性\n//@ts-ignore\nwindow.historyStore = historyStore","import { BUILD_VERSION, t } from './../i18n';\nimport { AgoraFetch } from \"../utils/fetch\";\nimport { ClassState, AgoraUser, Me } from \"../stores/room\";\nimport {Map} from 'immutable'\nimport {get} from 'lodash'\nimport { getIntlError, setIntlError } from \"./intl-error-helper\";\nimport { globalStore } from \"../stores/global\";\nimport { historyStore } from './../stores/history';\nimport OSS from \"ali-oss\";\nimport axios from 'axios';\n /* eslint-disable */ \nimport Log from '../utils/LogUploader';\n\nconst whiteboardGenerateTokenApiEndpoint = process.env.REACT_APP_YOUR_BACKEND_WHITEBOARD_API as string;\n\nexport interface UserAttrsParams {\n  userId: string\n  enableChat: number\n  enableVideo: number\n  enableAudio: number\n  grantBoard: number\n  // coVideo?: number\n}\n\nconst APP_ID: string = process.env.REACT_APP_AGORA_APP_ID as string;\nconst PREFIX: string = process.env.REACT_APP_AGORA_EDU_ENDPOINT_PREFIX as string;\nconst AUTHORIZATION: string = process.env.REACT_APP_AGORA_RESTFULL_TOKEN as string;\n\nconst AgoraFetchJson = async ({url, method, data, token, full_url}:{url?: string, method: string, data?: any, token?: string, full_url?: string}) => {  \n  const opts: any = {\n    method,\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Basic ${AUTHORIZATION!.replace(/basic\\s+|basic/i, '')}`\n    }\n  }\n\n  if (token) {\n    opts.headers['token'] = token;\n  }\n  if (data) {\n    opts.body = JSON.stringify(data);\n  }\n\n  let resp = undefined;\n  if (full_url) {\n    resp = await AgoraFetch(`${full_url}`, opts);\n  } else {\n    resp = await AgoraFetch(`${PREFIX}${url}`, opts);\n  }\n  const {code, msg, data: responseData} = resp\n\n  if (code !== 0 && code !== 408) {\n    const error = getIntlError(`${code}`)\n    const isErrorCode = `${error}` === `${code}`\n    globalStore.showToast({\n      type: 'eduApiError',\n      message: isErrorCode ? `${msg}` : error\n    })\n    if (code === 401 || code === 1101012) {\n      // historyStore.state.history.goBack()\n      historyStore.state.history.push('/')\n      return\n    }\n    throw {api_error: error, isErrorCode}\n  }\n\n  return responseData\n}\n\nexport interface EntryParams {\n  userName: string\n  roomName: string\n  roomUuid: string\n  userUuid: string\n  type: number\n  role: number\n}\n\nexport type RoomParams = Partial<{\n  muteAllChat: boolean\n  lockBoard: number\n  courseState: number\n  [key: string]: any\n}>\n\ntype FileParams = {\n  file: any,\n  key: string,\n  host: string,\n  policy: any,\n  signature: any,\n  callback: any,\n  accessid: string\n}\n\nconst uploadLogToOSS = async ({\n  file,\n  key,\n  host,\n  policy,\n  signature,\n  callback,\n  accessid\n}: FileParams) => {\n  const formData = new FormData()\n  formData.append('name', 'test.log')\n  formData.append('key', key)\n  formData.append('file', file)\n  formData.append('policy',policy)\n  formData.append('OSSAccessKeyId',accessid)\n  formData.append('success_action_status','200')\n  formData.append('callback',callback)\n  formData.append('signature',encodeURIComponent(signature).replace(/%20/g,'+'))\n  return await axios.post(host, formData, {\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded'}\n  })\n}\n\nexport class AgoraEduApi {\n\n  appID: string = APP_ID;\n  roomId: string = '';\n  public _userToken: string = '';\n\n  public get userToken(): string {\n    const userToken = window.sessionStorage.getItem(\"edu-userToken\") as string || '';\n    return userToken;\n  }\n\n  public set userToken(token: string) {\n    window.sessionStorage.setItem(\"edu-userToken\", token)\n  }\n  \n  recordId: string = '';\n\n  // fetch stsToken\n  // 获取 stsToken\n  async fetchStsToken(roomId: string, fileExt: string) {\n    // NOTE: demo feedback only\n    const appCode = 'edu-demo'\n    const _roomId = roomId ? roomId : 0;\n    let data = await AgoraFetchJson({\n      url: `/v1/log/params?appCode=${appCode}&osType=${3}&terminalType=${3}&appVersion=${BUILD_VERSION}&roomId=${_roomId}&fileExt=${fileExt}&appId=${this.appID}`,\n      method: 'GET',\n    })\n\n    return {\n      bucketName: data.bucketName as string,\n      callbackBody: data.callbackBody as string,\n      callbackContentType: data.callbackContentType as string,\n      accessKeyId: data.accessKeyId as string,\n      accessKeySecret: data.accessKeySecret as string,\n      securityToken: data.securityToken as string,\n      ossKey: data.ossKey as string,\n    }\n  }\n\n  async uploadToOss(roomId: string, file: any, ext: string) {\n    let {\n      bucketName,\n      callbackBody,\n      callbackContentType,\n      accessKeyId,\n      accessKeySecret,\n      securityToken,\n      ossKey\n    } = await this.fetchStsToken(roomId, ext);\n    const ossParams = {\n      bucketName,\n      callbackBody,\n      callbackContentType,\n      accessKeyId,\n      accessKeySecret,\n      securityToken,\n    }\n    const ossClient = new OSS({\n      accessKeyId: ossParams.accessKeyId,\n      accessKeySecret: ossParams.accessKeySecret,\n      stsToken: ossParams.securityToken,\n      bucket: ossParams.bucketName,\n      secure: true,\n      // TODO: 请传递你自己的oss endpoint\n      // TODO: Please use your own oss endpoint\n      endpoint: 'oss-accelerate.aliyuncs.com',\n    })\n\n    const url = `${PREFIX}/v1/log/sts/callback`\n    try {\n      return await ossClient.put(ossKey, file, {\n        callback: {\n          url: `${PREFIX}/v1/log/sts/callback`,\n          body: callbackBody,\n          contentType: callbackContentType,\n        }\n      });\n    } catch(err) {\n      globalStore.showToast({\n        type: 'oss',\n        message: t(\"toast.upload_log_failure\", {reason: err.name})\n      })\n      throw err\n    }\n  }\n\n  async uploadZipLogFile(\n    roomId: string,\n    file: any\n  ) {\n    const res = await this.uploadToOss(roomId, file, 'zip')\n    return res;\n  }\n\n  // upload log\n  async uploadLogFile(\n    roomId: string,\n    file: any\n  ) {\n    const res = await this.uploadToOss(roomId, file, 'log')\n    return res;\n  }\n\n  // fetch i18n\n  static async fetchI18n() {\n    let data = await AgoraFetchJson({\n      url: `/v1/multi/language`,\n      method: 'GET',\n    });\n\n    setIntlError(data || {})\n  }\n\n  // app config\n  // 配置入口\n  // async config() {\n  //   let data = await AgoraFetchJson({\n  //     url: `/v1/config?platform=0&device=0&version=5.2.0`,\n  //     method: 'GET',\n  //   });\n\n  //   if (data['multiLanguage']) {\n  //     setIntlError(data['multiLanguage'])\n  //   }\n\n  //   return {\n  //     appId: data.appId,\n  //     room: data.room,\n  //   }\n  // }\n\n  // room entry\n  // 房间入口\n  async entry(params: EntryParams) {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/entry`,\n      method: 'POST',\n      data: params,\n    });\n    \n    this.roomId = data.roomId;\n    this.userToken = data.userToken;\n    return {\n      data\n    }\n  }\n\n  // refresh token\n  // 刷新token \n  async refreshToken() {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${this.roomId}/token/refresh`,\n      method: 'POST',\n      token: this.userToken,\n    });\n    return {\n      rtcToken: data.rtcToken,\n      rtmToken: data.rtmToken,\n      screenToken: data.screenToken\n    }\n  }\n\n  // update course\n  // 更新课程状态\n  async updateCourse(params: Partial<RoomParams>) {\n    const {room} = params\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${this.roomId}`,\n      method: 'POST',\n      data: room,\n      token: this.userToken,\n    });\n    return {\n      data,\n    }\n  }\n\n  // updateRoomUser\n  // 更新用户状态，老师可更新房间内所有人，学生只能更新自己\n  async updateRoomUser(user: Partial<UserAttrsParams>) {\n    const {userId, ...userAttrs} = user\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${this.roomId}/user/${userId}`,\n      method: 'POST',\n      data: userAttrs,\n      token: this.userToken,\n    });\n    return {\n      data,\n    }\n  }\n\n  // start recording\n  // 开始录制\n  async startRecording(config: RecordingConfig) {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${this.roomId}/record/start`,\n      method: 'POST',\n      data: config,\n      token: this.userToken,\n    });\n    this.recordId = data.recordId\n    return {\n      data\n    }\n  }\n\n  // stop recording\n  // 结束录制\n  async stopRecording(recordId: string) {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${this.roomId}/record/${recordId}/stop`,\n      method: 'POST',\n      token: this.userToken,\n    })\n    return {\n      data\n    }\n  }\n\n  // get recording list\n  // 获取录制列表\n  async getRecordingList () {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${this.roomId}/records`,\n      method: 'GET',\n      token: this.userToken,\n    })\n    return {\n      data\n    }\n  }\n\n  // get whiteboard token\n  async getWhiteboardBy(roomId: string): Promise<any> {\n    let boardData = await AgoraFetchJson({\n      full_url: whiteboardGenerateTokenApiEndpoint.replace(\"%app_id%\", this.appID).replace(\"%room_id%\", roomId),\n      method: 'GET',\n      token: this.userToken,\n    })\n    return {\n      boardId: boardData.boardId,\n      boardToken: boardData.boardToken,\n    };\n  }\n\n  // get room info\n  // 获取房间信息\n  async getRoomInfoBy(roomId: string): Promise<{data: any}> {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${roomId}`,\n      method: 'GET',\n      token: this.userToken,\n    });\n    let boardData = await this.getWhiteboardBy(roomId);\n    return {\n      data: {\n        room: {\n          ...data.room,\n          boardId: boardData.boardId,\n          boardToken: boardData.boardToken,\n        },\n        users: data.room.coVideoUsers,\n        user: data.user\n      }\n    }\n  }\n\n  // getRoomState\n  // 获取用户状态\n  async getRoomState(roomId: string): Promise<{usersMap: Map<string, AgoraUser>, room: Partial<ClassState>, me: Partial<Me>}> {\n    const {data} = await this.getRoomInfoBy(roomId)\n    const {users: rawUsers, room: rawCourse, user: me} = data\n\n    let usersMap: Map<string, AgoraUser> = rawUsers.reduce((acc: Map<string, AgoraUser>, it: any) => {\n      return acc.set(`${it.uid}`, {\n        role: it.role,\n        account: it.userName,\n        uid: it.uid,\n        video: it.enableVideo,\n        audio: it.enableAudio,\n        chat: it.enableChat,\n        grantBoard: it.grantBoard,\n        userId: it.userId,\n        screenId: it.screenId,\n      });\n    }, Map<string, AgoraUser>());\n\n    const room: Partial<ClassState> = {\n      courseState: rawCourse.courseState,\n      muteChat: rawCourse.muteAllChat,\n      isRecording: rawCourse.isRecording,\n      boardId: rawCourse.boardId,\n      boardToken: rawCourse.boardToken,\n      lockBoard: rawCourse.lockBoard,\n      teacherId: '',\n      memberCount: rawCourse.onlineUsers,\n    }\n\n    const teacher = usersMap.find((it: AgoraUser) => it.role === 1)\n\n    if (teacher) {\n      room.teacherId = teacher.uid\n    }\n    \n    if (me.role === 1) {\n      room.teacherId = me.uid\n    }\n\n    return {\n      usersMap,\n      room,\n      me\n    }\n  }\n\n  // getCourseState\n  // 获取房间状态\n  async getCourseState(roomId: string): Promise<Partial<ClassState>> {\n    const {data} = await this.getRoomInfoBy(roomId)\n    const {users, room} = data\n\n    const result: Partial<ClassState> = {\n      roomName: room.roomName,\n      roomId: room.roomId,\n      courseState: room.courseState,\n      roomType: room.type,\n      muteChat: room.muteAllChat,\n      recordId: room.recordId,\n      recordingTime: room.recordingTime,\n      isRecording: Boolean(room.isRecording),\n      boardId: room.boardId,\n      boardToken: room.boardToken,\n      lockBoard: room.lockBoard,\n      memberCount: room.onlineUsers,\n    }\n\n    const teacher = users.find((it: any) => it.role === 1)\n    if (teacher) {\n      result.teacherId = teacher.uid\n      result.screenId = teacher.screenId\n      result.screenToken = teacher.screenToken\n    }\n\n    return result\n  }\n\n  // login 登录教室\n  async Login(params: EntryParams) {\n    if (!this.appID) throw `appId is empty: ${this.appID}`\n    let {data: {roomId, userToken}} = await this.entry(params)\n\n    const {data: {room, user, users: userList = []}} = await this.getRoomInfoBy(roomId)\n\n    const me = user\n\n    const teacherState = userList.find((user: any) => +user.role === 1)\n\n    const course: any = {\n      rid: room.channelName,\n      roomName: room.roomName,\n      channelName: room.channelName,\n      roomId: room.roomId,\n      roomType: room.type,\n      courseState: room.courseState,\n      muteAllChat: room.muteAllChat,\n      isRecording: room.isRecording,\n      recordId: room.recordId,\n      recordingTime: room.recordingTime,\n      boardId: room.boardId,\n      boardToken: room.boardToken,\n      lockBoard: room.lockBoard,\n      teacherId: 0\n    }\n\n    if (teacherState) {\n      course.teacherId = +teacherState.uid\n    }\n\n    if (me.role === 1) {\n      course.teacherId = me.uid\n    }\n\n    if (params.userUuid) {\n      me.uuid = params.userUuid\n    }\n\n    const coVideoUids = userList.map((it: any) => `${it.uid}`)\n\n    if (course.teacherId && coVideoUids.length) {\n      course.coVideoUids = coVideoUids.filter((uid: any) => `${uid}` !== `${course.teacherId}`)\n    }\n\n    const result = {\n      course,\n      me,\n      users: userList,\n      appID: this.appID,\n      onlineUsers: room.onlineUsers,\n    }\n\n    return result\n  }\n\n  async fetchRoomBy(roomId: string) {\n    if (!this.appID) throw `appId is empty: ${this.appID}`\n    this.roomId = roomId;\n    const {data: {room, user, users: userList = []}} = await this.getRoomInfoBy(roomId)\n\n    const me = user\n\n    const teacherState = userList.find((user: any) => +user.role === 1)\n\n    const course: any = {\n      rid: room.channelName,\n      roomName: room.roomName,\n      channelName: room.channelName,\n      roomId: room.roomId,\n      roomType: room.type,\n      courseState: room.courseState,\n      muteAllChat: room.muteAllChat,\n      isRecording: room.isRecording,\n      recordId: room.recordId,\n      recordingTime: room.recordingTime,\n      boardId: room.boardId,\n      boardToken: room.boardToken,\n      lockBoard: room.lockBoard,\n      teacherId: 0\n    }\n\n    if (teacherState) {\n      course.teacherId = +teacherState.uid\n    }\n\n    if (me.role === 1) {\n      course.teacherId = me.uid\n    }\n\n    const coVideoUids = userList.map((it: any) => `${it.uid}`)\n\n    if (course.teacherId && coVideoUids.length) {\n      course.coVideoUids = coVideoUids.filter((uid: any) => `${uid}` !== `${course.teacherId}`)\n    }\n\n    const result = {\n      course,\n      me,\n      users: userList,\n      appID: this.appID,\n      onlineUsers: room.onlineUsers,\n    }\n\n    return result;\n  }\n\n  async getCourseRecordBy(recordId: string, roomId: string, token: string) {\n    this.userToken = token\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${roomId}/record/${recordId}`,\n      method: 'GET',\n      token: this.userToken,\n    });\n\n    const boardData = await this.getWhiteboardBy(roomId);\n    const teacherRecord = get(data, 'recordDetails', []).find((it:any) => it.role === 1)\n\n    const recordStatus = [\n      'recording',\n      'finished',\n      'finished_recording_to_be_download',\n      'finished_download_to_be_convert',\n      'finished_convert_to_be_upload'\n    ]\n\n    const result = {\n      boardId: boardData.boardId,\n      boardToken: boardData.boardToken,\n      startTime: data.startTime,\n      endTime: data.endTime,\n      url: teacherRecord?.url,\n      status: data.status,\n      statusText: recordStatus[data.status],\n    }\n    return result\n  }\n\n  async exitRoom(roomId: string) {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${roomId}/exit`,\n      method: 'POST',\n      token: this.userToken,\n      data: {\n        appId: this.appID,\n        roomId: roomId\n      }\n    })\n    return\n  }\n\n  // NOTE: student send apply\n  // NOTE: 学生发起连麦申请\n  async studentSendApply(roomId: string) {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${roomId}/covideo`,\n      method: 'POST',\n      token: this.userToken,\n      data: {\n        type: 1\n      }\n    })\n    return data;\n  }\n\n  // NOTE: student stop apply\n  // NOTE: 学生主动取消连麦申请\n  async studentStopCoVideo(roomId: string) {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${roomId}/covideo`,\n      method: 'POST',\n      token: this.userToken,\n      data: {\n        type: 6,\n      }\n    })\n    return data;\n  }\n\n  // NOTE: teacher accept apply\n  // NOTE: 教师同意学生申请\n  async teacherAcceptApply(roomId: string, userId: string) {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${roomId}/covideo`,\n      method: 'POST',\n      token: this.userToken,\n      data: {\n        type: 4,\n        userIds: [userId]\n      }\n    })\n    return data;\n  }\n\n  // NOTE: teacher reject apply\n  // NOTE: 教师拒绝学生连麦\n  async teacherRejectApply(roomId: string, userId: string) {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${roomId}/covideo`,\n      method: 'POST',\n      token: this.userToken,\n      data: {\n        type: 2,\n        userIds: [userId]\n      }\n    })\n    return data;\n  }\n\n  // NOTE: teacher cancel apply\n  // NOTE: 教师取消学生连麦\n  async teacherCancelStudent(roomId: string, userId: string) {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${roomId}/covideo`,\n      method: 'POST',\n      token: this.userToken,\n      data: {\n        type: 5,\n        userIds: [userId]\n      }\n    })\n    return data;\n  }\n\n  // NOTE: send channel message\n  // NOTE: 发送聊天消息\n  async sendChannelMessage(payload: any) {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${payload.roomId}/chat`,\n      method: 'POST',\n      token: this.userToken,\n      data: {\n        message: payload.message,\n        type: payload.type\n      }\n    })\n\n    return data;\n  }\n\n  async startScreenShare(roomId: string) {\n    let data = await AgoraFetchJson({\n      url: `/v1/apps/${this.appID}/room/${roomId}/screen`,\n      method: 'POST',\n      token: this.userToken,\n      data: {\n        state: 1\n      }\n    })\n    return data;\n  }\n}\n\nexport const eduApi = new AgoraEduApi();\n\nexport const fetchI18n = async () => {\n  await AgoraEduApi.fetchI18n();\n}\n","import { platform } from '@/utils/platform';\nimport { AgoraElectronClient } from '@/utils/agora-electron-client';\nimport { ChatMessage, AgoraStream } from '../utils/types';\nimport { Subject } from 'rxjs';\nimport { Map, Set, List } from 'immutable';\nimport AgoraRTMClient, { RoomMessage, CoVideoType } from '../utils/agora-rtm-client';\nimport { globalStore } from './global';\nimport {AgoraWebClient} from '../utils/agora-web-client';\nimport { get, set } from 'lodash';\nimport { isElectron } from '../utils/platform';\nimport GlobalStorage from '../utils/custom-storage';\nimport { t } from '../i18n';\nimport { CustomBtoa } from '@/utils/helper';\nimport { eduApi, UserAttrsParams } from '../services/edu-api';\n\nexport interface NotifyFlag {\n  broad: boolean\n}\n\nexport type LocalAttrs = Partial<AgoraUser & ClassState & {rawAccounts: any[]} & {broad: boolean}>;\n\nexport interface AgoraUser {\n  uid: string\n  account: string\n  role: number\n  video: number\n  audio: number\n  chat: number\n  grantBoard: number\n  userId: string // 仅用于服务端\n  screenId: string //仅用于屏幕共享\n}\n\nexport interface Me extends AgoraUser {\n  rtmToken: string\n  rtcToken: string\n  channelName: string\n  screenToken?: string\n  appID: string\n  coVideo: number\n  uuid: string\n}\n\nexport interface ClassState {\n  rid: string\n  roomName: string\n  teacherId: string\n  boardId: string // whiteboard_uuid\n  boardToken: string // whiteboard_token\n  // edu roomId\n  // 房间id\n  roomId: string\n\n  // edu roomType\n  // 房间类型\n  roomType: number\n\n  // lock board\n  // 锁定\n  lockBoard: number // lock_board\n\n  // start class\n  // 开始上课\n  courseState: number\n  // mute all chat\n  // 全员禁言\n  muteChat: number\n  // recording \n  recordId: string\n  recordingTime: number\n  isRecording: boolean\n  screenId: string\n  screenToken: string\n  coVideoUids: string[]\n  memberCount: number\n}\n\ntype RtcState = {\n  published: boolean\n  joined: boolean\n  users: Set<number>\n  shared: boolean\n  localStream: AgoraMediaStream | null\n  localSharedStream: AgoraMediaStream | null\n  remoteStreams: Map<string, AgoraMediaStream>\n}\n\nexport type MediaDeviceState = {\n  microphoneId: string\n  speakerId: string\n  cameraId: string\n  speakerVolume: number\n  camera: number\n  microphone: number\n  speaker: number\n}\n\nexport type SessionInfo = {\n  uid: string\n  rid: string\n  account: string\n  roomName: string\n  roomType: number\n  role: string\n}\n\nexport type RtmState = {\n  joined: boolean\n}\n\nexport type UserParams = {\n  userId: string,\n  account: string,\n}\n\nexport type RoomState = {\n  rtmLock: boolean\n  rtmToken: string\n  recordLock: boolean\n  rtcToken: string\n  appID: string\n  me: Me\n  users: Map<string, AgoraUser>\n  course: ClassState\n  applyUser: UserParams\n  rtc: RtcState\n  rtm: RtmState\n  mediaDevice: MediaDeviceState\n  messages: List<ChatMessage>\n  language: string\n}\n\nexport type AgoraMediaStream = {\n  streamID: number\n  stream?: any\n}\n\nexport class RoomStore {\n  private subject: Subject<RoomState> | null;\n  public _state: RoomState;\n\n  get state() {\n    return this._state;\n  }\n\n  set state(newState) {\n    this._state = newState;\n  }\n  public readonly defaultState: RoomState = Object.freeze({\n    rtmLock: false,\n    rtcToken: '',\n    rtmToken: '',\n    appID: '',\n    recordLock: false,\n    me: {\n      account: \"\",\n      uid: \"\",\n      roomToken: \"\",\n      role: 0,\n      video: 1,\n      audio: 1,\n      chat: 1,\n      grantBoard: 0,\n      rtmToken: '',\n      rtcToken: '',\n      appID: '',\n      coVideo: '',\n    },\n    users: Map<string, AgoraUser>(),\n    applyUser: {\n      userId: '',\n      account: '',\n    },\n    rtm: {\n      joined: false,\n    },\n    rtc: {\n      published: false,\n      joined: false,\n      shared: false,\n      users: Set<number>(),\n      localStream: null,\n      localSharedStream: null,\n      remoteStreams: Map<string, AgoraMediaStream>(),\n    },\n    course: {\n      teacherId: '',\n      boardId: '',\n      boardToken: '',\n      courseState: 0,\n      muteChat: 0,\n      isRecording: false,\n      recordId: '',\n      recordingTime: 0,\n      rid: '',\n      roomName: '',\n      roomType: 0,\n      lockBoard: 0,\n      roomId: '',\n      screenId: '',\n      screenToken: '',\n\n    },\n    mediaDevice: {\n      microphoneId: '',\n      speakerId: '',\n      cameraId: '',\n      speakerVolume: 100,\n      camera: 0,\n      speaker: 0,\n      microphone: 0\n    },\n    messages: List<ChatMessage>(),\n    language: navigator.language,\n    ...GlobalStorage.read('agora_room')\n  });\n\n  public windowId: number = 0;\n\n  // public rtmClient: AgoraRTMClient = new AgoraRTMClient();\n  // public rtcClient: AgoraWebClient | AgoraElectronClient = isElectron ? new AgoraElectronClient() : new AgoraWebClient();\n\n  public rtmClient: AgoraRTMClient;\n  public rtcClient: AgoraWebClient | AgoraElectronClient;\n\n  constructor() {\n    this.subject = null;\n    this._state = {\n      ...this.defaultState\n    };\n    this.rtmClient = new AgoraRTMClient();\n    this.rtcClient = isElectron ? new AgoraElectronClient ({roomStore: this}) : new AgoraWebClient({roomStore: this});\n  }\n\n  initialize() {\n    this.subject = new Subject<RoomState>();\n    this.state = {\n      ...this.defaultState,\n    }\n    this.subject.next(this.state);\n  }\n\n  subscribe(updateState: any) {\n    this.initialize();\n    this.subject && this.subject.subscribe(updateState);\n  }\n\n  unsubscribe() {\n    this.subject && this.subject.unsubscribe();\n    this.subject = null;\n  }\n\n  commit(state: RoomState) {\n    this.subject && this.subject.next(state);\n  }\n\n  updateState(rootState: RoomState) {\n    this.state = {\n      ...this.state,\n      ...rootState,\n    }\n    this.commit(this.state);\n  }\n\n  isTeacher(peerId: string) {\n    if (!`${peerId}`\n      || !`${this.state.course.teacherId}`\n      || `${this.state.course.teacherId}` !== `${peerId}`\n    ) return false;\n    return true;\n  }\n\n  isStudent(peerId: string) {\n    if (!`${peerId}`\n      || `${this.state.course.teacherId}` === `${peerId}`\n    ) return false;\n\n    return true;\n  }\n\n  updateRecordState(params: RecordStateParams) {\n    this.state = {\n      ...this.state,\n      course: {\n        ...this.state.course,\n        roomId: params.roomId,\n        recordId: params.recordId,\n        recordingTime: params.recordingTime,\n        isRecording: !!params.isRecording,\n      },\n    }\n\n    console.log(\">>>: updateRecordState \", params)\n    this.commit(this.state)\n  }\n\n  async fetchCurrentRoom() {\n    try {\n      const res = await eduApi.fetchRoomBy(roomStore.state.course.roomId);\n      const {\n        course,\n        me,\n        users: rawUsers,\n        appID,\n        onlineUsers\n      } = res\n\n      let users = rawUsers.reduce((acc: Map<string, AgoraUser>, it: any) => {\n        return acc.set(`${it.uid}`, {\n          role: it.role,\n          account: it.userName,\n          uid: it.uid,\n          video: it.enableVideo,\n          audio: it.enableAudio,\n          chat: it.enableChat,\n          grantBoard: it.grantBoard,\n          userId: it.userId,\n          screenId: it.screenId,\n        });\n      }, Map<string, AgoraUser>());\n\n      await this.rtmClient.login(appID, `${me.uid}`, me.rtmToken)\n      await this.rtmClient.join(course.rid)\n      this.state = {\n        ...this.state,\n        rtm: {\n          ...this.state.rtm,\n          joined: true,\n        },\n        course: {\n          ...this.state.course,\n          rid: course.channelName,\n          roomType: course.roomType,\n          roomId: course.roomId,\n          roomName: course.roomName,\n          courseState: course.courseState,\n          muteChat: course.muteAllChat,\n          recordId: `${course.recordId}`,\n          isRecording: course.isRecording,\n          recordingTime: course.recordingTime,\n          lockBoard: course.lockBoard,\n          boardId: `${course.boardId}`,\n          boardToken: `${course.boardToken}`,\n          teacherId: `${course.teacherId}`,\n          screenId: `${me.screenId}`,\n          screenToken: `${me.screenToken}`,\n          coVideoUids: course.coVideoUids,\n          memberCount: +onlineUsers,\n        },\n        me: {\n          ...this.state.me,\n          uid: me.uid,\n          account: me.userName,\n          rtmToken: me.rtmToken,\n          rtcToken: me.rtcToken,\n          channelName: me.channelName,\n          screenId: me.screenId,\n          screenToken: me.screenToken,\n          appID: me.appID,\n          role: me.role,\n          chat: me.enableChat,\n          video: me.enableVideo,\n          audio: me.enableAudio,\n          userId: me.userId,\n          coVideo: me.coVideo,\n        },\n        users,\n        appID,\n      }\n      this.commit(this.state)\n    } catch(err) {\n      if (this.rtmClient._logged) {\n        await this.rtmClient.logout();\n      }\n      throw err;\n    }\n  }\n\n  addLocalStream(stream: AgoraStream) {\n    this.state = {\n      ...this.state,\n      rtc: {\n        ...this.state.rtc,\n        localStream: stream\n      }\n    }\n    this.commit(this.state);\n  }\n\n  removeLocalStream() {\n    this.state = {\n      ...this.state,\n      rtc: {\n        ...this.state.rtc,\n        localStream: null,\n        localSharedStream: null\n      }\n    }\n    this.commit(this.state);\n  }\n\n  addLocalSharedStream(stream: any) {\n    this.state = {\n      ...this.state,\n      rtc: {\n        ...this.state.rtc,\n        localSharedStream: stream\n      }\n    }\n    this.commit(this.state);\n  }\n\n  removeLocalSharedStream() {\n    this.state = {\n      ...this.state,\n      rtc: {\n        ...this.state.rtc,\n        localSharedStream: null\n      }\n    }\n    this.commit(this.state);\n  }\n\n  addRTCUser(uid: number) {\n    this.state = {\n      ...this.state,\n      rtc: {\n        ...this.state.rtc,\n        users: this.state.rtc.users.add(uid),\n      }\n    }\n    this.commit(this.state);\n  }\n\n  removePeerUser(uid: number) {\n    this.state = {\n      ...this.state,\n      rtc: {\n        ...this.state.rtc,\n        users: this.state.rtc.users.delete(uid),\n      }\n    }\n    this.commit(this.state);\n  }\n\n  addRemoteStream(stream: AgoraStream) {\n    this.state = {\n      ...this.state,\n      rtc: {\n        ...this.state.rtc,\n        remoteStreams: this.state.rtc.remoteStreams.set(`${stream.streamID}`, stream)\n      }\n    }\n    this.commit(this.state);\n  }\n\n  removeRemoteStream(uid: number) {\n    const remoteStream = this.state.rtc.remoteStreams.get(`${uid}`);\n    if (platform === 'web') {\n      if (remoteStream && remoteStream.stream && remoteStream.stream.isPlaying) {\n        remoteStream.stream.isPlaying() && remoteStream.stream.stop();\n      }\n    }\n\n    this.state = {\n      ...this.state,\n      rtc: {\n        ...this.state.rtc,\n        remoteStreams: this.state.rtc.remoteStreams.delete(`${uid}`)\n      }\n    }\n    this.commit(this.state);\n  }\n\n  updateRtc(newState: any) {\n    this.state = {\n      ...this.state,\n      rtc: {\n        ...this.state.rtc,\n        ...newState,\n      }\n    }\n    this.commit(this.state);\n  }\n\n  updateDevice(state: MediaDeviceState) {\n    this.state = {\n      ...this.state,\n      mediaDevice: state\n    }\n    this.commit(this.state);\n  }\n\n  async sendChannelMessage(args: any) {\n    await eduApi.sendChannelMessage({\n      roomId: this.state.course.roomId,\n      message: args.message,\n      type: 1,\n    })\n  }\n\n  async handlePeerMessage(body: any, peerId: string) {\n    const {cmd, data: {userName, userId, type}} = body\n    if (cmd !== 1) return\n\n    // student follow teacher peer message\n    // 当对端是老师的时候\n    // if (!this.isTeacher(myUid) && this.isTeacher(peerId)) {\n    switch (type) {\n      case CoVideoType.teacherSendReject: {\n        globalStore.showToast({\n          type: 'co-video',\n          message: t(\"toast.teacher_reject_co_video\")\n        });\n        return;\n      }\n      case CoVideoType.studentSendApply: {\n        if (globalStore.state.notice.reason === 'peer_hands_up'\n          && this.state.applyUser.userId) {\n          // when notice is peer_hands_up, ignore peer message\n          // 当已经收到消息以后屏蔽这条\"举手申请\"\n          console.warn(`ignore: `, peerId, userId, type, userName)\n          return\n        }\n        const applyUserId = userId\n\n        if (applyUserId && peerId) {\n          this.updateApplyUser({\n            account: `${userName}`,\n            userId: `${applyUserId}`,\n          });\n          globalStore.showNotice({\n            reason: 'peer_hands_up',\n            text: t('notice.student_interactive_apply', { reason: `${userName}` })\n          });\n          globalStore.showToast({\n            type: 'peer_hands_up', \n            message: t('toast.student_send_co_video_apply', { reason: `${userName}` })\n          });\n          return\n        }\n      }\n      case CoVideoType.teacherSendAccept: {\n        globalStore.showToast({\n          type: 'peer_hands_up',\n          message: t('toast.teacher_accept_co_video', { reason: `${userName}` }),\n        });\n        return;\n      }\n      case CoVideoType.teacherSendStop: {\n        globalStore.showToast({\n          type: 'peer_hands_up',\n          message: t('toast.stop_co_video', { reason: `${userName}` }),\n        });\n        return;\n      }\n    }\n  }\n\n  async mute(uid: string, type: string) {\n    const me = this.state.me;\n    if (`${me.uid}` === `${uid}`) {\n      if (type === 'audio') {\n        await this.updateLocalMe({\n          audio: 0,\n          broad: true\n        });\n      }\n      if (type === 'video') {\n        await this.updateLocalMe({\n          video: 0,\n          broad: true\n        });\n      }\n      if (type === 'chat') {\n        await this.updateLocalMe({\n          chat: 0,\n          broad: true\n        });\n      }\n      // if (type === 'grantBoard') {\n      //   await this.updateLocal({\n      //     grantBoard: 0\n      //   });\n      // }\n    }\n    else if (me.role === 1) {\n      if (type === 'audio') {\n        await this.updateUserBy(`${uid}`, {audio: 0});\n      }\n      if (type === 'video') {\n        await this.updateUserBy(`${uid}`, {video: 0});\n      }\n      if (type === 'chat') {\n        await this.updateUserBy(`${uid}`, {chat: 0});\n      }\n      if (type === 'grantBoard') {\n        await this.updateUserBy(`${uid}`, {grantBoard: 0});\n      }\n    }\n  }\n\n  async unmute(uid: string, type: string) {\n    const me = this.state.me;\n    if (`${me.uid}` === `${uid}`) {\n      if (type === 'audio') {\n        await this.updateLocalMe({\n          audio: 1,\n          broad: true\n        });\n      }\n      if (type === 'video') {\n        await this.updateLocalMe({\n          video: 1,\n          broad: true\n        });\n      }\n      if (type === 'chat') {\n        await this.updateLocalMe({\n          chat: 1,\n          broad: true\n        });\n      }\n      // if (type === 'grantBoard') {\n      //   await this.updateLocal({\n      //     grantBoard: 1\n      //   });\n      // }\n    }\n    else if (me.role === 1) {\n      if (type === 'audio') {\n        await this.updateUserBy(`${uid}`, {audio: 1});\n      }\n      if (type === 'video') {\n        await this.updateUserBy(`${uid}`, {video: 1});\n      }\n      if (type === 'chat') {\n        await this.updateUserBy(`${uid}`, {chat: 1});\n      }\n      if (type === 'grantBoard') {\n        await this.updateUserBy(`${uid}`, {grantBoard: 1});\n      }\n    }\n  }\n\n  async LoginToRoom(payload: any, pass: boolean = false) {\n    const {userName, roomName, role, type, uuid} = payload\n    try {\n      const res = await eduApi.Login({\n        userName,\n        roomName,\n        role,\n        type,\n        roomUuid: roomName,\n        userUuid: uuid\n      })\n\n      const {\n        course,\n        me,\n        users: rawUsers,\n        appID,\n        onlineUsers\n      } = res\n\n      let users = rawUsers.reduce((acc: Map<string, AgoraUser>, it: any) => {\n        return acc.set(`${it.uid}`, {\n          role: it.role,\n          account: it.userName,\n          uid: it.uid,\n          video: it.enableVideo,\n          audio: it.enableAudio,\n          chat: it.enableChat,\n          grantBoard: it.grantBoard,\n          userId: it.userId,\n          // coVideo: 1,\n          screenId: it.screenId,\n        });\n      }, Map<string, AgoraUser>());\n\n      await this.rtmClient.login(appID, `${me.uid}`, me.rtmToken)\n      await this.rtmClient.join(course.rid)\n      this.state = {\n        ...this.state,\n        rtm: {\n          ...this.state.rtm,\n          joined: true,\n        },\n        course: {\n          ...this.state.course,\n          rid: course.channelName,\n          roomType: course.roomType,\n          roomId: course.roomId,\n          roomName: course.roomName,\n          courseState: course.courseState,\n          muteChat: course.muteAllChat,\n          recordId: `${course.recordId}`,\n          isRecording: course.isRecording,\n          recordingTime: course.recordingTime,\n          lockBoard: course.lockBoard,\n          boardId: `${course.boardId}`,\n          boardToken: `${course.boardToken}`,\n          teacherId: `${course.teacherId}`,\n          screenId: `${me.screenId}`,\n          screenToken: `${me.screenToken}`,\n          coVideoUids: course.coVideoUids,\n          memberCount: +onlineUsers,\n        },\n        me: {\n          ...this.state.me,\n          uid: me.uid,\n          account: me.userName,\n          rtmToken: me.rtmToken,\n          rtcToken: me.rtcToken,\n          channelName: me.channelName,\n          screenId: me.screenId,\n          screenToken: me.screenToken,\n          appID: me.appID,\n          role: me.role,\n          chat: me.enableChat,\n          video: me.enableVideo,\n          audio: me.enableAudio,\n          userId: me.userId,\n          coVideo: me.coVideo,\n        },\n        users,\n        appID,\n      }\n      this.commit(this.state)\n    } catch(err) {\n      if (this.rtmClient._logged) {\n        await this.rtmClient.logout();\n      }\n      throw err;\n    }\n  }\n\n  setRTCJoined(joined: boolean) {\n    this.state = {\n      ...this.state,\n      rtc: {\n        ...this.state.rtc,\n        joined\n      }\n    }\n    this.commit(this.state);\n  }\n\n  updateChannelMessage(msg: ChatMessage) {\n    this.state = {\n      ...this.state,\n      messages: this.state.messages.push(msg)\n    };\n\n    this.commit(this.state);\n  }\n\n  private compositeMe(params: Partial<Me>): Me {\n    console.log(\"compositeMe: \", params);\n    const newMe: Me = { ...this.state.me };\n    for (const prop in params) {\n      if (newMe.hasOwnProperty(prop) && params.hasOwnProperty(prop)) {\n        set(newMe, prop, get(params, prop, ''));\n      }\n    }\n    return newMe;\n  }\n\n  private compositeCourse(params: Partial<ClassState>): ClassState {\n    console.log(\"compositeCourse: \", params);\n    const newCourse = { ...this.state.course };\n    for (const prop in params) {\n      if (newCourse.hasOwnProperty(prop) && params.hasOwnProperty(prop)) {\n        set(newCourse, prop, get(params, prop, ''));\n      }\n    }\n    return newCourse;\n  }\n\n  async fetchCourse() {\n    let course = await eduApi.getCourseState(this.state.course.roomId)\n    return await this.updateCourse({...course, broad: false})\n  }\n\n  async fetchRoomState() {\n    let {usersMap, room, me} = await eduApi.getRoomState(this.state.course.roomId)\n    return await this.updateRoomState({usersMap, room, me, broad: false})\n  }\n\n  async updateRoomState(params: {usersMap: Map<string, AgoraUser>, room: Partial<ClassState>, me: Partial<Me>} & NotifyFlag) {\n    const {usersMap, room, me} = params\n\n    const teacherId = room.teacherId as string\n\n    let coVideoUids = this.state.course.coVideoUids\n\n    if (usersMap.count()) {\n      const ids: any[] = []\n      const usersJson = usersMap.toJSON()\n      for (let key of Object.keys(usersJson)) {\n        ids.push(`${key}`)\n      }\n      coVideoUids = ids.filter((id: string) => `${id}` !== `${teacherId}`)\n    }\n\n    const newMe = me\n\n    this.state = {\n      ...this.state,\n      course: {\n        ...this.state.course,\n        ...room,\n        coVideoUids,\n      },\n      me: {\n        ...this.state.me,\n        ...newMe\n      },\n      users: usersMap,\n    }\n    this.commit(this.state)\n  }\n\n  async updateLocalMe(params: Partial<Me & NotifyFlag>) {\n    const {broad, ...meParams} = params\n    const newMe = this.compositeMe(meParams)\n\n    const newMeAttrs = {\n      uid: newMe.uid,\n      account: newMe.account,\n      role: newMe.role,\n      video: newMe.video,\n      audio: newMe.audio,\n      chat: newMe.chat,\n      grantBoard: newMe.grantBoard,\n      coVideo: newMe.coVideo,\n      userId: newMe.userId,\n      screenId: newMe.screenId,\n    }\n\n    const userAttrsParams: UserAttrsParams = {\n      userId: newMeAttrs.userId as string,\n      enableChat: newMeAttrs.chat as number,\n      enableAudio: newMeAttrs.audio as number,\n      enableVideo: newMeAttrs.video as number,\n      grantBoard: newMeAttrs.grantBoard as number,\n      // coVideo: newMeAttrs.coVideo as number\n    }\n\n    if (broad) {\n      await this.updateRoomUser({user: userAttrsParams})\n    }\n\n    this.state = {\n      ...this.state,\n      me: {\n        ...this.state.me,\n        ...newMeAttrs,\n      },\n      users: this.state.users.set(`${this.state.me.uid}`, newMeAttrs)\n    }\n    this.commit(this.state)\n  }\n\n  async updateRoomUser({user}: {user: UserAttrsParams}) {\n    return await eduApi.updateRoomUser(user)\n  }\n\n  updateApplyUser(user: any) {\n    this.state = {\n      ...this.state,\n      applyUser: user\n    }\n    this.commit(this.state)\n  }\n\n  async updateUserBy(uid: string, params: Partial<AgoraUser & NotifyFlag>) {\n    const {broad = true, ...userParams} = params\n    const prevUser = this.state.users.get(`${uid}`)\n    \n    const newUserAttrs: Partial<AgoraUser> = {\n      ...prevUser,\n    }\n\n    const userKeys = Object.keys(userParams)\n\n    for (let key of userKeys) {\n      if (newUserAttrs.hasOwnProperty(key)\n        && userParams.hasOwnProperty(key)) {\n        set(newUserAttrs, key, get(userParams, key))\n      }\n    }\n\n    const userAttrsParams: UserAttrsParams = {\n      userId: newUserAttrs.userId as string,\n      enableChat: newUserAttrs.chat as number,\n      enableAudio: newUserAttrs.audio as number,\n      enableVideo: newUserAttrs.video as number,\n      grantBoard: newUserAttrs.grantBoard as number,\n      // coVideo: newUserAttrs.coVideo as number\n    }\n\n    if (broad) {\n      await this.updateRoomUser({user: userAttrsParams})\n    }\n\n    this.state = {\n      ...this.state,\n      users: this.state.users.set(`${uid}`, newUserAttrs as AgoraUser)\n    }\n    this.commit(this.state)\n  }\n\n  resolveCourseAttrsToOperate(params: Partial<ClassState>): any {\n    const keys = ['lockBoard', 'courseState', 'muteChat']\n    for (let key of keys) {\n      if (params.hasOwnProperty(key)) {\n        let value = -1\n        let stateValue = get(params, key, 0)\n        let stateKey = key;\n        if (key === 'lockBoard') {\n          value = stateValue ? RoomMessage.lockBoard : RoomMessage.unlockBoard\n        } else if (key === 'courseState') {\n          value = stateValue ? RoomMessage.startCourse : RoomMessage.endCourse\n        } else if (key === 'muteChat') {\n          value = stateValue ? RoomMessage.muteAllChat : RoomMessage.unmuteAllChat\n          stateKey = 'muteAllChat'\n        }\n        return {\n          key: stateKey,\n          stateValue,\n          value\n        }\n      }\n    }\n  }\n\n  async updateCourse(params: Partial<ClassState & NotifyFlag>) {\n    const {broad = true, ...courseParams} = params\n\n    const {key, stateValue}: any = this.resolveCourseAttrsToOperate(courseParams)\n\n    if (broad) {\n      await eduApi.updateCourse({\n        room: {\n          [`${key}`]: stateValue\n        }\n      })\n      this.state = {\n        ...this.state,\n        course: {\n          ...this.state.course,\n          ...courseParams\n        }\n      }\n      this.commit(this.state)\n      return\n    }\n    this.state = {\n      ...this.state,\n      course: {\n        ...this.state.course,\n        ...courseParams\n      }\n    }\n    this.commit(this.state)\n  }\n\n  async updateLocal(params: LocalAttrs) {\n    const newMe = this.compositeMe(params)\n    const newCourse = this.compositeCourse(params)\n    const users = this.state.users\n\n    this.state = {\n      ...this.state,\n      me: {\n        ...newMe,\n      },\n      users,\n      course: {\n        ...newCourse,\n      }\n    }\n    this.commit(this.state)\n  }\n\n  async exitRoom() {\n    return await eduApi.exitRoom(this.state.course.roomId)\n  }\n\n  async exitAll() {\n    try {\n      try {\n        await this.rtmClient.exit();\n      } catch (err) {\n        console.warn(err);\n      }\n      try {\n        await this.rtcClient.exit();\n      } catch (err) {\n        console.warn(err);\n      }\n    } finally {\n      GlobalStorage.clear('agora_room');\n      this.state = {\n        ...this.defaultState\n      }\n      this.commit(this.state);\n    }\n  }\n\n  async startWebScreenShare() {\n    const webClient = this.rtcClient as AgoraWebClient\n    try {\n      const {screenToken} = await eduApi.refreshToken();\n      const {screenId, rid} = this.state.course\n      const appId = this.state.appID\n      await webClient.startScreenShare({\n        uid: +screenId,\n        token: screenToken,\n        channel: rid,\n        appId\n      })\n      // add screen client listener\n      // 监听屏幕共享主要的事件\n      webClient.shareClient.on('onTokenPrivilegeWillExpire', (evt: any) => {\n        // WARN: IF YOU ENABLED APP CERTIFICATE, PLEASE SIGN YOUR TOKEN IN YOUR SERVER SIDE AND OBTAIN IT FROM YOUR OWN TRUSTED SERVER API\n        const newToken = '';\n        webClient.shareClient.renewToken(newToken);\n      });\n      webClient.shareClient.on('onTokenPrivilegeDidExpire', (evt: any) => {\n        // WARN: IF YOU ENABLED APP CERTIFICATE, PLEASE SIGN YOUR TOKEN IN YOUR SERVER SIDE AND OBTAIN IT FROM YOUR OWN TRUSTED SERVER API\n        const newToken = '';\n        webClient.shareClient.renewToken(newToken);\n      });\n      webClient.shareClient.on('stopScreenSharing', (evt: any) => {\n        console.log('stop screen share', evt);\n        this.stopWebScreenShare().then(() => {\n          globalStore.showToast({\n            message: t('toast.canceled_screen_share'),\n            type: 'notice'\n          });\n        }).catch(console.warn).finally(() => {\n          console.log('[agora-web] stop share');\n        })\n      })\n    } catch(err) {\n      if (webClient.shareClient) {\n        webClient.shareClient.off('onTokenPrivilegeWillExpire', (evt: any) => {})\n        webClient.shareClient.off('onTokenPrivilegeDidExpire', (evt: any) => {})\n        webClient.shareClient.off('stopScreenSharing', (evt: any) => {})\n      }\n      if (err.type === 'error' && err.msg === 'NotAllowedError') {\n        globalStore.showToast({\n          message: t('toast.canceled_screen_share'),\n          type: 'notice'\n        });\n      }\n      if (err.type === 'error' && err.msg === 'PERMISSION_DENIED') {\n        globalStore.showToast({\n          message: t('toast.screen_sharing_failed', {reason: err.msg}),\n          type: 'notice'\n        });\n      }\n      throw err\n    }\n  }\n\n  async stopWebScreenShare() {\n    const webClient = this.rtcClient as AgoraWebClient\n    if (webClient.shared) {\n      await webClient.stopScreenShare()\n      this.removeLocalSharedStream();\n    }\n  }\n\n  // WARN: only work in electron environment\n  // 仅用于electron运行环境\n  async startNativeScreenShare() {\n    const rtcClient = this.rtcClient;\n    globalStore.setNativeWindowInfo({\n      visible: true,\n      items: (rtcClient as AgoraElectronClient).getScreenShareWindows()\n    })\n  }\n\n  async startScreenShare() {\n    if (platform === 'electron') {\n      await this.startNativeScreenShare()\n    }\n\n    if (platform === 'web') {\n      await this.startWebScreenShare()\n    }\n  }\n\n  async stopNativeScreenShare() {\n    const nativeClient = this.rtcClient as AgoraElectronClient;\n    await nativeClient.stopScreenShare();\n  }\n\n  async stopScreenShare() {\n    if (platform === 'web') {\n      await this.stopWebScreenShare()\n    }\n\n    if (platform === 'electron') {\n      await this.stopNativeScreenShare()\n    }\n  }\n\n  lockRecording() {\n    if (!this.state) return\n    this.state={\n      ...this.state,\n      recordLock: true\n    }\n    this.commit(this.state)\n  }\n\n  unlockRecording() {\n    if (!this.state) return\n    this.state={\n      ...this.state,\n      recordLock: false\n    }\n    this.commit(this.state)\n  }\n  \n  async startRecording () {\n    this.lockRecording()\n    try {\n      const maxIdleTime = 30\n      const {data: recordId} = await eduApi.startRecording({\n        recordingConfig: {\n          maxIdleTime\n        },\n      })\n      this.state = {\n        ...this.state,\n        course: {\n          ...this.state.course,\n          recordId,\n          isRecording: true\n        }\n      }\n      this.commit(this.state)\n    } catch(err) {\n      throw err;\n    } finally {\n      this.unlockRecording()\n    }\n  }\n\n  async stopRecording () {\n    this.lockRecording()\n    try {\n      await eduApi.stopRecording(this.state.course.recordId)\n      const roomId = this.state.course.roomId\n      const {data: roomInfo} = await eduApi.getRoomInfoBy(roomId)\n      const recordId = roomInfo.room.recordId\n      this.state = {\n        ...this.state,\n        course: {\n          ...this.state.course,\n          recordId: recordId,\n          isRecording: false\n        }\n      }\n      this.commit(this.state)\n    } catch(err) {\n      throw err\n    } finally {\n      this.unlockRecording()\n    }\n  }\n\n  updateCoVideoUsers(rawUsers: any) {\n    const coVideoUids: any[] = []\n    let users = rawUsers.reduce((acc: Map<string, AgoraUser>, it: any) => {\n      if (+it.role === 2) {\n        coVideoUids.push(+it.uid)\n      }\n      \n      return acc.set(`${it.uid}`, {\n        role: it.role,\n        account: it.userName,\n        uid: it.uid,\n        video: it.enableVideo,\n        audio: it.enableAudio,\n        chat: it.enableChat,\n        grantBoard: it.grantBoard,\n        userId: it.userId,\n        screenId: it.screenId,\n      });\n    }, Map<string, AgoraUser>());\n\n    let meState = this.state.me\n\n    let newMe = users.find((user: AgoraUser) => +this.state.me.uid === +user.uid)\n\n    if (newMe) {\n      meState = this.compositeMe({...newMe, coVideo: 1})\n    } else {\n      meState = {\n        ...meState,\n        coVideo: 0\n      }\n    }\n\n    let courseState: any = {\n      screenId: this.state.course.screenId,\n      teacherId: this.state.course.teacherId,\n    }\n\n    let newCourse = users.find((user: AgoraUser) => +user.role === 1)\n\n    if (newCourse) {\n      courseState.screenId = newCourse.screenId\n      courseState.teacherId = newCourse.uid\n    }\n\n    let applyUser = this.state.applyUser;\n    if (applyUser && applyUser.userId) {\n      const foundUser = users.find((user: AgoraUser) => user.userId === applyUser.userId)\n      if (!foundUser) {\n        applyUser = {\n          userId: '',\n          account: ''\n        }\n      }\n    }\n\n    this.state = {\n      ...this.state,\n      users: users,\n      me: {\n        ...this.state.me,\n        ...meState\n      },\n      course: {\n        ...this.state.course,\n        ...courseState,\n        coVideoUids,\n      },\n      applyUser\n    }\n    this.commit(this.state)\n  }\n\n  updateRoomInfo(data: any) {\n    this.state = {\n      ...this.state,\n      course: {\n        ...this.state.course,\n        lockBoard: data.lockBoard,\n        muteChat: data.muteAllChat,\n        courseState: data.courseState,\n      }\n    }\n    this.commit(this.state)\n  }\n\n  updateRoomMember(memberCount: number) {\n    this.state = {\n      ...this.state,\n      course: {\n        ...this.state.course,\n        memberCount\n      }\n    }\n    this.commit(this.state)\n  }\n\n  updateScreenShare(payload: any) {\n    this.state = {\n      ...this.state,\n      course: {\n        ...this.state.course,\n        screenId: payload.screenId,\n      }\n    }\n\n    this.commit(this.state)\n  }\n}\n\nexport const roomStore = new RoomStore();\n\n// TODO: Please remove it before release in production\n// 备注：请在正式发布时删除操作的window属性\n//@ts-ignore\nwindow.roomStore = roomStore;","import React from 'react'\nimport './index.scss';\n\nexport const GithubIcon: React.FC<{}> = (props) => {\n  return (\n    <a href=\"https://github.com/AgoraIO-Usecase/eEducation\" target=\"_blank\" rel=\"noopener noreferrer\" >\n    <span className=\"agora-github-pin\">\n    </span>\n    </a>\n  )\n}","import {get, isEmpty} from 'lodash';\nimport { AgoraFetch } from '../fetch';\n\nconst url = `${window.location.protocol}//${window.location.host}/dev/v2/project/%s/rtm`;\nconst PREFIX = url.replace('%s', process.env.REACT_APP_AGORA_APP_ID as string);\n\nexport type QueryChannelMessage = {\n  channelName: string,\n  startTime: string,\n  endTime: string\n}\n\nexport type AgoraChannelMessage = {\n  dst: string\n  message_type: string\n  ms: number\n  payload: string\n  src: string\n}\n\nexport class RTMRestful {\n  startTime: number\n  endTime: number\n  source: string\n  destination: string\n  customerId: string\n  appSecret: string\n  totalCount: number\n  offset: number\n  limit: number\n\n  constructor(customerId: string, appSecret: string) {\n    this.startTime = 0\n    this.endTime = 0\n    this.source = ''\n    this.destination = ''\n    this.customerId = customerId\n    this.appSecret = appSecret\n    this.totalCount = 0\n    this.offset = 0\n    this.limit = 100\n    // this.agoraAppId = appId\n  }\n\n  private basicAuthorization(): string {\n    const plainCredentials = `${this.customerId}:${this.appSecret}`;\n    return `Basic ${btoa(plainCredentials)}`;\n  }\n\n  async fetchChannelMessageCount({channelName, startTime, endTime}: QueryChannelMessage) {\n    const response: Response = await AgoraFetch(`${PREFIX}/message/history/count?destination=${channelName}&start_time=${startTime}&end_time=${endTime}`, {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: this.basicAuthorization(),\n      },\n    });\n    // const json = await response.json();\n    const json = response;\n    const count = get(json, 'count');\n    this.totalCount = count;\n    this.offset = 0;\n    this.limit = 100;\n    return count;\n  }\n\n  async fetchChannelMessages({\n    channelName, startTime, endTime\n  }: QueryChannelMessage): Promise<AgoraChannelMessage[]> {\n    const responseA: Response = await AgoraFetch(`${PREFIX}/message/history/query`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: this.basicAuthorization(),\n      },\n      body: JSON.stringify({\n          filter: {\n            source: \"\",\n            destination: channelName,\n            start_time: startTime,\n            end_time: endTime\n          },\n          offset: this.offset,\n          limit: this.limit,\n          order: \"asc\"\n        })\n    });\n    const jsonA = responseA;\n    const location = get(jsonA, 'location');\n    if (isEmpty(location)) {\n      throw `location from agora rtm endpoint must be present`\n    }\n    const respB = await AgoraFetch(`${PREFIX}/message/history/query/${location.replace('~/rtm/message/history/query/', '')}`, {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: this.basicAuthorization(),\n      },\n    });\n    // const jsonB = await respB.json();\n    const jsonB = respB;\n    const messages = get(jsonB, 'messages');\n    return messages;\n  }\n\n  async getAllChannelMessages(params: QueryChannelMessage) {\n    let count = await this.fetchChannelMessageCount(params);\n    if (count === 0) {\n      return undefined;\n    }\n    let totalCount = this.totalCount;\n    let channelMessages: AgoraChannelMessage[] = [];\n    while (totalCount > 0) {\n      const messages = await this.fetchChannelMessages(params);\n      channelMessages = channelMessages.concat(...messages);\n      if (totalCount >= messages.length) {\n        totalCount = totalCount - messages.length;\n        this.offset = channelMessages.length;\n        this.limit = 100;\n      }\n    }\n    return channelMessages;\n  }\n}\n\n//@ts-ignore\nwindow.RTMRestful = new RTMRestful(process.env.REACT_APP_AGORA_CUSTOMER_ID as string, process.env.REACT_APP_AGORA_CUSTOMER_CERTIFICATE as string);","import { WhiteWebSdk, ReplayRoomParams, PlayerCallbacks } from 'white-web-sdk';\n\nexport const WhiteboardAPI = {\n  async replayRoom(client: WhiteWebSdk, args: ReplayRoomParams, callback: PlayerCallbacks) {\n    let retrying;\n    do {\n      try {\n        let result = await client.replayRoom({\n          beginTimestamp: args.beginTimestamp,\n          duration: args.duration,\n          room: args.room,\n          mediaURL: args.mediaURL,\n          roomToken: args.roomToken,\n        }, callback);\n        retrying = false;\n        return result;\n      } catch (err) {\n        retrying = true;\n      }\n    } while (retrying);\n  }\n}","import uuidv4 from 'uuid/v4';\n\nexport { RTMRestful } from './rtm-restful';\nexport { WhiteboardAPI } from './whiteboard-api';\nexport function genUUID (): string {\n  let uuid = localStorage.getItem('demo_edu_uuid');\n  if (uuid) {\n    return uuid;\n  }\n  uuid = uuidv4();\n  localStorage.setItem('demo_edu_uuid', uuid);\n  return uuid;\n}","import Dexie from 'dexie';\n\nconst db = new Dexie('webdemo_agora_edu');\n\ndb.version(1).stores({\n  logs: 'content'\n});\n\nexport default db;\n","import { isElectron } from '@/utils/platform';\nimport { roomStore } from '@/stores/room';\nimport { eduApi } from '@/services/edu-api';\nimport Dexie from 'dexie';\n// eslint-disable-next-line\nimport LogWorker from 'worker-loader!./log.worker';\nimport db from './db';\nimport UAParser from 'ua-parser-js';\nimport {get} from 'lodash';\n\nconst parser = new UAParser();\n\nconst userAgentInfo = parser.getResult();\n\nexport const isSafari = () => {\n  return (\n    userAgentInfo.browser.name === 'Safari' ||\n    userAgentInfo.browser.name === 'Mobile Safari'\n  );\n};\n\nexport const isChrome = () => {\n  return userAgentInfo.browser.name === 'Chrome';\n};\n\nexport const isFirefox = () => {\n  return userAgentInfo.browser.name === 'Firefox';\n};\n\nexport const isMobile = () => {\n  return userAgentInfo.device.type === 'mobile';\n};\n\n// const getUserAgent = () => {\n//   return isSafari()\n//     ? 'safari'\n//     : isChrome()\n//     ? 'chrome'\n//     : isFirefox()\n//     ? 'firefox'\n//     : navigator.userAgent;\n// };\n\nconst flat = (arr: any[]) => {\n  return arr.reduce((arr, elem) => arr.concat(elem), []);\n};\n\nexport default class Log {\n  static originConsole = window.console;\n\n  static thread = null;\n\n  static init() {\n    if (!this.thread) {\n      //@ts-ignore\n      this.thread = new LogWorker()\n      this.debugLog();\n    }\n  }\n\n  static debugLog() {\n    const thread = this.thread as any;\n    function proxy(context: any, method: any) {\n      return function() {\n        let args = [...arguments];\n        flat(args).join('');\n        thread.postMessage({\n          type: 'log',\n          data: JSON.stringify([flat(args).join('')])\n        });\n        method.apply(context, args);\n      };\n    }\n\n    Object.keys(console)\n      .filter(e => ['info', 'error', 'warn', 'log', 'debug'].indexOf(e) >= 0)\n      .forEach((method: any, _) => {\n        //@ts-ignore\n        console[method] = proxy(console, console[method]);\n      });\n    //@ts-ignore\n    window.console = console;\n  }\n\n  static async uploadElectronLog(roomId: any) {\n    //@ts-ignore\n    let file = await window.doGzip();\n    const res = await eduApi.uploadZipLogFile(\n      roomId,\n      file\n    )\n    return get(res, 'data.data', -1);\n  }\n\n  static async doUpload() {\n    const ids = [];\n    // Upload Electron log\n    if (isElectron) {\n      ids.push(await this.uploadElectronLog(roomStore.state.course.roomId))\n    }\n    // Web upload log\n    ids.push(await this.uploadLog(roomStore.state.course.roomId))\n    return ids.join(\"#\")\n  }\n\n  static async uploadLog(roomId: string) {\n    // let ua = getUserAgent();\n    //@ts-ignore\n    let logs = await db.logs.toArray();\n    const logsStr = logs\n      .reverse()\n      .map((e: any) => JSON.parse(e.content))\n      .map((e: any) => (Array.isArray(e) ? e[0] : e))\n      .join('\\n');\n\n    //@ts-ignore\n    window.logsStr = logsStr\n\n    const file = await new File([logsStr], `${+Date.now()}`)\n\n    //@ts-ignore\n    window.file = file\n\n    let res = await eduApi.uploadLogFile(\n      roomId,\n      file,\n    )\n    await db.delete();\n    if (!(await Dexie.exists(db.name))) {\n      db.version(1).stores({\n        logs: 'content'\n      });\n    }\n    await db.open();\n    console.log(\"res \", res)\n    return get(res, 'data.data', -1);\n  }\n}\n","import React, { useState, useEffect, useRef, CSSProperties } from 'react';\r\nimport { Theme, FormControl, Tooltip } from '@material-ui/core';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport Button from '../components/custom-button';\r\nimport RoleRadio from '../components/role-radio';\r\nimport Icon from '../components/icon';\r\nimport FormInput from '../components/form-input';\r\nimport FormSelect from '../components/form-select';\r\nimport LangSelect from '../components/lang-select';\r\nimport { isElectron } from '../utils/platform';\r\nimport { usePlatform } from '../containers/platform-container';\r\nimport {useHistory} from 'react-router-dom';\r\nimport { roomStore } from '../stores/room';\r\nimport {GithubIcon} from '../components/github-icon';\r\nimport { globalStore, roomTypes } from '../stores/global';\r\nimport { t } from '../i18n';\r\nimport GlobalStorage from '../utils/custom-storage';\r\nimport { genUUID } from '../utils/api';\r\nimport Log from '../utils/LogUploader';\r\nimport axios from 'axios';\r\nconst useStyles = makeStyles ((theme: Theme) => ({\r\n  formControl: {\r\n    minWidth: '240px',\r\n    maxWidth: '240px',\r\n  }\r\n}));\r\n\r\nconst hiddenStyle: CSSProperties = {\r\n  display: 'none',\r\n}\r\n\r\n\r\ntype SessionInfo = {\r\n  roomName: string\r\n  roomType: number\r\n  yourName: string\r\n  role: string\r\n}\r\n\r\nconst defaultState: SessionInfo = {\r\n  roomName: '',\r\n  roomType: 0,\r\n  role: '',\r\n  yourName: '',\r\n}\r\n\r\nfunction HomePage() {\r\n  document.title = t(`home.short_title.title`)\r\n\r\n  const classes = useStyles();\r\n\r\n  const history = useHistory();\r\n\r\n  const handleSetting = (evt: any) => {\r\n    history.push({pathname: `/device_test`});\r\n  }\r\n\r\n  const [lock, setLock] = useState<boolean>(false);\r\n\r\n  const handleUpload = (evt: any) => {\r\n    setLock(true)\r\n    Log.doUpload().then((resultCode: any) => {\r\n      globalStore.showDialog({\r\n        type: 'uploadLog',\r\n        message: t('toast.show_log_id', {reason: `${resultCode}`})\r\n      });\r\n    }).finally(() => {\r\n      setLock(false)\r\n    })\r\n  }\r\n\r\n  const {\r\n    HomeBtn\r\n  } = usePlatform();\r\n\r\n  const ref = useRef<boolean>(false);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      ref.current = true;\r\n    }\r\n  }, []);\r\n\r\n  const [session, setSessionInfo] = useState<SessionInfo>(defaultState);\r\n\r\n  const [required, setRequired] = useState<any>({} as any);\r\n\r\n  const handleSubmit = () => {\r\n    const queryString = window.location.href;\r\n    var url = new URL(queryString);\r\n    var room_id = url.searchParams.get(\"room\");\r\n    var token = url.searchParams.get(\"token\");\r\n    var room_type = url.searchParams.get(\"roomtype\");\r\n    var subject = url.searchParams.get(\"subject\");\r\n\r\n\r\n    var data = {\r\n      'token':token,\r\n      'roomName': room_id,\r\n      'roomType': room_type,\r\n      'subject': subject,\r\n      'yourName': '',\r\n    }\r\n    axios.post(`${process.env.REACT_APP_END_POINT}creat_class_room`, data).then((res)=>{\r\n        session.roomName = res.data.roomName;\r\n        session.role = res.data.role;\r\n        session.roomType = res.data.roomType;\r\n        session.yourName = res.data.yourName;\r\n\r\n        if (!session.roomName) {\r\n          setRequired({...required, roomName: t('home.missing_room_name')});\r\n          return;\r\n        }\r\n    \r\n        if (!session.yourName) {\r\n          setRequired({...required, yourName: t('home.missing_your_name')});\r\n          return;\r\n        }\r\n    \r\n        if (!session.role) {\r\n          setRequired({...required, role: t('home.missing_role')});\r\n          return;\r\n        }\r\n        \r\n        if (!roomTypes[session.roomType]) return;\r\n        const path = roomTypes[session.roomType].path\r\n        globalStore.showLoading()\r\n        roomStore.LoginToRoom({\r\n          userName: session.yourName,\r\n          roomName: session.roomName,\r\n          role: session.role === 'teacher' ? 1 : 2,\r\n          type: session.roomType,\r\n          uuid: genUUID()\r\n        }).then(() => {\r\n\r\n          history.push(`/classroom/${path}`)\r\n        }).catch((err: any) => {\r\n          if (err.hasOwnProperty('api_error')) {\r\n            return\r\n          }\r\n          if (err.reason) {\r\n            globalStore.showToast({\r\n              type: 'rtmClient',\r\n              message: t('toast.rtm_login_failed_reason', {reason: err.reason}),\r\n            })\r\n          } else {\r\n            globalStore.showToast({\r\n              type: 'rtmClient',\r\n              message: t('toast.rtm_login_failed'),\r\n            })\r\n          }\r\n          console.warn(err)\r\n        }).finally(() => {\r\n          globalStore.stopLoading();\r\n        })\r\n    }).catch((err)=>{\r\n      console.log(err)\r\n      globalStore.showToast({\r\n        type: 'rtmClient',\r\n        message: t('toast.rtm_login_failed_reason', {reason: err.response.data.message}),\r\n      })\r\n \r\n    });\r\n    \r\n  }\r\n\r\n  return (\r\n    <div style={hiddenStyle} className={`flex-container ${isElectron ? 'draggable' : 'home-cover-web' }`}>\r\n      {isElectron ? null : \r\n      <div className=\"web-menu\">\r\n        <div className=\"web-menu-container\">\r\n          <div className=\"short-title\">\r\n            <span className=\"title\">{t('home.short_title.title')}</span>\r\n            <span className=\"subtitle\">{t('home.short_title.subtitle')}</span>\r\n            <span className=\"build-version\">{t(\"build_version\")}</span>\r\n          </div>\r\n          <div className=\"setting-container\">\r\n            <div className=\"flex-row\">\r\n              <Tooltip title={t(\"icon.upload-log\")} placement=\"top\">\r\n                <span>\r\n                  <Icon className={lock ? \"icon-loading\" : \"icon-upload\"} onClick={handleUpload}></Icon>\r\n                </span>\r\n              </Tooltip>\r\n              <Tooltip title={t(\"icon.setting\")} placement=\"top\">\r\n                <span>\r\n                  <Icon className=\"icon-setting\" onClick={handleSetting}/>\r\n                </span>\r\n              </Tooltip>\r\n            </div>\r\n            <Tooltip title={t(\"icon.lang-select\")} placement=\"top\">\r\n              <span>\r\n                <LangSelect\r\n                value={GlobalStorage.getLanguage().language.match(/^zh/) ? 0 : 1}\r\n                onChange={(evt: any) => {\r\n                  const value = evt.target.value;\r\n                  if (value === 0) {\r\n                    globalStore.setLanguage('zh-CN');\r\n                  } else {\r\n                    globalStore.setLanguage('en');\r\n                  }\r\n                }}\r\n                items={[\r\n                  {text: '中文', name: 'zh-CN'},\r\n                  {text: 'En', name: 'en'}\r\n                ]}></LangSelect>\r\n              </span>\r\n            </Tooltip>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      }\r\n      <div className=\"custom-card\">\r\n        {!isElectron ? <GithubIcon /> : null}\r\n        <div className=\"flex-item cover\">\r\n          {isElectron ? \r\n          <>\r\n          <div className={`short-title ${globalStore.state.language}`}>\r\n            <span className=\"title\">{t('home.short_title.title')}</span>\r\n            <span className=\"subtitle\">{t('home.short_title.subtitle')}</span>\r\n          </div>\r\n          <div className={`cover-placeholder ${t('home.cover_class')}`}></div>\r\n          <div className='build-version'>{t(\"build_version\")}</div>\r\n          </>\r\n          : <div className={`cover-placeholder-web ${t('home.cover_class')}`}></div>\r\n          }\r\n        </div>\r\n        <div className=\"flex-item card\">\r\n          <div className=\"position-top card-menu\">\r\n            <HomeBtn handleSetting={handleSetting}/>\r\n          </div>\r\n          <div className=\"position-content flex-direction-column\">\r\n            <FormControl className={classes.formControl}>\r\n              <FormInput Label={t('home.room_name')} value={session.roomName} onChange={\r\n                (val: string) => {\r\n                  setSessionInfo({\r\n                    ...session,\r\n                    roomName: val\r\n                  });\r\n                }}\r\n                requiredText={required.roomName}\r\n              />\r\n            </FormControl>\r\n            <FormControl className={classes.formControl}>\r\n              <FormInput Label={t('home.nickname')} value={session.yourName} onChange={\r\n                (val: string) => {\r\n                  setSessionInfo({\r\n                    ...session,\r\n                    yourName: val\r\n                  });\r\n                }}\r\n                requiredText={required.yourName}\r\n              />\r\n            </FormControl>\r\n            <FormControl className={classes.formControl}>\r\n              <FormSelect \r\n                Label={t('home.room_type')}\r\n                value={session.roomType}\r\n                onChange={(evt: any) => {\r\n                  setSessionInfo({\r\n                    ...session,\r\n                    roomType: evt.target.value\r\n                  });\r\n                }}\r\n                items={roomTypes.map((it: any) => ({\r\n                  value: it.value,\r\n                  text: t(`${it.text}`),\r\n                  path: it.path\r\n                }))}\r\n              />\r\n            </FormControl>\r\n            <FormControl className={classes.formControl}>\r\n              <RoleRadio value={session.role} onChange={(evt: any) => {\r\n                 setSessionInfo({\r\n                   ...session,\r\n                   role: evt.target.value\r\n                 });\r\n              }} requiredText={required.role}></RoleRadio>\r\n            </FormControl>\r\n            <Button name={t('home.room_join')} onClick={handleSubmit}/>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\nexport default React.memo(HomePage);","import React, {useEffect} from 'react';\nimport Icon from '../icon';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Slider from '@material-ui/core/Slider';\n\nimport './index.scss';\n\nconst useStyles = makeStyles({\n  root: {\n    display: 'flex',\n    marginTop: '8px',\n  },\n  sliderClass: {\n    color: '#44A2FC',\n    minWidth: '210px',\n    marginLeft: '6px'\n  }\n});\n\ninterface SliderProps {\n  volume: number\n  onChange: (volume: number) => void\n}\n\nexport default function ContinuousSlider(props: SliderProps) {\n  const classes = useStyles(props);\n  const [value, setValue] = React.useState<number>(props.volume);\n\n  const handleChange = (event: any, newValue: any) => {\n    setValue(newValue);\n  };\n\n  useEffect(() => {\n    props.onChange(value);\n  }, [value]);\n\n  return (\n    <div className=\"volume-container\">\n      <div className={classes.root}>\n        <Icon className=\"icon-speaker\" disable/>\n        <Slider className={classes.sliderClass} value={value} onChange={handleChange} aria-labelledby=\"continuous-slider\" />\n      </div>\n    </div>\n  );\n}","import React from 'react';\nimport Icon from '../icon';\nimport {makeStyles} from '@material-ui/core/styles';\n\nimport './index.scss';\n\nconst useStyles = makeStyles({\n  root: {\n    display: 'flex',\n    marginTop: '8px',\n  },\n  sliderClass: {\n    color: '#44A2FC',\n    minWidth: '210px',\n    marginLeft: '6px',\n  },\n  sliderRailClass: {\n    height: '12px',\n    color: '#44A2FC'\n  },\n  sliderMarkClass: {\n    height: '12px',\n    color: '#CCCCCC'\n  }\n});\n\nconst totalVolumes = 52;\n\nfunction CustomSlider(props: any) {\n  return (\n    <div className=\"voice-sliders\">\n      {[...Array(totalVolumes)].map((e: any, key: number) => <span className={props.volume > key ? \"active\" : \"\"} key={key}></span>)}\n    </div>\n  )\n}\n\nfunction VoiceSlider(props: any) {\n  const classes = useStyles(props);\n  const volume = props.volume;\n\n  return (\n    <div className={classes.root}>\n      <Icon className=\"icon-voice\" disable />\n      <CustomSlider volume={volume * totalVolumes} className={classes.sliderClass} />\n    </div>\n  );\n}\n\nexport default function (props: any) {\n  return (\n    <div className=\"volume-container\">\n      <VoiceSlider volume={props.volume}/>\n    </div>\n  )\n}","import { BehaviorSubject } from \"rxjs\"\n\nexport interface ErrorState {\n  reason: string | null,\n  errors: {[key: string]: any}[] | []\n}\n\nexport class ErrorStore {\n  public readonly defaultState: ErrorState = {\n    reason: null,\n    errors: [] \n  }\n\n  private subject: BehaviorSubject<ErrorState> = new BehaviorSubject<ErrorState>(this.defaultState);\n\n  constructor() {\n    // console.log(\"defaultValue\", this.subject.getValue());\n  }\n\n  set state(newState: Partial<ErrorState>) {\n    this.subject.next({...this.subject.getValue(), ...newState});\n  }\n\n  get state() {\n    return this.subject.getValue();\n  }\n\n  subscribe(updateState: any) {\n    this.subject.subscribe(updateState);\n  }\n\n  unsubscribe() {\n    this.subject.unsubscribe();\n    this.state = this.defaultState;\n  }\n}\n\nexport const errorStore = new ErrorStore();","import { EventEmitter } from 'events';\nimport { videoPlugin } from '@netless/white-video-plugin';\nimport { audioPlugin } from '@netless/white-audio-plugin';\nimport { Room, WhiteWebSdk, DeviceType, SceneState, createPlugins, RoomPhase } from 'white-web-sdk';\nimport { Subject } from 'rxjs';\nimport GlobalStorage from '../utils/custom-storage';\nimport { isEmpty, get } from 'lodash';\nimport { roomStore } from './room';\nimport { globalStore } from './global';\nimport { t } from '../i18n';\n\nconst ENABLE_LOG = process.env.REACT_APP_AGORA_LOG === 'true';\n\ninterface SceneFile {\n  name: string\n  type: string\n}\n\nexport interface CustomScene {\n  path: string\n  rootPath: string\n  file: SceneFile\n  type: string\n}\n\nexport interface SceneResource {\n  path: string\n  rootPath: string\n  file: SceneFile\n}\n\nconst pathName = (path: string): string => {\n  const reg = /\\/([^\\/]*)\\//g;\n  reg.exec(path);\n  if (RegExp.$1 === \"aria\") {\n    return \"\";\n  } else {\n    return RegExp.$1;\n  }\n}\n\nexport const plugins = createPlugins({\"video\": videoPlugin, \"audio\": audioPlugin});\n\nplugins.setPluginContext(\"video\", {identity: 'guest'});\nplugins.setPluginContext(\"audio\", {identity: 'guest'});\n\nexport type WhiteboardState = {\n  loading: boolean\n  joined: boolean\n  scenes: CustomScene[]\n  currentScenePath: string\n  currentHeight: number\n  currentWidth: number\n  dirs: SceneResource[]\n  zoomRadio: number\n  scale: number\n  room: Room | null\n  recording: boolean\n  startTime: number\n  endTime: number\n\n  totalPage: number\n  currentPage: number\n  type: string\n}\n\ntype JoinParams = {\n  rid: string\n  uuid: string\n  roomToken: string\n  location?: string\n  userPayload: {\n    userId: string,\n    identity: string\n  }\n}\n\nclass Whiteboard extends EventEmitter {\n  public state: WhiteboardState;\n  public subject: Subject<WhiteboardState> | null;\n  public defaultState: WhiteboardState = {\n    joined: false,\n    scenes: [],\n    currentScenePath: '',\n    currentHeight: 0,\n    currentWidth: 0,\n    dirs: [],\n    zoomRadio: 0,\n    scale: 0,\n    recording: false,\n    startTime: 0,\n    endTime: 0,\n    room: null,\n    loading: true,\n    // isWritable: false,\n    ...GlobalStorage.read('mediaDirs'),\n    totalPage: 0,\n    currentPage: 0,\n    type: 'static'\n  }\n\n  public disconnected: boolean = true\n\n  public readonly client: WhiteWebSdk = new WhiteWebSdk({\n    deviceType: DeviceType.Surface,\n    // handToolKey: \" \",\n    plugins,\n    loggerOptions: {\n      disableReportLog: ENABLE_LOG ? false : true,\n      reportLevelMask: \"debug\",\n      printLevelMask: \"debug\",\n    }\n  });\n\n  constructor() {\n    super();\n    this.subject = null;\n    this.state = this.defaultState;\n  }\n\n  initialize() {\n    this.subject = new Subject<WhiteboardState>();\n    this.state = {\n      ...this.defaultState,\n    }\n    this.subject.next(this.state);\n  }\n\n  subscribe(updateState: any) {\n    this.initialize();\n    this.subject && this.subject.subscribe(updateState);\n  }\n\n  unsubscribe() {\n    this.subject && this.subject.unsubscribe();\n    this.subject = null;\n  }\n\n  commit (state: WhiteboardState) {\n    this.subject && this.subject.next(state);\n  }\n\n  updateState(newState: WhiteboardState) {\n    this.state = {\n      ...this.state,\n      ...newState,\n    }\n    this.commit(this.state);\n  }\n\n  getNameByScenePath(scenePath: string) {\n    const sceneMap = get(this.state.room, `state.globalState.sceneMap`, {})\n    console.log(\"sceneMap\", sceneMap)\n    return get(sceneMap, scenePath, 'default name')\n  }\n\n  updateRoomState() {\n    if (!this.state.room) return;\n    console.log(\"current room state\", this.state.room.state);\n    const roomState = this.state.room.state;\n\n    const path = roomState.sceneState.scenePath;\n    const ppt = roomState.sceneState.scenes[0].ppt;\n\n    const type = isEmpty(ppt) ? 'static' : 'dynamic';\n    const currentPage = roomState.sceneState.index;\n    const totalPage = roomState.sceneState.scenes.length;\n\n    if (type !== 'dynamic') {\n      this.state = {\n        ...this.state,\n        currentHeight: 0,\n        currentWidth: 0\n      }\n    } else {\n      this.state = {\n        ...this.state,\n        currentHeight: get(ppt, 'height', 0),\n        currentWidth: get(ppt, 'width', 0)\n      }\n    }\n\n    const entireScenes = this.state.room ? this.state.room.entireScenes() : {};\n\n    const paths = Object.keys(entireScenes);\n\n    let scenes: CustomScene[] = [];\n    for (let dirPath of paths) {\n      const sceneInfo = {\n        path: dirPath,\n        file: {\n          name: this.getNameByScenePath(dirPath),\n          type: 'whiteboard'\n        },\n        type: 'static',\n        rootPath: '',\n      }\n      if (entireScenes[dirPath]) {\n        sceneInfo.rootPath = ['/', '/init'].indexOf(dirPath) !== -1 ? '/init' : `${dirPath}/${entireScenes[dirPath][0].name}`\n        sceneInfo.type = entireScenes[dirPath][0].ppt ? 'dynamic' : 'static'\n        if (sceneInfo.type === 'dynamic') {\n          sceneInfo.file.type = 'ppt';\n        }\n      }\n      scenes.push(sceneInfo);\n    }\n\n    const _dirPath = pathName(path);\n    const currentScenePath = _dirPath === \"\" ? \"/\" : `/${_dirPath}`;\n\n    const _dirs: SceneResource[] = [];\n    scenes.forEach((it: CustomScene) => {\n      _dirs.push({\n        path: it.path,\n        rootPath: it.rootPath,\n        file: it.file\n      });\n    });\n\n    this.state = {\n      ...this.state,\n      scenes: scenes,\n      currentScenePath: currentScenePath,\n      dirs: _dirs,\n      totalPage,\n      currentPage,\n      type,\n    }\n    this.commit(this.state);\n  }\n\n  setCurrentScene(dirPath: string) {\n    const currentDirIndex = this.state.dirs.findIndex((it: SceneResource) => it.path === dirPath);\n    this.state = {\n      ...this.state,\n      currentScenePath: dirPath,\n    }\n    this.commit(this.state);\n  }\n\n  updateSceneState(sceneState: SceneState) {\n    const path = sceneState.scenePath;\n    const ppt = sceneState.scenes[0].ppt;\n    const type = isEmpty(ppt) ? 'static' : 'dynamic';\n    const currentPage = sceneState.index;\n    const totalPage = sceneState.scenes.length;\n\n    this.state = {\n      ...this.state,\n      currentPage,\n      totalPage,\n      type,\n    }\n\n    this.commit(this.state);\n  }\n\n  updateScale(scale: number) {\n    this.state = {\n      ...this.state,\n      scale: scale\n    }\n    \n    this.commit(this.state);\n  }\n\n  updateLoading(value: boolean) {\n    this.state = {\n      ...this.state,\n      loading: value\n    }\n    this.commit(this.state);\n  }\n\n  async join({rid, uuid, roomToken, location, userPayload}: JoinParams) {\n    await this.leave();\n    const identity = userPayload.identity === 'host' ? 'host' : 'guest';\n\n    plugins.setPluginContext(\"video\", {identity});\n    plugins.setPluginContext(\"audio\", {identity});\n\n    const disableDeviceInputs: boolean = location!.match(/big-class/) && identity !== 'host' ? true : false;\n    const disableOperations: boolean = location!.match(/big-class/) && identity !== 'host' ? true : false;\n    const isWritable: boolean = location!.match(/big-class/) && identity !== 'host' ? false : true;\n\n    console.log(`[White] isWritable, ${isWritable}, disableDeviceInputs, ${disableDeviceInputs}, disableOperations, ${disableOperations}, location: ${location}`);\n\n    const roomParams = {\n      uuid,\n      roomToken,\n      disableBezier: true,\n      disableDeviceInputs,\n      disableOperations,\n      isWritable,\n      // rejectWhenReadonlyErrorLevel: RoomErrorLevel.Ignore,\n    }\n\n    const room = await this.client.joinRoom(roomParams, {\n      onPhaseChanged: (phase: RoomPhase) => {\n        if (phase === RoomPhase.Connected) {\n          this.disconnected = false\n          this.updateLoading(false);\n        } else {\n          this.disconnected = true\n          this.updateLoading(true);\n        }\n        console.log(\"[White] onPhaseChanged phase : \", phase);\n      },\n      onRoomStateChanged: state => {\n        console.log(\"onRoomStateChanged\", state)\n        if (state.zoomScale) {\n          whiteboard.updateScale(state.zoomScale);\n        }\n        if (state.sceneState || state.globalState) {\n          whiteboard.updateRoomState();\n        }\n      },\n      onDisconnectWithError: error => {},\n      onKickedWithReason: reason => {},\n      onKeyDown: event => {},\n      onKeyUp: event => {},\n      onHandToolActive: active => {},\n      onPPTLoadProgress: (uuid: string, progress: number) => {},\n    });\n\n    this.state = {\n      ...this.state,\n      room,\n    }\n    this.commit(this.state);\n  }\n\n  cleanRoom () {\n    this.state = {\n      ...this.state,\n      room: null\n    }\n    this.commit(this.state);\n  }\n\n  async leave() {\n    if (!this.state.room) return;\n    try {\n      await this.state.room.disconnect();\n    } catch(err) {\n      console.warn('disconnect whiteboard failed', err);\n    } finally {\n      this.disconnected = true\n      this.cleanRoom();\n      console.log(\"cleanRoom\");\n    }\n    this.updateLoading(true);\n  }\n\n  async destroy() {\n    await this.leave();\n    this.state = {\n      ...this.defaultState,\n    }\n    this.commit(this.state);\n    this.removeAllListeners();\n  }\n\n  private operator: any = null;\n\n  async lock() {\n    const lockBoardStatus = Boolean(roomStore.state.course.lockBoard)\n    const lockBoard = lockBoardStatus ? 0 : 1\n    await roomStore.updateCourse({\n      lockBoard\n    })\n    if (lockBoard) {\n      globalStore.showToast({\n        type: 'notice-board',\n        message: t('toast.whiteboard_lock')\n      })\n    } else {\n      globalStore.showToast({\n        type: 'notice-board',\n        message: t('toast.whiteboard_unlock')\n      })\n    }\n  }\n}\n\nexport const whiteboard = new Whiteboard();\n// TODO: Please remove it before release in production\n// 备注：请在正式发布时删除操作的window属性\n//@ts-ignore\nwindow.netlessStore = whiteboard;\n","import React, { useEffect, useRef } from 'react';\nimport {historyStore} from '../stores/history';\nimport { GlobalState, globalStore} from '../stores/global';\nimport { RoomState, roomStore} from '../stores/room';\nimport {ErrorState, errorStore} from '../pages/error-page/state';\nimport { WhiteboardState, whiteboard } from '../stores/whiteboard';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport { resolvePeerMessage, jsonParse } from '../utils/helper';\nimport GlobalStorage from '../utils/custom-storage';\nimport {fetchI18n} from '../services/edu-api';\nimport { t } from '../i18n';\nimport { ChatCmdType } from '../utils/agora-rtm-client';\nimport Log from '../utils/LogUploader';\n\nexport type IRootProvider = {\n  globalState: GlobalState\n  roomState: RoomState\n  whiteboardState: WhiteboardState\n  errorState: ErrorState\n  historyState: any\n}\n\nexport interface IObserver<T> {\n  subscribe: (setState: (state: T) => void) => void\n  unsubscribe: () => void\n  defaultState: T\n}\n\nfunction useObserver<T>(store: IObserver<T>) {\n  const [state, setState] = React.useState<T>(store.defaultState);\n  React.useEffect(() => {\n    store.subscribe((state: any) => {\n      setState(state);\n    });\n    return () => {\n      store.unsubscribe();\n    }\n  }, []);\n\n  return state;\n}\n\n\nexport const RootContext = React.createContext({} as IRootProvider);\n\nexport const useStore = () => {\n  const context = React.useContext(RootContext)\n  if (context === undefined) {\n    throw new Error('useStore must be used within a RootProvider');\n  }\n  return context;\n}\n\nexport const useGlobalState = () => {\n  return useStore().globalState;\n}\n\nexport const useRoomState = () => {\n  return useStore().roomState;\n}\n\nexport const useWhiteboardState = () => {\n  return useStore().whiteboardState;\n}\n\nexport const useErrorState = () => {\n  return useStore().errorState;\n}\n\nconst initLogWorker = () => {\n  Log.init();\n};\n\nexport const RootProvider: React.FC<any> = ({children}) => {\n  const globalState = useObserver<GlobalState>(globalStore);\n  const roomState = useObserver<RoomState>(roomStore);\n  const whiteboardState = useObserver<WhiteboardState>(whiteboard);\n  const errorState = useObserver<ErrorState>(errorStore);\n  const historyState = useObserver<any>(historyStore);\n  const history = useHistory();\n\n  const ref = useRef<boolean>(false);\n\n  useEffect(() => {\n    return () => {\n      ref.current = true;\n    }\n  }, []);\n\n  const value = {\n    globalState,\n    roomState,\n    whiteboardState,\n    errorState,\n    historyState,\n  }\n\n  useEffect(() => {\n    initLogWorker()\n    fetchI18n()\n    historyStore.setHistory(history)\n  }, [])\n\n  useEffect(() => {\n    if (!roomStore.state.rtm.joined) return;\n    const rtmClient = roomStore.rtmClient;\n    rtmClient.on('ConnectionStateChanged', ({ newState, reason }: { newState: string, reason: string }) => {\n      console.log(`newState: ${newState} reason: ${reason}`);\n      if (reason === 'LOGIN_FAILURE') {\n        globalStore.showToast({\n          type: 'rtmClient',\n          message: t('toast.login_failure'),\n        });\n        history.push('/');\n        return;\n      }\n      if (reason === 'REMOTE_LOGIN' || newState === 'ABORTED') {\n        globalStore.showToast({\n          type: 'rtmClient',\n          message: t('toast.kick'),\n        });\n        history.push('/');\n        return;\n      }\n    });\n    rtmClient.on(\"MessageFromPeer\", ({ message: { text }, peerId, props }: { message: { text: string }, peerId: string, props: any }) => {\n      const body = resolvePeerMessage(text);\n      console.log(\"message\", text, body)\n\n      // resolveMessage(peerId, body);\n      roomStore\n      .handlePeerMessage(body, peerId)\n      .then(() => {\n      }).catch(console.warn);\n    });\n    rtmClient.on(\"ChannelMessage\", ({ memberId, message }: { message: { text: string }, memberId: string }) => {\n      const {cmd, data} = jsonParse(message.text);\n      console.log(\"ChannelMessage cmd:  \", message, cmd, JSON.stringify(data))\n      // TODO: chat message\n      // TODO: 更新即时聊天\n      if (cmd === ChatCmdType.chat) {\n        if (data.userId === roomStore.state.me.userId) return\n        const isChatroom = globalStore.state.active === 'chatroom';\n        if (!isChatroom) {\n          globalStore.setMessageCount(globalStore.state.newMessageCount+1);\n        } else {\n          globalStore.setMessageCount(0);\n        }\n        const chatMessage = {\n          account: data.userName,\n          text: data.message,\n          ts: +Date.now(),\n          id: memberId,\n        }\n        roomStore.updateChannelMessage(chatMessage);\n        console.log(\"[rtmClient] chatMessage \", chatMessage, \" raw Data: \", data);\n      }\n\n      // TODO: update room member changed\n      // TODO: 更新人员进出\n      if (cmd === ChatCmdType.roomMemberChanged) {\n        const memberCount = data.total\n        roomStore.updateRoomMember(memberCount)\n      }\n\n      // TODO: update course state\n      // TODO: 更新房间信息\n      if (cmd === ChatCmdType.roomInfoChanged) {\n        roomStore.updateRoomInfo({\n          muteAllChat: data.muteAllChat,\n          lockBoard: data.lockBoard,\n          courseState: data.courseState\n        })\n      }\n\n      // TODO: update room co-video-users\n      // TODO: 更新连麦用户\n      if (cmd === ChatCmdType.coVideoUsersChanged) {\n        const users = data;\n        roomStore.updateCoVideoUsers(users);\n      }\n\n      // TODO: replay message\n      // TODO: 更新录制回放\n      if (cmd === ChatCmdType.replay) {\n        const isChatroom = globalStore.state.active === 'chatroom';\n        if (!isChatroom) {\n          globalStore.setMessageCount(globalStore.state.newMessageCount+1);\n        } else {\n          globalStore.setMessageCount(0);\n        }\n        const replayMessage = {\n          account: data.userName,\n          text: 'recording',\n          link: data.recordId,\n          ts: +Date.now(),\n          id: data.uid,\n        }\n        roomStore.updateChannelMessage(replayMessage);\n        console.log(\"[rtmClient] replayMessage\", replayMessage, \" raw Data: \", data);\n      }\n\n      if (cmd === ChatCmdType.screenShare) {\n        roomStore.updateScreenShare({\n          state: data.state,\n          screenId: data.screenId,\n          userId: data.userId\n        })\n      }\n\n      // TODO: recordingStateChanged\n      // TODO: 录制状态发生改变了\n      if (cmd === ChatCmdType.recordStateChanged) {\n        console.log(\"Received, ChatCmdType.recordStateChanged: \", cmd)\n        roomStore.updateRecordState({\n          roomId: data.roomId,\n          recordId: data.recordId,\n          isRecording: data.isRecording,\n          recordingTime: data.recordingTime\n        })\n      }\n    });\n    return () => {\n      rtmClient.removeAllListeners();\n    }\n  }, [roomStore.state.rtm.joined]);\n\n  const location = useLocation();\n\n  useEffect(() => {\n    if (location.pathname === '/') {\n      return;\n    }\n\n    const room = value.roomState;\n    GlobalStorage.save('agora_room', {\n      me: room.me,\n      course: room.course,\n      mediaDevice: room.mediaDevice,\n      applyUser: room.applyUser,\n    });\n    GlobalStorage.setLanguage(value.globalState.language);\n    // TODO: Please remove it before release in production\n    // 备注：请在正式发布时删除操作的window属性\n    //@ts-ignore\n    window.errorState = errorState;\n    //@ts-ignore\n    window.room = roomState;\n    //@ts-ignore\n    window.globalState = globalState;\n    //@ts-ignore\n    window.whiteboard = whiteboardState;\n  }, [value, location]);\n  return (\n    <RootContext.Provider value={value}>\n      {children}\n    </RootContext.Provider>\n  )\n}","import React, { useRef, useEffect, useState, useMemo } from 'react';\nimport Icon from './icon';\nimport './video-player.scss';\nimport { AgoraElectronStream, StreamType, AgoraRtcEngine } from '../utils/agora-electron-client';\nimport { useRoomState } from '../containers/root-container';\nimport { platform } from '../utils/platform';\n\nconst fillContentMode = 0;\nconst fitContentMode = 1;\n\ninterface VideoPlayerProps {\n  domId?: string\n  id?: string\n  streamID: number\n  preview?: boolean\n  account?: any\n  stream?: any\n  role?: string\n  audio?: boolean\n  video?: boolean\n  className?: string\n  showProfile?: boolean\n  local?: boolean\n  handleClick?: (type: string, streamID: number, uid: string) => Promise<any>\n  close?: boolean\n  handleClose?: (uid: string, streamID: number) => void\n  autoplay?: boolean\n}\n\nconst VideoPlayer: React.FC<VideoPlayerProps> = ({\n  preview,\n  role,\n  account,\n  stream,\n  className,\n  domId,\n  streamID,\n  audio,\n  id,\n  video,\n  handleClick,\n  local,\n  handleClose,\n  close,\n  autoplay\n}) => {\n  const loadVideo = useRef<boolean>(false);\n  const loadAudio = useRef<boolean>(false);\n\n  const lockPlay = useRef<boolean>(false);\n\n  const [resume, setResume] = useState<boolean>(false);\n\n  // TODO: 根据组件autoplay属性，仅判断远端流autoplay失败时触发\n  // TODO: only trigger resume when play remote stream\n  const needResume = useMemo(() => {\n    return resume === true &&\n      autoplay === false &&\n      local === false\n  }, [resume, autoplay, local])\n\n  useEffect(() => {\n    if (!domId || !stream || !AgoraRtcEngine) return;\n    if (platform === 'electron') {\n      const _stream = stream as AgoraElectronStream;\n      const dom = document.getElementById(domId);\n      if (!dom) return;\n      console.log(\"[agora-electron] video player\", dom, streamID, fillContentMode);\n      if (preview) {\n        // set for preview\n        AgoraRtcEngine.setupLocalVideo(dom);\n        AgoraRtcEngine.setupViewContentMode(streamID, fillContentMode);\n        AgoraRtcEngine.setClientRole(1);\n        // preview mode required you become host\n        AgoraRtcEngine.startPreview();\n        // AgoraRtcEngine.muteLocalVideoStream(nativeClient.published);\n        // AgoraRtcEngine.muteLocalAudioStream(nativeClient.published);\n        return () => {\n          console.log(\"[agora-electron] stop preview\", dom, streamID, fillContentMode);\n          AgoraRtcEngine.stopPreview();\n          AgoraRtcEngine.setClientRole(2);\n        }\n      }\n      if (_stream.type === StreamType.local) {\n        console.log(\"[agora-electron] video-player play \", AgoraRtcEngine.setupViewContentMode(streamID, fillContentMode));\n        console.log(\"[agora-electron] video-player setupLocalVideo \", AgoraRtcEngine.setupLocalVideo(dom));\n        return () => {\n          // AgoraRtcEngine.destroyRenderView(streamID, dom, (err: any) => { console.warn(err.message) });\n        }\n      }\n\n      if (_stream.type === StreamType.localVideoSource) {\n        AgoraRtcEngine.setupLocalVideoSource(dom);\n        AgoraRtcEngine.setupViewContentMode('videosource', fitContentMode);\n        // AgoraRtcEngine.setupViewContentMode(streamID, fitContentMode);\n        return () => {\n          // AgoraRtcEngine.destroyRenderView('videosource');\n          // AgoraRtcEngine.destroyRenderView(streamID, dom, (err: any) => { console.warn(err.message) });\n        }\n      }\n\n      if (_stream.type === StreamType.remote) {\n        AgoraRtcEngine.subscribe(streamID, dom);\n        AgoraRtcEngine.setupViewContentMode(streamID, fillContentMode);\n        return () => {\n          // AgoraRtcEngine.destroyRenderView(streamID, dom, (err: any) => { console.warn(err.message) });\n        }\n      }\n\n      if (_stream.type === StreamType.remoteVideoSource) {\n        AgoraRtcEngine.subscribe(streamID, dom);\n        // AgoraRtcEngine.setupViewContentMode('videosource', fitContentMode);\n        AgoraRtcEngine.setupViewContentMode(streamID, fitContentMode);\n        return () => {\n          // AgoraRtcEngine.destroyRenderView('videosource');\n          // AgoraRtcEngine.destroyRenderView(streamID, dom, (err: any) => { console.warn(err.message) });\n        }\n      }\n    }\n  }, [domId, stream, AgoraRtcEngine]);\n\n  useEffect(() => {\n    if (platform === 'web') {\n      if (!stream || !domId || lockPlay.current && stream.isPlaying()) return;\n      lockPlay.current = true;\n      stream.play(`${domId}`, { fit: 'cover' }, (err: any) => {\n        lockPlay.current = false;\n        console.warn('[video-player] ', JSON.stringify(err), id, stream.isPaused(), stream.isPlaying(), ' isLocal: ', local);\n        if (!autoplay && err && err.audio && err.audio.status !== \"aborted\" && !local) {\n          stream.isPaused() && setResume(true);\n          console.warn('[video-player] play failed ', JSON.stringify(err), id, stream.isPaused(), stream.isPlaying());\n        }\n      })\n      return () => {\n        if (stream.isPlaying()) {\n          stream.stop();\n        }\n      }\n    }\n  }, [domId, stream]);\n\n\n  useEffect(() => {\n    if (stream && platform === 'web') {\n      // prevent already muted audio\n      if (!loadAudio.current) {\n        if (!audio) {\n          stream.muteAudio();\n          console.log('stream mute audio');\n        }\n        loadAudio.current = true;\n        return;\n      }\n\n      if (audio) {\n        console.log('stream unmute audio');\n        stream.unmuteAudio();\n      } else {\n        console.log('stream mute audio');\n        stream.muteAudio();\n      }\n    }\n\n    if (stream && platform === 'electron') {\n      if (stream.type !== StreamType.local) return;\n      // prevent already muted video\n      if (!loadAudio.current) {\n        if (!audio) {\n          const res = AgoraRtcEngine.muteLocalAudioStream(true);\n          console.log(\"[agora-electron] muteLocalAudioStream(true); \", res);\n        }\n        loadAudio.current = true;\n        return;\n      }\n\n      if (audio) {\n        const res = AgoraRtcEngine.muteLocalAudioStream(false);\n        console.log(\"[agora-electron] muteLocalAudioStream(false); \", res);\n      } else {\n        const res = AgoraRtcEngine.muteLocalAudioStream(true);\n        console.log(\"[agora-electron] muteLocalAudioStream(true); \", res);\n      }\n    }\n  }, [stream, audio, AgoraRtcEngine]);\n\n  useEffect(() => {\n    if (stream && platform === 'web') {\n      // prevent already muted video\n      if (!loadVideo.current) {\n        if (!video) {\n          console.log('stream mute video');\n          stream.muteVideo();\n        }\n        loadVideo.current = true;\n        return;\n      }\n\n      if (video) {\n        console.log('stream unmute video');\n        stream.unmuteVideo();\n      } else {\n        console.log('stream mute video');\n        stream.muteVideo();\n      }\n    }\n\n    if (stream && platform === 'electron') {\n      if (stream.type !== StreamType.local) return;\n      // prevent already muted video\n      if (!loadVideo.current) {\n        if (!video) {\n          // const res = AgoraRtcEngine.muteLocalVideoStream(true);\n          const res = AgoraRtcEngine.enableLocalVideo(false);\n          console.log(\"[agora-electron] enableLocalVideo(false); \", res);\n        }\n        loadVideo.current = true;\n        return;\n      }\n\n      if (video) {\n        // const res = AgoraRtcEngine.muteLocalVideoStream(false);\n        const res2 = AgoraRtcEngine.enableLocalVideo(true);\n        console.log(\"[agora-electron] enableLocalVideo(true); \", res2);\n      } else {\n        // const res = AgoraRtcEngine.muteLocalVideoStream(true);\n        const res2 = AgoraRtcEngine.enableLocalVideo(false);\n        console.log(\"[agora-electron] enableLocalVideo(false); \", res2);\n      }\n    }\n  }, [stream, video, AgoraRtcEngine]);\n\n  const onAudioClick = (evt: any) => {\n    if (handleClick && id) {\n      handleClick('audio', streamID, id);\n    }\n  }\n\n  const onVideoClick = (evt: any) => {\n    if (handleClick && id) {\n      handleClick('video', streamID, id);\n    }\n  }\n\n  const onClose = (evt: any) => {\n    if (handleClose && id) {\n      handleClose('close', streamID);\n    }\n  }\n\n  const roomState = useRoomState()\n\n  const me = roomState.me;\n\n  return (\n    <div className={`${className ? className : (preview ? 'preview-video rotateY180deg' : `agora-video-view ${Boolean(video) === false && stream ? 'show-placeholder' : ''}`)}`}>\n      {close ? <div className=\"icon-close\" onClick={onClose}></div> : null}\n      {className !== 'screen-sharing' ? <div className={role === 'teacher' ? 'teacher-placeholder' : 'student-placeholder'}></div> : null}\n      {preview ? null :\n        account ?\n          <div className=\"video-profile\">\n            <span className=\"account\">{account}</span>\n            {`${me.uid}` === `${id}` || me.role === 1 ?\n              <span className=\"media-btn\">\n                <Icon onClick={onAudioClick} className={audio ? \"icon-speaker-on\" : \"icon-speaker-off\"} data={\"audio\"} />\n                <Icon onClick={onVideoClick} className={video ? \"icons-camera-unmute-s\" : \"icons-camera-mute-s\"} data={\"video\"} />\n              </span> : null}\n          </div>\n          : null\n      }\n      <div id={`${domId}`} className={`agora-rtc-video ${local ? 'rotateY180deg' : ''}`}></div>\n      {needResume ? <div className=\"clickable\" onClick={() => {\n        stream.resume().then(() => {\n          setResume(false);\n          console.log(\"clickable\");\n        }).catch(console.warn);\n      }}></div> : null}\n    </div>\n  )\n}\n\nexport default React.memo(VideoPlayer);","import React from 'react';\nimport { FormControl } from '@material-ui/core';\nimport {makeStyles} from '@material-ui/core/styles';\nimport Button from './custom-button';\nimport FormSelect from './form-select';\nimport SpeakerVolume from './volume/speaker';\nimport useSettingControl from '../hooks/use-setting-control';\nimport {t} from '../i18n';\n\nimport { usePlatform } from '../containers/platform-container';\n\nconst useStyles = makeStyles ({\n  formControl: {\n    minWidth: '240px',\n    maxWidth: '240px',\n  }\n});\n\ninterface SettingProps {\n  className?: string\n  handleFinish: (evt: any) => void\n}\n\nexport default function (props: SettingProps) {\n  const classes = useStyles();\n\n  const {SettingBtn} = usePlatform();\n  const {\n    cameraList,\n    microphoneList,\n    speakerList,\n    camera,\n    microphone,\n    speaker,\n    setCamera,\n    setMicrophone,\n    setSpeaker,\n    // volume,\n    speakerVolume,\n    setSpeakerVolume,\n    save,\n    PreviewPlayer,\n    MicrophoneVolume\n  } = useSettingControl();\n\n  const changeCamera = (evt: any) => {\n    console.log('changeCamera ', evt.target.value);\n    setCamera(evt.target.value);\n  }\n\n  const changeMicrophone = (evt: any) => {\n    console.log('changeMicrophone ', evt.target.value);\n    setMicrophone(evt.target.value);\n  }\n\n  const changeSpeaker = (evt: any) => {\n    console.log('changeSpeaker ', evt.target.value);\n    setSpeaker(evt.target.value);\n  }\n\n  const changeSpeakerVolume = (volume: number) => {\n    console.log('changeSpeaker ', volume);\n    setSpeakerVolume(volume);\n  }\n\n  return (\n    <div className={props.className ? props.className : \"flex-container\"}>\n      <div className=\"custom-card\">\n        <div className=\"flex-item cover\">\n          <PreviewPlayer />\n        </div>\n        <div className=\"flex-item card\">\n          <div className=\"position-top card-menu\">\n            <div></div>\n            <div className=\"icon-container\">\n              <SettingBtn />\n            </div>\n          </div>\n          <div className=\"position-content flex-direction-column\">\n            <FormControl className={classes.formControl}>\n              <FormSelect \n                Label={t(\"device.camera\")}\n                value={camera}\n                onChange={changeCamera}\n                items={cameraList}\n              />\n            </FormControl>\n            <FormControl className={classes.formControl}>\n              <FormSelect \n                Label={t(\"device.microphone\")}\n                value={microphone}\n                onChange={changeMicrophone}\n                items={microphoneList}\n              />\n              <MicrophoneVolume />\n            </FormControl>\n            <FormControl className={classes.formControl}>\n              <FormSelect \n                Label={t(\"device.speaker\")}\n                value={speaker}\n                onChange={changeSpeaker}\n                items={speakerList}\n              />\n              <SpeakerVolume volume={speakerVolume} onChange={changeSpeakerVolume} />\n            </FormControl>\n            <Button name={t(\"device.finish\")} onClick={(evt: any) => {\n              save({\n                speakerVolume,\n                camera,\n                microphone,\n                speaker,\n              })\n              props.handleFinish(evt);\n            }}/>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}","import { usePlatform } from '../containers/platform-container';\nimport React, { useState, useEffect, useMemo, useRef, useCallback } from 'react';\nimport VoiceVolume from '../components/volume/voice';\nimport {AgoraWebClient} from '../utils/agora-web-client';\nimport { AgoraElectronClient } from '../utils/agora-electron-client';\nimport VideoPlayer from '../components/video-player';\nimport { useRoomState } from '../containers/root-container';\nimport { roomStore, MediaDeviceState } from '../stores/room';\n\nexport default function useSettingControl () {\n\n  const [devices, setDevices] = useState<any[]>([]);\n\n  const {platform} = usePlatform();\n\n  const cameraList = useMemo(() => {\n    return devices\n    .filter((it: Device) => \n      it.kind === 'videoinput');\n  }, [devices]);\n\n  const microphoneList = useMemo(() => {\n    return devices\n    .filter((it: Device) => \n      it.kind === 'audioinput');\n  }, [devices]);\n\n  const speakerList = useMemo(() => {\n    return devices\n    .filter((it: Device) => \n      it.kind === 'audiooutput');\n  }, [devices]);\n\n  const roomState = useRoomState();\n\n  const mediaDevice = useMemo(() => {\n    return roomState.mediaDevice;\n  }, [roomState.mediaDevice]);\n\n  const [camera, setCamera] = useState(mediaDevice.camera);\n  const [microphone, setMicrophone] = useState(mediaDevice.microphone);\n  const [speaker, setSpeaker] = useState(mediaDevice.speaker);\n  const [speakerVolume, setSpeakerVolume] = useState<number>(mediaDevice.speakerVolume);\n  const [volume, setVolume] = useState<number>(0);\n\n  let mounted = false;\n\n  useEffect(() => {\n    const rtcClient: AgoraWebClient | AgoraElectronClient = roomStore.rtcClient;\n    if (!platform || !rtcClient) return;\n\n    if (platform === 'web' && !mounted) {\n      const webClient = rtcClient as AgoraWebClient;\n      const onChange = async () => {\n        const devices: Device[] = await webClient.getDevices();\n        setDevices(devices.map((item: Device) => ({\n          value: item.deviceId,\n          text: item.label,\n          kind: item.kind\n        })));\n      }\n      window.addEventListener('devicechange', onChange);\n      onChange().then(() => {\n      }).catch(console.warn);\n      mounted = true;\n      return () => {\n        window.removeEventListener('devicechange', onChange);\n      }\n    }\n\n    if (platform === 'electron' && !mounted) {\n      const nativeClient = rtcClient as AgoraElectronClient;\n\n      const onChange = async () => {\n        let microphoneIds = await nativeClient.rtcEngine.getAudioRecordingDevices();\n        let speakerIds = await nativeClient.rtcEngine.getAudioPlaybackDevices();\n        let cameraIds = await nativeClient.rtcEngine.getVideoDevices();\n\n        const microphones = microphoneIds.map((it: any) => (\n          {\n            kind: 'audioinput',\n            text: it.devicename,\n            value: it.deviceid\n          }\n        ));\n        const speakers = speakerIds.map((it: any) => ({\n          kind: 'audiooutput',\n          text: it.devicename,\n          value: it.deviceid,\n        }));\n        const cameras = cameraIds.map((it: any) => ({\n          kind: 'videoinput',\n          text: it.devicename,\n          value: it.deviceid,\n        }));\n        setDevices([].concat(microphones).concat(speakers).concat(cameras));\n      }\n      onChange().then(() => console.log('electron devices changed'))\n        .catch(console.warn);\n\n      nativeClient.on('videodevicestatechanged', onChange);\n      nativeClient.on('audiodevicestatechanged', onChange);\n      mounted = true;\n      return () => {\n        nativeClient.off('videodevicestatechanged', onChange);\n        nativeClient.off('audiodevicestatechanged', onChange);\n      }\n    }\n  }, [platform]);\n\n  const cameraId: string = useMemo(() => {\n    return cameraList[camera] ? cameraList[camera].value : '';\n  }, [cameraList, camera]);\n\n  const microphoneId: string = useMemo(() => {\n    return microphoneList[microphone] ? microphoneList[microphone].value : '';\n  }, [microphoneList, microphone]);\n\n  const speakerId: string = useMemo(() => {\n    return speakerList[speaker] ? speakerList[speaker].value : '';\n  }, [speakerList, speaker]);\n\n  const [stream, setStream] = useState<any>(null);\n\n  const ref = useRef<boolean>(false);\n\n  useEffect(() => {\n    return () => {\n      ref.current = true;\n    }\n  }, []);\n\n  const lock = useRef<boolean>(false);\n\n  useEffect(() => {\n    return () => {\n      lock.current = true;\n    }\n  }, []);\n  useEffect(() => {\n    if (lock.current || !speakerId || !cameraId || !microphoneId) return;\n    const rtcClient: AgoraWebClient | AgoraElectronClient = roomStore.rtcClient;\n    lock.current = true;\n    if (platform === 'web') {\n      const webClient = rtcClient as AgoraWebClient;\n      !ref.current &&\n      webClient.createPreviewStream({\n        cameraId,\n        microphoneId,\n        speakerId,\n      }).then((stream: any) => {\n        !ref.current && setStream(stream);\n      }).finally(() => {\n        lock.current = false;\n      })\n    }\n\n    if (platform === 'electron') {\n      const nativeClient = rtcClient as AgoraElectronClient;\n      const stream = nativeClient.createStream({\n        streamID: 0,\n        cameraId,\n        microphoneId,\n        speakerId,\n      })\n      setStream(stream);\n      lock.current = false;\n    }\n  }, [platform, speakerId, cameraId, microphoneId]);\n\n  const interval = useRef<any>(null);\n\n  useEffect(() => {\n    if (!stream || !stream.getAudioLevel) return;\n    interval.current = setInterval(() => {\n      !ref.current && setVolume(stream.getAudioLevel())\n    }, 300);\n    return () => {\n      interval.current && clearInterval(interval.current);\n      interval.current = null;\n    }\n  }, [stream]);\n\n  useEffect(() => {\n    if (!stream) return;\n    if (platform === 'electron') {\n      console.log(\"[electron-client] add volume event listener\");\n      const onVolumeChange = (speakers: any[], speakerNumber: number, totalVolume: number)=> {\n        setVolume(Number((totalVolume / 255).toFixed(3)))\n      }\n      const rtcClient: AgoraWebClient | AgoraElectronClient = roomStore.rtcClient;\n      const nativeClient = rtcClient as AgoraElectronClient;\n      nativeClient.rtcEngine.setClientRole(1);\n      const res = nativeClient.rtcEngine.enableAudioVolumeIndication(1000, 3, true);\n      console.log(\"enableAudioVolumeIndication(1000, 3, true), \", res)\n      nativeClient.rtcEngine.on('groupAudioVolumeIndication', onVolumeChange);\n      console.log('startplayback on result', nativeClient.rtcEngine.startAudioRecordingDeviceTest(300));\n      return () => {\n        nativeClient.rtcEngine.off(\"groupAudioVolumeIndication\", onVolumeChange);\n        console.log('startplayback off result', nativeClient.rtcEngine.stopAudioPlaybackDeviceTest());\n      }\n    }\n  }, [stream]);\n\n  const PreviewPlayer = useCallback(() => {\n    if (!stream) return null;\n    return (\n      <VideoPlayer\n        domId={\"local\"}\n        preview={true}\n        stream={stream}\n        streamID={0}\n        video={true}\n        audio={true}\n        local={true}\n      />\n    )\n\n  }, [stream]);\n\n  const MicrophoneVolume = useCallback(() => {\n    return (<VoiceVolume volume={volume}/>)\n  }, [volume]);\n\n  const handleSave = (args: {camera: number, microphone: number, speaker: number, speakerVolume: number}) => {\n    const { camera, microphone, speaker, speakerVolume } = args;\n    const cameraId = cameraList[camera] ? cameraList[camera].value : '';\n    const microphoneId = microphoneList[microphone] ? microphoneList[microphone].value : '';\n    const speakerId = speakerList[speaker] ? speakerList[speaker].value : '';\n    const mediaInfo: MediaDeviceState = {\n      cameraId,\n      microphoneId,\n      speakerId,\n      camera,\n      microphone,\n      speaker,\n      speakerVolume,\n    }\n    ref.current = true;\n    roomStore.updateDevice(mediaInfo);\n    if (stream && stream.close) {\n      stream.close();\n    }\n  }\n\n  return {\n    volume,\n    cameraList,\n    microphoneList,\n    speakerList,\n    camera,\n    microphone,\n    speaker,\n    setCamera,\n    setMicrophone,\n    setSpeaker,\n    speakerVolume,\n    setSpeakerVolume,\n    PreviewPlayer,\n    MicrophoneVolume,\n    save: handleSave,\n  }\n}\n","import React, { useEffect } from 'react';\nimport {useHistory} from 'react-router-dom';\nimport SettingCard from '../components/setting-card';\nimport { isElectron } from '../utils/platform';\nimport { roomStore } from '../stores/room';\nimport {AgoraWebClient} from '../utils/agora-web-client';\nimport {platform} from '../utils/platform';\n\nfunction DeviceTest() {\n  const history = useHistory();\n\n  const handleClick = (evt: any) => {\n    history.push('/')\n  }\n\n  useEffect(() => {\n    if (platform === 'web') {\n      const webClient = roomStore.rtcClient as AgoraWebClient;\n      return () => {\n        if (webClient.tmpStream) {\n          webClient.tmpStream.isPlaying() && webClient.tmpStream.stop();\n          webClient.tmpStream.close();\n        }\n      }\n    }\n  }, []);\n\n  return (\n    <div className={`flex-container ${isElectron ? 'draggable' : 'home-cover-web'}`}>\n      <SettingCard handleFinish={handleClick} />\n    </div>\n  )\n}\n\nexport default React.memo(DeviceTest);","export interface ChatMessage {\n  account: string\n  text: string\n  link?: string\n  ts: number\n  id: string\n}\nexport enum ClassState {\n  CLOSED = 0,\n  STARTED = 1\n}\n\nexport interface AgoraMediaStream {\n  streamID: number\n  local: boolean\n  account?: string\n  stream?: any\n  video?: boolean\n  audio?: boolean\n  playing?: boolean\n}\n\nexport class AgoraStream {\n  constructor(\n    public readonly stream: any = stream,\n    public readonly streamID: number = streamID,\n    public readonly local: boolean = local,\n  ) {\n  }\n}","import React, { useState, useEffect, useRef } from 'react';\nimport Icon from './icon';\nimport SettingCard from '../components/setting-card';\nimport './nav.scss';\nimport Button from './custom-button';\nimport * as moment from 'moment';\nimport { ClassState } from '../utils/types';\nimport { NetworkQualityEvaluation } from '../utils/helper';\nimport { usePlatform } from '../containers/platform-container';\nimport {AgoraWebClient} from '../utils/agora-web-client';\nimport { AgoraElectronClient } from '../utils/agora-electron-client';\nimport { isElectron, platform } from '../utils/platform';\nimport { useRoomState } from '../containers/root-container';\nimport { roomStore } from '../stores/room';\nimport { globalStore } from '../stores/global';\nimport { t } from '../i18n';\nimport Log from '../utils/LogUploader';\nimport { Tooltip } from '@material-ui/core';\n\ninterface NavProps {\n  delay: string\n  network: string\n  cpu: string\n  role: number\n  roomName: string\n  time: number\n  showSetting: boolean\n  classState: boolean\n  onCardConfirm: (type: string) => void\n  handleClick: (type: string) => void\n}\n\nconst networkQualityIcon: {[key: string]: string} = {\n  'excellent': 'network-good',\n  'good': 'network-good',\n  'poor': 'network-normal',\n  'bad': 'network-normal',\n  'very bad': 'network-bad',\n  'down': 'network-bad',\n  'unknown': 'network-bad',\n}\n\nexport function Nav ({\n  delay,\n  network,\n  cpu,\n  role,\n  roomName,\n  time,\n  handleClick,\n  showSetting,\n  classState,\n  onCardConfirm,\n}: NavProps) {\n\n  const {NavBtn} = usePlatform();\n    \n  const handleFinish = (evt: any) => {\n    onCardConfirm('setting');\n  }\n\n  return (\n    <>\n    <div className={`nav-container ${isElectron ? 'draggable' : ''}`}>\n      <div className=\"class-title\">\n        <span className=\"room-name\">{roomName}</span>\n          {+role === 1 ? \n            <Button className={`nav-button ${classState ? \"stop\" : \"start\"}`} name={classState ? t('nav.class_end') : t('nav.class_start')} onClick={(evt: any) => {\n              handleClick(\"classState\")\n            }} /> : null}\n\n            {/* <Button className={`nav-button ${ \"stop\" }`} name={t('nav.class_end')} onClick={(evt: any) => {\n              handleClick(\"classState\")\n            }} /> */}\n        \n      </div>\n      <div className=\"network-state\">\n        {platform === 'web' ? <span className=\"net-field\">{t('nav.delay')}<span className=\"net-field-value\">{delay}</span></span> : null}\n        {/* <span className=\"net-field\">Packet Loss Rate: <span className=\"net-field-value\">{lossPacket}</span></span> */}\n        <span className=\"net-field net-field-container\">\n          {t('nav.network')}\n          <span className={`net-field-value ${networkQualityIcon[network]}`} style={{marginLeft: '.2rem'}}>\n          </span>\n        </span>\n        {platform === 'electron' ? <span className=\"net-field\">{t('nav.cpu')}<span className=\"net-field-value\">{cpu}</span></span> : null}\n      </div>\n      <div className=\"menu\">\n        <div className=\"timer\">\n          <Icon className=\"icon-time\" disable />\n          <span className=\"time\">{moment.utc(time).format('HH:mm:ss')}</span>\n        </div>\n        <span className=\"menu-split\" />\n        <div className={platform === 'web' ? \"btn-group\" : 'electron-btn-group' }>\n          {platform === 'web' ?\n            <>\n            <Tooltip title={t(\"icon.setting\")} placement=\"bottom\">\n              <span>\n                <Icon className=\"icon-setting\" onClick={(evt: any) => {\n                  handleClick(\"setting\");\n                }}/>\n              </span>\n            </Tooltip>\n\n            </> : null\n          }\n          <Tooltip title={t(\"icon.upload-log\")} placement=\"bottom\">\n            <span>\n              <Icon className={globalStore.state.lock ? \"icon-loading\" : \"icon-upload\"} onClick={(evt: any) => {\n                handleClick('uploadLog')\n              }}></Icon>\n            </span>\n          </Tooltip>\n          <Tooltip title={t(\"icon.exit-room\")} placement=\"bottom\">\n            <span>\n              <Icon className=\"icon-exit\" onClick={(evt: any) => {\n                handleClick(\"exit\");\n              }} />\n            </span>\n          </Tooltip>\n        </div>\n        <NavBtn />\n      </div>\n    </div>\n    {showSetting ? \n      <SettingCard className=\"internal-card\"\n        handleFinish={handleFinish} /> : null\n    }\n    </>\n  )\n}\n\nexport default function NavContainer() {\n  const {\n    platform\n  } = usePlatform();\n\n  const ref = useRef<boolean>(false);\n\n  const [time, updateTime] = useState<number>(0);\n\n  const [timer, setTimer] = useState<any>(null);\n\n  const calcDuration = (time: number) => {\n    return setInterval(() => {\n      !ref.current && updateTime(+Date.now() - time);\n    }, 150, time)\n  }\n\n  const [card, setCard] = useState<boolean>(false);\n\n  const [rtt, updateRtt] = useState<number>(0);\n  const [quality, updateQuality] = useState<string>('unknown');\n  const [cpuUsage, updateCpuUsage] = useState<number>(0);\n\n  useEffect(() => {\n    return () => {\n      ref.current = true;\n      if (timer) {\n        clearInterval(timer);\n        setTimer(null);\n      }\n    }\n  }, []);\n\n  const roomState = useRoomState();\n\n  const me = roomState.me;\n\n  useEffect(() => {\n    const rtcClient = roomStore.rtcClient;\n    if (platform === 'web') {\n      const webClient = rtcClient as AgoraWebClient;\n      webClient.rtc.on('watch-rtt', (rtt: number) => {\n        !ref.current && updateRtt(rtt);\n      });\n      webClient.rtc.on('network-quality', (evt: any) => {\n        const quality = NetworkQualityEvaluation(evt);\n        !ref.current && updateQuality(quality);\n      })\n      return () => {\n        webClient.rtc.off('watch-rtt', () => {});\n        webClient.rtc.off('network-quality', () => {});\n      }\n    }\n    if (platform === 'electron') {\n      const nativeClient = rtcClient as AgoraElectronClient;\n      nativeClient.on('rtcStats', ({cpuTotalUsage}: any) => {\n        !ref.current && updateCpuUsage(cpuTotalUsage);\n      });\n      nativeClient.on('networkquality', (\n        uid: number,\n        txquality: number,\n        rxquality: number) => {\n        if (uid === 0) {\n          const quality = NetworkQualityEvaluation({\n            downlinkNetworkQuality: rxquality,\n            uplinkNetworkQuality: txquality,\n          });\n          !ref.current && updateQuality(quality);\n        }\n      })\n\n      return () => {\n        nativeClient.off('rtcStats', () => {});\n        nativeClient.off('networkquality', () => {});\n        nativeClient.off('audioquality', () => {});\n      }\n    }\n  }, []);\n\n  const courseState = roomState.course.courseState;\n  const course = roomState.course;\n\n  useEffect(() => {\n    if (courseState === ClassState.STARTED\n      && timer === null) {\n        const now: number = +Date.now();\n        setTimer(calcDuration(now));\n    }\n    if (timer && courseState === ClassState.CLOSED) {\n      clearInterval(timer);\n      setTimer(null);\n    }\n  }, [courseState]);\n\n  const lock = useRef<boolean>(false);\n\n  useEffect(() => {\n    return () => {\n      lock.current = true;\n    }\n  }, []);\n\n  const updateClassState = () => {\n    if (!lock.current) {\n      lock.current = true;\n      roomStore.updateCourse({\n        courseState: +!Boolean(roomStore.state.course.courseState)\n      }).then(() => {\n\n        // alert(roomStore.state.course.courseState);\n      }).catch(console.warn)\n      .finally(() => {\n        lock.current = false;\n      })\n    }\n    \n  };\n\n  const handleClick = (type: string) => {\n    if (type === 'setting') {\n      setCard(true);\n    } else if (type === 'exit') {\n      globalStore.showDialog({\n        type: 'exitRoom',\n        message: t('toast.quit_room'),\n      });\n    } else if (type === 'classState') {\n      updateClassState();\n    } else if (type === 'uploadLog') {\n      globalStore.lock()\n      Log.doUpload().then((resultCode: any) => {\n        globalStore.showDialog({\n          type: 'uploadLog',\n          message: t('toast.show_log_id', {reason: `${resultCode}`})\n        });\n      }).finally(() => {\n        globalStore.unlock()\n      })\n    }\n  }\n\n  const handleCardConfirm = (type: string) => {\n    switch (type) {\n      case 'setting':\n        setCard(false);\n        return;\n      case 'exitRoom':\n        globalStore.removeDialog();\n        return;\n    }\n  }\n\n  return (\n    <Nav \n      role={me.role}\n      roomName={course.roomName}\n      classState={Boolean(course.courseState)}\n      delay={`${rtt}ms`}\n      time={time}\n      network={`${quality}`}\n      cpu={`${cpuUsage}%`}\n      showSetting={card}\n      onCardConfirm={handleCardConfirm}\n      handleClick={handleClick}\n    />\n  )\n}","import React, {useMemo} from 'react';\nimport Button from '../custom-button';\nimport {Dialog, DialogContent, DialogContentText} from '@material-ui/core';\n\nimport './dialog.scss';\nimport { useGlobalState } from '@/containers/root-container';\nimport { roomStore } from '@/stores/room';\nimport { globalStore } from '@/stores/global';\nimport { useHistory } from 'react-router-dom';\n// import { RoomMessage } from '@/utils/agora-rtm-client';\nimport { t } from '@/i18n';\nimport { isElectron } from '@/utils/platform';\nimport { eduApi } from '@/services/edu-api';\n\ninterface RoomProps {\n  onConfirm: (type: string) => void\n  onClose: (type: string) => void\n  desc: string\n  type: string\n}\n\nfunction RoomDialog(\n{\n  onConfirm,\n  onClose,\n  desc,\n  type\n}: RoomProps) {\n\n  const handleClose = () => {\n    onClose(type)\n  };\n\n  const handleConfirm = () => {\n    onConfirm(type)\n  }\n\n  return (\n    <div>\n      <Dialog\n        disableBackdropClick\n        open={true}\n        onClose={handleClose}\n        aria-labelledby=\"alert-dialog-title\"\n        aria-describedby=\"alert-dialog-description\"\n      >\n        <DialogContent\n          className=\"modal-container\"\n        >\n          <DialogContentText className=\"dialog-title\">\n            {desc}\n          </DialogContentText>\n          <div className=\"button-group\">\n            <Button name={t(\"toast.confirm\")} className=\"confirm\" onClick={handleConfirm} color=\"primary\" />\n            <Button name={t(\"toast.cancel\")} className=\"cancel\" onClick={handleClose} color=\"primary\" />\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\nconst DialogContainer = () => {\n\n  const history = useHistory();\n  const {dialog} = useGlobalState();\n\n  const visible = useMemo(() => {\n    if (!dialog.type) return false;\n    return true;\n  }, [dialog]);\n\n  const onClose = (type: string) => {\n    if (type === 'exitRoom') {\n      globalStore.removeDialog();\n    }\n    else if (type === 'apply') {\n      eduApi\n      .teacherRejectApply(\n        roomStore.state.course.roomId,\n        roomStore.state.applyUser.userId,\n      )\n      .then(() => {\n        globalStore.showToast({\n          type: 'peer_hands_up', \n          message: t('toast.reject_co_video')\n        });\n        globalStore.removeNotice();\n        globalStore.removeDialog();\n      })\n      .catch((err: any) => {\n        console.warn(err)\n      })\n    } else if (type === 'uploadLog') {\n      globalStore.removeDialog()\n    }\n  }\n\n  const onConfirm = (type: string) => {\n    if (type === 'exitRoom') {\n      globalStore.showLoading()\n      roomStore.exitRoom().finally(() => {\n        globalStore.removeDialog();\n        globalStore.stopLoading()\n        if (isElectron) {\n          history.push('/')\n        } else {\n          history.goBack()\n        }\n      })\n    }\n    else if (type === 'apply') {\n      // p2p message accept coVideo\n      // 老师同意学生连麦申请\n      eduApi.teacherAcceptApply(roomStore.state.course.roomId, roomStore.state.applyUser.userId)\n        .then(() => {\n          globalStore.showToast({\n            type: 'peer_hands_up', \n            message: t('toast.accept_co_video')\n          });\n          globalStore.removeNotice();\n          globalStore.removeDialog();\n        })\n        .catch((err: any) => {\n          console.warn(err)\n        })\n    }\n    else if (type === 'uploadLog') {\n      globalStore.removeDialog()\n    }\n\n    return;\n  }\n\n  return (\n    visible ? \n      <RoomDialog \n        type={dialog.type}\n        desc={dialog.message}\n        onClose={onClose}\n        onConfirm={onConfirm}\n      /> : \n      null\n  )\n}\n\n\nexport default React.memo(DialogContainer);","import React from 'react';\nimport './native-shared-window.scss';\nimport Button from './custom-button';\nimport { usePlatform } from '../containers/platform-container';\nimport { AgoraElectronClient } from '../utils/agora-electron-client';\nimport { AgoraStream } from '../utils/types';\nimport { globalStore } from '../stores/global';\nimport { roomStore } from '../stores/room';\nimport { useGlobalState } from '../containers/root-container';\nimport { eduApi } from '../services/edu-api';\nimport { t } from '../i18n';\n\nexport const WindowItem: React.FC<any> = ({\n  ownerName,\n  name,\n  className,\n  windowId,\n  image,\n}) => {\n\n  return (\n    <div className={className ? className : ''} >\n      <div className=\"screen-image\">\n        <div className=\"content\" style={{ backgroundImage: `url(data:image/png;base64,${image})` }}>\n        </div>\n      </div>\n      <div className=\"screen-meta\">{name}</div>\n    </div>\n  )\n}\n\nexport interface WindowListProps {\n  title: string\n  items: any[]\n  windowId: number\n  selectWindow: (windowId: any) => void\n  confirm: (evt: any) => void\n  cancel: (evt: any) => void\n}\n\nexport const WindowList: React.FC<WindowListProps> = ({\n  title,\n  items,\n  windowId,\n  selectWindow,\n  confirm,\n  cancel\n}) => {\n  return (\n    <div className=\"window-picker-mask\">\n      <div className=\"window-picker\">\n        <div className=\"header\">\n          <div className=\"title\">{title}</div>\n          <div className=\"cancelBtn\" onClick={cancel}></div>\n        </div>\n        <div className='screen-container'>\n          {\n            items.map((it: any, key: number) =>\n              <div className=\"screen-item\" \n                key={key}\n                onClick={() => {\n                  selectWindow(it.windowId);\n                }}\n                onDoubleClick={confirm}\n                >\n                <WindowItem\n                  ownerName={it.ownerName}\n                  name={it.name}\n                  className={`window-item ${it.windowId === windowId ? 'active' : ''}`}\n                  windowId={it.windowId}\n                  image={it.image}\n                />\n              </div>\n            )\n          }\n        </div>\n        <div className='footer'>\n          <Button className={'share-confirm-btn'} name={\"start\"}\n            onClick={confirm} />\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default function NativeSharedWindowContainer() {\n\n  const {\n    platform\n  } = usePlatform();\n\n  const globalState = useGlobalState();\n  const nativeWindowInfo = globalState.nativeWindowInfo;\n  const [windowId, setWindowId] = React.useState<any>('');\n\n  return (\n    nativeWindowInfo.visible ? \n    <WindowList\n      windowId={windowId}\n      title={'Please select and click window for share'}\n      items={nativeWindowInfo.items}\n      cancel={() => {\n        globalStore.setNativeWindowInfo({visible: false, items: []});\n      }}\n      selectWindow={(windowId: any) => {\n        setWindowId(windowId)\n      }}\n      confirm={async (evt: any) => {\n        if (!windowId) {\n          console.warn(\"windowId is empty\");\n          return;\n        }\n        try {\n          if (platform === 'electron') {\n            globalStore.showLoading();\n            const rtcClient = roomStore.rtcClient;\n            const nativeClient = rtcClient as AgoraElectronClient;\n            // screen share token\n            let {screenToken} = await eduApi.refreshToken();\n            let electronStream = await nativeClient.startScreenShare(\n              windowId,\n              +roomStore.state.course.screenId,\n              roomStore.state.course.rid,\n              screenToken,\n              roomStore.state.appID,\n            );\n            roomStore.addLocalSharedStream(new AgoraStream(electronStream, electronStream.uid, true));\n          }\n        } catch(err) {\n          const rtcClient = roomStore.rtcClient;\n          const nativeClient = rtcClient as AgoraElectronClient;\n          nativeClient.releaseScreenShare()\n          globalStore.showToast({\n            type: 'nativeScreenShare',\n            message: t(\"electron.start_screen_share_failed\")\n          })\n          console.warn(JSON.stringify(err))\n          throw err;\n        } finally {\n          globalStore.stopLoading();\n          globalStore.setNativeWindowInfo({visible: false, items: []});\n        }\n      }}\n    />\n    : null\n  )\n}","import React, { useEffect, useMemo, useRef } from 'react';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport Nav from '@/components/nav';\nimport RoomDialog from '@/components/dialog';\nimport { AgoraStream } from '@/utils/types';\nimport './room.scss';\nimport NativeSharedWindow from '@/components/native-shared-window';\nimport { roomStore } from '@/stores/room';\nimport { useRoomState } from '@/containers/root-container';\nimport { globalStore } from '@/stores/global';\nimport { platform } from '@/utils/platform';\nimport { AgoraWebClient } from '@/utils/agora-web-client';\nimport { AgoraStreamSpec } from '@/utils/agora-rtc-client';\nimport { AgoraElectronClient, StreamType } from '@/utils/agora-electron-client';\nimport { t } from '@/i18n';\nimport { eduApi } from '@/services/edu-api';\nimport { genUUID } from '@/utils/api';\n// import { useInterval } from 'react-use';\n\nexport const roomTypes = [\n  {value: 0, path: 'one-to-one'},\n  {value: 1, path: 'small-class'},\n  {value: 2, path: 'big-class'},\n];\n\n// const delay = 5000\n\nexport function RoomPage({ children }: any) {\n\n  const history = useHistory();\n\n  const lock = useRef<boolean>(false);\n\n  // useInterval(() => {\n  //   roomStore.fetchRoomState()\n  // }, delay)\n\n  useEffect(() => {\n    const me = roomStore.state.me;\n    const course = roomStore.state.course;\n\n    if (!me.account || !course.roomName) {\n      history.push('/');\n    }\n\n    lock.current = true;\n    if (roomStore.state.rtm.joined) return;\n    globalStore.showLoading();\n    roomStore.fetchCurrentRoom().then(() => {\n    }).catch((err: any) => {\n      if (err.reason) {\n        globalStore.showToast({\n          type: 'rtmClient',\n          message: t('toast.rtm_login_failed_reason', {reason: err.reason}),\n        })\n      } else {\n        globalStore.showToast({\n          type: 'rtmClient',\n          message: t('toast.rtm_login_failed'),\n        })\n      }\n      console.warn(err)\n    }).finally(() => {\n      globalStore.stopLoading()\n    })\n  }, []);\n\n  const roomType = roomTypes[roomStore.state.course.roomType];\n\n  const location = useLocation();\n\n  const roomState = useRoomState();\n  const me = roomStore.state.me;\n  // const course = roomStore.state.course;\n  const classroom = Boolean(location.pathname.match(/classroom/));\n  // const isBigClass = Boolean(location.pathname.match(/big-class/));\n  const isSmallClass = Boolean(location.pathname.match(/small-class/));\n  \n  useEffect(() => {\n    return () => {\n      globalStore.removeUploadNotice();\n      roomStore.exitAll()\n      .then(() => {\n      })\n      .catch(console.warn)\n      .finally(() => {\n      });\n    }\n  }, [location]);\n\n  const rtc = useRef<boolean>(false);\n  \n  const canPublish = useMemo(() => {\n    return me.coVideo;\n  }, [me.coVideo]);\n\n  useEffect(() => {\n    return () => {\n      rtc.current = true\n    }\n  },[]);\n\n  const publishLock = useRef<boolean>(false);\n\n  const {rtcJoined, uid, role, mediaDevice} = useMemo(() => {\n    return {\n      rtcJoined: roomState.rtc.joined,\n      uid: roomState.me.uid,\n      role: roomState.me.role,\n      mediaDevice: roomState.mediaDevice,\n    }\n  }, [roomState]);\n\n  useEffect(() => {\n    if (!location.pathname.match(/big-class/) || me.role === 1) return\n    // if (course.linkId) return;\n    const rtcClient = roomStore.rtcClient;\n    if (platform === 'web') {\n      const webClient = rtcClient as AgoraWebClient;\n      if (!webClient.published) return;\n      Promise.all([\n        webClient\n        .unpublishLocalStream()\n      ])\n        .then(() => {\n          console.log(\"[agora-web] unpublish local stream\");\n        }).catch(console.warn)\n    }\n\n    if (platform === 'electron') {\n      const nativeClient = rtcClient as AgoraElectronClient;\n      if (!nativeClient.published) return;\n      nativeClient.unpublish();\n    }\n\n  }, [me.role, location.pathname, canPublish]);\n\n  useEffect(() => {\n    if (!rtcJoined || rtc.current) return;\n\n    if (platform === 'web') {\n      const webClient = roomStore.rtcClient as AgoraWebClient;\n      const uid = +roomStore.state.me.uid as number;\n      const streamSpec: AgoraStreamSpec = {\n        streamID: uid,\n        video: true,\n        audio: true,\n        mirror: false,\n        screen: false,\n        microphoneId: mediaDevice.microphoneId,\n        cameraId: mediaDevice.cameraId,\n        audioOutput: {\n          volume: mediaDevice.speakerVolume,\n          deviceId: mediaDevice.speakerId\n        }\n      }\n      console.log(\"canPb>>> \", canPublish, roomStore.state.me.uid);\n      if (canPublish && !publishLock.current) {\n        publishLock.current = true;\n        Promise.all([\n          webClient\n          .publishLocalStream(streamSpec)\n        ])\n        .then((res: any[]) => {\n          console.log(\"[agora-web] any: \", res[0], res[1]);\n          console.log(\"[agora-web] publish local stream\");\n        }).catch(console.warn)\n        .finally(() => {\n          publishLock.current = false;\n        })\n      }\n    }\n\n    if (platform === 'electron' && rtcJoined) {\n      const nativeClient = roomStore.rtcClient as AgoraElectronClient;\n      if (canPublish && !publishLock.current) {\n        publishLock.current = true;\n        console.log(\"board updateLocal\")\n        nativeClient.publish();\n        publishLock.current = false;\n      }\n    }\n  }, [\n    rtcJoined,\n    uid,\n    role,\n    mediaDevice,\n    canPublish,\n  ]);\n\n  useEffect(() => {\n    if (!roomState.me.uid || !roomState.course.rid ||!roomState.appID) return;\n    if (classroom) {\n      if (platform === 'web') {\n        const webClient = roomStore.rtcClient as AgoraWebClient;\n        if (webClient.joined || rtc.current) {\n          return;\n        }\n        console.log(\"[agora-rtc] add event listener\");\n        webClient.rtc.on('onTokenPrivilegeWillExpire', (evt: any) => {\n          // you need obtain the `newToken` token from server side \n          eduApi.refreshToken().then((res: any) => {\n            const newToken = res.rtcToken\n            webClient.rtc.renewToken(newToken);\n            console.log('[agora-web] onTokenPrivilegeWillExpire', evt);\n          })\n        });\n        webClient.rtc.on('onTokenPrivilegeDidExpire', (evt: any) => {\n          // you need obtain the `newToken` token from server side \n          eduApi.refreshToken().then((res: any) => {\n            const newToken = res.rtcToken\n            webClient.rtc.renewToken(newToken);\n            console.log('[agora-web] onTokenPrivilegeDidExpire', evt);\n          })\n        });\n        webClient.rtc.on('error', (evt: any) => {\n          console.log('[agora-web] error evt', evt);\n        });\n        webClient.rtc.on('stream-published', ({ stream }: any) => {\n          const _stream = new AgoraStream(stream, stream.getId(), true);\n          roomStore.addLocalStream(_stream);\n          roomStore.addRTCUser(stream.getId())\n        });\n        webClient.rtc.on('stream-subscribed', ({ stream }: any) => {\n          const streamID = stream.getId();\n          // when streamID is not share_id use switch high or low stream in dual stream mode\n          if (location.pathname.match(/small-class/)) {\n            if (roomStore.state.course.teacherId\n              && roomStore.state.course.teacherId === `${streamID}`) {\n              webClient.setRemoteVideoStreamType(stream, 0);\n              console.log(\"[agora-web] dual stream set high for teacher\");\n            }\n            else {\n              webClient.setRemoteVideoStreamType(stream, 1);\n              console.log(\"[agora-web] dual stream set low for student\");\n            }\n          }\n          const _stream = new AgoraStream(stream, stream.getId(), false);\n          console.log(\"[agora-web] subscribe remote stream, id: \", stream.getId());\n          roomStore.addRemoteStream(_stream);\n        });\n        webClient.rtc.on('stream-added', ({ stream }: any) => {\n          console.log(\"[agora-web] added remote stream, id: \", stream.getId());\n          webClient.subscribe(stream);\n        });\n        webClient.rtc.on('stream-removed', ({ stream }: any) => {\n          console.log(\"[agora-web] removed remote stream, id: \", stream.getId());\n          // const id = stream.getId();\n          roomStore.removeRemoteStream(stream.getId());\n        });\n        webClient.rtc.on('peer-online', ({uid}: any) => {\n          console.log(\"[agora-web] peer-online, id: \", uid);\n          roomStore.addRTCUser(uid);\n        });\n        webClient.rtc.on('peer-leave', ({ uid }: any) => {\n          console.log(\"[agora-web] peer-leave, id: \", uid);\n          roomStore.removePeerUser(uid);\n          roomStore.removeRemoteStream(uid);\n\n          if (roomStore.state.me.role === 1 && roomStore.state.course.roomType === 2) {\n            if (roomStore.state.applyUser.account) {\n              globalStore.showToast({\n                type: 'rtmClient',\n                message: t('toast.student_peer_leave', {reason: roomStore.state.applyUser.account}),\n              })\n            }\n          }\n        });\n        webClient.rtc.on(\"stream-fallback\", ({ uid, attr }: any) => {\n          const msg = attr === 0 ? 'resume to a&v mode' : 'fallback to audio mode';\n          console.info(`[agora-web] stream: ${uid} fallback: ${msg}`);\n        })\n        rtc.current = true;\n        // WARN: IF YOU ENABLED APP CERTIFICATE, PLEASE SIGN YOUR TOKEN IN YOUR SERVER SIDE AND OBTAIN IT FROM YOUR OWN TRUSTED SERVER API\n        webClient\n          .joinChannel({\n            uid: +roomState.me.uid, \n            channel: roomState.course.rid,\n            token: roomState.me.rtcToken,\n            dual: isSmallClass,\n            appId: roomState.appID,\n          }).then(() => {\n            \n          }).catch(console.warn).finally(() => {\n            rtc.current = false;\n          });\n        return () => {\n          const events = [\n            'onTokenPrivilegeWillExpire',\n            'onTokenPrivilegeDidExpire',\n            'error',\n            'stream-published',\n            'stream-subscribed',\n            'stream-added',\n            'stream-removed',\n            'peer-online',\n            'peer-leave',\n            'stream-fallback'\n          ]\n          for (let eventName of events) {\n            webClient.rtc.off(eventName, () => {});\n          }\n          console.log(\"[agora-web] remove event listener\");\n          !rtc.current && webClient.exit().then(() => {\n            console.log(\"[agora-web] do remove event listener\");\n          }).catch(console.warn)\n            .finally(() => {\n              rtc.current = true;\n              roomStore.removeLocalStream();\n            });\n        }\n      }\n\n      if (platform === 'electron') {\n        const rtcClient = roomStore.rtcClient;\n        const nativeClient = rtcClient as AgoraElectronClient;\n        if (nativeClient.joined) {\n          console.log(\"[agora-electron] electron joined \", nativeClient.joined);\n          return;\n        }\n        nativeClient.on('executefailed', (...args: any[]) => {\n          console.warn(\"[agora-electron] executefailed\", ...args);\n        });\n        nativeClient.on('error', (evt: any) => {\n          console.warn('[agora-electron] error evt', evt);\n        });\n        // when trigger `joinedchannel` it means publish rtc stream success\n        nativeClient.on('joinedchannel', (evt: any) => {\n          console.log(\"[agora-electron stream-published\")\n          const stream = evt.stream;\n          const _stream = new AgoraStream(stream, stream.uid, true);\n          roomStore.addLocalStream(_stream);\n        });\n        // when trigger `userjoined` it means peer user & peer stream is online\n        nativeClient.on('userjoined', (evt: any) => {\n          const stream = evt.stream;\n          const _stream = new AgoraStream(stream, stream.uid, false);\n          if (location.pathname.match(/small-class/) && +stream.uid !== +roomStore.state.course.screenId) {\n            if (roomStore.state.course.teacherId\n              && roomStore.state.course.teacherId === `${stream.uid}`) {\n              const res = nativeClient.rtcEngine.setRemoteVideoStreamType(stream, 0);\n              console.log(\"[agora-electron] dual stream set high for teacher, \", res);\n            }\n            else {\n              const res = nativeClient.rtcEngine.setRemoteVideoStreamType(stream, 1);\n              console.log(\"[agora-electron] dual stream set low for student, \", res);\n            }\n          }\n          if (_stream && _stream.stream && +roomStore.state.course.screenId === +stream.uid) {\n            if (+roomStore.state.course.screenId === +roomStore.state.me.screenId) {\n              _stream.stream.type = StreamType.localVideoSource\n            } else {\n              _stream.stream.type = StreamType.remoteVideoSource\n            }\n          }\n          roomStore.addRTCUser(stream.uid);\n          roomStore.addRemoteStream(_stream);\n        });\n        // when trigger `removestream` it means peer user & peer stream is offline\n        nativeClient.on('removestream', ({ uid }: any) => {\n          roomStore.removePeerUser(uid);\n          roomStore.removeRemoteStream(uid);\n        });\n        // WARN: IF YOU ENABLED APP CERTIFICATE, PLEASE SIGN YOUR TOKEN IN YOUR SERVER SIDE AND OBTAIN IT FROM YOUR OWN TRUSTED SERVER API\n        nativeClient.joinChannel({\n          uid: +roomState.me.uid, \n          channel: roomState.course.rid,\n          token: roomState.me.rtcToken,\n          dual: isSmallClass\n        });\n        roomStore.setRTCJoined(true);\n        return () => {\n          const events = [\n            'executefailed',\n            'error',\n            'joinedchannel',\n            'userjoined',\n            'removestream',\n          ]\n          for (let eventName of events) {\n            nativeClient.off(eventName, () => {})\n          }\n          !rtc.current && nativeClient.exit();\n          !rtc.current && roomStore.setRTCJoined(false);\n          !rtc.current && roomStore.removeLocalStream();\n        }\n      }\n    }\n  }, [JSON.stringify([roomState.me.uid, roomState.course.rid, roomState.appID])]);\n\n  return (\n    <div className={`classroom ${roomType.path}`}>\n      <NativeSharedWindow />\n      <Nav />\n      {children}\n      <RoomDialog />\n    </div>\n  );\n}\n\n","import React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { useGlobalState } from '../containers/root-container';\n\nconst useStyles = makeStyles(theme => ({\n  progress: {\n    margin: theme.spacing(2),\n    color: '#44A2FC'\n  },\n  container: {\n    position: 'absolute',\n    top: '0px',\n    left: '0px',\n    height: '100%',\n    width: '100%',\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    background: '#ffffff',\n    opacity: 0.8,\n    zIndex: 99999\n  }\n}));\n\nexport const Loading: React.FC<{}> = () => {\n  const classes = useStyles();\n  return (\n    <div className={classes.container}>\n      <CircularProgress className={classes.progress} />\n    </div>\n  );\n}\n\nexport default function LoadContainer () {\n\n  const state = useGlobalState();\n\n  const loading = state.loading;\n\n  return (\n    loading ? <Loading /> : null\n  )\n}","import React, { useEffect, useRef, useState } from 'react';\nimport './toast.scss';\nimport {useGlobalState} from '../containers/root-container';\nimport { isEmpty } from 'lodash';\n\nexport interface SnackbarMessage {\n  message: string;\n  key: number;\n}\n\ninterface SnackbarsProps {\n  duration?: number\n}\n\nexport default function ConsecutiveSnackbars({\n  duration = 2500\n}: SnackbarsProps) {\n\n  const globalState = useGlobalState();\n\n  const queueRef = React.useRef<SnackbarMessage[]>([]);\n  const [messages, setMessages] = useState<SnackbarMessage[]>([]);\n  const timerRef = useRef<any>(null);\n\n  useEffect(() => {\n    if (messages.length > 0 && timerRef.current === null) {\n      timerRef.current = setTimeout(() => {\n        queueRef.current.shift()\n        setMessages([...queueRef.current]);\n        timerRef.current = null;\n      }, duration);\n    }\n  }, [messages]);\n\n  useEffect(() => {\n    if (queueRef.current && globalState.toast.message) {\n      queueRef.current.push({\n        message: globalState.toast.message,\n        key: +Date.now()\n      })\n      setMessages([...queueRef.current]);\n    }\n  }, [globalState.toast]);\n\n  return (\n    <div className=\"notice-message-container\">\n      {messages.map((message: any, idx: number) => \n        <div key={`${idx}${message.key}`} className={\"custom-toast\"}>\n          <div className=\"toast-container\">\n            <span className=\"text\">{message.message}</span>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","import React from 'react';\nimport './progress.scss';\nimport { CircularProgress } from '@material-ui/core';\n\ntype ProgressProps = {\n  title: string\n}\n\nexport const Progress: React.FC<ProgressProps> = ({\n  title,\n}) => {\n  return (\n    <div className=\"progress-cover\">\n      <div className=\"progress\">\n        <div className=\"content\">\n          <CircularProgress className=\"circular\"/>\n          <span className=\"title\">{title}...</span>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default React.memo(Progress);","import React from 'react';\nimport { Subject } from 'rxjs';\nimport { Player, PlayerPhase } from 'white-web-sdk';\nimport { useParams, useLocation, Redirect } from 'react-router';\nimport moment from 'moment';\nimport { Progress } from '@/components/progress/progress';\nimport { globalStore } from '@/stores/global';\nimport { WhiteboardAPI, RTMRestful } from '@/utils/api';\nimport { whiteboard } from '@/stores/whiteboard';\nimport { RtmPlayerState } from '@/components/whiteboard/agora/rtm-player';\nimport { eduApi } from '@/services/edu-api';\n\ninterface IObserver<T> {\n  subscribe: (setState: (state: T) => void) => void\n  unsubscribe: () => void\n  defaultState: T\n}\n\nexport function useObserver<T>(store: IObserver<T>) {\n  const [state, setState] = React.useState<T>(store.defaultState);\n  React.useEffect(() => {\n    store.subscribe((state: any) => {\n      setState(state);\n    });\n    return () => {\n      store.unsubscribe();\n    }\n  }, []);\n\n  return state;\n}\n\n\nexport interface IPlayerState {\n  beginTimestamp: number\n  duration: number\n  roomToken: string\n  mediaURL: string\n  isPlaying: boolean\n  progress: number\n\n  currentTime: number\n  phase: string\n  boardPlayPhase: PlayerPhase\n  isFirstScreenReady: boolean\n  isPlayerSeeking: boolean\n  isChatOpen: boolean\n  isVisible: boolean\n  replayFail: boolean\n  courseRecordData: {\n    startTime: number\n    endTime: number\n    url: string\n    boardId: string\n    status: number\n    statusText: string\n  }\n  player: any\n  timelineScheduler: any\n  videoPlayer: any\n}\n\nexport const defaultState: IPlayerState = {\n  beginTimestamp: 0,\n  duration: 0,\n  roomToken: '',\n  mediaURL: '',\n  isPlaying: false,\n  progress: 0,\n\n  currentTime: 0,\n  phase: 'waiting',\n  boardPlayPhase: PlayerPhase.Pause,\n  isFirstScreenReady: false,\n  isPlayerSeeking: false,\n  isChatOpen: false,\n  isVisible: false,\n  replayFail: false,\n\n  courseRecordData: {\n    startTime: -1,\n    endTime: -1,\n    url: '',\n    boardId: '',\n    status: 0,\n    statusText: '',\n  },\n  player: null,\n  videoPlayer: null,\n  timelineScheduler: null\n}\n\nclass ReplayStore {\n  public subject: Subject<IPlayerState> | null;\n  public state: IPlayerState | null;\n  public defaultState: IPlayerState = defaultState\n\n  constructor() {\n    this.subject = null;\n    this.state = null;\n  }\n\n  initialize() {\n    this.subject = new Subject<IPlayerState>();\n    this.state = defaultState;\n    this.subject.next(this.state);\n  }\n\n  subscribe(setState: any) {\n    this.initialize();\n    this.subject && this.subject.subscribe(setState);\n  }\n\n  unsubscribe() {\n    this.subject && this.subject.unsubscribe();\n    this.state = null;\n    this.subject = null;\n  }\n\n  commit(state: IPlayerState) {\n    this.subject && this.subject.next(state);\n  }\n\n  setPlayer(player: Player) {\n    if (!this.state) return;\n    this.state = {\n      ...this.state,\n      player\n    }\n    this.commit(this.state);\n  }\n\n  setCurrentTime(scheduleTime: number) {\n    if (!this.state) return;\n    this.state = {\n      ...this.state,\n      currentTime: scheduleTime\n    }\n    this.commit(this.state);\n  }\n\n  async getCourseRecordBy(recordId: string, roomId: string, userToken: string) {\n    if (!this.state) return;\n    if (this.state.courseRecordData.status === 2 && this.state.courseRecordData.url) return;\n    const {boardId, startTime, endTime, url, status, statusText} = await eduApi.getCourseRecordBy(recordId as string, roomId as string, userToken)\n    this.state = {\n      ...this.state,\n      courseRecordData: {\n        startTime,\n        endTime,\n        url,\n        boardId,\n        status,\n        statusText\n      }\n    }\n    this.commit(this.state)\n  }\n\n  updatePlayerStatus(isPlaying: boolean) {\n    if (!this.state) return;\n\n    this.state = {\n      ...this.state,\n      isPlaying,\n    }\n    if (!this.state.isPlaying && this.state.player) {\n      this.state.player.seekToScheduleTime(0);\n    }\n    this.commit(this.state);\n  }\n\n  updateProgress(progress: number) {\n    if (!this.state) return\n    this.state = {\n      ...this.state,\n      progress\n    }\n    this.commit(this.state);\n  }\n\n  setReplayFail(val: boolean) {\n    if (!this.state) return\n    this.state = {\n      ...this.state,\n      replayFail: val\n    }\n    this.commit(this.state);\n  }\n\n  updateWhiteboardPhase(boardPlayPhase: PlayerPhase) {\n    if (!this.state) return\n    let isPlaying = this.state.isPlaying;\n\n    if (boardPlayPhase === PlayerPhase.Playing) {\n      isPlaying = true;\n    }\n\n    if (boardPlayPhase === PlayerPhase.Ended || boardPlayPhase === PlayerPhase.Pause) {\n      isPlaying = false;\n    }\n\n    this.state = {\n      ...this.state,\n      boardPlayPhase,\n      isPlaying,\n    }\n    \n    this.commit(this.state);\n  }\n\n  // updatePhase(phase: PlayerPhase) {\n  //   if (!this.state) return\n  //   let isPlaying = this.state.isPlaying;\n\n  //   if (phase === PlayerPhase.Playing) {\n  //     isPlaying = true;\n  //   }\n\n  //   if (phase === PlayerPhase.Ended || phase === PlayerPhase.Pause) {\n  //     isPlaying = false;\n  //   }\n\n  //   this.state = {\n  //     ...this.state,\n  //     phase,\n  //     isPlaying,\n  //   }\n    \n  //   this.commit(this.state);\n  // }\n\n  updatePlayState(phase: any) {\n    if (!this.state) return\n\n    this.state = {\n      ...this.state,\n      phase,\n    }\n    \n    this.commit(this.state);\n  }\n\n  loadFirstFrame() {\n    console.log(\"invoke loadFirstFrame\")\n    if (!this.state) return\n    this.state = {\n      ...this.state,\n      isFirstScreenReady: true,\n    }\n    if (this.state.player) {\n      this.state.player.seekToScheduleTime(0)\n    }\n    console.log(\"invoke loadFirstFrame success\", this.state.isFirstScreenReady)\n    this.commit(this.state);\n  }\n\n  addWhiteboardPlayer(player: any) {\n    if (!this.state) return\n    this.state = {\n      ...this.state,\n      player: player\n    }\n    this.commit(this.state)\n  }\n\n  addVideoPlayer(player: any) {\n    if (!this.state) return\n    this.state = {\n      ...this.state,\n      videoPlayer: player\n    }\n    this.commit(this.state)\n  }\n\n  addTimeline(scheduler: any) {\n    if (!this.state) return\n    this.state = {\n      ...this.state,\n      timelineScheduler: scheduler\n    }\n    this.commit(this.state)\n  }\n\n  async joinRoom(roomId: string) {\n    const res = await eduApi.getWhiteboardBy(roomId);\n    return {\n      roomToken: res.boardToken,\n      uuid: res.boardId,\n    }\n  }\n}\n\nexport const replayStore = new ReplayStore();","import {useEffect, useState, useRef, useCallback, Fragment, useMemo} from 'react';\nimport {useAsync} from 'react-use';\nimport { RTMRestful, AgoraChannelMessage } from '@/utils/api/rtm-restful';\nimport moment from 'moment';\nimport React from 'react';\nimport { Message } from '@/components/chat/message';\n\nexport interface RtmReplayResult {\n  loading: boolean\n  list?: RtmReplayList \n}\n\nexport type RtmReplayList = AgoraChannelMessage[] | undefined;\n\nexport enum RtmPlayerState {\n  pending = 'pending',\n  loading = 'loading',\n  load = 'load',\n};\n\nexport type RtmReplayProps = {\n  channelName: string,\n  startTime: number,\n  endTime: number,\n  currentSeekTime: number,\n  senderId?: string,\n  onPhaseChanged?: (e: RtmPlayerState) => void,\n};\n\nconst RtmPlayer = ({currentSeekTime, senderId, ...props}: RtmReplayProps) => {\n\n  const ref = useRef<any>(null);\n\n  const [state, setState] = useState<RtmPlayerState>(RtmPlayerState.pending);\n\n  useEffect(() => {\n    props.onPhaseChanged && props.onPhaseChanged(state);\n  }, [state]);\n\n  const {value, loading} = useAsync<AgoraChannelMessage[] | undefined>(async (): Promise<AgoraChannelMessage[] | undefined> => {\n    if (!props.channelName || !props.startTime || !props.endTime) {\n      throw new Error(`startTime & endTime & channelName shouldn't be empty`);\n    }\n\n    if (props.startTime > props.endTime) {\n      throw new Error(`startTime > endTime, please check your startTime and endTime`);\n    }\n\n    const rtmRecord = new RTMRestful(process.env.REACT_APP_AGORA_CUSTOMER_ID as string, process.env.REACT_APP_AGORA_CUSTOMER_CERTIFICATE as string);\n    const params = {\n      channelName: props.channelName,\n      startTime: moment(+props.startTime).utc().format('YYYY-MM-DDTHH:mm:ss'),\n      endTime: moment(+props.endTime).utc().format('YYYY-MM-DDTHH:mm:ss'),\n    }\n    return await rtmRecord.getAllChannelMessages(params)\n  }, [JSON.stringify(props)]);\n\n  useEffect(() => {\n    if (!loading) {\n      setState(RtmPlayerState.load);\n    }\n  }, [loading]);\n\n  const serializeMessage = (item: any) => {\n    const {account, content, link} = JSON.parse(item.payload);\n    return {\n      account,\n      content,\n      link,\n      ms: item.ms,\n      uid: item.src\n    }\n  }\n\n  const rtmMessages = useMemo(() => {\n    if (!value) return [];\n    return value\n    .filter((it: any) => it.payload)\n    .map(serializeMessage);\n  }, [value]);\n\n  const replayMessages = useMemo(() => {\n    if (props.startTime && state === RtmPlayerState.load && rtmMessages && rtmMessages.length) {\n      const time = +props.startTime + currentSeekTime;\n      return rtmMessages.filter((it: any) => (time >= it.ms));\n    }\n    return [];\n  }, [JSON.stringify([rtmMessages.length, currentSeekTime, state, props.startTime])]);\n\n  const scrollDown = (current: any) => {\n    current.scrollTop = current.scrollHeight;\n  }\n\n  useEffect(() => {\n    scrollDown(ref.current);\n  }, [replayMessages.length]);\n\n  const MessageList = useCallback(() => {\n    if (replayMessages) {\n      return (\n        <Fragment>\n          {\n          replayMessages\n          .map((item: any, key: number) => \n          (<Message\n              key={key}\n              nickname={item.account}\n              content={item.content}\n              link={item.link}\n              sender={item.uid === senderId}\n            >\n          </Message>)\n          )}\n        </Fragment>\n      )\n    }\n    return null;\n  }, [replayMessages.length, senderId]);\n\n  return (\n    <div className=\"chat-messages\" ref={ref}>\n      {state !== RtmPlayerState.load ? null : \n        <MessageList></MessageList>\n      }\n    </div>\n  )\n}\n\n// Feat: RTM replay \n// 功能: RTM 回放web集成\nexport const RTMReplayer = React.memo(RtmPlayer);","import React from 'react';\nimport './index.scss';\nimport { Link } from 'react-router-dom';\nimport { useRoomState } from '@/containers/root-container';\nimport { t } from '@/i18n';\nimport { eduApi } from '@/services/edu-api';\nimport { roomStore } from '@/stores/room';\ninterface MessageProps {\n  nickname: string\n  content: string\n  link?: string\n  sender?: boolean\n  children?: any\n  ref?: any\n  className?: string\n}\n\nexport const Message: React.FC<MessageProps> = ({\n  nickname,\n  content,\n  link,\n  sender,\n  children,\n  ref,\n  className\n}) => {\n\n  const roomState = useRoomState();\n\n  const text = React.useMemo(() => {\n    if (link && roomState.course.rid) {\n      return (\n        <Link to={`/replay/record/${link}?roomId=${roomState.course.roomId}&token=${eduApi.userToken}&senderId=${roomStore.state.me.uid}&channelName=${roomStore.state.course.rid}`} target=\"_blank\">{t('course_recording')}</Link>\n      )\n    }\n    return link ? link : content;\n  }, [content, link, roomState.course.roomId])\n\n  return (\n  <div ref={ref} className={`message ${sender ? 'sent': 'receive'} ${className ? className : ''}`}>\n    <div className=\"nickname\">\n      {nickname}\n    </div>\n    <div className=\"content\">\n      {text}\n    </div>\n    {children ? children : null}\n  </div>\n  )\n}","export enum LogLevel {\n  DEBUG = 'debug',\n  NONE = 'none'\n}\n\nconst rawLog = console\n\nexport class PlayerLogger {\n  constructor (public readonly level: LogLevel = LogLevel.DEBUG) {\n  }\n\n  prefix(text: string) {\n    return `[${this.level}] ${text}`\n  }\n\n  info (text: string, ...args: any[]) {\n    rawLog.info(this.prefix(text), ...args)\n  }\n\n  warn (text: string, ...args: any[]) {\n    rawLog.info(this.prefix(text), ...args)\n  }\n\n  error (text: string, ...args: any[]) {\n    rawLog.error(this.prefix(text), ...args)\n  }\n}","import React, { useEffect, useMemo, useRef, useCallback, useState } from 'react';\nimport '../replay.scss';\nimport Slider from '@material-ui/core/Slider';\nimport { Player, PlayerPhase } from 'white-web-sdk';\nimport { useParams, useLocation } from 'react-router';\nimport moment from 'moment';\nimport { Progress } from '@/components/progress/progress';\nimport { globalStore } from '@/stores/global';\nimport { replayStore, useObserver, IPlayerState } from './model';\nimport { WhiteboardAPI } from '@/utils/api';\nimport { whiteboard } from '@/stores/whiteboard';\nimport \"video.js/dist/video-js.css\";\nimport { RTMReplayer, RtmPlayerState } from '@/components/whiteboard/agora/rtm-player';\nimport { useInterval } from 'react-use';\nimport { isElectron } from '@/utils/platform';\nimport { t } from '@/i18n';\n\nconst delay = 5000\n\n\nconst ReplayContext = React.createContext({} as IPlayerState);\n\nconst useReplayContext = () => React.useContext(ReplayContext);\n\nconst ReplayContainer: React.FC<{}> = () => {\n  const replayState = useObserver<IPlayerState>(replayStore)\n\n  const {recordId} = useParams();\n  const location = useLocation();\n  const searchParams = new URLSearchParams(location.search);\n  const roomId: string = searchParams.get('roomId') as string;\n  const userToken: string = searchParams.get('token') as string;\n  const senderId: string = searchParams.get('senderId') as string;\n  const channelName: string = searchParams.get('channelName') as string;\n\n  useInterval(() => {\n    replayStore.getCourseRecordBy(recordId as string, roomId as string, userToken)\n  }, delay)\n\n  const value = replayState;\n\n  const result = value.courseRecordData;\n\n  return (\n    <ReplayContext.Provider value={value}>\n      {result?.status !== 2 ?\n        <Progress title={t(`replay.${result?.statusText ? result?.statusText : 'loading'}`)} /> : \n        <NetlessAgoraReplay\n          roomId={roomId}\n          senderId={senderId}\n          channelName={channelName}\n          whiteboardUUID={result?.boardId as string}\n          startTime={result?.startTime as number}\n          endTime={result?.endTime as number}\n          mediaUrl={result?.url as string} />\n      }\n    </ReplayContext.Provider>\n  )\n}\n\nexport default ReplayContainer;\n\nexport type NetlessAgoraReplayProps = {\n  whiteboardUUID: string\n  startTime: number\n  endTime: number\n  mediaUrl: string\n  senderId: string\n  channelName: string\n  roomId: string\n}\n\nexport const NetlessAgoraReplay: React.FC<NetlessAgoraReplayProps> = ({\n  whiteboardUUID: uuid,\n  startTime,\n  endTime,\n  mediaUrl,\n  senderId,\n  channelName,\n  roomId\n}) => {\n  const state = useReplayContext();\n\n  const player = useMemo(() => {\n    if (!replayStore.state || !replayStore.state.player) return null;\n    return replayStore.state.player as Player;\n  }, [replayStore.state]);\n\n  const handlePlayerClick = () => {\n    if (!replayStore.state || !player) return;\n\n    if (player.phase === PlayerPhase.Playing) {\n      player.pause();\n      return;\n    }\n    if (player.phase === PlayerPhase.WaitingFirstFrame || player.phase === PlayerPhase.Pause) {\n      player.play();\n      return;\n    }\n\n    if (player.phase === PlayerPhase.Ended) {\n      player.seekToScheduleTime(0);\n      player.play();\n      return;\n    }\n  }\n\n  const handleChange = (event: any, newValue: any) => {\n    replayStore.setCurrentTime(newValue);\n    replayStore.updateProgress(newValue);\n  }\n\n  const onWindowResize = () => {\n    if (state.player) {\n      state.player.refreshViewSize();\n    }\n  }\n\n  const handleSpaceKey = (evt: any) => {\n    if (evt.code === 'Space') {\n      if (state.player) {\n        handleOperationClick(state.player);\n      }\n    }\n  }\n\n  const handleOperationClick = (player: Player) => {\n    switch (player.phase) {\n      case PlayerPhase.WaitingFirstFrame:\n      case PlayerPhase.Pause: {\n        player.play();\n        break;\n      }\n      case PlayerPhase.Playing: {\n        player.pause();\n        break;\n      }\n      case PlayerPhase.Ended: {\n        player.seekToScheduleTime(0);\n        break;\n      }\n    }\n  }\n\n  const duration = useMemo(() => {\n    if (!startTime || !endTime) return 0;\n    const _duration = Math.abs(+startTime - +endTime);\n    return _duration;\n  }, [startTime, endTime]);\n\n  const lock = useRef<boolean>(false);\n\n  useEffect(() => {\n    return () => {\n      lock.current = true;\n    }\n  }, []);\n\n  useEffect(() => {\n    window.addEventListener('resize', onWindowResize);\n    window.addEventListener('keydown', handleSpaceKey);\n    if (roomId && startTime && endTime) {\n        replayStore.joinRoom(roomId).then(({roomToken, uuid}) => {\n          WhiteboardAPI.replayRoom(whiteboard.client,\n          {\n            beginTimestamp: +startTime,\n            duration: duration,\n            room: uuid,\n            mediaURL: mediaUrl,\n            roomToken: roomToken,\n          }, {\n            onCatchErrorWhenRender: error => {\n              error && console.warn(error);\n              globalStore.showToast({\n                message: t('toast.replay_failed'),\n                type: 'notice'\n              });\n            },\n            onCatchErrorWhenAppendFrame: error => {\n              error && console.warn(error);\n              globalStore.showToast({\n                message: t('toast.replay_failed'),\n                type: 'notice'\n              });\n            },\n            onPhaseChanged: phase => {\n              replayStore.updateWhiteboardPhase(phase);\n            },\n            onLoadFirstFrame: () => {\n              replayStore.loadFirstFrame();\n            },\n            onSliceChanged: () => {\n            },\n            onPlayerStateChanged: (error) => {\n            },\n            onStoppedWithError: (error) => {\n              error && console.warn(error);\n              globalStore.showToast({\n                message: t('toast.replay_failed'),\n                type: 'notice'\n              });\n              replayStore.setReplayFail(true);\n            },\n            onScheduleTimeChanged: (scheduleTime) => {\n              if (lock.current) return;\n              replayStore.setCurrentTime(scheduleTime);\n            }\n          }).then((player: Player | undefined) => {\n            if (player) {\n              replayStore.setPlayer(player);\n              player.seekToScheduleTime(0);\n              player.bindHtmlElement(document.getElementById(\"whiteboard\") as HTMLDivElement);\n            }\n          })\n        });\n    }\n    return () => {\n      window.removeEventListener('resize', onWindowResize);\n      window.removeEventListener('keydown', onWindowResize);\n    }\n  }, []);\n\n  const totalTime = useMemo(() => {\n    return moment(duration).format(\"mm:ss\");\n  }, [duration]);\n\n  const time = useMemo(() => {\n    return moment(state.currentTime).format(\"mm:ss\");\n  }, [state.currentTime]);\n\n  const PlayerCover = useCallback(() => {\n    if (!player) {\n      return (<Progress title={t(\"replay.loading\")} />)\n    }\n\n    if (!state.isFirstScreenReady) return null\n\n    if (player.phase === PlayerPhase.Playing) return null;\n\n    return (\n      <div className=\"player-cover\">\n        {player.phase === PlayerPhase.Buffering ? <Progress title={t(\"replay.loading\")} />: null}\n        {player.phase === PlayerPhase.Pause || player.phase === PlayerPhase.Ended || player.phase === PlayerPhase.WaitingFirstFrame ? \n          <div className=\"play-btn\" onClick={handlePlayerClick}></div> : null}\n      </div>\n    )\n  }, [player, state]);\n\n  return (\n    <div className={`replay`}>\n      <div className={`player-container`} >\n        <PlayerCover />\n        <div className=\"player\">\n          <div className=\"agora-logo\"></div>\n          <div id=\"whiteboard\" className=\"whiteboard\"></div>\n          <div className=\"video-menu\">\n            <div className=\"control-btn\">\n              <div className={`btn ${player && player.phase === PlayerPhase.Playing ? 'paused' : 'play'}`} onClick={handlePlayerClick}></div>\n            </div>\n            <div className=\"progress\">\n              <Slider\n                className='custom-video-progress'\n                value={state.currentTime}\n                onMouseDown={() => {\n                  if (replayStore.state && replayStore.state.player) {\n                    const player = replayStore.state.player as Player;\n                    player.pause();\n                    lock.current = true;\n                  }\n                }}\n                onMouseUp={() => {\n                  if (replayStore.state && replayStore.state.player) {\n                    const player = replayStore.state.player as Player;\n                    player.seekToScheduleTime(state.currentTime);\n                    player.play();\n                    lock.current = false;\n                  }\n                }}\n                onTouchStart={() => {\n                  console.log('onTouchEnd')\n                  if (replayStore.state && replayStore.state.player) {\n                    const player = replayStore.state.player as Player;\n                    player.pause();\n                    lock.current = true;\n                  }\n                }}\n                onTouchEnd={() => {\n                  console.log('onTouchStart')\n                  if (replayStore.state && replayStore.state.player) {\n                    const player = replayStore.state.player as Player;\n                    player.seekToScheduleTime(state.currentTime);\n                    player.play();\n                    lock.current = false;\n                  }\n                }}\n                onChange={handleChange}\n                min={0}\n                max={duration}\n                aria-labelledby=\"continuous-slider\"\n              />\n              <div className=\"time\">\n                <div className=\"current_duration\">{time}</div>\n                  /\n                <div className=\"video_duration\">{totalTime}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div className=\"video-container\">\n        <div className=\"video-player\">\n          <video playsInline={true} id=\"white-sdk-video-js\" className=\"video-js video-layout\" style={{width: \"100%\", height: \"100%\", objectFit: \"cover\"}}></video>\n        </div>\n        <div className=\"chat-holder chat-board chat-messages-container\">\n          <RTMReplayer\n            senderId={senderId}\n            channelName={channelName}\n            startTime={startTime}\n            endTime={endTime}\n            currentSeekTime={state.currentTime}\n            onPhaseChanged={(e: RtmPlayerState) => {\n              if (e !== RtmPlayerState.load) {\n                player?.stop();\n              }\n            }}\n          ></RTMReplayer>\n        </div>\n      </div>\n    </div>\n  )\n}","import { PlayerLogger } from './logger';\n\nimport { EventEmitter } from 'events'\nimport Videojs, {VideoJsPlayer} from 'video.js'\nimport './index.css';\n\nimport '@videojs/http-streaming'\n\nexport { TimelineScheduler } from './timeline-scheduler';\n\nexport interface AgoraPlayerCallback {\n  onPhaseChanged: (evt: any) => void\n}\n\ntype Player = VideoJsPlayer\n\nexport enum PhaseState {\n  init = 'init',\n  buffering = 'buffering',\n  waiting = 'waiting',\n  playing = 'playing',\n  paused = 'paused',\n  ended = 'ended',\n  loading = 'loading'\n}\n\nexport type PhaseStateType = \n  'init' |\n  'buffering' |\n  'playing' | \n  'paused' | \n  'ended' | \n  'waiting' |\n  'ready' |\n  'loading'\n\nexport class AgoraPlayer extends EventEmitter {\n\n  public player: Player\n\n  type: string\n\n  public cover: string = ''\n\n  private log: PlayerLogger\n\n  public phaseState: PhaseStateType\n\n  private $el: HTMLElement\n  mediaType: string\n\n  constructor(\n    public readonly url: string,\n    public readonly callback: AgoraPlayerCallback,\n  ) {\n    super()\n    this.log = new PlayerLogger()\n\n    this.$el = document.createElement('video')\n    this.$el.id = 'video-player'\n    this.$el.className = \"video-js video-layout\"\n    this.player = Videojs(this.$el, {\n      preload: 'auto',\n      controls: false,\n      autoplay: false,\n      loop: false,\n      html5: {\n        hls: {\n          overrideNative: true\n        }\n      }\n    })\n\n    this.type = this.url.split('.').pop() || 'mp4'\n\n    const mediaTypes: any = {\n      'm3u8': 'application/x-mpegURL',\n      'mp4': 'video/mp4',\n    }\n\n    this.mediaType = mediaTypes[this.type] || 'video/mp4'\n    if (!this.url) {\n      console.error(`URL: invalid ${this.url}`)\n    }\n    this.phaseState = 'init'\n    this.on('phaseChanged', (phaseState: any) => {\n      callback.onPhaseChanged(phaseState)\n      // this.log.info('phaseChanged', phaseState)\n    })\n  }\n\n  initVideo (domId: string) {\n    if (!domId) {\n      throw `DOMException: domId shouldn't empty`\n    }\n\n    const $dom = document.getElementById(domId)\n    if (!$dom) {\n      throw `DOMException: couldn't find ${domId} element`\n    }\n\n    $dom.appendChild(this.$el)\n\n    this.player.src({\n      src: this.url,\n      type: this.mediaType\n    })\n\n    this.player.on('loadeddata', (evt: any) => {\n      this.emit('phaseChanged', this.phaseState = 'ready')\n    })\n\n    this.player.on('loadstart', (evt: any) => {\n      this.emit('phaseChanged', this.phaseState = 'loading')\n    })\n\n    this.player.on('waiting', (evt: any) => {\n      this.emit('phaseChanged', this.phaseState = 'waiting')\n    })\n\n    this.player.on('ended', (evt: any) => {\n      this.emit('phaseChanged', this.phaseState = 'ended')\n    })\n\n    this.player.on('error', (evt: any) => {\n      console.error('error', this.phaseState)\n    })\n\n    this.player.load();\n  }\n\n  get isPlaying () {\n    return this.player.duration() > 0 \n      && !this.player.paused() \n      && !this.player.ended()\n      && this.player.readyState() > 2\n  }\n\n  play () {\n    if (!this.isPlaying && this.player.paused()) {\n      this.player.play()\n    }\n  }\n\n  pause () {\n    if (this.isPlaying && !this.player.paused()) {\n      this.player.pause()\n    }\n  }\n\n  seekTo(seconds: number) {\n    const duration = this.player.duration()\n    if (this.player.ended() && seconds !== 0) return\n    this.player.currentTime(Math.min(seconds, duration))\n  }\n\n  destroy () {\n    this.player.dispose()\n  }\n}\n","import { PlayerLogger } from './logger';\nimport { EventEmitter } from 'events';\nimport raf from 'raf'\n\nconst customClearTimeout = (id: any) => {\n  clearInterval(id)\n}\n\nexport class TimelineScheduler extends EventEmitter {\n\n  _state: string = 'paused'\n  delay: number\n  duration: number\n\n  public rafId: number\n  log: PlayerLogger\n\n  _lastTimeoutId: any\n  _stopTimer: boolean\n  _visibilityHandler: (evt?: any) => void | any\n\n  public currentTime: number\n  public currentDuration: number\n\n  constructor (\n    public readonly fps: number = 15,\n    public readonly callback: (args?: any) => void,\n    public readonly startTime: number,\n    public readonly endTime: number\n  ) {\n    super()\n    this.log = new PlayerLogger()\n    if (this.endTime <= this.startTime) throw `endTime must greater than startTime`\n    this.delay = 1000 / this.fps\n    this.rafId = -1\n    this.duration = this.endTime - this.startTime\n    this.currentTime = this.startTime\n    this.currentDuration = 0\n    this._visibilityHandler = () => {}\n\n    this._lastTimeoutId = -1\n    this._stopTimer = true\n  }\n\n  public start () {\n    this._visibilityHandler = (evt: any) => {\n      if(document.hidden) {\n        this.log.warn('passive paused by browser', Date.now())\n        this.stop();\n      } else {\n        this.log.warn('switch setTimeout back to raf', Date.now())\n      }\n    }\n\n    document.addEventListener('visibilitychange', this._visibilityHandler, false);\n    this.state = 'started'\n    let _time = -1\n    let frame = -1\n    const durationBase = this.currentDuration\n    const nextTick = (timestamp: number, v?: boolean): void => {\n      if (this.state === 'ended' || this.currentTime >= this.endTime) {\n        this.stop()\n        return\n      }\n      if (_time === -1) {\n        _time = timestamp\n      }\n\n      const elapsedTime = Math.ceil(timestamp - _time)\n      const currentDuration = durationBase + elapsedTime\n\n      const progress: number = Math.min(Math.ceil((currentDuration / this.duration) * 100) / 100, 1)\n      const duration = Math.min(currentDuration, this.duration)\n      const time = Math.min(this.startTime + duration, this.endTime)\n      this.currentDuration = duration\n      let currentFrame = Math.floor(elapsedTime / this.delay)\n      if (currentFrame > frame) {\n        const params = {\n          progress,\n          duration,\n          time,\n          startTime: this.startTime,\n          endTime: this.endTime,\n          isTimer: v === true\n        }\n        this.callback(params)\n        this.currentTime = time\n        frame = currentFrame\n      }\n      if (this.state === 'started') {\n        this.rafId = raf(nextTick)\n      }\n    }\n    this.rafId = raf(nextTick)\n  }\n\n  public stop () {\n    this.state = 'paused'\n\n    raf.cancel(this.rafId)\n    customClearTimeout(this._lastTimeoutId)\n    this._stopTimer = true\n    document.removeEventListener('visibilitychange', () => {}, false);\n    this.log.info('this.rafId canceled', this.rafId)\n\n    if (this.currentTime === this.endTime) {\n      this.state = 'ended'\n    }\n  }\n\n  public seekTo (time: number) {\n    if (typeof time !== 'number') {\n      return this.log.warn('time should pass number')\n    }\n\n    this.currentDuration = time\n\n    if (this.state === 'ended') {\n      this.currentTime = this.startTime\n    }\n\n    this.emit('seek-changed', this.currentDuration)\n  }\n\n  public set state (newState: any) {\n    this._state = newState\n    this.emit(\"state-changed\", this._state)\n  }\n\n  public get state () {\n    return this._state\n  }\n\n}","import React, {useEffect, useMemo, useCallback, useRef} from 'react';\nimport {replayStore, useObserver, IPlayerState} from './model';\nimport { useParams, useLocation } from 'react-router-dom';\nimport { useInterval } from 'react-use';\nimport { Progress } from '@/components/progress/progress';\nimport Slider from '@material-ui/core/Slider';\nimport { WhiteboardAPI } from '@/utils/api';\nimport { whiteboard } from '@/stores/whiteboard';\nimport { RTMReplayer, RtmPlayerState } from '@/components/whiteboard/agora/rtm-player';\nimport moment from 'moment';\nimport {AgoraPlayer, TimelineScheduler} from '@/utils/agora-web-player/agora-player';\nimport { t } from '@/i18n';\nimport { globalStore } from '@/stores/global';\nimport { PlayerPhase } from 'white-web-sdk';\n// import {isElectron} from '@/utils/platform';\n\nconst ReplayContext = React.createContext({} as IPlayerState);\n\n//@ts-ignore\nwindow.replayStore = replayStore\n\nconst delay = 5000\n\nconst useReplayContext = () => React.useContext(ReplayContext);\n\nconst ReplayContainer: React.FC<{}> = () => {\n  const replayState = useObserver<IPlayerState>(replayStore);\n\n  const location = useLocation()\n  const {recordId} = useParams()\n  const searchParams = new URLSearchParams(location.search);\n  const roomId: string = searchParams.get('roomId') as string;\n  const userToken: string = searchParams.get('token') as string;\n\n  const value = replayState;\n\n  const result = value.courseRecordData;\n\n  useInterval(() => {\n    replayStore.getCourseRecordBy(recordId as string, roomId as string, userToken)\n  }, delay)\n\n  return (\n    <ReplayContext.Provider value={value}>\n      {result?.status !== 2 ?\n        <Progress title={t(`replay.${result?.statusText ? result?.statusText : 'loading'}`)} /> : \n      <TimelineReplay\n        whiteboardUUID={result?.boardId as string}\n        startTime={result?.startTime as number}\n        endTime={result?.endTime as number}\n        mediaUrl={result?.url as string}\n      />}\n    </ReplayContext.Provider>\n  )\n}\n\nexport default ReplayContainer;\n\nexport const TimelineReplay: React.FC<any> = ({\n  startTime,\n  endTime,\n  mediaUrl,\n  channelName,\n  senderId,\n  whiteboardUUID\n}) => {\n  const state = useReplayContext()\n\n  useEffect(() => {\n    const startTimestamp: number = +(startTime as string)\n    const endTimestamp: number = +(endTime as string)\n    const duration = Math.abs(endTimestamp - startTimestamp)\n\n    const initPlayer = async () => {\n      const videoPlayer = new AgoraPlayer(mediaUrl, {\n        onPhaseChanged: state => {\n          console.log(\"[agore-replay phase] video phase \", state)\n          if (state === 'ready') {\n            replayStore.updatePlayState('ready')\n          }\n\n          if (state !== 'playing') {\n            // replayStore.state?.timelineScheduler.stop();\n            console.log(\"[agore-replay phase] timeline stop in video phase \")\n          }\n        }\n      })\n  \n      //@ts-ignore\n      window.videoPlayer = videoPlayer\n      replayStore.addVideoPlayer(videoPlayer)\n  \n      const timeline = new TimelineScheduler(30, (args: any) => {\n        if (replayStore.state && replayStore.state.phase && replayStore.state.phase === 'playing') {\n          replayStore.setCurrentTime(args.duration)\n          replayStore.updateProgress(args.progress)\n        }\n      }, startTimestamp, endTimestamp)\n  \n      timeline.on('seek-changed', (duration: number) => {\n        if (replayStore.state && replayStore.state.videoPlayer && replayStore.state.player) {\n          if (duration / 1000 < replayStore.state.videoPlayer.player.duration()) {\n            replayStore.state.videoPlayer.seekTo(duration / 1000)\n            replayStore.state.player.seekToScheduleTime(duration)\n          }\n        }\n      })\n  \n      timeline.on(\"state-changed\", async (state: any) => {\n        console.log(\"state-changed\", \"state\", state, replayStore.state)\n        if (replayStore.state && replayStore.state.videoPlayer && replayStore.state.player) {\n          if (state === 'started') {\n            replayStore.state.videoPlayer.play()\n            replayStore.state.player.play()\n            replayStore.updatePlayState('playing')\n          } else if (state === 'ended') {\n            replayStore.state.videoPlayer.pause()\n            replayStore.state.player.pause()\n            replayStore.updatePlayState('ended')\n          } else {\n            replayStore.state.videoPlayer.pause()\n            replayStore.state.player.pause()\n            console.log(\"[agore-replay phase] timeline \" ,state, 'replayStore.is not empty?: ', replayStore.state !== null)\n            replayStore.updatePlayState('paused')\n          }\n        }\n      })\n      replayStore.addTimeline(timeline)\n\n\n      if (whiteboardUUID) {\n        let {roomToken} = await replayStore.joinRoom(whiteboardUUID)\n        let player = await WhiteboardAPI.replayRoom(whiteboard.client, {\n          beginTimestamp: startTimestamp,\n          duration: duration,\n          room: whiteboardUUID,\n          roomToken,\n        },  {\n          onCatchErrorWhenRender: error => {\n            error && console.warn(error);\n            globalStore.showToast({\n              message: t('toast.replay_failed'),\n              type: 'notice'\n            });\n          },\n          onCatchErrorWhenAppendFrame: error => {\n            error && console.warn(error);\n            globalStore.showToast({\n              message: t('toast.replay_failed'),\n              type: 'notice'\n            });\n          },\n          onPhaseChanged: phase => {\n            console.log(\"[agore-replay phase] whiteboard \", phase)\n\n            let whiteboardPlayStatus = 'ready';\n\n            if (phase === PlayerPhase.Playing) {\n              whiteboardPlayStatus = 'playing'\n            } else if (phase === PlayerPhase.Pause ||\n              phase === PlayerPhase.Ended ||\n              phase === PlayerPhase.WaitingFirstFrame) {\n              whiteboardPlayStatus = 'paused'\n              replayStore.state?.timelineScheduler.stop()\n            } else {\n              whiteboardPlayStatus = 'waiting'\n              console.log(\"[agore-replay phase] whiteboard phase transmit\", phase, whiteboardPlayStatus)\n            }\n            console.log(\"[agore-replay phase] whiteboard phase transmit 2\", phase, whiteboardPlayStatus)\n            replayStore.updatePlayState(whiteboardPlayStatus)\n          },\n          onStoppedWithError: (error) => {\n            error && console.warn(error);\n            globalStore.showToast({\n              message: t('toast.replay_failed'),\n              type: 'notice'\n            });\n          }\n        })\n        replayStore.addWhiteboardPlayer(player)\n        console.log(\"[agore-replay phase] join whiteboard\")\n      }\n    }\n\n    initPlayer()\n  }, [])\n\n  const playerElementRef = useRef<any>(null)\n  const whiteboardElementRef = useRef<any>(null)\n\n\n  const onWindowResize = () => {\n    if (state.player) {\n      state.player.refreshViewSize()\n    }\n  }\n\n  useEffect(() => {\n    if (playerElementRef.current) {\n      if (state.videoPlayer) {\n        state.videoPlayer.initVideo(playerElementRef.current.id)\n        return () => {\n          state.videoPlayer.destroy()\n        }\n      }\n    }\n  }, [state.videoPlayer, playerElementRef])\n\n  useEffect(() => {\n    if (whiteboardElementRef.current) {\n      if (state.player) {\n        console.log(\"bind\", state.player)\n        state.player.bindHtmlElement(whiteboardElementRef.current as HTMLDivElement);\n        window.addEventListener('resize', onWindowResize);\n        return () => {\n          window.removeEventListener('resize', onWindowResize);\n        }\n      }\n    }\n  }, [state.player, whiteboardElementRef])\n\n  const handlePlayerClick = () => {\n    if (!replayStore.state || !state.videoPlayer || !state.timelineScheduler) return;\n\n    if (replayStore.state.phase === 'paused' || replayStore.state.phase === 'ready') {\n      state.timelineScheduler.start()\n      return\n    }\n\n    if (replayStore.state.phase === 'started' || replayStore.state.phase === 'playing') {\n      state.timelineScheduler.stop()\n      return\n    }\n\n    if (replayStore.state.phase === 'ended') {\n      state.timelineScheduler.seekTo(0)\n      state.timelineScheduler.start()\n      return\n    }\n  }\n\n  const handleChange = (event: any, newValue: any) => {\n    replayStore.setCurrentTime(newValue);\n    replayStore.updateProgress(newValue);\n  }\n\n  const duration = useMemo(() => {\n    if (!startTime || !endTime) return 0;\n    const _duration = Math.abs(+startTime - +endTime);\n    return _duration;\n  }, [startTime, endTime]);\n\n  const totalTime = useMemo(() => {\n    return moment(duration).format(\"mm:ss\")\n  }, [duration]);\n\n  const time = useMemo(() => {\n    return moment(state.currentTime).format(\"mm:ss\");\n  }, [state.currentTime]);\n\n  const playState = state.phase;\n\n  const PlayerCover = useCallback(() => {\n\n    document.title = playState\n\n    if (!state.videoPlayer || !state.player || playState === 'waiting' || playState === 'loading') {\n      return (<Progress title={t(\"replay.loading\")} />)\n    }\n\n    if (playState === 'playing') return null;\n\n    return (\n      <div className=\"player-cover\">\n        {playState !== 'playing' ? \n          <div className=\"play-btn\" onClick={handlePlayerClick}></div> : null}\n      </div>\n    )\n  }, [state.videoPlayer, state.player, state.phase]);\n\n  const onMouseDown = () => {\n    if (state.timelineScheduler) {\n      console.log(\"seek to replay. down\")\n      state.timelineScheduler.stop()\n      replayStore.updatePlayState('paused')\n    }\n  }\n\n  const onMouseUp = () => {\n    if (state.timelineScheduler) {\n      console.log(\"seek to replay. up\")\n      state.timelineScheduler.seekTo(state.currentTime)\n      state.timelineScheduler.start()\n    }\n  }\n\n  return (\n    <div className={`replay`}>\n      <div className={`player-container`} >\n        <PlayerCover />\n        <div className=\"player\">\n          <div className=\"agora-logo\"></div>\n          <div ref={whiteboardElementRef} id=\"whiteboard\" className=\"whiteboard\"></div>\n          <div className=\"video-menu\">\n            <div className=\"control-btn\">\n              <div className={`btn ${playState === 'playing' ? 'paused' : 'play'}`} onClick={handlePlayerClick}></div>\n            </div>\n            <div className=\"progress\">\n              <Slider\n                className='custom-video-progress'\n                value={state.currentTime}\n                onMouseDown={onMouseDown}\n                onMouseUp={onMouseUp}\n                onTouchStart={onMouseDown}\n                onTouchEnd={onMouseUp}\n                onChange={handleChange}\n                min={0}\n                max={duration}\n                aria-labelledby=\"continuous-slider\"\n              />\n              <div className=\"time\">\n                <div className=\"current_duration\">{time}</div>\n                  /\n                <div className=\"video_duration\">{totalTime}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div className=\"video-container\">\n        <div className=\"video-player\">\n          <div ref={playerElementRef} id=\"player\" style={{width: \"100%\", height: \"100%\", objectFit: \"cover\"}}></div>\n        </div>\n        <div className=\"chat-holder chat-board chat-messages-container\">\n          <RTMReplayer\n            senderId={senderId}\n            channelName={channelName}\n            startTime={startTime}\n            endTime={endTime}\n            currentSeekTime={state.currentTime}\n            onPhaseChanged={(e: RtmPlayerState) => {\n              if (e !== RtmPlayerState.load) {\n                state.timelineScheduler?.stop();\n              }\n            }}\n          ></RTMReplayer>\n        </div>\n      </div>\n    </div>\n  )\n}","import { useMemo } from 'react';\nimport { isEmpty } from 'lodash';\nimport { roomStore } from '../stores/room';\nimport { useRoomState } from '../containers/root-container';\n\ntype StreamValue = {\n  teacher: any\n  students: any[]\n  sharedStream: any\n  currentHost: any\n  onPlayerClick: (type: string, streamID: number, uid: string) => Promise<any>\n}\n\n\nexport default function useStream () {\n  const roomState = useRoomState();\n  const me = roomState.me;\n  const course = roomState.course;\n\n  const teacher = useMemo(() => {\n    if (!course.teacherId || !me.uid) return;\n    const teacherInfo = roomStore.state.users.get(`${course.teacherId}`);\n    if (!teacherInfo) return;\n\n    // 当本地流为老师时\n    if (+me.uid === +course.teacherId) {\n      return {\n        ...roomState.rtc.localStream,\n        account: teacherInfo.account,\n        video: teacherInfo.video,\n        audio: teacherInfo.audio,\n        local: true,\n      }\n    } else {\n      // when peer teacher is online\n      // 当远端流为老师时\n      const teacherUid = roomState.rtc.users.get(+course.teacherId);\n      if(!teacherUid) return null;\n      // when peer teacher stream is found\n      // 当找到老师的音视频流时\n      const remoteTeacherStream = roomState.rtc.remoteStreams.get(`${teacherUid}`);\n      if (remoteTeacherStream) {\n        return {\n          ...remoteTeacherStream,\n          account: teacherInfo.account,\n          video: teacherInfo.video,\n          audio: teacherInfo.audio,\n        }\n      }\n      return {\n        streamID: teacherUid,\n        account: teacherInfo.account,\n        video: teacherInfo.video,\n        audio: teacherInfo.audio,\n      }\n    }\n  }, [\n    JSON.stringify(\n      [\n        course.teacherId,\n        me.uid\n      ]\n    ),\n    roomState.users,\n    roomState.rtc.users,\n    roomState.rtc.remoteStreams,\n    roomState.rtc.localStream\n  ]);\n\n  const screenId = useMemo(() => {\n    const teacher = roomState.users.get(`${course.teacherId}`)\n    let id = ''\n    if (teacher) {\n      id = teacher.screenId\n    }\n    return id\n  }, [course.teacherId, roomState.users])\n\n  const students = useMemo(() => {\n    const userAttrs = roomStore.state.users;\n    if (!me.uid || userAttrs.count() === 0) return [];\n    const teacherUid = course.teacherId;\n    const peerUsers = roomState.rtc.users;\n    // exclude teacher and me and screenId\n    // 排除老师，屏幕共享，和自己的uid\n    let studentIds = peerUsers.filter((it: number) => it !== +teacherUid && it !== +me.uid && it !== +screenId);\n\n    const studentStreams: any[] = [];\n    const myAttr = userAttrs.get(`${me.uid}`);\n\n    // when i m student\n    // 当自己是学生流时\n    if (+me.role === 2) {\n      if (myAttr && roomState.rtc.localStream) {\n        const _tmpStream = {\n          ...roomState.rtc.localStream,\n          account: myAttr.account,\n          video: myAttr.video,\n          audio: myAttr.audio,\n          local: true,\n        }\n        studentStreams.push(_tmpStream);\n      }\n    }\n\n    // capture all remote streams\n    // 所有远端的学生流\n    for (let studentId of studentIds) {\n      const studentAttr = userAttrs.get(`${studentId}`);\n      const stream = roomState.rtc.remoteStreams.get(`${studentId}`);\n      if (studentAttr) {\n        let _tmpStream = {\n          streamID: studentId,\n          account: studentAttr.account,\n          video: studentAttr.video,\n          audio: studentAttr.audio,\n        }\n        if (stream) {\n          _tmpStream = {\n            ...stream,\n            streamID: studentId,\n            account: studentAttr.account,\n            video: studentAttr.video,\n            audio: studentAttr.audio,\n          }\n        }\n        studentStreams.push(_tmpStream);\n      }\n    }\n    return studentStreams;\n  }, [\n    JSON.stringify(\n      [\n        course.teacherId,\n        screenId,\n        me.uid\n      ]\n    ),\n    roomState.users,\n    roomState.rtc.users,\n    roomState.rtc.remoteStreams,\n    roomState.rtc.localStream\n  ]);\n\n  const sharedStream = useMemo(() => {\n    if (roomState.rtc.localSharedStream) {\n      const _tmpStream = {\n        ...roomState.rtc.localSharedStream,\n        video: 1,\n        audio: 1,\n        local: true,\n      }\n      return _tmpStream;\n    }\n\n    const remoteStream = roomState.rtc.remoteStreams.get(`${screenId}`);\n\n    if (remoteStream) {\n      const _tmpStream = {\n        ...remoteStream,\n        video: 1,\n        audio: 1,\n      }\n      return _tmpStream;\n    }\n\n    return null;\n  }, [\n    screenId,\n    roomState.rtc.remoteStreams,\n    roomState.rtc.localSharedStream\n  ]);\n\n  const currentHost = useMemo(() => {\n    if (!course.coVideoUids || isEmpty(course.coVideoUids)) return null;\n    const coVideoUid = ''+course.coVideoUids[0];\n    const userAttr = roomState.users.get(`${coVideoUid}`);\n    if (!userAttr) return null;\n    // when i am current broadcaster\n    if (`${me.uid}` === coVideoUid) {\n      if (roomState.rtc.localStream) {\n        let _tmpStream = {\n          ...roomState.rtc.localStream,\n          account: userAttr.account,\n          video: userAttr.video,\n          audio: userAttr.audio,\n          local: true,\n          streamID: +me.uid,\n        }\n        return _tmpStream;\n      }\n    } else {\n      // when remote user is broadcaster\n      const peerUid = coVideoUid;\n      const peerUserAttr = roomState.users.get(`${peerUid}`);\n      if (peerUid && peerUserAttr) {\n        let tmpStream = {\n          account: peerUserAttr.account,\n          video: peerUserAttr.video,\n          audio: peerUserAttr.audio,\n          streamID: +peerUid,\n        }\n        const remoteStream = roomState.rtc.remoteStreams.get(`${peerUid}`);\n        if (remoteStream) {\n          tmpStream = {\n            ...tmpStream,\n            ...remoteStream\n          }\n        }\n        return tmpStream\n      }\n    }\n    return null;\n  }, [\n    course.coVideoUids,\n    me.uid,\n    me.role,\n    roomState.users,\n    roomState.rtc.remoteStreams,\n    roomState.rtc.localStream,\n  ]);\n\n  const value: StreamValue = {\n    teacher: teacher,\n    students: students,\n    sharedStream: sharedStream,\n    currentHost: currentHost,\n    onPlayerClick: async (type: string, streamID: number, uid: string) => {\n      console.log(\"streamID \", streamID, uid);\n      const me = roomStore.state.me;\n      if (!roomStore.state.rtm.joined || !me.uid) return console.warn(\"please confirm joined rtm\");\n      const targetUser = roomStore.state.users.get(`${uid}`);\n      if (!targetUser) return;\n\n      const targetUid = targetUser.uid;\n\n      const video = Boolean(targetUser.video);\n      const audio = Boolean(targetUser.audio);\n      const chat = Boolean(targetUser.chat);\n\n      if (type === 'video') {\n        if (video) {\n          await roomStore.mute(targetUid, 'video');\n        } else {\n          await roomStore.unmute(targetUid, 'video');\n        }\n        return;\n      }\n\n      if (type === 'audio') {\n        if (audio) {\n          await roomStore.mute(targetUid, 'audio');\n        } else {\n          await roomStore.unmute(targetUid, 'audio');\n        }\n        return;\n      }\n\n      if (type === 'chat') {\n        if (chat) {\n          await roomStore.mute(targetUid, 'chat');\n        } else {\n          await roomStore.unmute(targetUid, 'chat');\n        }\n        return;\n      }\n    }\n  }\n  return value;\n}","import React, { useRef, useEffect, useState, useLayoutEffect } from 'react';\nimport VideoPlayer from './video-player';\nimport './video-marquee.scss';\nimport useStream from '../hooks/use-streams';\nimport { AgoraMediaStream } from '../utils/types';\n\nconst showScrollbar = () => {\n  const $marquee = document.querySelector(\".video-marquee .agora-video-view\");\n  if ($marquee) {\n    const clientWidth = $marquee.clientWidth;\n    const marqueeLength: number = document.querySelectorAll(\".video-marquee .agora-video-view\").length;\n    const videoMarqueeMark = document.querySelector('.video-marquee-mask')\n    if (clientWidth && videoMarqueeMark) {\n      const videoMarqueeWidth = videoMarqueeMark.clientWidth;\n      const width: number = clientWidth * marqueeLength;\n      if (videoMarqueeWidth <= width) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nfunction VideoMarquee() {\n\n  const {teacher, students, onPlayerClick} = useStream();\n\n  const marqueeEl = useRef(null);\n\n  const scrollLeft = (current: any, offset: number) => {\n    current.scrollLeft += (offset * current.childNodes[1].offsetWidth);\n  }\n\n  const handleScrollLeft = (evt: any) => {\n    scrollLeft(marqueeEl.current, 1);\n  }\n\n  const handleScrollRight = (evt: any) => {\n    scrollLeft(marqueeEl.current, -1);\n  }\n\n  const ref = useRef<boolean>(false);\n\n  useEffect(() => {\n    return () => {\n      ref.current = true;\n    }\n  }, []);\n\n  const [scrollBar, setScrollBar] = useState<boolean>(false);\n\n  useLayoutEffect(() => {\n    if (!students.length) return;\n    !ref.current && setScrollBar(showScrollbar());\n  }, [students]);\n\n  useEffect(() => {\n    window.addEventListener('resize', (evt: any) => {\n      !ref.current && setScrollBar(showScrollbar());\n    });\n    return () => {\n      window.removeEventListener('resize', () => {});\n    }\n  }, []);\n\n  return (\n    <div className=\"video-marquee-container\">\n      <div className=\"main\">\n        {teacher ?\n          <VideoPlayer\n            role=\"teacher\"\n            domId={`dom-${teacher.streamID}`}\n            id={`${teacher.streamID}`}\n            streamID={teacher.streamID}\n            stream={teacher.stream}\n            account={teacher.account}\n            audio={Boolean(teacher.audio)}\n            video={Boolean(teacher.video)}\n            local={Boolean(teacher.local)}\n            handleClick={onPlayerClick}\n            autoplay={true}\n          />\n          :\n          <VideoPlayer role=\"teacher\" account={'teacher'} video audio streamID={0} />\n          }\n      </div>\n      <div className=\"video-marquee-mask\">\n        <div className=\"video-marquee\" ref={marqueeEl}>\n        {scrollBar ? \n          <div className=\"scroll-btn-group\">\n            <div className=\"icon icon-left\" onClick={handleScrollLeft}></div>\n            <div className=\"icon icon-right\" onClick={handleScrollRight}></div>\n          </div> : null\n        }\n          {students.map((student: AgoraMediaStream, key: number) => (\n            <VideoPlayer\n              role=\"student\"\n              domId={`dom-${student.streamID}`}\n              key={`${key}${student.streamID}`}\n              id={`${student.streamID}`}\n              account={student.account}\n              streamID={student.streamID}\n              stream={student.stream}\n              video={student.video}\n              audio={student.audio}\n              local={student.local}\n              handleClick={onPlayerClick}\n              autoplay={true}\n            />\n          ))}\n        </div>\n      </div>\n    </div>\n  )\n}\nexport default React.memo(VideoMarquee);","import React, {useEffect, useRef} from 'react';\nimport './whiteboard.scss';\nimport { Room } from 'white-web-sdk';\nimport { whiteboard } from '../stores/whiteboard';\nimport { t } from '../i18n';\nimport { Progress } from '../components/progress/progress';\nimport { ResizeObserver } from '@juggle/resize-observer';\n\ninterface WhiteBoardProps {\n  room?: Room | null\n  className: string\n  loading: boolean\n}\n\nexport default function Whiteboard ({\n  room,\n  className,\n  loading\n}: WhiteBoardProps) {\n\n  const domRef = useRef(null);\n  const domObserver = useRef<any>(null)\n\n  useEffect(() => {\n    if (!room || !whiteboard.state.room || !domRef.current) return;\n    room.bindHtmlElement(domRef.current);\n    domObserver.current = new ResizeObserver((entries, observer) => {\n      if (!whiteboard.disconnected && whiteboard.state.room !== null && whiteboard.state.room.isWritable) {\n        whiteboard.state.room.moveCamera({centerX: 0, centerY: 0});\n        whiteboard.state.room.refreshViewSize();           \n      }\n    })\n    if (domObserver.current) {\n      domObserver.current.observe(domRef.current)\n    }\n    whiteboard.updateRoomState();\n    return () => {\n      if (whiteboard.state.room) {\n        whiteboard.state.room.bindHtmlElement(null);\n      }\n    }\n  }, [room, domRef]);\n\n  return (\n    <div className=\"whiteboard\">\n      { loading || !room ? <Progress title={t(\"whiteboard.loading\")}></Progress> : null}\n      <div ref={domRef} id=\"whiteboard\" className={`whiteboard-canvas ${className}`}></div>\n    </div>\n  )\n}","import React, { useRef } from 'react';\nimport Icon from '../icon';\nimport { roomStore } from '@/stores/room';\nimport { whiteboard } from '@/stores/whiteboard';\nimport moment from 'moment';\nimport { globalStore } from '@/stores/global';\nimport { t } from '@/i18n';\nimport { Tooltip } from '@material-ui/core';\nimport { useRoomState } from '@/containers/root-container';\ninterface ControlItemProps {\n  name: string\n  onClick: (evt: any, name: string) => void\n  active: boolean\n  text?: string\n  loading?: boolean\n}\n\nconst ControlItem = (props: ControlItemProps) => {\n  const onClick = (evt: any) => {\n    props.onClick(evt, props.name);\n  }\n  return (\n    props.text ?\n      <div className={`control-btn control-${props.name} ${props.loading ? 'icon-loading' : ''}`} onClick={onClick}>\n        <div className={`btn-icon ${props.name} ${props.active ? 'active' : ''}`}\n          data-name={props.name} />\n        <div className=\"control-text\">{props.text}</div>\n      </div>\n      :\n      <Icon\n        loading={props.loading}\n        data={props.name}\n        onClick={onClick}\n        className={`items ${props.name} ${props.active ? 'active' : ''}`}\n      />\n  )\n}\n\ninterface NoticeProps {\n  reason: string\n  text?: string\n}\n\ninterface ControlProps {\n  sharing: boolean\n  isHost?: boolean\n  current: string\n  currentPage: number\n  totalPage: number\n  role: number\n  notice?: NoticeProps\n  onClick: (evt: any, type: string) => void\n}\n\nexport default function Control({\n  sharing,\n  isHost,\n  current,\n  currentPage,\n  totalPage,\n  onClick,\n  role,\n  notice,\n}: ControlProps) {\n\n  const roomState = useRoomState();\n  const lock = useRef<boolean>(false);\n\n  const canStop = () => {\n    const timeMoment = moment(whiteboard.state.startTime).add(15, 'seconds');\n    if (+timeMoment >= +Date.now()) {\n      globalStore.showToast({\n        type: 'netlessClient',\n        message: t('toast.recording_too_short')\n      })\n      return false;\n    }\n    return true;\n  }\n\n  const onRecordButtonClick = (evt: any, type: string) => {\n    handleRecording(evt, type)\n    .then(() => {}).catch(console.warn);\n  }\n  \n  const handleRecording = async (evt: any, type: string) => {\n    try {\n      const roomState = roomStore.state;\n      const me = roomState.me;\n      if (lock.current || !me.uid) return;\n  \n      if (roomState.course.isRecording) {\n        if (!canStop()) return;\n        await roomStore.stopRecording();\n        globalStore.showToast({\n          type: 'recording',\n          message: t('toast.stop_recording'),\n        });\n      } else {\n        await roomStore.startRecording();\n        globalStore.showToast({\n          type: 'recording',\n          message: t('toast.start_recording'),\n        });\n      }\n    } catch(err) {\n      if (err.recordingErr) {\n        globalStore.showToast({\n          type: 'recordingErr',\n          message: t('toast.recording_failed', {reason: err.recordingErr.message})\n        });\n      }\n    }\n  }\n\n  return (\n    <div className=\"controls-container\">\n      <div className=\"interactive\">\n      {notice && roomState.users.count() <= 1 ?\n          <ControlItem name={notice.reason}\n            onClick={onClick}\n            active={notice.reason === current} />\n        : null}\n      </div>\n      <div className=\"controls\">\n        {!sharing && role === 1 ?\n          <>\n            <Tooltip title={t(`control_items.first_page`)} placement=\"top\">\n              <span>\n                <ControlItem name={`first_page`}\n                  active={'first_page' === current}\n                  onClick={onClick} />\n              </span>\n            </Tooltip>\n            <Tooltip title={t(`control_items.prev_page`)} placement=\"top\">\n              <span>\n                <ControlItem name={`prev_page`}\n                  active={'prev_page' === current}\n                  onClick={onClick} />\n              </span>\n            </Tooltip>\n            <div className=\"current_page\">\n              <span>{currentPage}/{totalPage}</span>\n            </div>\n            <Tooltip title={t(`control_items.next_page`)} placement=\"top\">\n              <span>\n                <ControlItem name={`next_page`}\n                  active={'next_page' === current}\n                  onClick={onClick} />\n              </span>\n            </Tooltip>\n            <Tooltip title={t(`control_items.last_page`)} placement=\"top\">\n              <span>\n                <ControlItem name={`last_page`}\n                  active={'last_page' === current}\n                  onClick={onClick} />\n              </span>\n            </Tooltip>\n            <div className=\"menu-split\" style={{ marginLeft: '7px', marginRight: '7px' }}></div>\n          </> : null\n        }\n        {+role === 1 ?\n          <>\n            <Tooltip title={t(roomStore.state.course.isRecording ? 'control_items.stop_recording' : 'control_items.recording')} placement=\"top\">\n              <span>\n                <ControlItem\n                  loading={Boolean(roomStore.state.recordLock)}\n                  name={Boolean(roomStore.state.recordLock) ? 'icon-loading ' : (roomStore.state.course.isRecording ? 'stop_recording' : 'recording')}\n                  onClick={onRecordButtonClick}\n                  active={false}\n                />\n              </span>\n            </Tooltip>\n            <Tooltip title={t(sharing ? 'control_items.quit_screen_sharing' : 'control_items.screen_sharing')} placement=\"top\">\n              <span>\n                <ControlItem\n                  name={sharing ? 'quit_screen_sharing' : 'screen_sharing'}\n                  onClick={(evt: any) => {\n                    if (sharing) {\n                      roomStore.stopScreenShare()\n                      .then(() => {\n                        console.log(\"stop screen share\")\n                      }).catch(console.warn)\n                    } else {\n                      roomStore.startScreenShare()\n                      .then(() => {\n                        console.log(\"start screen share\")\n                      }).catch(console.warn)\n                    }\n                  }}\n                  active={false}\n                  text={sharing ? 'stop sharing' : ''}\n                />\n              </span>\n            </Tooltip>\n          </> : null }\n        {+role === 2 ?\n          <>\n            <ControlItem\n              name={isHost ? 'hands_up_end' : 'hands_up'}\n              onClick={onClick}\n              active={false}\n              text={''}\n            />\n          </>\n         :null}\n      </div>\n\n    </div>\n  )\n}","import React from 'react';\nimport Icon from '../icon';\nimport { Tooltip } from '@material-ui/core';\nimport {t} from '@/i18n';\n\nconst ToolItem = (props: any) => {\n  const onClick = (evt: any) => {\n    props.onClick(evt, props.name);\n  }\n  return (\n    <Tooltip title={t(`tool.${props.name}`)} placement=\"right\">\n      <span>\n      <Icon data={props.name}\n        onClick={onClick} className={`items ${props.name} ${props.active ? 'active' : ''}`} />\n      </span>\n    </Tooltip>\n  )\n}\n\ninterface ToolsProps {\n  items: any[]\n  currentTool: string\n  handleToolClick: (evt: any, name: string) => void\n};\n\nexport default function Tools (props: ToolsProps) {\n  return (\n    <div className=\"menu\">\n      {props.items.map((item: any, key: number) => (\n        <ToolItem key={key}\n          name={item.name}\n          onClick={props.handleToolClick}\n          active={props.currentTool === item.name}\n        >\n        </ToolItem>\n      ))}\n    </div>\n  )\n}","import { MultipartUploadResult } from 'ali-oss';\nimport uuidv4 from 'uuid/v4';\nimport {Room, PptConverter, PptKind, Ppt} from 'white-web-sdk';\nimport MD5 from 'js-md5';\nimport { resolveFileInfo } from './helper';\n\nexport type imageSize = {\n  width: number\n  height: number\n};\n\nexport type PPTDataType = {\n    active: boolean\n    pptType: PPTType\n    id: string\n    data: any\n    cover?: any\n};\n\nexport enum PPTType {\n    dynamic = \"dynamic\",\n    static = \"static\",\n    init = \"init\",\n}\nexport type NetlessImageFile = {\n  width: number;\n  height: number;\n  file: File;\n  coordinateX: number;\n  coordinateY: number;\n};\n\nexport type TaskType = {\n  uuid: string,\n  imageFile: NetlessImageFile\n};\n\nexport type PPTProgressListener = (phase: PPTProgressPhase, percent: number) => void;\n\nexport enum PPTProgressPhase {\n  Uploading,\n  Converting,\n}\n\nexport class UploadManager {\n\n  private readonly ossClient: any;\n  private readonly room: Room;\n  private readonly ossUploadCallback?: (res: any) => void;\n  public constructor(ossClient: any, room: Room, ossUploadCallback?: (res: any) => void) {\n    this.ossClient = ossClient;\n    this.room = room;\n    this.ossUploadCallback = ossUploadCallback;\n  }\n  \n  public async convertFile(\n    rawFile: File,\n    pptConverter: PptConverter,\n    kind: PptKind,\n    folder: string,\n    uuid: string,\n    onProgress?: PPTProgressListener,\n  ): Promise<void> {\n    const {fileType} = resolveFileInfo(rawFile);\n    const path = `/${folder}/${uuid}${fileType}`;\n    const pptURL = await this.addFile(path, rawFile, onProgress);\n    let res: Ppt;\n    if (kind === PptKind.Static) {\n        res = await pptConverter.convert({\n          url: pptURL,\n          kind: kind,\n          onProgressUpdated: progress => {\n            if (onProgress) {\n              onProgress(PPTProgressPhase.Converting, progress);\n            }\n          },\n        });\n        const documentFile: PPTDataType = {\n          active: true,\n          id: `${uuidv4()}`,\n          pptType: PPTType.static,\n          data: res.scenes,\n        };\n        const scenePath = MD5(`/${uuid}/${documentFile.id}`);\n        this.room.putScenes(`/${scenePath}`, res.scenes);\n        this.room.setScenePath(`/${scenePath}/${res.scenes[0].name}`);\n    } else {\n      console.log(\"convert no static ppt\");\n        res = await pptConverter.convert({\n          url: pptURL,\n          kind: kind,\n          onProgressUpdated: progress => {\n            if (onProgress) {\n              onProgress(PPTProgressPhase.Converting, progress);\n            }\n          },\n        });\n        const documentFile: PPTDataType = {\n          active: true,\n          id: `${uuidv4()}`,\n          pptType: PPTType.dynamic,\n          data: res.scenes,\n        };\n        const scenePath = MD5(`/${uuid}/${documentFile.id}`);\n        this.room.putScenes(`/${scenePath}`, res.scenes);\n        this.room.setScenePath(`/${scenePath}/${res.scenes[0].name}`);\n    }\n    if (onProgress) {\n        onProgress(PPTProgressPhase.Converting, 1);\n    }\n  }\n  private getImageSize(imageInnerSize: imageSize): imageSize {\n    const windowSize: imageSize = {width: window.innerWidth, height: window.innerHeight};\n    const widthHeightProportion: number = imageInnerSize.width / imageInnerSize.height;\n    const maxSize: number = 960;\n    if ((imageInnerSize.width > maxSize && windowSize.width > maxSize) || (imageInnerSize.height > maxSize && windowSize.height > maxSize)) {\n      if (widthHeightProportion > 1) {\n        return {\n          width: maxSize,\n          height: maxSize / widthHeightProportion,\n        };\n      } else {\n        return {\n          width: maxSize * widthHeightProportion,\n          height: maxSize,\n        };\n      }\n    } else {\n      if (imageInnerSize.width > windowSize.width || imageInnerSize.height > windowSize.height) {\n        if (widthHeightProportion > 1) {\n          return {\n            width: windowSize.width,\n            height: windowSize.width / widthHeightProportion,\n          };\n        } else {\n          return {\n            width: windowSize.height * widthHeightProportion,\n            height: windowSize.height,\n          };\n        }\n      } else {\n        return {\n          width: imageInnerSize.width,\n          height: imageInnerSize.height,\n        };\n      }\n    }\n  }\n  public async uploadImageFiles(imageFiles: File[], x: number, y: number, onProgress?: PPTProgressListener): Promise<void> {\n    const newAcceptedFilePromises = imageFiles.map(file => this.fetchWhiteImageFileWith(file, x, y));\n    const newAcceptedFiles = await Promise.all(newAcceptedFilePromises);\n    await this.uploadImageFilesArray(newAcceptedFiles, onProgress);\n  }\n\n  private fetchWhiteImageFileWith(file: File, x: number, y: number): Promise<NetlessImageFile> {\n    return new Promise(resolve => {\n      const image = new Image();\n      const reader = new FileReader();\n      reader.readAsDataURL(file);\n      reader.onload = () => {\n        image.src = reader.result as string;\n        image.onload = async () => {\n          const res = this.getImageSize(image);\n          const imageFile: NetlessImageFile = {\n            width: res.width,\n            height: res.height,\n            file: file,\n            coordinateX: x,\n            coordinateY: y,\n          };\n          resolve(imageFile);\n        };\n      };\n    });\n  }\n  private async uploadImageFilesArray(imageFiles: NetlessImageFile[], onProgress?: PPTProgressListener): Promise<void> {\n    if (imageFiles.length > 0) {\n\n      const tasks: { uuid: string, imageFile: NetlessImageFile }[] = imageFiles.map(imageFile => {\n        return {\n          uuid: uuidv4(),\n          imageFile: imageFile,\n        };\n      });\n\n      for (const {uuid, imageFile} of tasks) {\n        const {x, y} = this.room.convertToPointInWorld({x: imageFile.coordinateX, y: imageFile.coordinateY});\n        this.room.insertImage({\n          uuid: uuid,\n          centerX: x,\n          centerY: y,\n          width: imageFile.width,\n          height: imageFile.height,\n        });\n      }\n      await Promise.all(tasks.map(task => this.handleUploadTask(task, onProgress)));\n      if (this.room.isWritable) {\n        this.room.setMemberState({\n          currentApplianceName: \"selector\",\n        });\n      }\n    }\n  }\n  private async handleUploadTask(task: TaskType, onProgress?: PPTProgressListener): Promise<void> {\n    const fileUrl: string = await this.addFile(`${task.uuid}${task.imageFile.file.name}`, task.imageFile.file, onProgress);\n    if (this.room.isWritable) {\n      this.room.completeImageUpload(task.uuid, fileUrl);\n    }\n  }\n\n  private getFile = (name: string): string => {\n    return this.ossClient.generateObjectUrl(name);\n  }\n  public addFile = async (path: string, rawFile: File, onProgress?: PPTProgressListener): Promise<string> => {\n    const res: MultipartUploadResult = await this.ossClient.multipartUpload(\n      path,\n      rawFile,\n      {\n        progress: (p: any) => {\n          if (onProgress) {\n            onProgress(PPTProgressPhase.Uploading, p);\n          }\n        },\n      });\n      if (this.ossUploadCallback) {\n        this.ossUploadCallback(res);\n      }\n    if (res.res.status === 200) {\n      return this.getFile(path);\n    } else {\n      throw new Error(`upload to ali oss error, status is ${res.res.status}`);\n    }\n  }\n}","import React, { useRef } from 'react';\nimport uuidv4 from 'uuid/v4';\nimport { PPTProgressListener, UploadManager } from \"@/utils/upload-manager\";\nimport { PptKind, Room } from \"white-web-sdk\";\nimport { ossConfig, ossClient, resolveFileInfo } from '@/utils/helper';\nimport { whiteboard } from '@/stores/whiteboard';\nimport {t} from '@/i18n';\n\nexport type UploadBtnProps = {\n  room: Room,\n  uuid: string,\n  roomToken: string,\n  onProgress?: PPTProgressListener,\n  onFailure?: (err: any) => void,\n  onSuccess?: () => void,\n  didUpload: () => void\n};\n\nexport const UploadBtn: React.FC<UploadBtnProps> = ({\n  room, uuid, roomToken,\n  onProgress, onFailure,\n  onSuccess,\n  didUpload\n}) => {\n\n  const ImageInput = useRef<any>(null);\n  const DynamicInput = useRef<any>(null);\n  const StaticInput = useRef<any>(null);\n  const AudioVideoInput = useRef<any>(null);\n\n  const uploadDynamic = async (event: any) => {\n    try {\n      didUpload();\n      const file = event.currentTarget.files[0];\n      if (file) {\n        const uploadManager = new UploadManager(ossClient, room);\n        const pptConverter = whiteboard.client.pptConverter(roomToken);\n        await uploadManager.convertFile(\n          file,\n          pptConverter,\n          PptKind.Dynamic,\n          ossConfig.folder,\n          uuid,\n          onProgress,\n        );\n        onSuccess && onSuccess();\n      }\n    } catch (err) {\n      onFailure && onFailure(err);\n      console.warn(err)\n    } finally {\n      if (DynamicInput.current) {\n        DynamicInput.current.value = ''\n      }\n    }\n  }\n\n  const uploadStatic = async (event: any) => {\n    try {\n      didUpload();\n      const file = event.currentTarget.files[0];\n      if (file) {\n        const uploadManager = new UploadManager(ossClient, room);\n        const pptConverter = whiteboard.client.pptConverter(roomToken);\n        await uploadManager.convertFile(\n          file,\n          pptConverter,\n          PptKind.Static,\n          ossConfig.folder,\n          uuid,\n          onProgress);\n        onSuccess && onSuccess();\n      }\n    } catch (err) {\n      onFailure && onFailure(err)\n      console.warn(err)\n    } finally {\n      if (StaticInput.current) {\n        StaticInput.current.value = ''\n      }\n    }\n  }\n\n  const uploadImage = async (event: any) => {\n    try {\n      didUpload();\n      const file = event.currentTarget.files[0];\n      if (file) {\n        const uploadFileArray: File[] = [];\n        uploadFileArray.push(file);\n        const uploadManager = new UploadManager(ossClient, room);\n        const $whiteboard = document.getElementById('whiteboard') as HTMLDivElement;\n        if ($whiteboard) {\n          const { clientWidth, clientHeight } = $whiteboard;\n          await uploadManager.uploadImageFiles(uploadFileArray, clientWidth / 2, clientHeight / 2, onProgress);\n        } else {\n          const clientWidth = window.innerWidth;\n          const clientHeight = window.innerHeight;\n          await uploadManager.uploadImageFiles(uploadFileArray, clientWidth / 2, clientHeight / 2, onProgress);\n        }\n        onSuccess && onSuccess();\n      }\n    } catch (err) {\n      onFailure && onFailure(err)\n      console.warn(err)\n    } finally {\n      if (ImageInput.current) {\n        ImageInput.current.value = ''\n      }\n    }\n  }\n\n  const uploadAudioVideo = async (event: any) => {\n    didUpload()\n    const uploadManager = new UploadManager(ossClient, room);\n    const file = event.currentTarget.files[0];\n    if (file) {\n      try {\n        const {fileName, fileType} = resolveFileInfo(file);\n        const path = `/${ossConfig.folder}`\n        const uuid = uuidv4();\n        const res = await uploadManager.addFile(`${path}/video-${fileName}${uuid}`, file,\n          onProgress\n        );\n        const isHttps = res.indexOf(\"https\") !== -1;\n        let url;\n        if (isHttps) {\n          url = res;\n        } else {\n          url = res.replace(\"http\", \"https\");\n        }\n        const type = fileType.split(\".\")[1];\n        if (url && whiteboard.state.room) {\n          if (type.toLowerCase() === 'mp4') {\n            const res = whiteboard.state.room.insertPlugin('video', {\n              originX: 0,\n              originY: 0,\n              width: 480,\n              height: 270,\n              attributes: {\n                  pluginVideoUrl: url,\n              },\n            });\n            console.log(\"[upload-btn] video resource after insert plugin, res: \", res);\n          }\n          if (type.toLowerCase() === 'mp3') {\n            const res = whiteboard.state.room.insertPlugin('audio', {\n              originX: 0,\n              originY: 0,\n              width: 480,\n              height: 86,\n              attributes: {\n                  pluginAudioUrl: url,\n              },\n            });\n            console.log(\"[upload-btn] audio resource after insert plugin, res: \", res);\n          }\n          onSuccess && onSuccess();\n        }\n      } catch(err) {\n        onFailure && onFailure(err);\n      } finally {\n        if (AudioVideoInput.current) {\n          AudioVideoInput.current.value = ''\n        }\n      }\n    }\n  }\n\n  return (\n    <div className=\"upload-btn\">\n      <div className=\"upload-items\">\n        <label htmlFor=\"upload-image\">\n          <div className=\"upload-image-resource\"></div>\n          <div className=\"text-container\">\n            <div className=\"title\">{t('upload_picture')}</div>\n            <div className=\"description\">bmp, jpg, png, gif</div>\n          </div>\n        </label>\n        <input ref={ImageInput} id=\"upload-image\" accept=\"image/*,.bmp,.jpg,.png,.gif\"\n          onChange={uploadImage} type=\"file\"></input>\n      </div>\n      <div className=\"slice-dash\"></div>\n      <div className=\"upload-items\">\n        <label htmlFor=\"upload-dynamic\">\n          <div className=\"upload-dynamic-resource\"></div>\n          <div className=\"text-container\">\n            <div className=\"title\">{t('convert_webpage')}</div>\n            <div className=\"description\">pptx</div>\n          </div>\n        </label>\n        <input ref={DynamicInput} id=\"upload-dynamic\" accept=\".pptx\" onChange={uploadDynamic} type=\"file\"></input>\n      </div>\n      <div className=\"slice-dash\"></div>\n      <div className=\"upload-items\">\n        <label htmlFor=\"upload-static\">\n          <div className=\"upload-static-resource\"></div>\n          <div className=\"text-container\">\n            <div className=\"title\">{t('convert_to_picture')}</div>\n            <div className=\"description\">pptx, word, pdf support</div>\n          </div>\n        </label>\n        <input ref={StaticInput} id=\"upload-static\" accept=\".doc,.docx,.ppt,.pptx,.pdf\" onChange={uploadStatic} type=\"file\"></input>\n      </div>\n      <div className=\"slice-dash\"></div>\n      <div className=\"upload-items\">\n        <label htmlFor=\"upload-video\">\n          <div className=\"upload-static-resource\"></div>\n          <div className=\"text-container\">\n            <div className=\"title\">{t('upload_audio_video')}</div>\n            <div className=\"description\">mp4,mp3</div>\n          </div>\n        </label>\n        <input ref={AudioVideoInput} id=\"upload-video\" accept=\".mp4,.mp3\" onChange={uploadAudioVideo} type=\"file\"></input>\n      </div>\n    </div>\n  )\n}","import React, {useRef, useState, useEffect} from 'react';\nimport { SceneResource, whiteboard } from '@/stores/whiteboard';\nimport { t } from '@/i18n';\nimport { Input, Tooltip } from '@material-ui/core';\nimport { useDebounce } from 'react-use';\nimport { globalStore } from '@/stores/global';\nimport Icon from '@/components/icon'; \nimport {omit} from 'lodash';\n\ntype ResourceMenuProps = {\n  activeScenePath: string\n  items: SceneResource[]\n  onClose: (evt: any) => void\n  onClick: (rootPath: string) => void\n}\n\nconst debounceDelay = 800\n\nexport const ResourceItem: React.FC<any> = (props: any) => {\n\n  const [name, setName] = useState<string>(props.name);\n\n  const mounted = useRef<boolean>(false);\n\n  // `useDebounce` documentation: https://github.com/streamich/react-use/blob/master/docs/useDebounce.md\n  // `useDebounce` 文档请参考: https://github.com/streamich/react-use/blob/master/docs/useDebounce.md\n  const [, cancel] = useDebounce(\n    () => {\n      if (!mounted.current || !name) return\n      if (whiteboard.state.room) {\n        const globalState: any = whiteboard.state.room.state.globalState as any;\n        const sceneMap: any = globalState['sceneMap'];\n        if (!sceneMap) {\n          whiteboard.state.room?.setGlobalState({\n            sceneMap: {\n              [`${props.item.path}`]: `${name}`\n            }\n          })\n        } else {\n          const blob = new Blob([JSON.stringify(globalState)])\n          const globalStateLength = Object.keys(globalState).length\n          const sceneMapLength = Object.keys(sceneMap).length\n          // WARN: Please do not use too large size with room.setGlobalState api especially in production environment.\n          // 警告: 请不要给room.setGlobalState传递过大的参数，以免造成网络问题\n          if (\n            globalStateLength <= 30 \n            && sceneMapLength <= 30\n            && blob.size <= (1000 * 50)) {\n            whiteboard.state.room?.setGlobalState({sceneMap: {\n              ...sceneMap,\n              [`${props.item.path}`]: `${name}`\n            }})\n          } else {\n            globalStore.showToast({\n              type: 'whiteboard',\n              message: t(\"whiteboard.global_state_limit\")\n            })\n          }\n        }\n      }\n    },\n    debounceDelay,\n    [name]\n  );\n\n  useEffect(() => {\n    mounted.current = true;\n    return () => {\n      mounted.current = false;\n      cancel()\n    }\n  }, [cancel])\n\n  const onChange = (evt: any) => {\n    setName(evt.target.value)\n  }\n\n  const isMainScene = [\"/\", \"/init\"].indexOf(props.item.path) !== -1\n\n  return (\n    <>\n    <div className={`item ${props.activeClass} relative`}>\n      <Tooltip title={isMainScene ? t(\"control_items.delete_all\") : t(\"control_items.delete_current\")} placement=\"bottom\">\n        <span>\n          <Icon className=\"icon-delete\" onClick={() => {\n            const room = whiteboard.state.room\n            if (room) {\n              room.removeScenes(props.item.path)\n              const roomGlobalState = room.state.globalState as any;\n              const sceneMap = roomGlobalState['sceneMap'];\n              const newSceneMap = omit(sceneMap, [`${props.item.path}`])\n              if (isMainScene) {\n                room.setGlobalState({\n                  sceneMap: ''\n                })\n              } else {\n                room.setGlobalState({\n                  sceneMap: newSceneMap\n                })\n              }\n            }\n          }} />\n        </span>\n      </Tooltip>\n      <div className={`cover-item ${props.coverType}`}\n        onClick={() => {\n          props.handleClick(props.item.rootPath);\n        }}\n      ></div>\n      <span>\n        <Input className=\"title\"\n          onChange={onChange}\n          defaultValue={props.name}\n        />\n      </span>\n    </div>\n  </>\n  )\n}\n\nexport const ResourcesMenu: React.FC<ResourceMenuProps> = (\n  {\n    onClose,\n    items,\n    activeScenePath,\n    onClick\n  }\n) => {\n  return (\n    <div className=\"resource-menu-container\">\n      <div className=\"menu-header\">\n      <div className=\"menu-title\">{t('doc_center')}</div>\n        <div className=\"menu-close\" onClick={onClose}></div>\n      </div>\n      <div className=\"menu-body\">\n        <div className=\"menu-items\">\n          {items.map((item: any, key: number) => (\n            <ResourceItem\n              activeClass={activeScenePath === item.path ? 'active' : ''}\n              coverType={item.file.type.match(/ppt/) ? 'ppt-cover' : 'doc-cover'}\n              item={item}\n              name={item.file.name}\n              key={key+item.path+item.file.name}\n              handleClick={onClick}\n            ></ResourceItem>\n          ))}\n        </div>\n      </div>\n    </div>\n  )\n}","import React from 'react';\nimport { Tooltip } from '@material-ui/core';\nimport {t} from '@/i18n';\nimport {roomStore} from '@/stores/room';\n\nexport type ScaleControllerProps = {\n  zoomScale: number\n  zoomChange: (scale: number) => void\n  onClick: () => void\n  onClickBoardLock: () => void\n};\n\nexport default class ScaleController extends React.Component<ScaleControllerProps, {}> {\n\n  private static readonly syncDuration: number = 200;\n\n  private static readonly dividingRule: ReadonlyArray<number> = Object.freeze(\n      [\n          0.10737418240000011,\n          0.13421772800000012,\n          0.16777216000000014,\n          0.20971520000000016,\n          0.26214400000000015,\n          0.3276800000000002,\n          0.4096000000000002,\n          0.5120000000000001,\n          0.6400000000000001,\n          0.8,\n          1,\n          1.26,\n          1.5876000000000001,\n          2.000376,\n          2.5204737600000002,\n          3.1757969376000004,\n          4.001504141376,\n          5.041895218133761,\n          6.352787974848539,\n          8.00451284830916,\n          10,\n      ],\n  );\n\n  private tempRuleIndex?: number;\n  private syncRuleIndexTimer: any = null;\n\n  public constructor(props: ScaleControllerProps) {\n      super(props);\n  }\n\n  private delaySyncRuleIndex(): void {\n      if (this.syncRuleIndexTimer !== null) {\n          clearTimeout(this.syncRuleIndexTimer);\n          this.syncRuleIndexTimer = null;\n      }\n      this.syncRuleIndexTimer = setTimeout(() => {\n          this.syncRuleIndexTimer = null;\n          this.tempRuleIndex = undefined;\n\n      }, ScaleController.syncDuration);\n  }\n\n  private static readRuleIndexByScale(scale: number): number {\n      const {dividingRule} = ScaleController;\n\n      if (scale < dividingRule[0]) {\n          return 0;\n      }\n      for (let i = 0; i < dividingRule.length; ++i) {\n          const prePoint = dividingRule[i - 1];\n          const point = dividingRule[i];\n          const nextPoint = dividingRule[i + 1];\n\n          const begin = prePoint === undefined ? Number.MIN_SAFE_INTEGER : (prePoint + point) / 2;\n          const end = nextPoint === undefined ? Number.MAX_SAFE_INTEGER : (nextPoint + point) / 2;\n\n          if (scale >= begin && scale <= end) {\n              return i;\n          }\n      }\n      return dividingRule.length - 1;\n  }\n\n  private moveTo100(): void {\n      this.tempRuleIndex = ScaleController.readRuleIndexByScale(1);\n      this.delaySyncRuleIndex();\n      this.props.zoomChange(1);\n  }\n\n\n  private moveRuleIndex(deltaIndex: number): void {\n\n      if (this.tempRuleIndex === undefined) {\n          this.tempRuleIndex = ScaleController.readRuleIndexByScale(this.props.zoomScale);\n      }\n      this.tempRuleIndex += deltaIndex;\n\n      if (this.tempRuleIndex > ScaleController.dividingRule.length - 1) {\n          this.tempRuleIndex = ScaleController.dividingRule.length - 1;\n\n      } else if (this.tempRuleIndex < 0) {\n          this.tempRuleIndex = 0;\n      }\n      const targetScale = ScaleController.dividingRule[this.tempRuleIndex];\n\n      this.delaySyncRuleIndex();\n      this.props.zoomChange(targetScale);\n  }\n\n  public render(): React.ReactNode {\n      return (\n        <div className=\"zoom-controls\">\n          <Tooltip title={t(\"zoom_control.folder\")} placement=\"top\">\n            <div className=\"zoom-icon\" onClick={() => this.props.onClick()}>\n            </div>\n          </Tooltip>\n          <div className=\"zoom-hold\"></div>\n          <div className=\"zoom-size\">{Math.ceil(this.props.zoomScale * 100)} %</div>\n          <div className=\"zoom-items\">\n            <div className=\"item zoom-in\" onClick={() => this.moveRuleIndex(-1)}>-</div>\n            <div className=\"item zoom-out\" onClick={() => this.moveRuleIndex(+1)}>+</div>\n          </div>\n          <Tooltip title={!roomStore.state.course.lockBoard ? t(\"zoom_control.lock_board\") : t(\"zoom_control.unlock_board\")} placement=\"top\">\n            <div className=\"lock-board\" onClick={() => this.props.onClickBoardLock() }></div>\n          </Tooltip>\n        </div>\n      );\n  }\n}","import React, { useRef, useEffect, useState } from 'react';\n\nimport './upload-notice.scss';\nimport { useGlobalState } from '@/containers/root-container';\n\ntype UploadNoticeProps = {\n  title: string\n  type: string\n}\n\nconst UploadNotice: React.FC<UploadNoticeProps> = ({\n  type,\n  title\n}) => {\n  return (\n    <div className={`notice-container ${type}`}>\n      <span className={`icon-${type}`}></span>\n      <span className=\"title\">{title}</span>\n    </div>\n  )\n}\n\nexport interface NoticeMessage {\n  title: string\n  key?: number\n  type: string\n}\n\ntype NoticeContext = {\n  state: NoticeMessage\n  Notice: (state: NoticeMessage) => any\n}\n\nconst UploadNoticeContext = React.createContext({} as NoticeContext);\n\nexport const useUploadNotice = () => React.useContext(UploadNoticeContext);\n\nconst duration = 2500;\n\nexport const UploadNoticeContainer: React.FC<{}> = () => {\n\n  const globalState = useGlobalState();\n\n  const uploadNotice = globalState.uploadNotice;\n\n  const queueRef = React.useRef<NoticeMessage[]>([]);\n  const [messages, setMessages] = useState<NoticeMessage[]>([]);\n  const timerRef = useRef<any>(null);\n\n  useEffect(() => {\n    if (messages.length > 0 && timerRef.current === null) {\n      timerRef.current = setTimeout(() => {\n        queueRef.current.shift()\n        setMessages([...queueRef.current]);\n        timerRef.current = null;\n      }, duration);\n    }\n  }, [messages]);\n\n  useEffect(() => {\n    if (!uploadNotice.title || !uploadNotice.type) return;\n    if (queueRef.current) {\n      queueRef.current.push({\n        ...uploadNotice,\n        key: +Date.now()\n      })\n      setMessages([...queueRef.current]);\n    }\n  }, [uploadNotice]);\n\n  return (\n    <div className=\"upload-notice\">\n      {messages.map((it: any, idx: number) => \n        <UploadNotice key={`${idx}${it.key}`}\n          type={it.type}\n          title={it.title}\n        />\n      )}\n    </div>\n  )\n}\n\nexport const UploadNoticeView = React.memo(UploadNoticeContainer);","import React, { useMemo, useEffect, useState, useRef, useCallback } from 'react';\nimport Whiteboard from './whiteboard';\nimport VideoPlayer from '../components/video-player';\nimport Control from './whiteboard/control';\nimport { AgoraStream } from '../utils/types';\nimport useStream from '../hooks/use-streams';\nimport { useLocation } from 'react-router';\nimport Tools from './whiteboard/tools';\nimport { SketchPicker, RGBColor } from 'react-color';\nimport { AgoraElectronClient } from '../utils/agora-electron-client';\nimport { UploadBtn } from './whiteboard/upload/upload-btn';\nimport { ResourcesMenu } from './whiteboard/resources-menu';\nimport ScaleController from './whiteboard/scale-controller';\nimport { PPTProgressPhase } from '../utils/upload-manager';\nimport { UploadNoticeView } from '../components/whiteboard/upload/upload-notice';\nimport Progress from '../components/progress/progress';\nimport { useRoomState, useWhiteboardState, useGlobalState } from '../containers/root-container';\nimport { roomStore } from '../stores/room';\nimport { whiteboard } from '../stores/whiteboard';\nimport { globalStore } from '../stores/global';\nimport { platform } from '../utils/platform';\nimport \"white-web-sdk/style/index.css\";\nimport { ViewMode } from 'white-web-sdk';\nimport { t } from '../i18n';\nimport { Collapse, Paper} from '@material-ui/core';\n\nconst pathName = (path: string): string => {\n  const reg = /\\/([^/]*)\\//g;\n  reg.exec(path);\n  if (RegExp.$1 === \"aria\") {\n      return \"\";\n  } else {\n      return RegExp.$1;\n  }\n}\n\ninterface MediaBoardProps {\n  handleClick?: (type: string) => void\n  children?: any\n}\n\nconst MediaBoard: React.FC<MediaBoardProps> = ({\n  handleClick,\n  children\n}) => {\n\n  const location = useLocation()\n\n  const roomState = useRoomState();\n\n  const whiteboardState = useWhiteboardState();\n  \n  const role = roomState.me.role;\n  const room = whiteboardState.room;\n  const me = roomState.me;\n  const course = roomState.course;\n  const rtmState = roomState.rtm;\n  \n  const ref = useRef<any>(false);\n\n  const [pageTool, setPageTool] = useState<string>('');\n\n  const {sharedStream} = useStream();\n\n  const handlePageTool: any = (evt: any, type: string) => {\n    setPageTool(type);\n    console.log(\"[page-tool] click \", type);\n    if (type === 'first_page') {\n      changePage(1, true);\n    }\n\n    if (type === 'last_page') {\n      changePage(totalPage, true);\n    }\n\n    if (type === 'prev_page') {\n      changePage(currentPage-1);\n    }\n\n    if (type === 'next_page') {\n      changePage(currentPage+1);\n    }\n\n    if (type === 'peer_hands_up') {\n      globalStore.showDialog({\n        type: 'apply',\n        message: `${globalStore.state.notice.text}`,\n      })\n      setPageTool('');\n    }\n\n    if (handleClick) {\n      handleClick(type);\n    }\n  }\n\n  const studentIsHost = useMemo(() => {\n    if (\n      location.pathname.match(/big-class/) \n      && me.role === 2 && me.coVideo) {\n      return true\n    }\n    return false\n  }, [me.role, me.coVideo, location])\n\n  \n  const current = useMemo(() => {\n    return {\n      totalPage: whiteboardState.totalPage,\n      currentPage: whiteboardState.currentPage,\n      type: whiteboardState.type\n    }\n  }, [whiteboardState.currentPage, whiteboardState.totalPage, whiteboardState.type]);\n\n  const totalPage = useMemo(() => {\n    if (!current) return 0;\n    return current.totalPage;\n  }, [current]);\n\n  const currentPage = useMemo(() => {\n    if (!current) return 0;\n    return current.currentPage + 1;\n  }, [current]);\n\n  const addNewPage: any = (evt: any) => {\n    if (!current || !room) return;\n    // const newIndex = netlessClient.state.sceneState.scenes.length;\n    const newIndex = room.state.sceneState.index + 1;\n    const scenePath = room.state.sceneState.scenePath;\n    const currentPath = `/${pathName(scenePath)}`;\n    if (room.isWritable) {\n      room.putScenes(currentPath, [{}], newIndex);\n      room.setSceneIndex(newIndex);\n    }\n\n    whiteboard.updateRoomState();\n  }\n\n  const changePage = (idx: number, force?: boolean) => {\n    if (ref.current || !current || !room || !room.isWritable) return;\n    const _idx = idx -1;\n    if (_idx < 0 || _idx >= current.totalPage) return;\n    if (force) {\n      room.setSceneIndex(_idx);\n      whiteboard.updateRoomState();\n      return\n    }\n    if (current.type === 'dynamic') {\n      if (_idx > current.currentPage) {\n        room.pptNextStep();\n        console.log(\"room.pptNextStep\");\n      } else {\n        room.pptPreviousStep();\n        console.log(\"room.pptPreviousStep\");\n      }\n    } else {\n      room.setSceneIndex(_idx);\n      console.log(\"room.setSceneIndex\", _idx);\n    }\n    whiteboard.updateRoomState();\n  }\n\n  const showControl: boolean = useMemo(() => {\n    if (+me.role === 1) return true;\n    if (location.pathname.match(/big-class/)) {\n      if (+me.role === 2) {\n        return true;\n      }\n    }\n    return false;\n  }, []);\n\nconst items = [\n  {\n    name: 'selector'\n  },\n  {\n    name: 'pencil'\n  },\n  {\n    name: 'rectangle',\n  },\n  {\n    name: 'ellipse'\n  },\n  {\n    name: 'text'\n  },\n  {\n    name: 'eraser'\n  },\n  {\n    name: 'color_picker'\n  },\n  {\n    name: 'add'\n  },\n  {\n    name: 'upload'\n  },\n  {\n    name: 'hand_tool'\n  }\n];\n\n  const toolItems = useMemo(() => {\n    return items.filter((item: any) => {\n      if (+role === 1) return item;\n      if (['add', 'folder', 'upload'].indexOf(item.name) === -1) {\n        if (item.name === 'hand_tool') {\n          if (course.lockBoard) {\n            return false;\n          } else {\n            return true;\n          }\n        }\n        return item;\n      }\n    });\n  }, [course.lockBoard]);\n\n  const drawable: string = useMemo(() => {\n    if (location.pathname.match('small-class|big-class')) {\n      if (+me.role === 1) {\n        return 'drawable';\n      }\n      if (+me.role === 2) {\n        if (Boolean(me.grantBoard)) {\n          return 'drawable';\n        } else {\n          return 'panel';\n        }\n      }\n    }\n    return 'drawable';\n  }, [me.role, me.grantBoard, location]);\n\n  const [tool, setTool] = useState<string | any>(drawable === 'drawable' ? 'pencil' : '');\n  \n  const [selector, updateSelector] = useState<string>('');\n\n  const handleToolClick = (evt: any, name: string) => {\n    if (!room || !room.isWritable) return;\n    if (['upload', 'color_picker', 'hand_tool'].indexOf(name) !== -1 && name === tool) {\n      setTool('');\n      if (name === 'hand_tool') {\n        room.handToolActive = false;\n        updateSelector('');\n      }\n      return;\n    }\n    if (name !== 'hand_tool') {\n      room.handToolActive = false;\n      updateSelector('');\n    }\n    setTool(name);\n    if (name === 'upload'\n      || name === 'folder'\n      || name === 'color_picker'\n      || name === 'add'\n      || name === 'hand_tool'\n    ) {\n      if (name === 'hand_tool') {\n        room.handToolActive = true;\n        updateSelector('hand');\n        room.setMemberState({currentApplianceName: 'selector'});\n      } else {\n        if (name === 'add' && addNewPage) {\n          addNewPage();\n        }\n      }\n      return;\n    }\n    room.setMemberState({currentApplianceName: name});\n  }\n\n  const onColorChanged = (color: any) => {\n    if (!room || !room.isWritable) return;\n    const {rgb} = color;\n    const {r, g, b} = rgb;\n    room.setMemberState({\n      strokeColor: [r, g, b]\n    });\n  }\n\n  const lock = useRef<boolean>(false);\n\n  useEffect(() => {\n    return () => {\n      lock.current = true;\n      whiteboard.destroy()\n      .then(() => {\n        console.log(\"destroy whiteboard\");\n      }).catch(console.warn);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!rtmState.joined) return;\n    if (!lock.current && !whiteboard.state.room) {\n      lock.current = true;\n      whiteboard.join({\n        rid: roomStore.state.course.rid,\n        uuid: course.boardId,\n        roomToken: course.boardToken,\n        location: location.pathname,\n        userPayload: {\n          userId: roomStore.state.me.uid,\n          identity: +roomStore.state.me.role === 1 ? 'host' : 'guest'\n        }\n      })\n      .then(() => {\n        console.log(\"join whiteboard success\");\n      }).catch((err: any) => {\n        console.warn(err)\n      })\n      .finally(() => {\n        lock.current = false;\n      })\n    }\n\n  }, [JSON.stringify([rtmState.joined, course.boardId, course.boardToken])]);\n\n  const [uploadPhase, updateUploadPhase] = useState<string>('');\n  const [convertPhase, updateConvertPhase] = useState<string>('');\n\n  useEffect(() => {\n    console.log(\"uploading [mediaboard] uploadPhase: \", uploadPhase, \" convertPhase: \", convertPhase);\n  }, [uploadPhase, convertPhase]);\n\n  const UploadPanel = useCallback(() => {\n    if (tool !== 'upload' || !room) return null;\n    return (<UploadBtn \n      room={room}\n      uuid={room.uuid}\n      roomToken={room.roomToken}\n      didUpload={() => {\n        setTool('')\n      }}\n      onProgress={(phase: PPTProgressPhase, percent: number) => {\n        console.log(\"uploading [onProgress] phase: \", phase, \" percent: \", percent, \"uploadPhase: \", uploadPhase, \"convertPhase: \", convertPhase);\n        if (phase === PPTProgressPhase.Uploading) {\n          if (percent < 1) {\n            uploadPhase !== 'uploading' && updateUploadPhase('uploading');\n          } else {\n            updateUploadPhase('upload_success');\n          }\n          return;\n        }\n\n        if (phase === PPTProgressPhase.Converting) {\n          if (percent < 1) {\n            convertPhase !== 'converting' && updateConvertPhase('converting');\n          } else {\n            updateConvertPhase('convert_success');\n          }\n          return;\n        }\n      }}\n      onSuccess={() => {\n        uploadPhase && updateUploadPhase('');\n        updateConvertPhase && updateConvertPhase('');\n        console.log(\"uploading [onSuccess]\", uploadPhase, convertPhase);\n      }}\n      onFailure={(err: any) => {\n        // WARN: capture exception\n        if (uploadPhase === 'uploading') {\n          updateUploadPhase('upload_failure');\n          return;\n        }\n        if (convertPhase === 'converting') {\n          updateConvertPhase('convert_failure');\n          return;\n        }\n      }}\n    />)\n  }, [tool, room]);\n\n  useEffect(() => {\n    if (uploadPhase === 'upload_success') {\n      globalStore.showUploadNotice({\n        title: t('room.upload_success'),\n        type: 'ok',\n      });\n    }\n    if (uploadPhase === 'convert_failure') {\n      globalStore.showUploadNotice({\n        title: t('room.upload_failure'),\n        type: 'error',\n      });\n    }\n  }, [uploadPhase]);\n\n  useEffect(() => {\n    if (convertPhase === 'convert_success') {\n      globalStore.showUploadNotice({\n        title: t('room.convert_success'),\n        type: 'ok',\n      });\n    }\n    if (convertPhase === 'convert_failure') {\n      globalStore.showUploadNotice({\n        title: t('room.convert_failure'),\n        type: 'error',\n      });\n    }\n  }, [convertPhase]);\n\n  useMemo(() => {\n    if (+roomState.me.role === 2 && +roomState.course.lockBoard === 1) {\n      globalStore.showToast({\n        type: \"whiteboard\",\n        message: t(\"whiteboard.locked_board\")\n      })\n    }\n  }, [roomState.course.lockBoard, roomState.me.role])\n\n  useEffect(() => {\n    if (!me.role || !room) return;\n    if (+me.role === 1) {\n      if (roomStore.state.course.lockBoard) {\n        room.setViewMode(ViewMode.Broadcaster);\n      } else {\n        room.setViewMode(ViewMode.Freedom);\n      }\n    }\n    if (+me.role === 2) {\n      if (roomStore.state.course.lockBoard) {\n        room.handToolActive = false;\n        room.disableCameraTransform = true;\n        room.disableDeviceInputs = true;\n      } else {\n        room.disableCameraTransform = false;\n        room.disableDeviceInputs = false;\n      }\n    }\n  }, [room, roomStore.state.course.lockBoard, roomStore.state.me.role]);\n\n  const globalState = useGlobalState();\n\n  const scale = whiteboardState.scale ? whiteboardState.scale : 1;\n\n  const UploadProgressView = useCallback(() => {\n    if (uploadPhase === 'uploading') {\n      return (\n        <Progress title={t(\"room.uploading\")} />\n      )\n    } else \n    if (convertPhase === 'converting') {\n      return (\n        <Progress title={t(\"room.converting\")} />\n      )\n    }\n    return null;\n  }, [uploadPhase, convertPhase]);\n\n  let strokeColor: RGBColor | undefined = undefined;\n\n  if (whiteboardState.room && whiteboardState.room.state.memberState.strokeColor) {\n    const color = whiteboardState.room.state.memberState.strokeColor;\n    strokeColor = {\n      r: color[0],\n      g: color[1],\n      b: color[2],\n    }\n  }\n\n  // useEffect(() => {\n  //   if (!room) return;\n  //   if (drawable === 'panel') {\n  //     room.disableDeviceInputs = true;\n  //     room.disableCameraTransform = true;\n  //     return;\n  //   }\n  //   room.disableDeviceInputs = false;\n  //   room.disableCameraTransform = false;\n  // }, [drawable, room]);\n\n  const showTools = drawable === 'drawable';\n  \n  return (\n    <div className={`media-board ${drawable}`}>\n      {sharedStream ? \n        <VideoPlayer\n          id={`${sharedStream.streamID}`}\n          domId={`shared-${sharedStream.streamID}`}\n          className={'screen-sharing'}\n          streamID={sharedStream.streamID}\n          stream={sharedStream.stream}\n          video={true}\n          audio={true}\n          local={sharedStream.local}\n        />\n        :\n        <Whiteboard\n          loading={whiteboardState.loading}\n          className={selector}\n          room={room}\n        />\n      }\n      <div className=\"layer\">\n        {!sharedStream ? \n        <>\n          {showTools ? <Tools\n          items={toolItems}\n          currentTool={tool}\n          handleToolClick={handleToolClick} /> : null}\n          {tool === 'color_picker' && strokeColor ?\n            <SketchPicker\n              color={strokeColor}\n              onChangeComplete={onColorChanged} />\n          : null}\n        </> : null}\n        <UploadPanel />\n        {children ? children : null}\n      </div>\n      {me.role === 1 && room ?\n        <ScaleController\n          zoomScale={scale}\n          onClick={() => {\n            setTool('folder');\n          }}\n          onClickBoardLock={() => {\n            whiteboard.lock()\n              .then(console.log)\n              .catch(console.warn);\n          }}\n          zoomChange={(scale: number) => {\n            room.moveCamera({scale});\n            whiteboard.updateScale(scale);\n          }}\n        />\n        :\n        null\n      }\n      { showControl ?\n      <Control\n        notice={globalState.notice}\n        role={role}\n        sharing={Boolean(sharedStream)}\n        current={pageTool}\n        currentPage={currentPage}\n        totalPage={totalPage}\n        isHost={studentIsHost}\n        onClick={handlePageTool}/> : null }\n        {tool === 'folder' && whiteboardState.room ? \n        <ResourcesMenu\n          activeScenePath={whiteboardState.currentScenePath}\n          items={whiteboardState.dirs}\n          onClick={(rootPath: string) => {\n            if (room) {\n              room.setScenePath(rootPath);\n              room.setSceneIndex(0);\n              whiteboard.updateRoomState();\n            }\n          }}\n          onClose={(evt: any) => {\n            setTool('')\n          }}\n        />\n        : null}\n      <UploadNoticeView />\n      <UploadProgressView />\n    </div>\n  )\n} \n\nexport default React.memo(MediaBoard);","import React, { useRef, useEffect } from 'react';\nimport {Message} from './message';\nimport { Input } from '@material-ui/core';\nimport Button from '../custom-button';\nimport './panel.scss';\nimport { List } from 'immutable';\nimport { ChatMessage } from '@/utils/types';\nimport { useRoomState } from '@/containers/root-container';\nimport useChatControl from '@/hooks/use-chat-control';\nimport { t } from '@/i18n';\n\ninterface ChatPanelProps {\n  messages: List<ChatMessage>\n  value: string\n  sendMessage: (evt: any) => void\n  handleChange: (evt: any) => void\n}\n\nconst regexPattern = /^\\s+/;\n\nconst truncateBlank: (m: string) => string = (message: string) => message.replace(regexPattern, '');\n\nexport default function ChatPanel ({\n  messages,\n  value,\n  sendMessage,\n  handleChange,\n}: ChatPanelProps) {\n  \n  const {handleMute, disableChat, muteControl, muteChat} = useChatControl();\n\n  const ref = useRef(null);\n\n  const scrollDown = (current: any) => {\n    current.scrollTop = current.scrollHeight;\n  }\n\n  useEffect(() => {\n    scrollDown(ref.current);\n  }, [messages]);\n\n  const roomState = useRoomState();\n\n  return (\n    <>\n      <div className=\"chat-messages-container\">\n        <div className=\"chat-messages\" ref={ref}>\n          {messages.map((item: ChatMessage, key: number) => (\n            <Message key={key} nickname={item.account} content={item.text} link={item.link} sender={item.id === roomState.me.uid} />\n          ))}\n        </div>   \n      </div>\n      <div className=\"message-panel\">\n        {muteControl ?\n          <div className={`icon ${muteChat ? 'icon-chat-off' : 'icon-chat-on' }`}\n            onClick={() => {\n              handleMute(muteChat ? 'unmute' : 'mute')\n            }}></div> : null}\n        <Input\n          disabled={disableChat}\n          value={value}\n          placeholder={disableChat ? t(\"chat.banned\") : t(\"chat.placeholder\")}\n          disableUnderline\n          className={\"message-input\"}\n          onKeyPress={async (evt: any) => {\n            if (evt.key === 'Enter') {\n              const val = truncateBlank(value)\n              val.length > 0 && await sendMessage(val);\n            }\n          }}\n          onChange={handleChange}/>\n        <Button className={'chat-panel-btn'} name={t(\"chat.send\")}\n          onClick={async (evt: any) => {\n            const val = truncateBlank(value)\n            val.length > 0 && await sendMessage(val);\n          }} />\n      </div>\n    </>\n  )\n}","import { roomStore } from '@/stores/room';\nimport {useEffect, useRef, useMemo} from 'react';\n\nexport default function useChatControl () {\n\n  const lock = useRef<boolean>(false);\n\n  useEffect(() => {\n    lock.current = false;\n    return () => {\n      lock.current = true;\n    }\n  }, []);\n\n  const me = roomStore.state.me;\n  const course = roomStore.state.course;\n\n  const muteControl = me.role === 1;\n\n  const muteChat = Boolean(course.muteChat);\n\n  const chat =  Boolean(me.chat);\n\n  const disableChat: boolean = useMemo(() => {\n    if (+me.role === 2 && (muteChat || !chat)) return true;\n    return false;\n  }, [muteChat, chat, me.role]);\n\n  return {\n    chat,\n    disableChat,\n    muteControl,\n    muteChat,\n    handleMute (type: string) {\n      if (!lock.current) {\n        lock.current = true;\n        roomStore.updateCourse({\n          muteChat: type === 'mute' ? 1 : 0\n        }).then(() => {\n          console.log(\"update success\");\n        }).catch(console.warn)\n        .finally(() => {\n          lock.current = false;\n        })\n      }\n\n    }\n  }\n}","import React, {useRef } from 'react';\nimport './student-list.scss';\nimport Icon from './icon';\nimport { useRoomState } from '../containers/root-container';\nimport {roomStore, AgoraUser} from '../stores/room';\nimport { get } from 'lodash';\n\ninterface CustomIconProps {\n  value: boolean\n  type: string\n  icon: string\n  id: string\n  onClick: (evt: any, id: string, type: string) => any\n}\n\nfunction CustomIcon ({\n  value,\n  icon,\n  id,\n  type,\n  onClick\n}: CustomIconProps) {\n  const handleClick = (evt: any) => {\n    onClick(evt, id, type);\n  }\n  return (\n    <div className=\"items\">\n        {/* {value ? */}\n          <Icon className={`icon-${icon}-${value ? \"on\" : \"off\"}`}\n            onClick={handleClick}\n            />\n             {/* : null } */}\n    </div>\n  )\n}\n\ninterface UserProps {\n  uid: string\n  account: string\n  video: number\n  audio: number\n  chat: number\n}\n\ninterface StudentListProps {\n  list: AgoraUser[]\n  role: number\n}\n\nexport default function StudentList ({\n  list,\n  role\n}: StudentListProps) {\n\n  const state = useRoomState();\n\n  const me = state.me;\n\n  const lock = useRef<any>(false);\n\n  const handleClick = (evt: any, id: string, type: string) => {\n    if (!roomStore.state || !me) return;\n    const targetUser = roomStore.state.users.get(`${id}`);\n    if (!targetUser) return;\n    if (!lock.current) {\n      const val = Boolean(get(targetUser, type));\n      lock.current = true;\n      if (val) {\n        roomStore.mute(targetUser.uid, type)\n        .then(() => {\n        }).catch(console.warn)\n        .finally(() => {\n          lock.current = false;\n        });\n      } else {\n        roomStore.unmute(targetUser.uid, type)\n        .then(() => {\n        }).catch(console.warn)\n        .finally(() => {\n          lock.current = false;\n        });\n      }\n    }\n  }\n\n  return (\n    <div className=\"student-list\">\n      {list.map((item: AgoraUser, key: number) => (\n        <div key={key} className=\"item\">\n          <div className=\"nickname\">{item.account}</div>\n          <div className=\"attrs-group\">\n            <CustomIcon type=\"grantBoard\" id={item.uid} value={Boolean(item.grantBoard)} icon=\"connect\" onClick={handleClick} />\n            <CustomIcon type=\"chat\" id={item.uid} value={Boolean(item.chat)} icon=\"chat\" onClick={handleClick} />\n            <CustomIcon type=\"audio\" id={item.uid} value={Boolean(item.audio)} icon=\"audio\" onClick={handleClick} />\n            <CustomIcon type=\"video\" id={item.uid} value={Boolean(item.video)} icon=\"video\" onClick={handleClick} />\n          </div>\n        </div>\n      ))}\n    </div>\n  )\n}","import { useState, useMemo } from 'react';\nimport { useRoomState } from '../containers/root-container';\nimport { roomStore, AgoraUser } from '../stores/room';\n\nexport default function useChatText () {\n  const [value, setValue] = useState('');\n\n  const roomState = useRoomState();\n\n  const roomName = roomState.course.roomName;\n\n  const me = roomState.me;\n\n  const role = me.role;\n\n  const messages = useMemo(() => {\n    return roomState.messages;\n  }, [roomState.messages]);\n\n  const rtmClient = roomStore.rtmClient;\n\n  const sendMessage = async (content: string) => {\n    if (rtmClient &&  me.uid) {\n      if (me.role !== 1 && (!me.chat || Boolean(roomState.course.muteChat))) return console.warn(\"chat already muted\");\n      if (me.role === 1 && !me.chat) return console.warn(\"chat already muted\");\n      await roomStore.sendChannelMessage({\n        message: content,\n      });\n      const message = {\n        account: me.account,\n        id: me.uid,\n        text: content,\n        ts: +Date.now()\n      }\n      roomStore.updateChannelMessage(message);\n      setValue('');\n    }\n  }\n\n  const handleChange = (evt: any) => {\n    setValue(evt.target.value.slice(0, 100));\n  }\n  const list = useMemo(() => {\n    if (!roomState.me.uid || !roomState.rtc.users.count() && !roomState.rtc.localStream) return [];\n    const my = roomState.users.get(roomState.me.uid);\n    const users = [];\n    if (my) {\n      users.push(my);\n    }\n    for (let id of roomState.rtc.users) {\n      const user = roomState.users.get(''+id);\n      if (user) {\n        users.push(user);\n      }\n    }\n    return users.filter((user: AgoraUser) => +user.role === 2);\n  }, [roomState.me.uid, roomState.rtc.users, roomState.users, roomState.rtc.localStream]);\n\n  return {\n    list,\n    role,\n    messages,\n    sendMessage,\n    value,\n    handleChange,\n    roomName\n  }\n}","import React, {useState} from 'react';\nimport ChatPanel from './chat/panel';\nimport StudentList from './student-list';\nimport useChatText from '../hooks/use-chat-text';\nimport { t } from '../i18n';\nimport { useGlobalState } from '../containers/root-container';\nimport { globalStore } from '../stores/global';\n\nexport default function Roomboard (props: any) {\n  const {\n    role, list, value,\n    messages, sendMessage, handleChange\n  } = useChatText();\n\n  const {active} = useGlobalState();\n\n  const [visible, setVisible] = useState(true);\n\n  const toggleCollapse = (evt: any) => {\n    setVisible(!visible);\n  }\n\n  const count = active !== 'chatroom' ? globalStore.state.newMessageCount : 0;\n\n  return (\n    <>\n    <div className={`${visible ? \"icon-collapse-off\" : \"icon-collapse-on\" } fixed`} onClick={toggleCollapse}></div>\n    {visible ? \n    <div className={`small-class chat-board`}>\n      <div className=\"menu\">\n        <div onClick={() => { globalStore.setActive('chatroom') }} className={`item ${active === 'chatroom' ? 'active' : ''}`}>\n          {t('room.chat_room')}\n          {active !== 'chatroom' && count > 0 ? <span className={`message-count ${globalStore.state.language}`}>{count}</span> : null}\n        </div>\n        <div onClick={() => { globalStore.setActive('studentList') }} className={`item ${active === 'studentList' ? 'active' : ''}`}>{t('room.student_list')}</div>\n      </div>\n      <div className={`chat-container ${active === 'chatroom' ? '' : 'hide'}`}>\n        <ChatPanel\n          messages={messages}\n          value={value}\n          sendMessage={sendMessage}\n          handleChange={handleChange} />\n      </div>\n      <div className={`student-container ${active !== 'chatroom' ? '' : 'hide'}`}>\n        <StudentList\n          role={role}\n          list={list}\n        />\n      </div>\n    </div>\n    : null}\n    </>\n  )\n}","import React from 'react';\nimport VideoMarquee from '@/components/video-marquee';\nimport MediaBoard from '@/components/mediaboard';\nimport Roomboard from '@/components/roomboard';\nimport './small-class.scss';\n\nexport default function SmallClass() {\n  return (\n    <div className=\"room-container\">\n      <VideoMarquee />\n      <div className=\"container\">\n        <MediaBoard />\n        <Roomboard currentActive={'media'} />\n      </div>\n    </div>\n  )\n}","import React from 'react';\nimport ChatPanel from './panel';\nimport { ChatMessage } from '@/utils/types';\nimport { List } from 'immutable';\n\ninterface ChatBoard {\n  name?: string\n  messages: List<ChatMessage>\n  value: string\n  teacher?: boolean\n  mute?: boolean\n  roomCount?: number\n  sendMessage: (evt: any) => void\n  handleChange: (evt: any) => void\n}\n\nexport default function ChatBoard (props: ChatBoard) {\n  return (\n    <div className=\"chat-board\">\n      {props.name ? <div className=\"chat-roomname\">{props.name}{props.roomCount ? `(${props.roomCount})` : null }</div> : null}\n        <ChatPanel\n          messages={props.messages}\n          value={props.value}\n          sendMessage={props.sendMessage}\n          handleChange={props.handleChange} />\n    </div>\n  )\n}","import React from 'react';\nimport VideoPlayer from '@/components/video-player';\nimport MediaBoard from '@/components/mediaboard';\nimport ChatBoard from '@/components/chat/board';\nimport useStream from '@/hooks/use-streams';\nimport useChatText from '@/hooks/use-chat-text';\n\nexport default function OneToOne() {\n  const {\n    value,\n    messages,\n    sendMessage,\n    handleChange,    \n  } = useChatText();\n\n  const {teacher, students, onPlayerClick} = useStream();\n\n  return (\n    <div className=\"room-container\">\n      <MediaBoard />\n      <div className=\"live-board\">\n        <div className=\"video-board\">\n          {teacher ?\n            <VideoPlayer\n              role=\"teacher\"\n              streamID={teacher.streamID}\n              stream={teacher.stream}\n              domId={`${teacher.streamID}`}\n              id={`${teacher.streamID}`}\n              account={teacher.account}\n              handleClick={onPlayerClick}\n              video={teacher.video}\n              audio={teacher.audio}\n              local={teacher.local}\n              autoplay={true}\n              /> :\n            <VideoPlayer\n              role=\"teacher\"\n              account={'teacher'}\n              domId={'teacher'}\n              streamID={0}\n              video\n              audio\n              />}\n          {students[0] ?\n            <VideoPlayer\n              role=\"student\"\n              streamID={students[0].streamID}\n              stream={students[0].stream}\n              domId={`${students[0].streamID}`}\n              id={`${students[0].streamID}`}\n              handleClick={onPlayerClick}\n              account={students[0].account}\n              video={students[0].video}\n              audio={students[0].audio}\n              local={students[0].local}\n              autoplay={true}\n            /> :\n            <VideoPlayer\n              role=\"student\"\n              account={\"student\"}\n              domId={\"student\"}\n              streamID={0}\n              video={false}\n              audio={false}\n            />}\n        </div>\n        <ChatBoard\n          messages={messages}\n          value={value}\n          sendMessage={sendMessage}\n          handleChange={handleChange}\n        />\n      </div>\n    </div>\n  )\n}","import React, {useRef, useEffect} from 'react';\nimport VideoPlayer from '@/components/video-player';\n\nimport './big-class.scss';\nimport ChatBoard from '@/components/chat/board';\nimport MediaBoard from '@/components/mediaboard';\nimport useStream from '@/hooks/use-streams';\nimport useChatText from '@/hooks/use-chat-text';\nimport { AgoraElectronClient } from '@/utils/agora-electron-client';\nimport {AgoraWebClient} from '@/utils/agora-web-client';\nimport { useRoomState } from '@/containers/root-container';\nimport { roomStore } from '@/stores/room';\nimport { platform } from '@/utils/platform';\nimport { eduApi } from '@/services/edu-api';\nimport { globalStore } from '@/stores/global';\nimport { t } from '@/i18n';\n\nexport default function BigClass() {\n  const {\n    value,\n    messages,\n    sendMessage,\n    handleChange,\n    role,\n    roomName\n  } = useChatText();\n\n  const roomState = useRoomState();\n\n  const me = roomState.me;\n\n  const memberCount = roomState.course.memberCount;\n\n  const {teacher, currentHost, onPlayerClick} = useStream();\n\n  const rtmLock = useRef<boolean>(false);\n  const lock = useRef<boolean>(false);\n  \n  useEffect(() => {\n    rtmLock.current = false;\n    return () => {\n      rtmLock.current = true;\n      lock.current = true;\n    }\n  }, []);\n\n  const handleClick = (type: string) => {\n    if (rtmLock.current) return;\n\n    if (type === 'hands_up') {\n      if (roomStore.state.course.teacherId) {\n        eduApi.studentSendApply(roomStore.state.course.roomId)\n          .then((data: any) => {\n            console.log('hands_up fulfilled', data)\n          })\n          .catch((err: any) => {\n            console.warn(err)\n          })\n      }\n    }\n  \n    if (type === 'hands_up_end') {\n      rtmLock.current = true;\n      eduApi.studentStopCoVideo(roomStore.state.course.roomId)\n        .then((data: any) => {\n          console.log('hands_up_end success', data)\n        })\n        .catch((err: any) => {\n          console.warn(err)\n        })\n        .finally(() => {\n          rtmLock.current = false;\n        })\n    }\n  }\n\n  // TODO: handleClose\n  const closeLock = useRef<boolean>(false);\n\n  useEffect(() => {\n    return () => {\n      closeLock.current = true;\n    }\n  }, []);\n\n  const handleClose = (type: string, streamID: number) => {\n    if (type === 'close') {\n      if (!currentHost || closeLock.current) return;\n\n      const rtmClient = roomStore.rtmClient;\n      const rtcClient = roomStore.rtcClient;\n      const teacherUid = roomStore.state.course.teacherId;\n\n      console.log(\"close rtmClient: \", rtmClient, \", rtcClient: \", rtcClient, \", teacherUid: \", teacherUid, \", lock :\", closeLock.current);\n\n      if (currentHost.streamID === +me.uid && teacherUid) {\n        const quitClient = new Promise((resolve, reject) => {\n          if (platform === 'electron') {\n            const nativeClient = rtcClient as AgoraElectronClient;\n            const val = nativeClient.unpublish();\n            if (val >= 0) {\n              resolve();\n            } else {\n              console.warn('quit native client failed');\n              reject(val);\n            }\n          }\n          if (platform === 'web') {\n            const webClient = rtcClient as AgoraWebClient;\n            resolve(webClient.unpublishLocalStream());\n          }\n        });\n        closeLock.current = true;\n        rtmLock.current = true;\n        Promise.all([\n          eduApi.studentStopCoVideo(\n            roomStore.state.course.roomId\n          ),\n          quitClient\n        ]).then(() => {\n          globalStore.showToast({\n            type: 'close_youself_co_video',\n            message: t('toast.close_youself_co_video')\n          })\n          rtmLock.current = false;\n        }).catch((err: any) => {\n          rtmLock.current = false;\n          console.warn(err);\n          throw err;\n        }).finally(() => {\n          closeLock.current = false;\n        })\n      }\n\n      if (`${teacherUid}` && `${teacherUid}` === `${me.uid}`) {\n        rtmLock.current = true;\n        closeLock.current = true;\n        Promise.all([\n          eduApi.teacherCancelStudent(\n            roomStore.state.course.roomId,\n            roomStore.state.applyUser.userId,\n          )\n        ]).then(() => {\n          globalStore.showToast({\n            type: 'peer_hands_up',\n            message: t(\"toast.close_co_video\")\n          })\n          roomStore.updateApplyUser({\n            account: '',\n            userId: '',\n          })\n          rtmLock.current = false;\n        }).catch((err: any) => {\n          rtmLock.current = false;\n          console.warn(err);\n        }).finally(() => {\n          closeLock.current = false;\n        })\n      }\n    }\n  }\n  \n  return (\n    <div className=\"room-container\">\n      <div className=\"live-container\">\n        <MediaBoard\n          handleClick={handleClick}\n        >\n          <div className=\"video-container\">\n          {currentHost ? \n            <VideoPlayer\n              role=\"teacher\"\n              streamID={currentHost.streamID}\n              stream={currentHost.stream}\n              domId={`${currentHost.streamID}`}\n              id={`${currentHost.streamID}`}\n              account={currentHost.account}\n              handleClick={onPlayerClick}\n              close={me.role === 1 || +me.uid === currentHost.streamID}\n              handleClose={handleClose}\n              video={currentHost.video}\n              audio={currentHost.audio}\n              local={currentHost.local}\n              autoplay={Boolean(me.coVideo)}\n            /> :\n            null\n          }\n        </div>\n        </MediaBoard>\n      </div>\n      <div className=\"live-board\">\n        <div className=\"video-board\">\n          {teacher ?\n            <VideoPlayer\n              role=\"teacher\"\n              streamID={teacher.streamID}\n              stream={teacher.stream}\n              domId={`dom-${teacher.streamID}`}\n              id={`${teacher.streamID}`}\n              account={teacher.account}\n              handleClick={onPlayerClick}\n              audio={Boolean(teacher.audio)}\n              video={Boolean(teacher.video)}\n              local={Boolean(teacher.local)}\n              autoplay={Boolean(me.coVideo)}\n              /> :\n            <VideoPlayer\n              role=\"teacher\"\n              account={'teacher'}\n              streamID={0}\n              video={true}\n              audio={true}\n              />}\n        </div>\n        <ChatBoard\n          name={roomName}\n          teacher={role === 1}\n          messages={messages}\n          mute={Boolean(roomState.course.muteChat)}\n          value={value}\n          roomCount={memberCount}\n          sendMessage={sendMessage}\n          handleChange={handleChange} />\n      </div>\n    </div>\n  )\n}\n","import React from 'react';\nimport {t} from '../i18n';\n\nimport './404.scss';\nimport { useHistory } from 'react-router-dom';\n\nconst BasicLayout: React.FC<any> = ({children}) => {\n  return (\n    <div className=\"main-layout-container\">\n      {children}\n    </div>\n  )\n}\n\nexport const PageNotFound: React.FC<any> = () => {\n\n  const history = useHistory();\n\n  return (\n    <BasicLayout>\n      <div className=\"layout-content\">\n        <h1>404</h1>\n        <h2>{t('error.not_found')}</h2>\n        <a style={{\"cursor\": \"pointer\"}} onClick={() => {\n            history.push('/');\n        }}>{t('return.home')}</a>\n      </div>\n    </BasicLayout>\n  )\n}","import React, { useState } from 'react';\nimport '../classroom/room.scss';\nimport { isElectron } from '@/utils/platform';\nimport '@/components/nav.scss';\nimport { Tooltip } from '@material-ui/core';\nimport { t } from '@/i18n';\nimport { globalStore } from '@/stores/global';\nimport Log from '@/utils/LogUploader';\nimport { usePlatform } from '@/containers/platform-container';\nimport Icon from '@/components/icon';\n\nconst MenuNav = () => {\n\n  const [loading, setLoading] = useState<boolean>(false)\n\n  const {NavBtn} = usePlatform();\n\n  const handleClick = (type: string) => {\n    if (type === 'exit') {\n      globalStore.showDialog({\n        type: 'exitRoom',\n        message: t('toast.quit_room'),\n      });\n    } else if (type === 'uploadLog') {\n      setLoading(true)\n      Log.doUpload().then((resultCode: any) => {\n        globalStore.showDialog({\n          type: 'uploadLog',\n          message: t('toast.show_log_id', { reason: `${resultCode}` })\n        });\n      }).finally(() => {\n        setLoading(false)\n      })\n    }\n  }\n  return (\n    <div className={`nav-container menu-nav ${isElectron ? 'draggable' : ''}`}>\n      <div className=\"menu-nav-right\">\n        {/* <Tooltip title={t(\"icon.upload-log\")} placement=\"bottom\">\n          <div>\n            <Icon className={loading ? \"icon-loading\" : \"icon-upload\"} onClick={(evt: any) => {\n              handleClick('uploadLog')\n            }}></Icon>\n          </div>\n        </Tooltip> */}\n        <NavBtn />\n      </div>\n    </div>\n  )\n}\n\nexport function ReplayPageWrapper({ children }: any) {\n  return (\n    <>\n    {isElectron ? \n      <div className=\"replay-page-wrapper\">\n        <MenuNav />\n        {children}\n      </div>\n      : children\n    }\n    </>\n  );\n}\n\n","import React from 'react';\nimport Avatar from '@material-ui/core/Avatar';\nimport Button from '@material-ui/core/Button';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport TextField from '@material-ui/core/TextField';\nimport Link from '@material-ui/core/Link';\nimport Grid from '@material-ui/core/Grid';\nimport Box from '@material-ui/core/Box';\nimport LockOutlinedIcon from '@material-ui/icons/LockOutlined';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Container from '@material-ui/core/Container';\n\nfunction Copyright() {\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" align=\"center\">\n      {'Copyright © '}\n      <Link color=\"inherit\" href=\"https://material-ui.com/\">\n        Your Website\n      </Link>{' '}\n      {new Date().getFullYear()}\n      {'.'}\n    </Typography>\n  );\n}\n\nconst useStyles = makeStyles((theme) => ({\n  paper: {\n    marginTop: theme.spacing(8),\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n  },\n  avatar: {\n    margin: theme.spacing(1),\n    backgroundColor: theme.palette.secondary.main,\n  },\n  form: {\n    width: '100%', // Fix IE 11 issue.\n    marginTop: theme.spacing(1),\n  },\n  submit: {\n    margin: theme.spacing(3, 0, 2),\n  },\n}));\n\nexport function ConfigPage() {\n  const classes = useStyles();\n\n  return (\n    <Container component=\"main\" maxWidth=\"xs\">\n      <CssBaseline />\n      <div className={classes.paper}>\n        <Avatar className={classes.avatar}>\n          <LockOutlinedIcon />\n        </Avatar>\n        <Typography component=\"h1\" variant=\"h5\">\n          Sign in\n        </Typography>\n        <form className={classes.form} noValidate>\n          <TextField\n            variant=\"outlined\"\n            margin=\"normal\"\n            required\n            fullWidth\n            id=\"appID\"\n            label=\"Agora AppID\"\n            name=\"appID\"\n            autoFocus\n          />\n          <TextField\n            variant=\"outlined\"\n            margin=\"normal\"\n            required\n            fullWidth\n            name=\"Netless SDKToken\"\n            label=\"Netless SDKToken\"\n            id=\"sdkToken\"\n          />\n          <Button\n            type=\"submit\"\n            fullWidth\n            variant=\"contained\"\n            color=\"primary\"\n            className={classes.submit}\n          >\n            Send\n          </Button>\n          <Grid container>\n            <Grid item xs>\n              <Link href=\"https://github.com/agoraio-usecase/eEducation/issues/new\" target=\"_blank\" variant=\"body2\">\n                Feedback Github issues\n              </Link>\n            </Grid>\n            <Grid item>\n              <Link href=\"#\" variant=\"body2\">\n              </Link>\n            </Grid>\n          </Grid>\n        </form>\n      </div>\n      <Box mt={8}>\n        <Copyright />\n      </Box>\n    </Container>\n  );\n}","import React from 'react';\nimport { Route } from 'react-router-dom';\nimport CustomBrowserRouter from '../containers/custom-browser-router';\nimport ThemeContainer from '../containers/theme-container';\nimport Home from './home';\nimport DeviceTest from './device-test';\nimport { RoomPage } from './classroom';\nimport Loading from '../components/loading';\nimport Toast from '../components/toast';\nimport '../icons.scss';\nimport { PlatformContainer } from '../containers/platform-container';\nimport ReplayContainer from './replay/replay';\nimport AgoraReplayContainer from './replay/agora-replay';\nimport { RootProvider } from '../containers/root-container';\nimport SmallClass from './classroom/small-class';\nimport OneToOne from './classroom/one-to-one';\nimport BigClass from './classroom/big-class';\nimport { PageNotFound } from './404';\nimport RoomDialog from '../components/dialog';\nimport { ReplayPageWrapper } from './replay';\nimport { ConfigPage } from './config';\n\nexport default function () {\n  return (\n    <ThemeContainer>\n      <CustomBrowserRouter>\n        <PlatformContainer>\n        <RootProvider>\n          <Loading />\n          <Toast />\n          <RoomDialog />\n          <Route exact path=\"/device_test\">\n            <DeviceTest />\n          </Route>\n          <Route exact path=\"/classroom/one-to-one\">\n            <RoomPage >\n              <OneToOne />\n            </RoomPage>\n          </Route>\n          <Route exact path=\"/classroom/small-class\">\n            <RoomPage>\n              <SmallClass />\n            </RoomPage>\n          </Route>\n          <Route exact path=\"/classroom/big-class\">\n            <RoomPage>\n              <BigClass />\n            </RoomPage>\n          </Route>\n          <Route path=\"/replay/record/:recordId\">\n            <ReplayPageWrapper>\n              <ReplayContainer />\n            </ReplayPageWrapper>\n          </Route>\n          <Route path=\"/replay/agora_record/:recordId\">\n            <ReplayPageWrapper>\n              <AgoraReplayContainer />\n            </ReplayPageWrapper>\n          </Route>\n          <Route path=\"/config\">\n            <ConfigPage />\n          </Route>\n          <Route exact path=\"/\">\n            <Home />\n          </Route>\n          {/* <Route path=\"/error\">\n            <ErrorPage />\n          </Route> */}\n          <Route exact path=\"/404\">\n            <PageNotFound />\n          </Route>\n        </RootProvider>\n        </PlatformContainer>\n      </CustomBrowserRouter>\n    </ThemeContainer>\n  )\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport App from './pages/index';\nimport * as serviceWorker from './serviceWorker';\nimport TagManager from 'react-gtm-module';\nimport Eruda from 'eruda';\nimport UAParser from 'ua-parser-js';\nimport {isElectron} from './utils/platform';\n\nconst parser = new UAParser();\n\nconst userAgentInfo = parser.getResult();\n\nconst isMobile = () => {\n  return userAgentInfo.device.type === 'mobile';\n};\n\n// use gtm\nif (process.env.REACT_APP_AGORA_GTM_ID) {\n  !isElectron && TagManager.initialize({\n    gtmId: process.env.REACT_APP_AGORA_GTM_ID\n  })\n}\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root'));\n  document.getElementById(\"room_join\")?.click();\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n\nif (isMobile()) {\n  const el = document.createElement('div');\n  document.body.appendChild(el);\n  \n  Eruda.init({\n    container: el,\n    tool: ['console', 'elements']\n  });\n}"],"sourceRoot":""}